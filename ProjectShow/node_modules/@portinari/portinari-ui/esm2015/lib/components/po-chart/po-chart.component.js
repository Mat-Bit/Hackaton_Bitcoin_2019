/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ComponentFactoryResolver, ElementRef, HostListener, IterableDiffers, ViewChild, ViewContainerRef } from '@angular/core';
import { Subject } from 'rxjs';
import { PoChartBaseComponent } from './po-chart-base.component';
import { PoChartColors } from './po-chart-colors.constant';
import { PoChartDonutComponent } from './po-chart-types/po-chart-donut/po-chart-donut.component';
import { PoChartPieComponent } from './po-chart-types/po-chart-pie/po-chart-pie.component';
import { PoChartType } from './enums/po-chart-type.enum';
/**
 * \@docsExtends PoChartBaseComponent
 *
 * \@example
 *
 * <example name="po-chart-basic" title="Portinari Chart Basic">
 *  <file name="sample-po-chart-basic/sample-po-chart-basic.component.html"> </file>
 *  <file name="sample-po-chart-basic/sample-po-chart-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-chart-labs" title="Portinari Chart Labs">
 *  <file name="sample-po-chart-labs/sample-po-chart-labs.component.html"> </file>
 *  <file name="sample-po-chart-labs/sample-po-chart-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-chart-coffee-ranking" title="Portinari Chart - Coffee Ranking">
 *  <file name="sample-po-chart-coffee-ranking/sample-po-chart-coffee-ranking.component.html"> </file>
 *  <file name="sample-po-chart-coffee-ranking/sample-po-chart-coffee-ranking.component.ts"> </file>
 * </example>
 */
export class PoChartComponent extends PoChartBaseComponent {
    /**
     * @param {?} changeDetector
     * @param {?} componentFactoryResolver
     * @param {?} differs
     */
    constructor(changeDetector, componentFactoryResolver, differs) {
        super();
        this.changeDetector = changeDetector;
        this.componentFactoryResolver = componentFactoryResolver;
        this.differs = differs;
        this.calculatedElement = false;
        this.initialized = false;
        this.windowResizeListener = new Subject();
        this.mappings = {
            [PoChartType.Pie]: PoChartPieComponent,
            [PoChartType.Donut]: PoChartDonutComponent
        };
        this.colors = [];
        this.onResize = (/**
         * @return {?}
         */
        () => this.windowResizeListener.next());
        this.differ = this.differs.find([]).create(null);
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.initialized = true;
    }
    /**
     * @return {?}
     */
    ngDoCheck() {
        /** @type {?} */
        const charWrapperWidth = this.chartWrapper.nativeElement.offsetWidth;
        // Permite que o chart seja calculado na primeira vez que o componente torna-se visÃ­vel,
        // evitando com isso, problemas com Tabs ou Divs que iniciem escondidas.
        if (charWrapperWidth && !this.calculatedElement && this.initialized) {
            this.calculatedElement = true;
            this.getSeriesColor();
            this.dynamicComponentSetting();
        }
        this.checkingForSerieChanges();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.removeWindowResizeListener();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.getSeriesColor();
    }
    /**
     * @return {?}
     */
    rebuildComponent() {
        if (this.componentRef) {
            this.componentRef.destroy();
            this.dynamicComponentSetting();
        }
    }
    /**
     * @private
     * @return {?}
     */
    checkingForSerieChanges() {
        if (this.componentRef && this.differ) {
            /** @type {?} */
            const changeSeries = this.differ.diff(this.series);
            if (changeSeries) {
                this.getSeriesColor();
                this.rebuildComponent();
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    createComponent() {
        /** @type {?} */
        const componentType = this.getComponentType(this.type);
        /** @type {?} */
        const factory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        this.componentRef = this.chartContainer.createComponent(factory);
        /** @type {?} */
        const instance = (/** @type {?} */ (this.componentRef.instance));
        this.setChartProperties(instance);
        return instance;
    }
    /**
     * @private
     * @return {?}
     */
    dynamicComponentSetting() {
        /** @type {?} */
        const instance = this.createComponent();
        this.setResizeListenerSubscribe(instance);
        this.changeDetector.detectChanges();
        this.setClickSubscribe(instance);
        this.setHoverSubscribe(instance);
    }
    /**
     * @private
     * @param {?} typeName
     * @return {?}
     */
    getComponentType(typeName) {
        return this.mappings[typeName];
    }
    /**
     * @private
     * @return {?}
     */
    getSeriesColor() {
        /** @type {?} */
        const colorsLength = PoChartColors.length - 1;
        if (!this.series) {
            return this.colors = PoChartColors[colorsLength];
        }
        /** @type {?} */
        const seriesLength = this.series.length - 1;
        if (seriesLength > colorsLength) {
            /** @type {?} */
            let colors = PoChartColors[colorsLength];
            // recupera o resultado da divisao entre tamanho das series e o numero de cores disponiveis
            /** @type {?} */
            const quantityDuplicates = seriesLength / colorsLength;
            for (let i = 1; i <= quantityDuplicates; i++) {
                colors = colors.concat(PoChartColors[colorsLength]);
            }
            return this.colors = colors;
        }
        return this.colors = PoChartColors[seriesLength];
    }
    /**
     * @private
     * @return {?}
     */
    removeWindowResizeListener() {
        if (this.onResize) {
            this.onResize = (/**
             * @return {?}
             */
            () => { });
        }
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setChartProperties(instance) {
        instance.chartHeader = this.chartHeader.nativeElement.offsetHeight;
        instance.chartLegend = this.chartLegend.nativeElement.offsetHeight;
        instance.chartWrapper = this.chartWrapper.nativeElement.offsetWidth;
        instance.colors = Array.isArray(this.colors) ? [...this.colors] : [];
        instance.height = this.height;
        instance.series = this.series || [];
        instance.type = this.type;
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setClickSubscribe(instance) {
        instance.onSerieClick.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            this.onSeriesClick(event);
        }));
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setHoverSubscribe(instance) {
        instance.onSerieHover.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            this.onSeriesHover(event);
        }));
    }
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    setResizeListenerSubscribe(instance) {
        this.windowResizeListener.subscribe((/**
         * @return {?}
         */
        () => {
            instance.chartHeader = this.chartHeader.nativeElement.offsetHeight;
            instance.chartLegend = this.chartLegend.nativeElement.offsetHeight;
            instance.chartWrapper = this.chartWrapper.nativeElement.offsetWidth;
        }));
    }
}
PoChartComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-chart',
                template: "<div #chartWrapper class=\"po-chart-wrapper\">\n  <div #chartHeader class=\"po-chart-header\">\n    <div class=\"po-chart-title\">{{ title }}</div>\n  </div>\n  <ng-template #chartContainer></ng-template>\n  <div #chartLegend class=\"po-chart-legend\">\n    <div class=\"po-chart-legend-container\">\n      <div class=\"po-chart-legend-item\" *ngFor=\"let serie of series; let i = index\">\n        <div class=\"po-chart-legend-square\" [style.background]=\"colors[i]\"></div>\n        <span class=\"po-chart-legend-text\">{{ serie.category }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n"
            }] }
];
/** @nocollapse */
PoChartComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ComponentFactoryResolver },
    { type: IterableDiffers }
];
PoChartComponent.propDecorators = {
    chartContainer: [{ type: ViewChild, args: ['chartContainer', { read: ViewContainerRef, static: true },] }],
    chartHeader: [{ type: ViewChild, args: ['chartHeader', { static: true },] }],
    chartLegend: [{ type: ViewChild, args: ['chartLegend', { static: true },] }],
    chartWrapper: [{ type: ViewChild, args: ['chartWrapper', { static: true },] }],
    onResize: [{ type: HostListener, args: ['window:resize',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.calculatedElement;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.windowResizeListener;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.mappings;
    /** @type {?} */
    PoChartComponent.prototype.colors;
    /** @type {?} */
    PoChartComponent.prototype.chartContainer;
    /** @type {?} */
    PoChartComponent.prototype.chartHeader;
    /** @type {?} */
    PoChartComponent.prototype.chartLegend;
    /** @type {?} */
    PoChartComponent.prototype.chartWrapper;
    /** @type {?} */
    PoChartComponent.prototype.onResize;
    /** @type {?} */
    PoChartComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.differs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLHdCQUF3QixFQUF5QixVQUFVLEVBQUUsWUFBWSxFQUM3SCxlQUFlLEVBQXFCLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV6RixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRS9CLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwwREFBMEQsQ0FBQztBQUVqRyxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxzREFBc0QsQ0FBQztBQUMzRixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCekQsTUFBTSxPQUFPLGdCQUFpQixTQUFRLG9CQUFvQjs7Ozs7O0lBeUJ4RCxZQUNTLGNBQWlDLEVBQ2hDLHdCQUFrRCxFQUNsRCxPQUF3QjtRQUM5QixLQUFLLEVBQUUsQ0FBQztRQUhILG1CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQUNoQyw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO1FBQ2xELFlBQU8sR0FBUCxPQUFPLENBQWlCO1FBMUIxQixzQkFBaUIsR0FBWSxLQUFLLENBQUM7UUFHbkMsZ0JBQVcsR0FBWSxLQUFLLENBQUM7UUFDN0IseUJBQW9CLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFFbkQsYUFBUSxHQUFHO1lBQ2pCLENBQUMsV0FBVyxDQUFD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Q0FBQztJQUNMLENBQUM7OztZQXRLRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLFVBQVU7Z0JBQ3BCLGdtQkFBd0M7YUFDekM7Ozs7WUFuQ3VCLGlCQUFpQjtZQUFhLHdCQUF3QjtZQUM1RSxlQUFlOzs7NkJBa0RkLFNBQVMsU0FBQyxnQkFBZ0IsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzBCQUdwRSxTQUFTLFNBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTswQkFDekMsU0FBUyxTQUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBQ3pDLFNBQVMsU0FBQyxjQUFjLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO3VCQUUxQyxZQUFZLFNBQUMsZUFBZTs7Ozs7OztJQXBCN0IsNkNBQTJDOzs7OztJQUMzQyx3Q0FBdUM7Ozs7O0lBQ3ZDLGtDQUFvQjs7Ozs7SUFDcEIsdUNBQXFDOzs7OztJQUNyQyxnREFBMkQ7Ozs7O0lBRTNELG9DQUdFOztJQUVGLGtDQUEyQjs7SUFFM0IsMENBQ2lDOztJQUVqQyx1Q0FBb0U7O0lBQ3BFLHVDQUFvRTs7SUFDcEUsd0NBQXNFOztJQUV0RSxvQ0FDaUQ7O0lBRy9DLDBDQUF3Qzs7Ozs7SUFDeEMsb0RBQTBEOzs7OztJQUMxRCxtQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRG9DaGVjaywgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLFxuICBJdGVyYWJsZURpZmZlcnMsIE9uRGVzdHJveSwgT25Jbml0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0QmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9DaGFydENvbG9ycyB9IGZyb20gJy4vcG8tY2hhcnQtY29sb3JzLmNvbnN0YW50JztcbmltcG9ydCB7IFBvQ2hhcnREb251dENvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtZG9udXQvcG8tY2hhcnQtZG9udXQuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtZHluYW1pYy10eXBlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0UGllQ29tcG9uZW50IH0gZnJvbSAnLi9wby1jaGFydC10eXBlcy9wby1jaGFydC1waWUvcG8tY2hhcnQtcGllLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgUG9DaGFydEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1jaGFydC1iYXNpY1wiIHRpdGxlPVwiUG9ydGluYXJpIENoYXJ0IEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1iYXNpYy9zYW1wbGUtcG8tY2hhcnQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2hhcnQtYmFzaWMvc2FtcGxlLXBvLWNoYXJ0LWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLWNoYXJ0LWxhYnNcIiB0aXRsZT1cIlBvcnRpbmFyaSBDaGFydCBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1sYWJzL3NhbXBsZS1wby1jaGFydC1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNoYXJ0LWxhYnMvc2FtcGxlLXBvLWNoYXJ0LWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2hhcnQtY29mZmVlLXJhbmtpbmdcIiB0aXRsZT1cIlBvcnRpbmFyaSBDaGFydCAtIENvZmZlZSBSYW5raW5nXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1jb2ZmZWUtcmFua2luZy9zYW1wbGUtcG8tY2hhcnQtY29mZmVlLXJhbmtpbmcuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2hhcnQtY29mZmVlLXJhbmtpbmcvc2FtcGxlLXBvLWNoYXJ0LWNvZmZlZS1yYW5raW5nLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLWNoYXJ0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWNoYXJ0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q29tcG9uZW50IGV4dGVuZHMgUG9DaGFydEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBEb0NoZWNrLCBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVkRWxlbWVudDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPHt9PjtcbiAgcHJpdmF0ZSBkaWZmZXI6IGFueTtcbiAgcHJpdmF0ZSBpbml0aWFsaXplZDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHdpbmRvd1Jlc2l6ZUxpc3RlbmVyOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIHByaXZhdGUgbWFwcGluZ3MgPSB7XG4gICAgW1BvQ2hhcnRUeXBlLlBpZV06IFBvQ2hhcnRQaWVDb21wb25lbnQsXG4gICAgW1BvQ2hhcnRUeXBlLkRvbnV0XTogUG9DaGFydERvbnV0Q29tcG9uZW50XG4gIH07XG5cbiAgY29sb3JzOiBBcnJheTxzdHJpbmc+ID0gW107XG5cbiAgQFZpZXdDaGlsZCgnY2hhcnRDb250YWluZXInLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYsIHN0YXRpYzogdHJ1ZSB9KVxuICBjaGFydENvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcblxuICBAVmlld0NoaWxkKCdjaGFydEhlYWRlcicsIHsgc3RhdGljOiB0cnVlIH0pIGNoYXJ0SGVhZGVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjaGFydExlZ2VuZCcsIHsgc3RhdGljOiB0cnVlIH0pIGNoYXJ0TGVnZW5kOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjaGFydFdyYXBwZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBjaGFydFdyYXBwZXI6IEVsZW1lbnRSZWY7XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpXG4gIG9uUmVzaXplID0gKCkgPT4gdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lci5uZXh0KClcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBkaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMpIHtcbiAgICAgIHN1cGVyKCk7XG5cbiAgICAgIHRoaXMuZGlmZmVyID0gdGhpcy5kaWZmZXJzLmZpbmQoW10pLmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcbiAgICBjb25zdCBjaGFyV3JhcHBlcldpZHRoID0gdGhpcy5jaGFydFdyYXBwZXIubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIC8vIFBlcm1pdGUgcXVlIG8gY2hhcnQgc2VqYSBjYWxjdWxhZG8gbmEgcHJpbWVpcmEgdmV6IHF1ZSBvIGNvbXBvbmVudGUgdG9ybmEtc2Ugdmlzw612ZWwsXG4gICAgLy8gZXZpdGFuZG8gY29tIGlzc28sIHByb2JsZW1hcyBjb20gVGFicyBvdSBEaXZzIHF1ZSBpbmljaWVtIGVzY29uZGlkYXMuXG4gICAgaWYgKGNoYXJXcmFwcGVyV2lkdGggJiYgIXRoaXMuY2FsY3VsYXRlZEVsZW1lbnQgJiYgdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhpcy5jYWxjdWxhdGVkRWxlbWVudCA9IHRydWU7XG4gICAgICB0aGlzLmdldFNlcmllc0NvbG9yKCk7XG4gICAgICB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jaGVja2luZ0ZvclNlcmllQ2hhbmdlcygpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5yZW1vdmVXaW5kb3dSZXNpemVMaXN0ZW5lcigpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5nZXRTZXJpZXNDb2xvcigpO1xuICB9XG5cbiAgcmVidWlsZENvbXBvbmVudCgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNldHRpbmcoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNraW5nRm9yU2VyaWVDaGFuZ2VzKCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZiAmJiB0aGlzLmRpZmZlcikge1xuICAgICAgY29uc3QgY2hhbmdlU2VyaWVzID0gdGhpcy5kaWZmZXIuZGlmZih0aGlzLnNlcmllcyk7XG4gICAgICBpZiAoY2hhbmdlU2VyaWVzKSB7XG4gICAgICAgIHRoaXMuZ2V0U2VyaWVzQ29sb3IoKTtcbiAgICAgICAgdGhpcy5yZWJ1aWxkQ29tcG9uZW50KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDb21wb25lbnQoKSB7XG4gICAgY29uc3QgY29tcG9uZW50VHlwZSA9IHRoaXMuZ2V0Q29tcG9uZW50VHlwZSh0aGlzLnR5cGUpO1xuICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjb21wb25lbnRUeXBlKTtcblxuICAgIHRoaXMuY29tcG9uZW50UmVmID0gdGhpcy5jaGFydENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XG5cbiAgICBjb25zdCBpbnN0YW5jZSA9IDxQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQ+dGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XG5cbiAgICB0aGlzLnNldENoYXJ0UHJvcGVydGllcyhpbnN0YW5jZSk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCkge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jcmVhdGVDb21wb25lbnQoKTtcblxuICAgIHRoaXMuc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMuc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRUeXBlKHR5cGVOYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMubWFwcGluZ3NbdHlwZU5hbWVdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXJpZXNDb2xvcigpIHtcbiAgICBjb25zdCBjb2xvcnNMZW5ndGggPSBQb0NoYXJ0Q29sb3JzLmxlbmd0aCAtIDE7XG5cbiAgICBpZiAoIXRoaXMuc2VyaWVzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb2xvcnMgPSBQb0NoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF07XG4gICAgfVxuXG4gICAgY29uc3Qgc2VyaWVzTGVuZ3RoID0gdGhpcy5zZXJpZXMubGVuZ3RoIC0gMTtcblxuICAgIGlmIChzZXJpZXNMZW5ndGggPiBjb2xvcnNMZW5ndGgpIHtcbiAgICAgIGxldCBjb2xvcnMgPSBQb0NoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF07XG5cbiAgICAgIC8vIHJlY3VwZXJhIG8gcmVzdWx0YWRvIGRhIGRpdmlzYW8gZW50cmUgdGFtYW5obyBkYXMgc2VyaWVzIGUgbyBudW1lcm8gZGUgY29yZXMgZGlzcG9uaXZlaXNcbiAgICAgIGNvbnN0IHF1YW50aXR5RHVwbGljYXRlcyA9IHNlcmllc0xlbmd0aCAvIGNvbG9yc0xlbmd0aDtcblxuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gcXVhbnRpdHlEdXBsaWNhdGVzOyBpKyspIHtcbiAgICAgICAgY29sb3JzID0gY29sb3JzLmNvbmNhdChQb0NoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jb2xvcnMgPSBjb2xvcnM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY29sb3JzID0gUG9DaGFydENvbG9yc1tzZXJpZXNMZW5ndGhdO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dSZXNpemVMaXN0ZW5lcigpIHtcbiAgICBpZiAodGhpcy5vblJlc2l6ZSkge1xuICAgICAgdGhpcy5vblJlc2l6ZSA9ICgpID0+IHt9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2hhcnRQcm9wZXJ0aWVzKGluc3RhbmNlOiBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQpIHtcbiAgICBpbnN0YW5jZS5jaGFydEhlYWRlciA9IHRoaXMuY2hhcnRIZWFkZXIubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgaW5zdGFuY2UuY2hhcnRMZWdlbmQgPSB0aGlzLmNoYXJ0TGVnZW5kLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgaW5zdGFuY2UuY29sb3JzID0gQXJyYXkuaXNBcnJheSh0aGlzLmNvbG9ycykgPyBbLi4udGhpcy5jb2xvcnNdIDogW107XG4gICAgaW5zdGFuY2UuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgaW5zdGFuY2Uuc2VyaWVzID0gdGhpcy5zZXJpZXMgfHwgW107XG4gICAgaW5zdGFuY2UudHlwZSA9IHRoaXMudHlwZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGluc3RhbmNlLm9uU2VyaWVDbGljay5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgdGhpcy5vblNlcmllc0NsaWNrKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGluc3RhbmNlLm9uU2VyaWVIb3Zlci5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgdGhpcy5vblNlcmllc0hvdmVyKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGluc3RhbmNlLmNoYXJ0SGVhZGVyID0gdGhpcy5jaGFydEhlYWRlci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGluc3RhbmNlLmNoYXJ0TGVnZW5kID0gdGhpcy5jaGFydExlZ2VuZC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgfSk7XG4gIH1cblxufVxuIl19