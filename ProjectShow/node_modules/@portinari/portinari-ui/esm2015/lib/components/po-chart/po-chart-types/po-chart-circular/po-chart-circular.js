/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { poChartAngleStepInterval, poChartCompleteCircle, poChartPadding, poChartStartAngle } from './po-chart-circular.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
import { PoSeriesTextBlack } from '../../po-chart-colors.constant';
/** @type {?} */
const poChartBlackColor = '#000000';
/** @type {?} */
const poChartWhiteColor = '#ffffff';
export class PoChartCircular extends PoChartDynamicTypeComponent {
    /**
     * @param {?} el
     * @param {?} ngZone
     * @param {?} renderer
     */
    constructor(el, ngZone, renderer) {
        super();
        this.el = el;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.chartItemsEndAngleList = [];
        this.svgPathElementsList = [];
        this.svgTextElementsList = [];
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set series(value) {
        this._series = this.getSeriesWithValue(value);
    }
    /**
     * @return {?}
     */
    get series() {
        return this._series;
    }
    /**
     * @private
     * @param {?} value
     * @param {?} totalValue
     * @return {?}
     */
    static calculateEndAngle(value, totalValue) {
        return value / totalValue * (Math.PI * 2);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.chartInitSetup();
        this.setEventListeners();
    }
    /**
     * @private
     * @return {?}
     */
    animationSetup() {
        this.chartItemStartAngle = poChartStartAngle;
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    }
    /**
     * @private
     * @return {?}
     */
    calculateAngleRadians() {
        this.series.forEach((/**
         * @param {?} serie
         * @param {?} index
         * @return {?}
         */
        (serie, index) => this.chartItemsEndAngleList[index] = PoChartCircular.calculateEndAngle(serie.value, this.totalValue)));
    }
    /**
     * @private
     * @param {?} angleCurrentPosition
     * @return {?}
     */
    calculateCurrentEndAngle(angleCurrentPosition) {
        /** @type {?} */
        const isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return (this.chartItemStartAngle + this.chartItemEndAngle) - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    }
    /**
     * @private
     * @return {?}
     */
    calculateSVGDimensions() {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.setInnerRadius();
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    changeTooltipPosition(event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        /** @type {?} */
        const tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', `${tooltipPositions.left}px`);
        this.renderer.setStyle(this.tooltipElement, 'top', `${tooltipPositions.top}px`);
    }
    /**
     * @private
     * @return {?}
     */
    chartInitSetup() {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    }
    /**
     * @private
     * @return {?}
     */
    checkingIfScrollsWithPoPage() {
        /** @type {?} */
        const poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    }
    /**
     * @private
     * @param {?} serie
     * @param {?} svgPathsWrapper
     * @return {?}
     */
    createPath(serie, svgPathsWrapper) {
        /** @type {?} */
        const svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setTooltipAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    }
    /**
     * @private
     * @return {?}
     */
    createPaths() {
        /** @type {?} */
        const svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        this.series.forEach((/**
         * @param {?} serie
         * @return {?}
         */
        serie => this.createPath(serie, svgPathsWrapper)));
    }
    /**
     * @private
     * @param {?} serie
     * @return {?}
     */
    createText(serie) {
        const { value } = serie;
        /** @type {?} */
        const svgG = this.renderer.createElement('svg:g', 'svg');
        /** @type {?} */
        const svgText = this.renderer.createElement('svg:text', 'svg');
        /** @type {?} */
        const fontSize = this.getFontSize();
        /** @type {?} */
        const textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(value, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setTooltipAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    }
    /**
     * @private
     * @return {?}
     */
    createTexts() {
        if (this.type === PoChartType.Donut) {
            this.series.forEach((/**
             * @param {?} serie
             * @return {?}
             */
            serie => this.createText(serie)));
        }
    }
    /**
     * @private
     * @return {?}
     */
    createSVGElements() {
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', `0 0 ${this.chartWrapper} ${this.centerX * 2}`);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', 'xMidYMin meet');
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', `${this.chartWrapper - poChartPadding * 2}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    }
    /**
     * @private
     * @param {?} path
     * @param {?} chartItemStartAngle
     * @param {?} chartItemEndAngle
     * @return {?}
     */
    drawPath(path, chartItemStartAngle, chartItemEndAngle) {
        /** @type {?} */
        const largeArc = chartItemEndAngle - chartItemStartAngle > Math.PI;
        /** @type {?} */
        const sinAlpha = Math.sin(chartItemStartAngle);
        /** @type {?} */
        const cosAlpha = Math.cos(chartItemStartAngle);
        /** @type {?} */
        const sinBeta = Math.sin(chartItemEndAngle);
        /** @type {?} */
        const cosBeta = Math.cos(chartItemEndAngle);
        /** @type {?} */
        const startX = this.centerX + cosAlpha * this.centerX;
        /** @type {?} */
        const startY = this.centerX + sinAlpha * this.centerX;
        /** @type {?} */
        const endX = this.centerX + cosBeta * this.centerX;
        /** @type {?} */
        const endY = this.centerX + sinBeta * this.centerX;
        /** @type {?} */
        const startInnerX = this.centerX + cosAlpha * this.innerRadius;
        /** @type {?} */
        const startInnerY = this.centerX + sinAlpha * this.innerRadius;
        /** @type {?} */
        const endInnerX = this.centerX + cosBeta * this.innerRadius;
        /** @type {?} */
        const endInnerY = this.centerX + sinBeta * this.innerRadius;
        /** @type {?} */
        const pathCoordinates = [
            'M', startX, startY,
            'A', this.centerX, this.centerX, 0, largeArc ? '1,1' : '0,1', endX, endY,
            'L', endInnerX, endInnerY,
            'A', this.innerRadius, this.innerRadius, 0, largeArc ? '1,0' : '0,0', startInnerX, startInnerY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', pathCoordinates);
    }
    /**
     * @private
     * @return {?}
     */
    drawPathInit() {
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            () => this.drawSeries()));
        }
    }
    /**
     * @private
     * @param {?=} currentSerieIndex
     * @param {?=} angleCurrentPosition
     * @return {?}
     */
    drawSeries(currentSerieIndex = 0, angleCurrentPosition = 0) {
        /** @type {?} */
        const isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        /** @type {?} */
        const isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    emitEventOnEnter(event) {
        this.onSerieHover.next(event);
    }
    /**
     * @private
     * @return {?}
     */
    getFontSize() {
        /** @type {?} */
        const fontSizePorcent = 0.04;
        /** @type {?} */
        const fontSize = fontSizePorcent * this.chartWrapper;
        return `${fontSize.toFixed(0)}px`;
    }
    /**
     * @private
     * @param {?} value
     * @param {?} totalValue
     * @return {?}
     */
    getPercentValue(value, totalValue) {
        /** @type {?} */
        const percentValue = (value / totalValue) * 100;
        // caso tiver mais que duas casas decimais, fixa até duas, ex: 10.6575 => 10.65
        // se não retorna o valor com parsefloat que remove casa decimal desencessaria, ex: 10.60 => 10.6
        /** @type {?} */
        const floatPercentValue = this.isMoreThanTwoDecimalsPlaces(percentValue) ?
            parseFloat(percentValue.toFixed(2)) : parseFloat((/** @type {?} */ (percentValue)));
        return String(floatPercentValue).replace('.', ',');
    }
    /**
     * @private
     * @param {?} series
     * @return {?}
     */
    getSeriesWithValue(series) {
        /** @type {?} */
        const newSeries = [];
        series.forEach((/**
         * @param {?} serie
         * @param {?} index
         * @return {?}
         */
        (serie, index) => {
            if (serie.value > 0) {
                newSeries.push(Object.assign({}, serie, { color: this.colors[index] }));
            }
        }));
        return newSeries;
    }
    /**
     * @private
     * @param {?} color
     * @return {?}
     */
    getTextColor(color) {
        if (PoSeriesTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    getTooltipValue(value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    }
    /**
     * @private
     * @param {?=} value
     * @return {?}
     */
    isMoreThanTwoDecimalsPlaces(value = 0) {
        const [, valueAfterDot] = value.toString().split('.');
        return valueAfterDot && valueAfterDot.length > 2;
    }
    /**
     * @private
     * @return {?}
     */
    onMouseClick() {
        /** @type {?} */
        const serieOnClick = { category: this.chartElementCategory, value: this.chartElementValue };
        this.onSerieClick.next(serieOnClick);
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    onMouseEnter(event) {
        this.tooltipElement = this.chartBody.nativeElement.lastChild;
        this.chartElementCategory = event.target.getAttributeNS(null, 'data-tooltip-category');
        this.chartElementValue = event.target.getAttributeNS(null, 'data-tooltip-value');
        this.tooltipText = event.target.getAttributeNS(null, 'data-tooltip-text');
        this.showTooltip();
        this.changeTooltipPosition(event);
        /** @type {?} */
        const serieOnEnter = { category: this.chartElementCategory, value: this.chartElementValue };
        this.emitEventOnEnter(serieOnEnter);
    }
    /**
     * @private
     * @return {?}
     */
    onWindowResize() {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', `${this.chartWrapper - poChartPadding * 2}`);
        this.renderer.setAttribute(this.svgElement, 'height', `${this.svgHeight}`);
    }
    /**
     * @private
     * @return {?}
     */
    removeTooltip() {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    }
    /**
     * @private
     * @return {?}
     */
    removeWindowResizeListener() {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    }
    /**
     * @private
     * @return {?}
     */
    removeWindowScrollListener() {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    }
    /**
     * @private
     * @return {?}
     */
    setEventListeners() {
        /** @type {?} */
        let chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach((/**
         * @param {?} serie
         * @return {?}
         */
        serie => {
            this.renderer.listen(serie, 'click', this.onMouseClick.bind(this));
            this.renderer.listen(serie, 'mouseenter', this.onMouseEnter.bind(this));
            this.renderer.listen(serie, 'mousemove', this.changeTooltipPosition.bind(this));
            this.renderer.listen(serie, 'mouseleave', this.removeTooltip.bind(this));
        }));
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    }
    /**
     * @private
     * @return {?}
     */
    setInnerRadius() {
        // tamanho da largua da serie proporcional ao grafico, o valor 0.27 fica proximo de 32px
        /** @type {?} */
        const serieWidth = 0.27;
        this.innerRadius = this.type === PoChartType.Pie ? 0 : this.centerX - (this.centerX * serieWidth);
    }
    /**
     * @private
     * @param {?} text
     * @param {?} startAngle
     * @param {?} endAngle
     * @return {?}
     */
    setTextProperties(text, startAngle, endAngle) {
        if (this.type === PoChartType.Donut) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            /** @type {?} */
            const centerAngle = (startAngle + endAngle) / 2;
            /** @type {?} */
            const textBox = text.getBBox();
            /** @type {?} */
            const halfTextWidth = textBox.width / 2;
            /** @type {?} */
            const halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferença entre tamanho do centro e radius interno
            /** @type {?} */
            const radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            /** @type {?} */
            const xCoordinate = radius * Math.cos(centerAngle) + this.centerX - (halfTextWidth);
            /** @type {?} */
            const yCoordinate = radius * Math.sin(centerAngle) + this.centerX + (halfTextHeight / 2);
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    }
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    setTooltipPositions(event) {
        /** @type {?} */
        const displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    }
    /**
     * @private
     * @param {?} svgElement
     * @param {?} serie
     * @return {?}
     */
    setTooltipAttributes(svgElement, serie) {
        const { value, category, tooltip } = serie;
        /** @type {?} */
        const tooltipValue = this.getTooltipValue(value);
        this.renderer.setAttribute(svgElement, 'data-tooltip-category', category);
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', `${value}`);
        this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || `${category}: ${tooltipValue}`);
    }
    /**
     * @private
     * @return {?}
     */
    showTooltip() {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype._series;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.animationRunning;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.chartItemEndAngle;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.chartItemStartAngle;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.chartItemsEndAngleList;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.svgPathElementsList;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.svgTextElementsList;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.el;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWNoYXJ0L3BvLWNoYXJ0LXR5cGVzL3BvLWNoYXJ0LWNpcmN1bGFyL3BvLWNoYXJ0LWNpcmN1bGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFFQSxPQUFPLEVBQ0wsd0JBQXdCLEVBQ3hCLHFCQUFxQixFQUNyQixjQUFjLEVBQ2QsaUJBQWlCLEVBQ2xCLE1BQU0sOEJBQThCLENBQUM7QUFDdEMsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDakYsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBSTdELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGdDQUFnQyxDQUFDOztNQUU3RCxpQkFBaUIsR0FBRyxTQUFTOztNQUM3QixpQkFBaUIsR0FBRyxTQUFTO0FBRW5DLE1BQU0sT0FBTyxlQUFnQixTQUFRLDJCQUEyQjs7Ozs7O0lBdUI5RCxZQUFvQixFQUFjLEVBQVUsTUFBYyxFQUFVLFFBQW1CO1FBQ3JGLEtBQUssRUFBRSxDQUFDO1FBRFUsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUFVLFdBQU0sR0FBTixNQUFNLENBQVE7UUFBVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBaEIvRSwyQkFBc0IsR0FBa0IsRUFBRSxDQUFDO1FBQzNDLHdCQUFtQixHQUFrQixFQUFFLENBQUM7UUFDeEMsd0JBQW1CLEdBQWtCLEVBQUUsQ0FBQztJQWdCaEQsQ0FBQzs7Ozs7SUFkRCxJQUFJLE1BQU0sQ0FBQyxLQUFtRDtRQUM1RCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNoRCxDQUFDOzs7O0lBRUQsSUFBSSxNQUFNO1FBQ1IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3RC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Q0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSx1QkFBdUIsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMxRSxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3pFLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLFVBQVUsRUFBRSxtQkFBbUIsRUFBRSxPQUFPLElBQUksR0FBRyxRQUFRLEtBQUssWUFBWSxFQUFFLENBQUMsQ0FBQztJQUN6RyxDQUFDOzs7OztJQUVPLFdBQVc7UUFDakIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxjQUFjLENBQUMsQ0FBQztJQUNqRSxDQUFDO0NBRUY7Ozs7OztJQTNZQyxrQ0FBOEQ7Ozs7O0lBRTlELDJDQUFrQzs7Ozs7SUFDbEMsNENBQWtDOzs7OztJQUNsQyw4Q0FBb0M7Ozs7O0lBQ3BDLGlEQUFtRDs7Ozs7SUFDbkQsOENBQWdEOzs7OztJQUNoRCw4Q0FBZ0Q7Ozs7O0lBY3BDLDZCQUFzQjs7Ozs7SUFBRSxpQ0FBc0I7Ozs7O0lBQUUsbUNBQTJCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRWxlbWVudFJlZiwgTmdab25lLCBPbkRlc3Ryb3ksIE9uSW5pdCwgUmVuZGVyZXIyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7XG4gIHBvQ2hhcnRBbmdsZVN0ZXBJbnRlcnZhbCxcbiAgcG9DaGFydENvbXBsZXRlQ2lyY2xlLFxuICBwb0NoYXJ0UGFkZGluZyxcbiAgcG9DaGFydFN0YXJ0QW5nbGVcbn0gZnJvbSAnLi9wby1jaGFydC1jaXJjdWxhci5jb25zdGFudCc7XG5pbXBvcnQgeyBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgfSBmcm9tICcuLi9wby1jaGFydC1keW5hbWljLXR5cGUuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2hhcnRUeXBlIH0gZnJvbSAnLi4vLi4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcbmltcG9ydCB7IFBvQ2lyY3VsYXJDaGFydFNlcmllcyB9IGZyb20gJy4vcG8tY2hhcnQtY2lyY3VsYXItc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0RvbnV0Q2hhcnRTZXJpZXMgfSBmcm9tICcuLi9wby1jaGFydC1kb251dC9wby1jaGFydC1kb251dC1zZXJpZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvUGllQ2hhcnRTZXJpZXMgfSBmcm9tICcuLi9wby1jaGFydC1waWUvcG8tY2hhcnQtcGllLXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9TZXJpZXNUZXh0QmxhY2sgfSBmcm9tICcuLi8uLi9wby1jaGFydC1jb2xvcnMuY29uc3RhbnQnO1xuXG5jb25zdCBwb0NoYXJ0QmxhY2tDb2xvciA9ICcjMDAwMDAwJztcbmNvbnN0IHBvQ2hhcnRXaGl0ZUNvbG9yID0gJyNmZmZmZmYnO1xuXG5leHBvcnQgY2xhc3MgUG9DaGFydENpcmN1bGFyIGV4dGVuZHMgUG9DaGFydER5bmFtaWNUeXBlQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95LCBPbkluaXQge1xuXG4gIHByaXZhdGUgX3NlcmllczogQXJyYXk8UG9QaWVDaGFydFNlcmllcyB8IFBvRG9udXRDaGFydFNlcmllcz47XG5cbiAgcHJpdmF0ZSBhbmltYXRpb25SdW5uaW5nOiBib29sZWFuO1xuICBwcml2YXRlIGNoYXJ0SXRlbUVuZEFuZ2xlOiBudW1iZXI7XG4gIHByaXZhdGUgY2hhcnRJdGVtU3RhcnRBbmdsZTogbnVtYmVyO1xuICBwcml2YXRlIGNoYXJ0SXRlbXNFbmRBbmdsZUxpc3Q6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgcHJpdmF0ZSBzdmdQYXRoRWxlbWVudHNMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG4gIHByaXZhdGUgc3ZnVGV4dEVsZW1lbnRzTGlzdDogQXJyYXk8c3RyaW5nPiA9IFtdO1xuXG4gIHNldCBzZXJpZXModmFsdWU6IEFycmF5PFBvUGllQ2hhcnRTZXJpZXMgfCBQb0RvbnV0Q2hhcnRTZXJpZXM+KSB7XG4gICAgdGhpcy5fc2VyaWVzID0gdGhpcy5nZXRTZXJpZXNXaXRoVmFsdWUodmFsdWUpO1xuICB9XG5cbiAgZ2V0IHNlcmllcygpIHtcbiAgICByZXR1cm4gdGhpcy5fc2VyaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgY2FsY3VsYXRlRW5kQW5nbGUodmFsdWU6IG51bWJlciwgdG90YWxWYWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdmFsdWUgLyB0b3RhbFZhbHVlICogKE1hdGguUEkgKiAyKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZWw6IEVsZW1lbnRSZWYsIHByaXZhdGUgbmdab25lOiBOZ1pvbmUsIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCk7XG4gICAgdGhpcy5yZW1vdmVXaW5kb3dTY3JvbGxMaXN0ZW5lcigpO1xuICAgIHRoaXMuYW5pbWF0aW9uUnVubmluZyA9IGZhbHNlO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5jaGFydEluaXRTZXR1cCgpO1xuICAgIHRoaXMuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHByaXZhdGUgYW5pbWF0aW9uU2V0dXAoKSB7XG4gICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlID0gcG9DaGFydFN0YXJ0QW5nbGU7XG4gICAgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZSA9IHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFswXTtcbiAgICB0aGlzLmFuaW1hdGlvblJ1bm5pbmcgPSB0cnVlO1xuICAgIHRoaXMuZHJhd1BhdGhJbml0KCk7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUFuZ2xlUmFkaWFucygpIHtcbiAgICB0aGlzLnNlcmllcy5mb3JFYWNoKChzZXJpZSwgaW5kZXgpID0+XG4gICAgICB0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbaW5kZXhdID0gUG9DaGFydENpcmN1bGFyLmNhbGN1bGF0ZUVuZEFuZ2xlKHNlcmllLnZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQ3VycmVudEVuZEFuZ2xlKGFuZ2xlQ3VycmVudFBvc2l0aW9uOiBudW1iZXIpIHtcbiAgICBjb25zdCBpc1NlcmllRHJhd0NvbXBsZXRlZCA9IHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uID4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZTtcblxuICAgIGlmIChpc1NlcmllRHJhd0NvbXBsZXRlZCkge1xuICAgICAgcmV0dXJuICh0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlKSAtIHBvQ2hhcnRDb21wbGV0ZUNpcmNsZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIGFuZ2xlQ3VycmVudFBvc2l0aW9uO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0NvbnRhaW5lckRpbWVuc2lvbnModGhpcy5jaGFydFdyYXBwZXIsIHRoaXMuY2hhcnRIZWFkZXIsIHRoaXMuY2hhcnRMZWdlbmQpO1xuXG4gICAgdGhpcy5zZXRJbm5lclJhZGl1cygpO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGFuZ2VUb29sdGlwUG9zaXRpb24oZXZlbnQ6IE1vdXNlRXZlbnQpIHtcbiAgICBpZiAodGhpcy50b29sdGlwRWxlbWVudCAmJiB0aGlzLnRvb2x0aXBFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygncG8taW52aXNpYmxlJykpIHtcbiAgICAgIHRoaXMuc2hvd1Rvb2x0aXAoKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b29sdGlwUG9zaXRpb25zID0gdGhpcy5zZXRUb29sdGlwUG9zaXRpb25zKGV2ZW50KTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudG9vbHRpcEVsZW1lbnQsICdsZWZ0JywgYCR7dG9vbHRpcFBvc2l0aW9ucy5sZWZ0fXB4YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnRvb2x0aXBFbGVtZW50LCAndG9wJywgYCR7dG9vbHRpcFBvc2l0aW9ucy50b3B9cHhgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2hhcnRJbml0U2V0dXAoKSB7XG4gICAgdGhpcy5jYWxjdWxhdGVTVkdEaW1lbnNpb25zKCk7XG4gICAgdGhpcy5jYWxjdWxhdGVUb3RhbFZhbHVlKCk7XG4gICAgdGhpcy5jYWxjdWxhdGVBbmdsZVJhZGlhbnMoKTtcbiAgICB0aGlzLmNyZWF0ZVNWR0VsZW1lbnRzKCk7XG4gICAgdGhpcy5hbmltYXRpb25TZXR1cCgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja2luZ0lmU2Nyb2xsc1dpdGhQb1BhZ2UoKSB7XG4gICAgY29uc3QgcG9QYWdlQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3BvLXBhZ2UtY29udGVudCcpO1xuXG4gICAgcmV0dXJuIHBvUGFnZUNvbnRlbnQubGVuZ3RoID8gcG9QYWdlQ29udGVudFswXSA6IHdpbmRvdztcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUGF0aChzZXJpZTogUG9DaXJjdWxhckNoYXJ0U2VyaWVzLCBzdmdQYXRoc1dyYXBwZXI6IGFueSkge1xuICAgIGNvbnN0IHN2Z1BhdGggPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpwYXRoJywgJ3N2ZycpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1BhdGgsICdmaWxsJywgc2VyaWUuY29sb3IpO1xuXG4gICAgdGhpcy5zZXRUb29sdGlwQXR0cmlidXRlcyhzdmdQYXRoLCBzZXJpZSk7XG5cbiAgICBzdmdQYXRoc1dyYXBwZXIuYXBwZW5kQ2hpbGQoc3ZnUGF0aCk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCwgc3ZnUGF0aHNXcmFwcGVyKTtcblxuICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1BhdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQYXRocygpIHtcbiAgICBjb25zdCBzdmdQYXRoc1dyYXBwZXIgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuXG4gICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVBhdGgoc2VyaWUsIHN2Z1BhdGhzV3JhcHBlcikpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0KHNlcmllOiBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMpIHtcbiAgICBjb25zdCB7IHZhbHVlIH0gPSBzZXJpZTtcblxuICAgIGNvbnN0IHN2Z0cgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpnJywgJ3N2ZycpO1xuICAgIGNvbnN0IHN2Z1RleHQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2Zzp0ZXh0JywgJ3N2ZycpO1xuXG4gICAgY29uc3QgZm9udFNpemUgPSB0aGlzLmdldEZvbnRTaXplKCk7XG4gICAgY29uc3QgdGV4dENvbG9yID0gdGhpcy5nZXRUZXh0Q29sb3Ioc2VyaWUuY29sb3IpO1xuXG4gICAgc3ZnVGV4dC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0UGVyY2VudFZhbHVlKHZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnIDtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdjbGFzcycsICdwby1wYXRoLWl0ZW0nKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnZmlsbCcsIHRleHRDb2xvcik7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2ZvbnQtc2l6ZScsIGZvbnRTaXplKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnZmlsbC1vcGFjaXR5JywgJzAnKTtcblxuICAgIHRoaXMuc2V0VG9vbHRpcEF0dHJpYnV0ZXMoc3ZnVGV4dCwgc2VyaWUpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChzdmdHLCBzdmdUZXh0KTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdHKTtcbiAgICB0aGlzLnN2Z1RleHRFbGVtZW50c0xpc3QucHVzaChzdmdUZXh0KTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVGV4dHMoKSB7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuRG9udXQpIHtcbiAgICAgIHRoaXMuc2VyaWVzLmZvckVhY2goc2VyaWUgPT4gdGhpcy5jcmVhdGVUZXh0KHNlcmllKSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTVkdFbGVtZW50cygpIHtcbiAgICB0aGlzLnN2Z0VsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ3N2ZzpzdmcnLCAnc3ZnJyk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd2aWV3Qm94JywgYDAgMCAke3RoaXMuY2hhcnRXcmFwcGVyfSAke3RoaXMuY2VudGVyWCAqIDJ9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAncHJlc2VydmVBc3BlY3RSYXRpbycsICd4TWlkWU1pbiBtZWV0Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnY2xhc3MnLCAncG8tY2hhcnQtc3ZnLWVsZW1lbnQnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd3aWR0aCcsIGAke3RoaXMuY2hhcnRXcmFwcGVyIC0gcG9DaGFydFBhZGRpbmcgKiAyfWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuXG4gICAgdGhpcy5zdmdDb250YWluZXIubmF0aXZlRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQpO1xuXG4gICAgdGhpcy5jcmVhdGVQYXRocygpO1xuICAgIHRoaXMuY3JlYXRlVGV4dHMoKTtcblxuICB9XG5cbiAgcHJpdmF0ZSBkcmF3UGF0aChwYXRoLCBjaGFydEl0ZW1TdGFydEFuZ2xlLCBjaGFydEl0ZW1FbmRBbmdsZSkge1xuICAgIGNvbnN0IGxhcmdlQXJjID0gY2hhcnRJdGVtRW5kQW5nbGUgLSBjaGFydEl0ZW1TdGFydEFuZ2xlID4gTWF0aC5QSTtcblxuICAgIGNvbnN0IHNpbkFscGhhID0gTWF0aC5zaW4oY2hhcnRJdGVtU3RhcnRBbmdsZSk7XG4gICAgY29uc3QgY29zQWxwaGEgPSBNYXRoLmNvcyhjaGFydEl0ZW1TdGFydEFuZ2xlKTtcblxuICAgIGNvbnN0IHNpbkJldGEgPSBNYXRoLnNpbihjaGFydEl0ZW1FbmRBbmdsZSk7XG4gICAgY29uc3QgY29zQmV0YSA9IE1hdGguY29zKGNoYXJ0SXRlbUVuZEFuZ2xlKTtcblxuICAgIGNvbnN0IHN0YXJ0WCA9IHRoaXMuY2VudGVyWCArIGNvc0FscGhhICogdGhpcy5jZW50ZXJYO1xuICAgIGNvbnN0IHN0YXJ0WSA9IHRoaXMuY2VudGVyWCArIHNpbkFscGhhICogdGhpcy5jZW50ZXJYO1xuXG4gICAgY29uc3QgZW5kWCA9IHRoaXMuY2VudGVyWCArIGNvc0JldGEgKiB0aGlzLmNlbnRlclg7XG4gICAgY29uc3QgZW5kWSA9IHRoaXMuY2VudGVyWCArIHNpbkJldGEgKiB0aGlzLmNlbnRlclg7XG5cbiAgICBjb25zdCBzdGFydElubmVyWCA9IHRoaXMuY2VudGVyWCArIGNvc0FscGhhICogdGhpcy5pbm5lclJhZGl1cztcbiAgICBjb25zdCBzdGFydElubmVyWSA9IHRoaXMuY2VudGVyWCArIHNpbkFscGhhICogdGhpcy5pbm5lclJhZGl1cztcblxuICAgIGNvbnN0IGVuZElubmVyWCA9IHRoaXMuY2VudGVyWCArIGNvc0JldGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuICAgIGNvbnN0IGVuZElubmVyWSA9IHRoaXMuY2VudGVyWCArIHNpbkJldGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuXG4gICAgY29uc3QgcGF0aENvb3JkaW5hdGVzID0gW1xuICAgICAgJ00nLCBzdGFydFgsIHN0YXJ0WSxcbiAgICAgICdBJywgdGhpcy5jZW50ZXJYLCB0aGlzLmNlbnRlclgsIDAsIGxhcmdlQXJjID8gJzEsMScgOiAnMCwxJywgZW5kWCwgZW5kWSxcbiAgICAgICdMJywgZW5kSW5uZXJYLCBlbmRJbm5lclksXG4gICAgICAnQScsIHRoaXMuaW5uZXJSYWRpdXMsIHRoaXMuaW5uZXJSYWRpdXMsIDAsIGxhcmdlQXJjID8gJzEsMCcgOiAnMCwwJywgc3RhcnRJbm5lclgsIHN0YXJ0SW5uZXJZLFxuICAgICAgJ1onXS5qb2luKCcgJyk7XG5cbiAgICByZXR1cm4gcGF0aC5zZXRBdHRyaWJ1dGUoJ2QnLCBwYXRoQ29vcmRpbmF0ZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBkcmF3UGF0aEluaXQoKSB7XG5cbiAgICBpZiAoIXRoaXMuYW5pbWF0aW9uUnVubmluZykge1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmRyYXdTZXJpZXMoKSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkcmF3U2VyaWVzKGN1cnJlbnRTZXJpZUluZGV4OiBudW1iZXIgPSAwLCBhbmdsZUN1cnJlbnRQb3NpdGlvbjogbnVtYmVyID0gMCkge1xuICAgIGNvbnN0IGlzRmluaXNoZWREcmF3aW5nQ3VycmVudFNlcmllcyA9IGFuZ2xlQ3VycmVudFBvc2l0aW9uID4gdGhpcy5jaGFydEl0ZW1FbmRBbmdsZTtcbiAgICBjb25zdCBpc0ZpbmlzaGVkRHJhd2luZ0FsbFNlcmllcyA9IGN1cnJlbnRTZXJpZUluZGV4ID09PSB0aGlzLnN2Z1BhdGhFbGVtZW50c0xpc3QubGVuZ3RoO1xuXG4gICAgaWYgKCBpc0ZpbmlzaGVkRHJhd2luZ0FsbFNlcmllcyApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIGlzRmluaXNoZWREcmF3aW5nQ3VycmVudFNlcmllcyApIHtcblxuICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlID0gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgdGhpcy5jaGFydEl0ZW1FbmRBbmdsZTtcbiAgICAgIGN1cnJlbnRTZXJpZUluZGV4Kys7XG4gICAgICB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlID0gdGhpcy5jaGFydEl0ZW1zRW5kQW5nbGVMaXN0W2N1cnJlbnRTZXJpZUluZGV4XTtcbiAgICAgIGFuZ2xlQ3VycmVudFBvc2l0aW9uID0gMDtcblxuICAgIH0gZWxzZSB7XG4gICAgICBhbmdsZUN1cnJlbnRQb3NpdGlvbiArPSBwb0NoYXJ0QW5nbGVTdGVwSW50ZXJ2YWw7XG5cbiAgICAgIHRoaXMuZHJhd1BhdGgoXG4gICAgICAgIHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb24pXG4gICAgICApO1xuXG4gICAgICB0aGlzLnNldFRleHRQcm9wZXJ0aWVzKFxuICAgICAgICB0aGlzLnN2Z1RleHRFbGVtZW50c0xpc3RbY3VycmVudFNlcmllSW5kZXhdLFxuICAgICAgICB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUsXG4gICAgICAgIHRoaXMuY2FsY3VsYXRlQ3VycmVudEVuZEFuZ2xlKGFuZ2xlQ3VycmVudFBvc2l0aW9uKSk7XG4gICAgfVxuXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLmRyYXdTZXJpZXMuYmluZCh0aGlzLCBjdXJyZW50U2VyaWVJbmRleCwgYW5nbGVDdXJyZW50UG9zaXRpb24pKTtcblxuICB9XG5cbiAgcHJpdmF0ZSBlbWl0RXZlbnRPbkVudGVyKGV2ZW50OiBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMpIHtcbiAgICB0aGlzLm9uU2VyaWVIb3Zlci5uZXh0KGV2ZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0Rm9udFNpemUoKSB7XG4gICAgY29uc3QgZm9udFNpemVQb3JjZW50ID0gMC4wNDtcblxuICAgIGNvbnN0IGZvbnRTaXplID0gZm9udFNpemVQb3JjZW50ICogdGhpcy5jaGFydFdyYXBwZXI7XG5cbiAgICByZXR1cm4gYCR7Zm9udFNpemUudG9GaXhlZCgwKX1weGA7XG4gIH1cblxuICBwcml2YXRlIGdldFBlcmNlbnRWYWx1ZSh2YWx1ZTogbnVtYmVyLCB0b3RhbFZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBwZXJjZW50VmFsdWUgPSAodmFsdWUgLyB0b3RhbFZhbHVlKSAqIDEwMDtcblxuICAgIC8vIGNhc28gdGl2ZXIgbWFpcyBxdWUgZHVhcyBjYXNhcyBkZWNpbWFpcywgZml4YSBhdMOpIGR1YXMsIGV4OiAxMC42NTc1ID0+IDEwLjY1XG4gICAgLy8gc2UgbsOjbyByZXRvcm5hIG8gdmFsb3IgY29tIHBhcnNlZmxvYXQgcXVlIHJlbW92ZSBjYXNhIGRlY2ltYWwgZGVzZW5jZXNzYXJpYSwgZXg6IDEwLjYwID0+IDEwLjZcbiAgICBjb25zdCBmbG9hdFBlcmNlbnRWYWx1ZSA9IHRoaXMuaXNNb3JlVGhhblR3b0RlY2ltYWxzUGxhY2VzKHBlcmNlbnRWYWx1ZSkgP1xuICAgICAgcGFyc2VGbG9hdChwZXJjZW50VmFsdWUudG9GaXhlZCgyKSkgOiBwYXJzZUZsb2F0KDxhbnk+IHBlcmNlbnRWYWx1ZSk7XG5cbiAgICByZXR1cm4gU3RyaW5nKGZsb2F0UGVyY2VudFZhbHVlKS5yZXBsYWNlKCcuJywgJywnKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U2VyaWVzV2l0aFZhbHVlKHNlcmllczogQXJyYXk8UG9DaXJjdWxhckNoYXJ0U2VyaWVzPikge1xuICAgIGNvbnN0IG5ld1NlcmllcyA9IFtdO1xuXG4gICAgc2VyaWVzLmZvckVhY2goKHNlcmllLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHNlcmllLnZhbHVlID4gMCkge1xuICAgICAgICBuZXdTZXJpZXMucHVzaCh7IC4uLnNlcmllLCBjb2xvcjogdGhpcy5jb2xvcnNbaW5kZXhdIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG5ld1NlcmllcztcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGV4dENvbG9yKGNvbG9yOiBzdHJpbmcpIHtcbiAgICBpZiAoUG9TZXJpZXNUZXh0QmxhY2suaW5jbHVkZXMoY29sb3IpKSB7XG4gICAgICByZXR1cm4gcG9DaGFydEJsYWNrQ29sb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBvQ2hhcnRXaGl0ZUNvbG9yO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb29sdGlwVmFsdWUodmFsdWU6IG51bWJlcikge1xuICAgIGlmICh0aGlzLnR5cGUgPT09IFBvQ2hhcnRUeXBlLlBpZSkge1xuICAgICAgcmV0dXJuIHZhbHVlLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuZ2V0UGVyY2VudFZhbHVlKHZhbHVlLCB0aGlzLnRvdGFsVmFsdWUpICsgJyUnO1xuICB9XG5cbiAgcHJpdmF0ZSBpc01vcmVUaGFuVHdvRGVjaW1hbHNQbGFjZXModmFsdWU6IG51bWJlciA9IDApIHtcbiAgICBjb25zdCBbLCB2YWx1ZUFmdGVyRG90IF0gPSB2YWx1ZS50b1N0cmluZygpLnNwbGl0KCcuJyk7XG5cbiAgICByZXR1cm4gdmFsdWVBZnRlckRvdCAmJiB2YWx1ZUFmdGVyRG90Lmxlbmd0aCA+IDI7XG4gIH1cblxuICBwcml2YXRlIG9uTW91c2VDbGljaygpIHtcbiAgICBjb25zdCBzZXJpZU9uQ2xpY2s6IFBvQ2lyY3VsYXJDaGFydFNlcmllcyA9IHsgY2F0ZWdvcnk6IHRoaXMuY2hhcnRFbGVtZW50Q2F0ZWdvcnksIHZhbHVlOiB0aGlzLmNoYXJ0RWxlbWVudFZhbHVlIH07XG5cbiAgICB0aGlzLm9uU2VyaWVDbGljay5uZXh0KHNlcmllT25DbGljayk7XG4gIH1cblxuICBwcml2YXRlIG9uTW91c2VFbnRlcihldmVudCkge1xuICAgIHRoaXMudG9vbHRpcEVsZW1lbnQgPSB0aGlzLmNoYXJ0Qm9keS5uYXRpdmVFbGVtZW50Lmxhc3RDaGlsZDtcbiAgICB0aGlzLmNoYXJ0RWxlbWVudENhdGVnb3J5ID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtY2F0ZWdvcnknKTtcbiAgICB0aGlzLmNoYXJ0RWxlbWVudFZhbHVlID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtdmFsdWUnKTtcbiAgICB0aGlzLnRvb2x0aXBUZXh0ID0gZXZlbnQudGFyZ2V0LmdldEF0dHJpYnV0ZU5TKG51bGwsICdkYXRhLXRvb2x0aXAtdGV4dCcpO1xuICAgIHRoaXMuc2hvd1Rvb2x0aXAoKTtcbiAgICB0aGlzLmNoYW5nZVRvb2x0aXBQb3NpdGlvbihldmVudCk7XG5cbiAgICBjb25zdCBzZXJpZU9uRW50ZXIgPSB7IGNhdGVnb3J5OiB0aGlzLmNoYXJ0RWxlbWVudENhdGVnb3J5LCB2YWx1ZTogdGhpcy5jaGFydEVsZW1lbnRWYWx1ZSB9O1xuICAgIHRoaXMuZW1pdEV2ZW50T25FbnRlcihzZXJpZU9uRW50ZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbldpbmRvd1Jlc2l6ZSgpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0RpbWVuc2lvbnMoKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICd3aWR0aCcsIGAke3RoaXMuY2hhcnRXcmFwcGVyIC0gcG9DaGFydFBhZGRpbmcgKiAyfWApO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ2hlaWdodCcsIGAke3RoaXMuc3ZnSGVpZ2h0fWApO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVUb29sdGlwKCkge1xuICAgIGlmICh0aGlzLnRvb2x0aXBFbGVtZW50KSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMudG9vbHRpcEVsZW1lbnQsICdwby1pbnZpc2libGUnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Jlc2l6ZUxpc3RlbmVyKCkge1xuICAgIGlmICh0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyKSB7XG4gICAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dTY3JvbGxMaXN0ZW5lcigpIHtcbiAgICBpZiAodGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lcikge1xuICAgICAgdGhpcy53aW5kb3dTY3JvbGxMaXN0ZW5lcigpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgbGV0IGNoYXJ0U2VyaWVzOiBBcnJheTxzdHJpbmc+ID0gdGhpcy5lbC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wby1wYXRoLWl0ZW0nKTtcbiAgICBjaGFydFNlcmllcyA9IEFycmF5LmZyb20oY2hhcnRTZXJpZXMpO1xuXG4gICAgY2hhcnRTZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB7XG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ2NsaWNrJywgdGhpcy5vbk1vdXNlQ2xpY2suYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ21vdXNlZW50ZXInLCB0aGlzLm9uTW91c2VFbnRlci5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2Vtb3ZlJywgdGhpcy5jaGFuZ2VUb29sdGlwUG9zaXRpb24uYmluZCh0aGlzKSk7XG4gICAgICB0aGlzLnJlbmRlcmVyLmxpc3RlbihzZXJpZSwgJ21vdXNlbGVhdmUnLCB0aGlzLnJlbW92ZVRvb2x0aXAuYmluZCh0aGlzKSk7XG4gICAgfSk7XG5cbiAgICB0aGlzLndpbmRvd1Jlc2l6ZUxpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4od2luZG93LCAncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5jaGVja2luZ0lmU2Nyb2xsc1dpdGhQb1BhZ2UoKSwgJ3Njcm9sbCcsIHRoaXMucmVtb3ZlVG9vbHRpcC5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SW5uZXJSYWRpdXMoKSB7XG4gICAgLy8gdGFtYW5obyBkYSBsYXJndWEgZGEgc2VyaWUgcHJvcG9yY2lvbmFsIGFvIGdyYWZpY28sIG8gdmFsb3IgMC4yNyBmaWNhIHByb3hpbW8gZGUgMzJweFxuICAgIGNvbnN0IHNlcmllV2lkdGggPSAwLjI3O1xuXG4gICAgdGhpcy5pbm5lclJhZGl1cyA9IHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuUGllID8gMCA6IHRoaXMuY2VudGVyWCAtICh0aGlzLmNlbnRlclggKiBzZXJpZVdpZHRoKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VGV4dFByb3BlcnRpZXModGV4dCwgc3RhcnRBbmdsZTogbnVtYmVyLCBlbmRBbmdsZTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuRG9udXQpIHtcbiAgICAgIC8vIHV0aWxpemFkbyBwYXJhIHJlY3VwZXJhciBvIGFuZ3VsbyBkbyBtZWlvLCBlbnRyZSBvIGluaWNpbyBlIGZpbSBwYXJhIGNlbnRyYWxpemFyIG8gdGV4dG9cbiAgICAgIGNvbnN0IGNlbnRlckFuZ2xlID0gKHN0YXJ0QW5nbGUgKyBlbmRBbmdsZSkgLyAyO1xuICAgICAgY29uc3QgdGV4dEJveCA9IHRleHQuZ2V0QkJveCgpO1xuXG4gICAgICBjb25zdCBoYWxmVGV4dFdpZHRoID0gdGV4dEJveC53aWR0aCAvIDI7XG4gICAgICBjb25zdCBoYWxmVGV4dEhlaWdodCA9IHRleHRCb3guaGVpZ2h0IC8gMjtcblxuICAgICAgLy8gcmFkaXVzIGludGVybm8gKGNpcmN1bG8gYnJhbmNvKSArIGEgbWV0YWRlIGRhIGRpZmVyZW7Dp2EgZW50cmUgdGFtYW5obyBkbyBjZW50cm8gZSByYWRpdXMgaW50ZXJub1xuICAgICAgY29uc3QgcmFkaXVzID0gdGhpcy5pbm5lclJhZGl1cyArICh0aGlzLmNlbnRlclggLSB0aGlzLmlubmVyUmFkaXVzKSAvIDI7XG5cbiAgICAgIGNvbnN0IHhDb29yZGluYXRlID0gcmFkaXVzICogTWF0aC5jb3MoY2VudGVyQW5nbGUpICsgdGhpcy5jZW50ZXJYIC0gKGhhbGZUZXh0V2lkdGgpO1xuICAgICAgY29uc3QgeUNvb3JkaW5hdGUgPSByYWRpdXMgKiBNYXRoLnNpbihjZW50ZXJBbmdsZSkgKyB0aGlzLmNlbnRlclggKyAoaGFsZlRleHRIZWlnaHQgLyAyKTtcblxuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ3gnLCB4Q29vcmRpbmF0ZSk7XG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgneScsIHlDb29yZGluYXRlKTtcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCdmaWxsLW9wYWNpdHknLCAnMScpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9vbHRpcFBvc2l0aW9ucyhldmVudDogTW91c2VFdmVudCkge1xuICAgIGNvbnN0IGRpc3BsYWNlbWVudDogbnVtYmVyID0gODtcblxuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiBldmVudC5jbGllbnRYIC0gdGhpcy50b29sdGlwRWxlbWVudC5vZmZzZXRXaWR0aCAvIDIsXG4gICAgICB0b3A6IGV2ZW50LmNsaWVudFkgLSB0aGlzLnRvb2x0aXBFbGVtZW50Lm9mZnNldEhlaWdodCAtIGRpc3BsYWNlbWVudFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHNldFRvb2x0aXBBdHRyaWJ1dGVzKHN2Z0VsZW1lbnQsIHNlcmllOiBQb1BpZUNoYXJ0U2VyaWVzIHwgUG9Eb251dENoYXJ0U2VyaWVzKSB7XG4gICAgY29uc3QgeyB2YWx1ZSwgY2F0ZWdvcnksIHRvb2x0aXAgfSA9IHNlcmllO1xuXG4gICAgY29uc3QgdG9vbHRpcFZhbHVlID0gdGhpcy5nZXRUb29sdGlwVmFsdWUodmFsdWUpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC1jYXRlZ29yeScsIGNhdGVnb3J5KTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLXZhbHVlJywgYCR7dmFsdWV9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnRWxlbWVudCwgJ2RhdGEtdG9vbHRpcC10ZXh0JywgdG9vbHRpcCB8fCBgJHtjYXRlZ29yeX06ICR7dG9vbHRpcFZhbHVlfWApO1xuICB9XG5cbiAgcHJpdmF0ZSBzaG93VG9vbHRpcCgpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMudG9vbHRpcEVsZW1lbnQsICdwby1pbnZpc2libGUnKTtcbiAgfVxuXG59XG4iXX0=