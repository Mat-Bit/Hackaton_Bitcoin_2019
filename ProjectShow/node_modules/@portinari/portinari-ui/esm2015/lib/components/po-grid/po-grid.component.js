/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, Input, Renderer2, ViewChild } from '@angular/core';
/**
 * \@description
 *
 * Componente grid.
 *
 * Ações / atalhos:
 *
 * - ARROW-UP: Navega para celula superior / Na ultima linha adiciona uma linha em branco no grid;
 * - ARROW-DOWN: Navega para celula inferior;
 * - ARROW-RIGHT: Navega para celula direita;
 * - ARROW-LEFT: Navega para celula esquerda;
 * - TAB: Navega para próxima celula;
 * - SHIFT+TAB: Navega para celula anterior;
 * - CTRL+DEL: Remove linha;
 * - DEL/BACKSPACE: Limpa celula;
 * - ENTER: Edita linha com valor atual/Confirma edição da celula;
 * - DOUBLE-CLICK: Edita linha com valor atual;
 * - ESC: Cancela edição da celula / Cancela inserção de linhas em branco;
 * - A..Z/0..9: Inicia edição com valor em branco.
 *
 * \@example
 *
 * <example name="po-grid-basic" title="Portinari Grid Basic">
 *  <file name="sample-po-grid-basic/sample-po-grid-basic.component.html"> </file>
 *  <file name="sample-po-grid-basic/sample-po-grid-basic.component.ts"> </file>
 * </example>
 */
export class PoGridComponent {
    /**
     * @param {?} changeDetectorRef
     * @param {?} elRef
     * @param {?} renderer
     */
    constructor(changeDetectorRef, elRef, renderer) {
        this.changeDetectorRef = changeDetectorRef;
        this.elRef = elRef;
        this.lastCell = '0-0';
        this.lastRow = 0;
        this.lastColumn = 0;
        this.currencyCell = '0-0';
        this.currencyRow = 0;
        this.currencyColumn = 0;
        this.logger = false;
        this.width = '100%';
        this.widporeeze = 0;
        this.widthActions = 0;
        this._columns = [];
        /**
         * \@description
         *
         * Ações disparadas quando uma linha do grid é manipulada.
         */
        this.rowActions = {};
        /**
         * Lista com os dados que serão exibidos no grid.
         */
        this.data = [];
        this.debounceResize();
        this.resizeListener = renderer.listen('window', 'resize', (/**
         * @param {?} event
         * @return {?}
         */
        (event) => {
            this.debounceResize();
        }));
    }
    /**
     * Colunas exibidas no grid.
     * @param {?} value
     * @return {?}
     */
    set columns(value) {
        this._columns = [...value];
        this._columns.forEach((/**
         * @param {?} column
         * @return {?}
         */
        column => {
            column.label = column.label || column.property;
            if (column.freeze === true) {
                column.cssWidth = `${column.width || 100}px`;
            }
            else {
                column.cssWidth = column.width ? `${column.width}px` : '100%';
            }
        }));
    }
    /**
     * @return {?}
     */
    get columns() {
        return this._columns.filter((/**
         * @param {?} column
         * @return {?}
         */
        column => column.freeze !== true && column.action !== true));
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.resizeListener) {
            this.resizeListener();
        }
    }
    /**
     * @private
     * @return {?}
     */
    debounceResize() {
        clearTimeout(this.timeoutResize);
        this.timeoutResize = setTimeout((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const widthTableWrapper = this.tableWrapper.nativeElement.offsetWidth;
            this.width = `${widthTableWrapper - (this.widporeeze + 8) - this.widthActions}px`;
        }), 100);
    }
    /**
     * @return {?}
     */
    get freezeColumns() {
        /** @type {?} */
        const freezeColumns = this._columns.filter((/**
         * @param {?} column
         * @return {?}
         */
        column => column.freeze === true));
        this.widporeeze = freezeColumns.reduce((/**
         * @param {?} prev
         * @param {?} current
         * @return {?}
         */
        (prev, current) => prev + (current.width || 100)), 0);
        return freezeColumns;
    }
    /**
     * @return {?}
     */
    get actionColumns() {
        /** @type {?} */
        const actionsColumns = this._columns.filter((/**
         * @param {?} column
         * @return {?}
         */
        column => column.action === true));
        this.widthActions = actionsColumns.length > 0 ? 56 : 0;
        return actionsColumns;
    }
    /**
     * @param {?} event
     * @param {?} row
     * @return {?}
     */
    cancelRow(event, row) {
        /** @type {?} */
        const el = event.path.find((/**
         * @param {?} element
         * @return {?}
         */
        element => element.id));
        if (!el) {
            return;
        }
        const [x] = (el.id).split('-');
        if (this.isEmptyRow(x)) {
            if (!this.removeRow(event, row)) {
                return;
            }
            this.currencyObj = Object.assign({}, this.data[this.currencyRow - 1]);
        }
        else {
            this.data[+x - 1] = Object.assign({}, this.currencyObj);
            setTimeout((/**
             * @return {?}
             */
            () => this.selectCell(this.currencyRow, this.currencyColumn)));
        }
    }
    /**
     * @param {?} event
     * @param {?} row
     * @return {?}
     */
    removeRow(event, row) {
        if (this.rowActions.beforeRemove && !this.rowActions.beforeRemove(Object.assign({}, row))) {
            return false;
        }
        /** @type {?} */
        const index = this.data.indexOf(row);
        this.data.splice(index, 1);
        this.changeDetectorRef.detectChanges();
        if ((this.data.length === 0) || (index === this.data.length)) {
            this.selectCell(this.currencyRow - 1, this.currencyColumn);
        }
        else {
            this.selectCell(this.currencyRow, this.currencyColumn);
        }
        return true;
    }
    /**
     * @param {?} event
     * @param {?} direction
     * @return {?}
     */
    tableKeydown(event, direction) {
        let [row, col] = event.target.id.split('-');
        row = +row;
        col = +col;
        /** @type {?} */
        let prow = +row;
        /** @type {?} */
        let pcol = +col;
        // event.preventDefault();
        // event.stopPropagation();
        // debugger;
        if (direction === 'down') {
            if (row <= this.data.length) {
                prow++;
            }
            if (row === this.data.length) {
                if (row === 0 || !this.isEmptyRow(row)) {
                    if (this.saveRow(row)) {
                        if (!this.insertRow()) {
                            return;
                        }
                    }
                    else {
                        return;
                    }
                }
                else {
                    prow--;
                }
            }
        }
        else if ((direction === 'up') && (row > 0)) {
            prow--;
        }
        else if ((direction === 'left') && (col > 0)) {
            pcol--;
        }
        else if ((direction === 'right') && (col < this._columns.length - 1)) {
            pcol++;
        }
        else if (direction === 'next') {
            if (col < this._columns.length - 1) {
                pcol++;
                event.preventDefault();
            }
            else if (row < this.data.length) {
                pcol = 0;
                prow++;
                event.preventDefault();
            }
        }
        else if (direction === 'prior') {
            if (col > 0) {
                pcol--;
                event.preventDefault();
            }
            else if (row > 0) {
                pcol = this._columns.length - 1;
                prow--;
                event.preventDefault();
            }
        }
        if (this.currencyCell === `${prow}-${pcol}`) {
            // console.log('vazou');
            return;
        }
        // debugger;
        if (prow !== this.currencyRow && row > 0 && this.data.length >= row) {
            if (!this.isEmptyRow(row)) {
                if (!this.saveRow(row)) {
                    return;
                }
            }
            else {
                if (!this.removeRow(event, row)) {
                    return;
                }
            }
        }
        if (this.currencyRow !== prow) {
            this.currencyObj = Object.assign({}, this.data[prow - 1]);
            // console.log('mudou de linha');
        }
        this.lastCell = event.target.id;
        this.lastRow = row;
        this.lastColumn = col;
        this.selectCell(prow, pcol);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    tableClick(event) {
        /** @type {?} */
        const el = event.path.find((/**
         * @param {?} element
         * @return {?}
         */
        element => element.id));
        if (!el) {
            this.selectCell(this.currencyRow, this.currencyColumn);
            return;
        }
        if (this.currencyCell === el.id) {
            return;
        }
        const [row, col] = (el.id).split('-');
        /** @type {?} */
        const prow = +row;
        /** @type {?} */
        const pcol = +col;
        if (prow !== this.currencyRow) {
            if (this.currencyRow > 0) {
                if (!this.isEmptyRow(this.currencyRow)) {
                    if (!this.saveRow(this.currencyRow)) {
                        this.selectCell(this.currencyRow, this.currencyColumn);
                        return;
                    }
                }
                else {
                    if (!this.removeRow(event, row)) {
                        return;
                    }
                }
            }
            this.currencyObj = Object.assign({}, this.data[prow - 1]);
            // console.log('>>>>>>> ', prow - 1);
        }
        this.lastCell = this.currencyCell;
        this.lastRow = this.currencyRow;
        this.lastColumn = this.currencyColumn;
        this.currencyCell = el.id;
        this.currencyRow = prow;
        this.currencyColumn = pcol;
    }
    /**
     * @param {?} row
     * @return {?}
     */
    saveRow(row) {
        // console.log(this.data[row - 1]);
        // console.log(this.data[row - 1]);
        /** @type {?} */
        const obj = this.data[row - 1];
        if (!Object.keys(obj).some((/**
         * @param {?} prop
         * @return {?}
         */
        prop => obj[prop] !== this.currencyObj[prop]))) {
            // console.log('tudo igual');
            return true;
        }
        if (this.rowActions.beforeSave && !this.rowActions.beforeSave(obj, this.currencyObj)) {
            return false;
        }
        /** @type {?} */
        const requireds = [];
        this.columns.forEach((/**
         * @param {?} column
         * @return {?}
         */
        column => {
            if (column.required === true && !obj[column.property]) {
                requireds.push(column.property);
            }
        }));
        return requireds.length === 0;
    }
    /**
     * @return {?}
     */
    insertRow() {
        /** @type {?} */
        const obj = {};
        if (this.rowActions.beforeInsert && !this.rowActions.beforeInsert(obj)) {
            return false;
        }
        // this.currencyObj = Object.assign({}, obj);
        this.data.push(obj);
        this.changeDetectorRef.detectChanges();
        return true;
    }
    /**
     * @param {?} row
     * @return {?}
     */
    isEmptyRow(row) {
        /** @type {?} */
        const obj = this.data[row - 1];
        if (!obj) { // title
            return false;
        }
        /** @type {?} */
        const filled = Object.keys(obj).some((/**
         * @param {?} property
         * @return {?}
         */
        property => obj[property]));
        return !filled;
    }
    /**
     * @param {?} row
     * @param {?} col
     * @return {?}
     */
    selectCell(row, col) {
        /** @type {?} */
        const nextCell = this.elRef.nativeElement.querySelector(`[id='${row}-${col}']`);
        if (nextCell) {
            this.currencyCell = `${row}-${col}`;
            this.currencyRow = row;
            this.currencyColumn = col;
            nextCell.focus();
        }
    }
}
PoGridComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-grid',
                template: "<div class=\"po-grid-wrapper po-grid-row-wrapper\" #wrapper>\n\n  <div *ngIf=\"logger\">\n    lastCell: {{ lastCell }} | currencyCell: {{ currencyCell }} <br>\n    lastRow: {{ lastRow }} | currencyRow: {{ currencyRow }} <br>\n    lastColumn: {{ lastColumn }} | currencyColumn: {{ currencyColumn }} <br>\n    <hr>\n    currencyObj: {{ currencyObj | json }}\n    <hr>\n  </div>\n\n  <div class=\"po-grid\">\n    <div class=\"po-grid-body\">\n      <div class=\"po-grid-row\"\n        #table\n        (keydown.arrowup)=\"tableKeydown($event, 'up')\"\n        (keydown.arrowdown)=\"tableKeydown($event, 'down')\"\n        (keydown.arrowleft)=\"tableKeydown($event, 'left')\"\n        (keydown.arrowright)=\"tableKeydown($event, 'right')\"\n        (keydown.tab)=\"tableKeydown($event, 'next')\"\n        (keydown.shift.tab)=\"tableKeydown($event, 'prior')\"\n        (click)=\"tableClick($event)\"\n        (contextmenu)=\"tableClick($event)\"\n        (dblclick)=\"tableClick($event)\">\n\n        <div class=\"po-grid-cell po-grid-cell-freeze\" *ngIf=\"freezeColumns.length > 0\">\n          <ng-container *ngTemplateOutlet=\"divFreezeColumns\"></ng-container>\n        </div>\n\n        <div class=\"po-grid-cell po-grid-cell-normal\"\n          [style.width]=\"width\" [style.max-width]=\"width\" [style.min-width]=\"width\">\n          <ng-container *ngTemplateOutlet=\"divColumns\"></ng-container>\n        </div>\n\n        <div class=\"po-grid-cell po-grid-cell-action\" *ngIf=\"actionColumns.length > 0\">\n          <ng-container *ngTemplateOutlet=\"divActionColumns\"></ng-container>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n  <!-- <div class=\"po-grid-footer-wrapper\">\n    <div class=\"po-grid-footer\">\n      <div class=\"links\"><a href=\"#\">RODAP\u00C9</a></div>\n    </div>\n  </div> -->\n\n</div>\n\n<!-- Coluna com as colunas congeladas -->\n<ng-template #divFreezeColumns>\n  <div class=\"po-grid po-grid-freeze\">\n    <div class=\"po-grid-header-group\">\n      <div class=\"po-grid-row\">\n        <po-grid-head *ngFor=\"let column of freezeColumns; index as i\" class=\"po-grid-title\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          p-freeze=\"true\"\n          p-position=\"{{ '0-' + i }}\"\n          [p-width]=\"column.width\"\n          [p-align]=\"column.align\"\n          [p-title]=\"column.label\">\n        </po-grid-head>\n      </div>\n    </div>\n\n    <div class=\"po-grid-body\">\n      <div class=\"po-grid-row\" *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\">\n        <po-grid-cell *ngFor=\"let column of freezeColumns; index as i\" class=\"po-grid-cell\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          p-freeze=\"true\"\n          [p-align]=\"column.align\"\n          [p-readonly]=\"column.readonly\"\n          [p-required]=\"column.required\"\n          p-position=\"{{ (j + 1) + '-' + i }}\"\n          [p-width]=\"column.width\"\n          [(p-value)]=\"row[column.property]\">\n        </po-grid-cell>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas congeladas -->\n\n<!-- Coluna com as colunas nornais -->\n<ng-template #divColumns>\n  <div class=\"po-grid po-grid-normal\">\n    <div class=\"po-grid-header-group\">\n      <div class=\"po-grid-row\">\n        <po-grid-head *ngFor=\"let column of columns; index as i\" class=\"po-grid-title\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          [p-align]=\"column.align\"\n          p-position=\"{{ '0-' + (i + freezeColumns.length) }}\"\n          [p-title]=\"column.label\"\n          [p-width]=\"column.width\">\n        </po-grid-head>\n      </div>\n    </div>\n\n    <div class=\"po-grid-body\">\n      <div class=\"po-grid-row\" *ngFor=\"let row of data; index as j\"\n        (keydown.control.delete)=\"removeRow($event, row)\"\n        (keydown.esc)=\"cancelRow($event, row)\">\n        <po-grid-cell *ngFor=\"let column of columns; index as i\" class=\"po-grid-cell\"\n          [style.width]=\"column.cssWidth\" [style.max-width]=\"column.cssWidth\" [style.min-width]=\"column.cssWidth\"\n          [p-align]=\"column.align\"\n          [p-readonly]=\"column.readonly\"\n          [p-required]=\"column.required\"\n          p-position=\"{{ (j + 1) + '-' + (i + freezeColumns.length) }}\"\n          [(p-value)]=\"row[column.property]\"\n          [p-width]=\"column.width\">\n        </po-grid-cell>\n      </div>\n    </div>\n  </div>\n</ng-template>\n<!-- FIM: Coluna com as colunas nornais -->\n\n<!-- Coluna com as colunas de a\u00E7\u00E3o -->\n<ng-template #divActionColumns>\n    <div class=\"po-grid po-grid-actions\">\n      <div class=\"po-grid-header-group\">\n        <div class=\"po-grid-row\">\n          <po-grid-head *ngFor=\"let column of actionColumns; index as i\" class=\"po-grid-title\"\n            p-position=\"{{ '0-' + (i + freezeColumns.length + columns.length) }}\"\n            [p-title]=\"column.label\"\n            [p-align]=\"column.align\">\n          </po-grid-head>\n        </div>\n      </div>\n\n      <div class=\"po-grid-body\">\n        <div class=\"po-grid-row\" *ngFor=\"let row of data; index as j\"\n          (keydown.control.delete)=\"removeRow($event, row)\"\n          (keydown.esc)=\"cancelRow($event, row)\">\n          <po-grid-cell-action *ngFor=\"let column of actionColumns; index as i\" class=\"po-grid-cell\"\n            p-position=\"{{ (j + 1) + '-' + (i + freezeColumns.length + columns.length) }}\"\n            [p-value]=\"row[column.property]\">\n          </po-grid-cell-action>\n        </div>\n      </div>\n    </div>\n  </ng-template>\n  <!-- FIM: Coluna com as colunas de a\u00E7\u00E3o -->\n",
                styles: [`
  .po-grid-wrapper {
    /* margin: 30px; */
    overflow: auto;
    border: 1px solid #eceeee;
    /* width: 100%; */
    /* border: 1px solid red; */
    /* display: table-cell; */
  }

  .po-grid {
    display: table;
    border-right: none;
    border-bottom: none;
  }

  .po-grid-cell-normal::-webkit-scrollbar, .po-grid-row-wrapper::-webkit-scrollbar {
    border-radius: 2px;
    height: 4px;
    opacity: 0.5;
    width: 4px;
  }
  .po-grid-cell-normal::-webkit-scrollbar-thumb, .po-grid-row-wrapper::-webkit-scrollbar-thumb {
    background-color: #0c9abe;
  }

  .po-grid .fixed {
    display: table;
  }

  .po-grid-header-group {
    display: table-header-group;
  }

  .po-grid-body {
    display: table-row-group;
  }

  .po-grid-row {
    display: table-row;
  }

  .po-grid-title, .po-grid-cell {
    display: table-cell;
    border: none;
  }

  .po-grid-cell-freeze {
    border-right: 2px solid #ceeaf2;
  }

  .po-grid-cell-action {
    color: blue;
    border-left: 2px solid #ceeaf2;
  }

  .po-grid-freeze, .po-grid-actions {
    width: 100%;
  }

  .po-grid-normal {
    width: 100%;
  }

  .po-grid-cell-normal {
    overflow: auto;
  }

  .po-grid-footer {
    display: table-footer-group;
  }

  .po-grid-footer-wrapper {
    border: 1px solid #eceeee;
    border-top: none;
  }
  `]
            }] }
];
/** @nocollapse */
PoGridComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: ElementRef },
    { type: Renderer2 }
];
PoGridComponent.propDecorators = {
    tableElement: [{ type: ViewChild, args: ['table', { static: true },] }],
    tableWrapper: [{ type: ViewChild, args: ['wrapper', { static: true },] }],
    rowActions: [{ type: Input, args: ['p-row-actions',] }],
    columns: [{ type: Input, args: ['p-columns',] }],
    data: [{ type: Input, args: ['p-data',] }]
};
if (false) {
    /** @type {?} */
    PoGridComponent.prototype.lastCell;
    /** @type {?} */
    PoGridComponent.prototype.lastRow;
    /** @type {?} */
    PoGridComponent.prototype.lastColumn;
    /** @type {?} */
    PoGridComponent.prototype.currencyCell;
    /** @type {?} */
    PoGridComponent.prototype.currencyRow;
    /** @type {?} */
    PoGridComponent.prototype.currencyColumn;
    /** @type {?} */
    PoGridComponent.prototype.currencyObj;
    /** @type {?} */
    PoGridComponent.prototype.logger;
    /** @type {?} */
    PoGridComponent.prototype.width;
    /** @type {?} */
    PoGridComponent.prototype.widporeeze;
    /** @type {?} */
    PoGridComponent.prototype.widthActions;
    /**
     * @type {?}
     * @private
     */
    PoGridComponent.prototype.resizeListener;
    /**
     * @type {?}
     * @private
     */
    PoGridComponent.prototype.timeoutResize;
    /** @type {?} */
    PoGridComponent.prototype.tableElement;
    /** @type {?} */
    PoGridComponent.prototype.tableWrapper;
    /**
     * @type {?}
     * @private
     */
    PoGridComponent.prototype._columns;
    /**
     * \@description
     *
     * Ações disparadas quando uma linha do grid é manipulada.
     * @type {?}
     */
    PoGridComponent.prototype.rowActions;
    /**
     * Lista com os dados que serão exibidos no grid.
     * @type {?}
     */
    PoGridComponent.prototype.data;
    /**
     * @type {?}
     * @private
     */
    PoGridComponent.prototype.changeDetectorRef;
    /**
     * @type {?}
     * @private
     */
    PoGridComponent.prototype.elRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ3JpZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWdyaWQvcG8tZ3JpZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBYSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUhqSCxNQUFNLE9BQU8sZUFBZTs7Ozs7O0lBd0QxQixZQUNVLGlCQUFvQyxFQUNwQyxLQUFpQixFQUN6QixRQUFtQjtRQUZYLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQXhEM0IsYUFBUSxHQUFXLEtBQUssQ0FBQztRQUN6QixZQUFPLEdBQVcsQ0FBQyxDQUFDO1FBQ3BCLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsaUJBQVksR0FBVyxLQUFLLENBQUM7UUFDN0IsZ0JBQVcsR0FBVyxDQUFDLENBQUM7UUFDeEIsbUJBQWMsR0FBVyxDQUFDLENBQUM7UUFHM0IsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUVmLFVBQUssR0FBRyxNQUFNLENBQUM7UUFDZixlQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsaUJBQVksR0FBRyxDQUFDLENBQUM7UUFRVCxhQUFRLEdBQUcsRUFBRSxDQUFDOzs7Ozs7UUFPRSxlQUFVLEdBQXFCLEVBQUUsQ0FBQzs7OztRQXlCekMsU0FBSSxHQUFlLEVBQUUsQ0FBQztRQU9yQyxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFdEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxRQUFROzs7O1FBQUUsQ0FBQyxLQUFVLEVBQUUsRUFBRTtZQUN2RSxJQUFJLENB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QixRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDbEI7SUFDSCxDQUFDOzs7WUE1WkYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxTQUFTO2dCQUNuQixzMkxBQXVDO3lCQUU5Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQTRFUjthQUNGOzs7O1lBaEhRLGlCQUFpQjtZQUFhLFVBQVU7WUFBb0IsU0FBUzs7OzJCQW9JM0UsU0FBUyxTQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7MkJBQ25DLFNBQVMsU0FBQyxTQUFTLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO3lCQVNyQyxLQUFLLFNBQUMsZUFBZTtzQkFLckIsS0FBSyxTQUFDLFdBQVc7bUJBb0JqQixLQUFLLFNBQUMsUUFBUTs7OztJQXBEZixtQ0FBeUI7O0lBQ3pCLGtDQUFvQjs7SUFDcEIscUNBQXVCOztJQUN2Qix1Q0FBNkI7O0lBQzdCLHNDQUF3Qjs7SUFDeEIseUNBQTJCOztJQUMzQixzQ0FBaUI7O0lBRWpCLGlDQUFlOztJQUVmLGdDQUFlOztJQUNmLHFDQUFlOztJQUNmLHVDQUFpQjs7Ozs7SUFFakIseUNBQW1DOzs7OztJQUNuQyx3Q0FBc0I7O0lBRXRCLHVDQUErRDs7SUFDL0QsdUNBQWlFOzs7OztJQUVqRSxtQ0FBc0I7Ozs7Ozs7SUFPdEIscUNBQTBEOzs7OztJQXlCMUQsK0JBQXVDOzs7OztJQUdyQyw0Q0FBNEM7Ozs7O0lBQzVDLGdDQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkRlc3Ryb3ksIFJlbmRlcmVyMiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFBvR3JpZFJvd0FjdGlvbnMgfSBmcm9tICcuL3BvLWdyaWQtcm93LWFjdGlvbnMuaW50ZXJmYWNlJztcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBDb21wb25lbnRlIGdyaWQuXG4gKlxuICogQcOnw7VlcyAvIGF0YWxob3M6XG4gKlxuICogLSBBUlJPVy1VUDogTmF2ZWdhIHBhcmEgY2VsdWxhIHN1cGVyaW9yIC8gTmEgdWx0aW1hIGxpbmhhIGFkaWNpb25hIHVtYSBsaW5oYSBlbSBicmFuY28gbm8gZ3JpZDtcbiAqIC0gQVJST1ctRE9XTjogTmF2ZWdhIHBhcmEgY2VsdWxhIGluZmVyaW9yO1xuICogLSBBUlJPVy1SSUdIVDogTmF2ZWdhIHBhcmEgY2VsdWxhIGRpcmVpdGE7XG4gKiAtIEFSUk9XLUxFRlQ6IE5hdmVnYSBwYXJhIGNlbHVsYSBlc3F1ZXJkYTtcbiAqIC0gVEFCOiBOYXZlZ2EgcGFyYSBwcsOzeGltYSBjZWx1bGE7XG4gKiAtIFNISUZUK1RBQjogTmF2ZWdhIHBhcmEgY2VsdWxhIGFudGVyaW9yO1xuICogLSBDVFJMK0RFTDogUmVtb3ZlIGxpbmhhO1xuICogLSBERUwvQkFDS1NQQUNFOiBMaW1wYSBjZWx1bGE7XG4gKiAtIEVOVEVSOiBFZGl0YSBsaW5oYSBjb20gdmFsb3IgYXR1YWwvQ29uZmlybWEgZWRpw6fDo28gZGEgY2VsdWxhO1xuICogLSBET1VCTEUtQ0xJQ0s6IEVkaXRhIGxpbmhhIGNvbSB2YWxvciBhdHVhbDtcbiAqIC0gRVNDOiBDYW5jZWxhIGVkacOnw6NvIGRhIGNlbHVsYSAvIENhbmNlbGEgaW5zZXLDp8OjbyBkZSBsaW5oYXMgZW0gYnJhbmNvO1xuICogLSBBLi5aLzAuLjk6IEluaWNpYSBlZGnDp8OjbyBjb20gdmFsb3IgZW0gYnJhbmNvLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLWdyaWQtYmFzaWNcIiB0aXRsZT1cIlBvcnRpbmFyaSBHcmlkIEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1ncmlkLWJhc2ljL3NhbXBsZS1wby1ncmlkLWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWdyaWQtYmFzaWMvc2FtcGxlLXBvLWdyaWQtYmFzaWMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tZ3JpZCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1ncmlkLmNvbXBvbmVudC5odG1sJyxcbiAgLy8gc3R5bGVVcmxzOiBbJy4vcG8tZ3JpZC5jb21wb25lbnQuY3NzJ11cbiAgc3R5bGVzOiBbYFxuICAucG8tZ3JpZC13cmFwcGVyIHtcbiAgICAvKiBtYXJnaW46IDMwcHg7ICovXG4gICAgb3ZlcmZsb3c6IGF1dG87XG4gICAgYm9yZGVyOiAxcHggc29saWQgI2VjZWVlZTtcbiAgICAvKiB3aWR0aDogMTAwJTsgKi9cbiAgICAvKiBib3JkZXI6IDFweCBzb2xpZCByZWQ7ICovXG4gICAgLyogZGlzcGxheTogdGFibGUtY2VsbDsgKi9cbiAgfVxuXG4gIC5wby1ncmlkIHtcbiAgICBkaXNwbGF5OiB0YWJsZTtcbiAgICBib3JkZXItcmlnaHQ6IG5vbmU7XG4gICAgYm9yZGVyLWJvdHRvbTogbm9uZTtcbiAgfVxuXG4gIC5wby1ncmlkLWNlbGwtbm9ybWFsOjotd2Via2l0LXNjcm9sbGJhciwgLnBvLWdyaWQtcm93LXdyYXBwZXI6Oi13ZWJraXQtc2Nyb2xsYmFyIHtcbiAgICBib3JkZXItcmFkaXVzOiAycHg7XG4gICAgaGVpZ2h0OiA0cHg7XG4gICAgb3BhY2l0eTogMC41O1xuICAgIHdpZHRoOiA0cHg7XG4gIH1cbiAgLnBvLWdyaWQtY2VsbC1ub3JtYWw6Oi13ZWJraXQtc2Nyb2xsYmFyLXRodW1iLCAucG8tZ3JpZC1yb3ctd3JhcHBlcjo6LXdlYmtpdC1zY3JvbGxiYXItdGh1bWIge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICMwYzlhYmU7XG4gIH1cblxuICAucG8tZ3JpZCAuZml4ZWQge1xuICAgIGRpc3BsYXk6IHRhYmxlO1xuICB9XG5cbiAgLnBvLWdyaWQtaGVhZGVyLWdyb3VwIHtcbiAgICBkaXNwbGF5OiB0YWJsZS1oZWFkZXItZ3JvdXA7XG4gIH1cblxuICAucG8tZ3JpZC1ib2R5IHtcbiAgICBkaXNwbGF5OiB0YWJsZS1yb3ctZ3JvdXA7XG4gIH1cblxuICAucG8tZ3JpZC1yb3cge1xuICAgIGRpc3BsYXk6IHRhYmxlLXJvdztcbiAgfVxuXG4gIC5wby1ncmlkLXRpdGxlLCAucG8tZ3JpZC1jZWxsIHtcbiAgICBkaXNwbGF5OiB0YWJsZS1jZWxsO1xuICAgIGJvcmRlcjogbm9uZTtcbiAgfVxuXG4gIC5wby1ncmlkLWNlbGwtZnJlZXplIHtcbiAgICBib3JkZXItcmlnaHQ6IDJweCBzb2xpZCAjY2VlYWYyO1xuICB9XG5cbiAgLnBvLWdyaWQtY2VsbC1hY3Rpb24ge1xuICAgIGNvbG9yOiBibHVlO1xuICAgIGJvcmRlci1sZWZ0OiAycHggc29saWQgI2NlZWFmMjtcbiAgfVxuXG4gIC5wby1ncmlkLWZyZWV6ZSwgLnBvLWdyaWQtYWN0aW9ucyB7XG4gICAgd2lkdGg6IDEwMCU7XG4gIH1cblxuICAucG8tZ3JpZC1ub3JtYWwge1xuICAgIHdpZHRoOiAxMDAlO1xuICB9XG5cbiAgLnBvLWdyaWQtY2VsbC1ub3JtYWwge1xuICAgIG92ZXJmbG93OiBhdXRvO1xuICB9XG5cbiAgLnBvLWdyaWQtZm9vdGVyIHtcbiAgICBkaXNwbGF5OiB0YWJsZS1mb290ZXItZ3JvdXA7XG4gIH1cblxuICAucG8tZ3JpZC1mb290ZXItd3JhcHBlciB7XG4gICAgYm9yZGVyOiAxcHggc29saWQgI2VjZWVlZTtcbiAgICBib3JkZXItdG9wOiBub25lO1xuICB9XG4gIGBdXG59KVxuZXhwb3J0IGNsYXNzIFBvR3JpZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG5cbiAgbGFzdENlbGw6IHN0cmluZyA9ICcwLTAnO1xuICBsYXN0Um93OiBudW1iZXIgPSAwO1xuICBsYXN0Q29sdW1uOiBudW1iZXIgPSAwO1xuICBjdXJyZW5jeUNlbGw6IHN0cmluZyA9ICcwLTAnO1xuICBjdXJyZW5jeVJvdzogbnVtYmVyID0gMDtcbiAgY3VycmVuY3lDb2x1bW46IG51bWJlciA9IDA7XG4gIGN1cnJlbmN5T2JqOiBhbnk7XG5cbiAgbG9nZ2VyID0gZmFsc2U7XG5cbiAgd2lkdGggPSAnMTAwJSc7XG4gIHdpZHBvcmVlemUgPSAwO1xuICB3aWR0aEFjdGlvbnMgPSAwO1xuXG4gIHByaXZhdGUgcmVzaXplTGlzdGVuZXI6ICgpID0+IHZvaWQ7XG4gIHByaXZhdGUgdGltZW91dFJlc2l6ZTtcblxuICBAVmlld0NoaWxkKCd0YWJsZScsIHsgc3RhdGljOiB0cnVlIH0pIHRhYmxlRWxlbWVudDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnd3JhcHBlcicsIHsgc3RhdGljOiB0cnVlIH0pIHRhYmxlV3JhcHBlcjogRWxlbWVudFJlZjtcblxuICBwcml2YXRlIF9jb2x1bW5zID0gW107XG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBBw6fDtWVzIGRpc3BhcmFkYXMgcXVhbmRvIHVtYSBsaW5oYSBkbyBncmlkIMOpIG1hbmlwdWxhZGEuXG4gICAqL1xuICBASW5wdXQoJ3Atcm93LWFjdGlvbnMnKSByb3dBY3Rpb25zOiBQb0dyaWRSb3dBY3Rpb25zID0ge307XG5cbiAgLyoqXG4gICAqIENvbHVuYXMgZXhpYmlkYXMgbm8gZ3JpZC5cbiAgICovXG4gIEBJbnB1dCgncC1jb2x1bW5zJykgc2V0IGNvbHVtbnModmFsdWU6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLl9jb2x1bW5zID0gWy4uLnZhbHVlXTtcblxuICAgIHRoaXMuX2NvbHVtbnMuZm9yRWFjaChjb2x1bW4gPT4ge1xuICAgICAgY29sdW1uLmxhYmVsID0gY29sdW1uLmxhYmVsIHx8IGNvbHVtbi5wcm9wZXJ0eTtcblxuICAgICAgaWYgKGNvbHVtbi5mcmVlemUgPT09IHRydWUpIHtcbiAgICAgICAgY29sdW1uLmNzc1dpZHRoID0gYCR7Y29sdW1uLndpZHRoIHx8IDEwMH1weGA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb2x1bW4uY3NzV2lkdGggPSBjb2x1bW4ud2lkdGggPyBgJHtjb2x1bW4ud2lkdGh9cHhgIDogJzEwMCUnO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIGdldCBjb2x1bW5zKCk6IEFycmF5PGFueT4ge1xuICAgIHJldHVybiB0aGlzLl9jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmZyZWV6ZSAhPT0gdHJ1ZSAmJiBjb2x1bW4uYWN0aW9uICE9PSB0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMaXN0YSBjb20gb3MgZGFkb3MgcXVlIHNlcsOjbyBleGliaWRvcyBubyBncmlkLlxuICAgKi9cbiAgQElucHV0KCdwLWRhdGEnKSBkYXRhOiBBcnJheTxhbnk+ID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBlbFJlZjogRWxlbWVudFJlZixcbiAgICByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG5cbiAgICB0aGlzLmRlYm91bmNlUmVzaXplKCk7XG5cbiAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyID0gcmVuZGVyZXIubGlzdGVuKCd3aW5kb3cnLCAncmVzaXplJywgKGV2ZW50OiBhbnkpID0+IHtcbiAgICAgIHRoaXMuZGVib3VuY2VSZXNpemUoKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnJlc2l6ZUxpc3RlbmVyKSB7XG4gICAgICB0aGlzLnJlc2l6ZUxpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkZWJvdW5jZVJlc2l6ZSgpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lb3V0UmVzaXplKTtcblxuICAgIHRoaXMudGltZW91dFJlc2l6ZSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgY29uc3Qgd2lkdGhUYWJsZVdyYXBwZXIgPSB0aGlzLnRhYmxlV3JhcHBlci5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgdGhpcy53aWR0aCA9IGAke3dpZHRoVGFibGVXcmFwcGVyIC0gKHRoaXMud2lkcG9yZWV6ZSArIDgpIC0gdGhpcy53aWR0aEFjdGlvbnN9cHhgO1xuICAgIH0sIDEwMCk7XG4gIH1cblxuICBnZXQgZnJlZXplQ29sdW1ucygpIHtcbiAgICBjb25zdCBmcmVlemVDb2x1bW5zID0gdGhpcy5fY29sdW1ucy5maWx0ZXIoY29sdW1uID0+IGNvbHVtbi5mcmVlemUgPT09IHRydWUpO1xuXG4gICAgdGhpcy53aWRwb3JlZXplID0gZnJlZXplQ29sdW1ucy5yZWR1Y2UoKHByZXYsIGN1cnJlbnQpID0+IHByZXYgKyAoY3VycmVudC53aWR0aCB8fCAxMDApLCAwKTtcblxuICAgIHJldHVybiBmcmVlemVDb2x1bW5zO1xuICB9XG5cbiAgZ2V0IGFjdGlvbkNvbHVtbnMoKSB7XG4gICAgY29uc3QgYWN0aW9uc0NvbHVtbnMgPSB0aGlzLl9jb2x1bW5zLmZpbHRlcihjb2x1bW4gPT4gY29sdW1uLmFjdGlvbiA9PT0gdHJ1ZSk7XG5cbiAgICB0aGlzLndpZHRoQWN0aW9ucyA9IGFjdGlvbnNDb2x1bW5zLmxlbmd0aCA+IDAgPyA1NiA6IDA7XG5cbiAgICByZXR1cm4gYWN0aW9uc0NvbHVtbnM7XG4gIH1cblxuICBjYW5jZWxSb3coZXZlbnQ6IGFueSwgcm93OiBhbnkpIHtcbiAgICBjb25zdCBlbCA9IGV2ZW50LnBhdGguZmluZChlbGVtZW50ID0+IGVsZW1lbnQuaWQpO1xuXG4gICAgaWYgKCFlbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IFt4XSA9IChlbC5pZCkuc3BsaXQoJy0nKTtcblxuICAgIGlmICh0aGlzLmlzRW1wdHlSb3coeCkpIHtcbiAgICAgIGlmICghdGhpcy5yZW1vdmVSb3coZXZlbnQsIHJvdykpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmN1cnJlbmN5T2JqID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kYXRhW3RoaXMuY3VycmVuY3lSb3cgLSAxXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGF0YVsreCAtIDFdID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jdXJyZW5jeU9iaik7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmN1cnJlbmN5Um93LCB0aGlzLmN1cnJlbmN5Q29sdW1uKSk7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlUm93KGV2ZW50OiBhbnksIHJvdzogYW55KTogYm9vbGVhbiB7XG5cbiAgICBpZiAodGhpcy5yb3dBY3Rpb25zLmJlZm9yZVJlbW92ZSAmJiAhdGhpcy5yb3dBY3Rpb25zLmJlZm9yZVJlbW92ZShPYmplY3QuYXNzaWduKHt9LCByb3cpKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5kYXRhLmluZGV4T2Yocm93KTtcblxuICAgIHRoaXMuZGF0YS5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICBpZiAoKHRoaXMuZGF0YS5sZW5ndGggPT09IDApIHx8IChpbmRleCA9PT0gdGhpcy5kYXRhLmxlbmd0aCkpIHtcbiAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmN1cnJlbmN5Um93IC0gMSwgdGhpcy5jdXJyZW5jeUNvbHVtbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0Q2VsbCh0aGlzLmN1cnJlbmN5Um93LCB0aGlzLmN1cnJlbmN5Q29sdW1uKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHRhYmxlS2V5ZG93bihldmVudDogYW55LCBkaXJlY3Rpb246IHN0cmluZykge1xuICAgIGxldCBbcm93LCBjb2xdID0gZXZlbnQudGFyZ2V0LmlkLnNwbGl0KCctJyk7XG4gICAgcm93ID0gK3JvdztcbiAgICBjb2wgPSArY29sO1xuICAgIGxldCBwcm93ID0gK3JvdztcbiAgICBsZXQgcGNvbCA9ICtjb2w7XG5cbiAgICAvLyBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIC8vIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgLy8gZGVidWdnZXI7XG4gICAgaWYgKGRpcmVjdGlvbiA9PT0gJ2Rvd24nKSB7XG4gICAgICBpZiAocm93IDw9IHRoaXMuZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgcHJvdysrO1xuICAgICAgfVxuXG4gICAgICBpZiAocm93ID09PSB0aGlzLmRhdGEubGVuZ3RoKSB7XG4gICAgICAgIGlmIChyb3cgPT09IDAgfHwgIXRoaXMuaXNFbXB0eVJvdyhyb3cpKSB7XG4gICAgICAgICAgaWYgKHRoaXMuc2F2ZVJvdyhyb3cpKSB7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5zZXJ0Um93KCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHByb3ctLTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoKGRpcmVjdGlvbiA9PT0gJ3VwJykgJiYgKHJvdyA+IDApKSB7XG4gICAgICBwcm93LS07XG4gICAgfSBlbHNlIGlmICgoZGlyZWN0aW9uID09PSAnbGVmdCcpICYmIChjb2wgPiAwKSkge1xuICAgICAgcGNvbC0tO1xuICAgIH0gZWxzZSBpZiAoKGRpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgJiYgKGNvbCA8IHRoaXMuX2NvbHVtbnMubGVuZ3RoIC0gMSkpIHtcbiAgICAgIHBjb2wrKztcbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ25leHQnKSB7XG4gICAgICBpZiAoY29sIDwgdGhpcy5fY29sdW1ucy5sZW5ndGggLSAxKSB7XG4gICAgICAgIHBjb2wrKztcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0gZWxzZSBpZiAocm93IDwgdGhpcy5kYXRhLmxlbmd0aCkge1xuICAgICAgICBwY29sID0gMDtcbiAgICAgICAgcHJvdysrO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAncHJpb3InKSB7XG4gICAgICBpZiAoY29sID4gMCkge1xuICAgICAgICBwY29sLS07XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9IGVsc2UgaWYgKHJvdyA+IDApIHtcbiAgICAgICAgcGNvbCA9IHRoaXMuX2NvbHVtbnMubGVuZ3RoIC0gMTtcbiAgICAgICAgcHJvdy0tO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmN1cnJlbmN5Q2VsbCA9PT0gYCR7cHJvd30tJHtwY29sfWApIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCd2YXpvdScpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIGRlYnVnZ2VyO1xuICAgIGlmIChwcm93ICE9PSB0aGlzLmN1cnJlbmN5Um93ICYmIHJvdyA+IDAgJiYgdGhpcy5kYXRhLmxlbmd0aCA+PSByb3cpIHtcbiAgICAgIGlmICghdGhpcy5pc0VtcHR5Um93KHJvdykpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNhdmVSb3cocm93KSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCF0aGlzLnJlbW92ZVJvdyhldmVudCwgcm93KSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmN1cnJlbmN5Um93ICE9PSBwcm93KSB7XG4gICAgICB0aGlzLmN1cnJlbmN5T2JqID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5kYXRhW3Byb3cgLSAxXSk7XG4gICAgICAvLyBjb25zb2xlLmxvZygnbXVkb3UgZGUgbGluaGEnKTtcbiAgICB9XG5cbiAgICB0aGlzLmxhc3RDZWxsID0gZXZlbnQudGFyZ2V0LmlkO1xuICAgIHRoaXMubGFzdFJvdyA9IHJvdztcbiAgICB0aGlzLmxhc3RDb2x1bW4gPSBjb2w7XG5cbiAgICB0aGlzLnNlbGVjdENlbGwocHJvdywgcGNvbCk7XG4gIH1cblxuICB0YWJsZUNsaWNrKGV2ZW50OiBhbnkpIHtcbiAgICBjb25zdCBlbCA9IGV2ZW50LnBhdGguZmluZChlbGVtZW50ID0+IGVsZW1lbnQuaWQpO1xuXG4gICAgaWYgKCFlbCkge1xuICAgICAgdGhpcy5zZWxlY3RDZWxsKHRoaXMuY3VycmVuY3lSb3csIHRoaXMuY3VycmVuY3lDb2x1bW4pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmN1cnJlbmN5Q2VsbCA9PT0gZWwuaWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBbcm93LCBjb2xdID0gKGVsLmlkKS5zcGxpdCgnLScpO1xuICAgIGNvbnN0IHByb3cgPSArcm93O1xuICAgIGNvbnN0IHBjb2wgPSArY29sO1xuXG4gICAgaWYgKHByb3cgIT09IHRoaXMuY3VycmVuY3lSb3cpIHtcbiAgICAgIGlmICh0aGlzLmN1cnJlbmN5Um93ID4gMCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNFbXB0eVJvdyh0aGlzLmN1cnJlbmN5Um93KSkge1xuICAgICAgICAgIGlmICghdGhpcy5zYXZlUm93KHRoaXMuY3VycmVuY3lSb3cpKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdENlbGwodGhpcy5jdXJyZW5jeVJvdywgdGhpcy5jdXJyZW5jeUNvbHVtbik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICghdGhpcy5yZW1vdmVSb3coZXZlbnQsIHJvdykpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdGhpcy5jdXJyZW5jeU9iaiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZGF0YVtwcm93IC0gMV0pO1xuICAgICAgLy8gY29uc29sZS5sb2coJz4+Pj4+Pj4gJywgcHJvdyAtIDEpO1xuICAgIH1cblxuICAgIHRoaXMubGFzdENlbGwgPSB0aGlzLmN1cnJlbmN5Q2VsbDtcbiAgICB0aGlzLmxhc3RSb3cgPSB0aGlzLmN1cnJlbmN5Um93O1xuICAgIHRoaXMubGFzdENvbHVtbiA9IHRoaXMuY3VycmVuY3lDb2x1bW47XG5cbiAgICB0aGlzLmN1cnJlbmN5Q2VsbCA9IGVsLmlkO1xuICAgIHRoaXMuY3VycmVuY3lSb3cgPSBwcm93O1xuICAgIHRoaXMuY3VycmVuY3lDb2x1bW4gPSBwY29sO1xuICB9XG5cbiAgc2F2ZVJvdyhyb3c6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZGF0YVtyb3cgLSAxXSk7XG5cbiAgICBjb25zdCBvYmogPSB0aGlzLmRhdGFbcm93IC0gMV07XG5cbiAgICBpZiAoIU9iamVjdC5rZXlzKG9iaikuc29tZShwcm9wID0+IG9ialtwcm9wXSAhPT0gdGhpcy5jdXJyZW5jeU9ialtwcm9wXSkpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCd0dWRvIGlndWFsJyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yb3dBY3Rpb25zLmJlZm9yZVNhdmUgJiYgIXRoaXMucm93QWN0aW9ucy5iZWZvcmVTYXZlKG9iaiwgdGhpcy5jdXJyZW5jeU9iaikpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCByZXF1aXJlZHMgPSBbXTtcblxuICAgIHRoaXMuY29sdW1ucy5mb3JFYWNoKGNvbHVtbiA9PiB7XG4gICAgICBpZiAoY29sdW1uLnJlcXVpcmVkID09PSB0cnVlICYmICFvYmpbY29sdW1uLnByb3BlcnR5XSkge1xuICAgICAgICByZXF1aXJlZHMucHVzaChjb2x1bW4ucHJvcGVydHkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHJlcXVpcmVkcy5sZW5ndGggPT09IDA7XG4gIH1cblxuICBpbnNlcnRSb3coKSB7XG4gICAgY29uc3Qgb2JqID0ge307XG5cbiAgICBpZiAodGhpcy5yb3dBY3Rpb25zLmJlZm9yZUluc2VydCAmJiAhdGhpcy5yb3dBY3Rpb25zLmJlZm9yZUluc2VydChvYmopKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gdGhpcy5jdXJyZW5jeU9iaiA9IE9iamVjdC5hc3NpZ24oe30sIG9iaik7XG5cbiAgICB0aGlzLmRhdGEucHVzaChvYmopO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpc0VtcHR5Um93KHJvdzogbnVtYmVyKSB7XG4gICAgY29uc3Qgb2JqID0gdGhpcy5kYXRhW3JvdyAtIDFdO1xuXG4gICAgaWYgKCFvYmopIHsgLy8gdGl0bGVcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBmaWxsZWQgPSBPYmplY3Qua2V5cyhvYmopLnNvbWUocHJvcGVydHkgPT4gb2JqW3Byb3BlcnR5XSk7XG5cbiAgICByZXR1cm4gIWZpbGxlZDtcbiAgfVxuXG4gIHNlbGVjdENlbGwocm93OiBudW1iZXIsIGNvbDogbnVtYmVyKSB7XG4gICAgY29uc3QgbmV4dENlbGwgPSB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihgW2lkPScke3Jvd30tJHtjb2x9J11gKTtcblxuICAgIGlmIChuZXh0Q2VsbCkge1xuICAgICAgdGhpcy5jdXJyZW5jeUNlbGwgPSBgJHtyb3d9LSR7Y29sfWA7XG4gICAgICB0aGlzLmN1cnJlbmN5Um93ID0gcm93O1xuICAgICAgdGhpcy5jdXJyZW5jeUNvbHVtbiA9IGNvbDtcbiAgICAgIG5leHRDZWxsLmZvY3VzKCk7XG4gICAgfVxuICB9XG59XG4iXX0=