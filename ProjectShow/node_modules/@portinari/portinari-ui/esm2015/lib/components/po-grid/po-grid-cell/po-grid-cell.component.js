/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, ElementRef, ChangeDetectorRef, Output, EventEmitter } from '@angular/core';
export class PoGridCellComponent {
    /**
     * @param {?} changeDetectorRef
     */
    constructor(changeDetectorRef) {
        this.changeDetectorRef = changeDetectorRef;
        this._value = '';
        this.edit = false;
        this.editValue = '';
        this.align = 'left';
        this.freeze = false;
        this.tabIndex = -1;
        this.position = '';
        this.readonly = false;
        this.required = false;
        this.valueChange = new EventEmitter();
    }
    /**
     * @param {?} value
     * @return {?}
     */
    set width(value) {
        this._width = value;
        if (this.freeze && !this._width) {
            this._width = 100;
        }
    }
    /**
     * @return {?}
     */
    get width() {
        return this._width ? `${this._width}px` : '100%';
    }
    // @Input('p-value') value?: string;
    /**
     * @param {?} value
     * @return {?}
     */
    set value(value) {
        this._value = value;
        this.valueChange.emit(this._value);
    }
    /**
     * @return {?}
     */
    get value() {
        return this._value;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onKeyDownContent(event) {
        // console.log('onKeyDownContent: ', event);
        // BACKSPACE / DELETE
        if ((!event.ctrlKey) && ((event.keyCode === 8) || (event.keyCode === 46))) {
            if (this.readonly) {
                return;
            }
            event.preventDefault();
            this.value = '';
            return;
        }
        // ENTER
        if (event.keyCode === 13) {
            event.preventDefault();
            this.onEditCell(this.value);
            return;
        }
        // A..Z - 0..9
        if ((event.keyCode >= 65) && (event.keyCode <= 90) || (event.keyCode >= 48) && (event.keyCode <= 57)) {
            event.preventDefault();
            this.onEditCell(event.key);
            return;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    dblclick(event) {
        // console.log('dblclick: ', event);
        event.preventDefault();
        this.onEditCell(this.value);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onBlurInput(event) {
        // console.log('onBlurInput: ', event);
        this.value = this.editValue;
        this.editValue = undefined;
        this.edit = false;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onKeyDownInput(event) {
        // console.log('onKeyDownInput: ', event);
        // ENTER
        if (event.keyCode === 13) {
            this.value = this.editValue;
            this.editValue = undefined;
            this.edit = false;
            this.changeDetectorRef.detectChanges();
            this.contentElement.nativeElement.focus();
        }
        // ESCAPE
        if (event.keyCode === 27) {
            this.editValue = undefined;
            this.edit = false;
            this.changeDetectorRef.detectChanges();
            this.contentElement.nativeElement.focus();
            event.stopPropagation();
        }
    }
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    onEditCell(value) {
        if (this.readonly) {
            return;
        }
        this.editValue = value;
        this.edit = true;
        this.changeDetectorRef.detectChanges();
        this.inputElement.nativeElement.focus();
    }
}
PoGridCellComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-grid-cell',
                template: "<div>\n  <ng-container *ngIf=\"edit; then input; else content\"></ng-container>\n\n  <ng-template #content>\n    <div #contentElement\n      [id]=\"position\"\n      class=\"po-grid-cell-content po-grid-cell-{{ align }} {{ !value && required ? 'po-grid-cell-required' : '' }}\"\n      (keydown)=\"onKeyDownContent($event)\"\n      tabindex=\"{{ readonly ? -1 : 0 }}\"\n      (dblclick)=dblclick($event)>\n      <span>{{ value || '&nbsp;' }}</span>\n    </div>\n  </ng-template>\n\n  <ng-template #input>\n    <input\n      [id]=\"position\"\n      #inputElement class=\"po-grid-cell-input\"\n      [(ngModel)]=\"editValue\"\n      (keydown.arrowup)=\"$event.stopPropagation()\"\n      (keydown.arrowdown)=\"$event.stopPropagation()\"\n      (keydown.arrowleft)=\"$event.stopPropagation()\"\n      (keydown.arrowright)=\"$event.stopPropagation()\"\n      (keydown)=\"onKeyDownInput($event)\"\n      (blur)=\"onBlurInput($event)\">\n\n    <!-- <po-input\n      #inputElement class=\"po-grid-cell-input\"\n      [(ngModel)]=\"editValue\"\n      (keydown)=\"onKeyDownInput($event)\"\n      (p-blur)=\"onBlurInput($event)\">\n    </po-input> -->\n  </ng-template>\n</div>\n\n",
                styles: [`
  .po-grid-cell-content, .po-grid-cell-input {
    border-bottom: 1px solid #eceeee;
    border-left: none;
    border-right: 1px solid #eceeee;
    border-top: none;
    font-family: NunitoSans;
    font-size: 14px;
    height: 44px;
    line-height: 1.71;
    margin: 0;
    overflow: hidden;
    padding: 10px 16px;
    text-align: left;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .po-grid-cell-center {
    text-align: center;
  }

  .po-grid-cell-right {
    text-align: right;
  }

  .po-grid-cell-content:focus {
    border: none;
    outline: 1px solid #0c9abe;
  }

  .po-grid-cell-required {
    border: 1px dashed red;
  }

  .po-grid-cell-input {
    border: 1px solid #0c9abe;
    box-shadow: 0px 0px 4px 4px rgba(0, 0, 0, 0.10);
    outline: none;
    position: relative;
    min-width: 100%;
    max-width: 100%;
    width: 100%;
  }
  `]
            }] }
];
/** @nocollapse */
PoGridCellComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
PoGridCellComponent.propDecorators = {
    align: [{ type: Input, args: ['p-align',] }],
    freeze: [{ type: Input, args: ['p-freeze',] }],
    tabIndex: [{ type: Input, args: ['p-tab-index',] }],
    position: [{ type: Input, args: ['p-position',] }],
    width: [{ type: Input, args: ['p-width',] }],
    readonly: [{ type: Input, args: ['p-readonly',] }],
    required: [{ type: Input, args: ['p-required',] }],
    valueChange: [{ type: Output, args: ['p-valueChange',] }],
    value: [{ type: Input, args: ['p-value',] }],
    inputElement: [{ type: ViewChild, args: ['inputElement', { static: true },] }],
    contentElement: [{ type: ViewChild, args: ['contentElement', { static: true },] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoGridCellComponent.prototype._width;
    /** @type {?} */
    PoGridCellComponent.prototype._value;
    /** @type {?} */
    PoGridCellComponent.prototype.edit;
    /** @type {?} */
    PoGridCellComponent.prototype.editValue;
    /** @type {?} */
    PoGridCellComponent.prototype.align;
    /** @type {?} */
    PoGridCellComponent.prototype.freeze;
    /** @type {?} */
    PoGridCellComponent.prototype.tabIndex;
    /** @type {?} */
    PoGridCellComponent.prototype.position;
    /** @type {?} */
    PoGridCellComponent.prototype.readonly;
    /** @type {?} */
    PoGridCellComponent.prototype.required;
    /** @type {?} */
    PoGridCellComponent.prototype.valueChange;
    /** @type {?} */
    PoGridCellComponent.prototype.inputElement;
    /** @type {?} */
    PoGridCellComponent.prototype.contentElement;
    /**
     * @type {?}
     * @private
     */
    PoGridCellComponent.prototype.changeDetectorRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZ3JpZC1jZWxsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZ3JpZC9wby1ncmlkLWNlbGwvcG8tZ3JpZC1jZWxsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxpQkFBaUIsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBb0RqSCxNQUFNLE9BQU8sbUJBQW1COzs7O0lBNEM5QixZQUFvQixpQkFBb0M7UUFBcEMsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQXhDeEQsV0FBTSxHQUFRLEVBQUUsQ0FBQztRQUNqQixTQUFJLEdBQVksS0FBSyxDQUFDO1FBQ3RCLGNBQVMsR0FBVyxFQUFFLENBQUM7UUFFTCxVQUFLLEdBQVksTUFBTSxDQUFDO1FBRXZCLFdBQU0sR0FBYSxLQUFLLENBQUM7UUFFdEIsYUFBUSxHQUFZLENBQUMsQ0FBQyxDQUFDO1FBRXhCLGFBQVEsR0FBWSxFQUFFLENBQUM7UUFhdkIsYUFBUSxHQUFhLEtBQUssQ0FBQztRQUUzQixhQUFRLEdBQWEsS0FBSyxDQUFDO1FBRXZCLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQWFILENBQUM7Ozs7O0lBNUI3RCxJQUFzQixLQUFLLENBQUMsS0FBd0I7UUFDbEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFFcEIsSUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUMvQixJQUFJLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztTQUNuQjtJQUNILENBQUM7Ozs7SUFDRCxJQUFJLEtBQUs7UUFDUCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdB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Q0FBZ0Q7O0lBRWhELDBDQUErRDs7SUFVL0QsMkNBQXNFOztJQUN0RSw2Q0FBMEU7Ozs7O0lBRTlELGdEQUE0QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgQ2hhbmdlRGV0ZWN0b3JSZWYsIE91dHB1dCwgRXZlbnRFbWl0dGVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLWdyaWQtY2VsbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1ncmlkLWNlbGwuY29tcG9uZW50Lmh0bWwnLFxuICAvLyBzdHlsZVVybHM6IFsnLi9wby1ncmlkLWNlbGwuY29tcG9uZW50LmNzcyddLFxuICBzdHlsZXM6IFtgXG4gIC5wby1ncmlkLWNlbGwtY29udGVudCwgLnBvLWdyaWQtY2VsbC1pbnB1dCB7XG4gICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlY2VlZWU7XG4gICAgYm9yZGVyLWxlZnQ6IG5vbmU7XG4gICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgI2VjZWVlZTtcbiAgICBib3JkZXItdG9wOiBub25lO1xuICAgIGZvbnQtZmFtaWx5OiBOdW5pdG9TYW5zO1xuICAgIGZvbnQtc2l6ZTogMTRweDtcbiAgICBoZWlnaHQ6IDQ0cHg7XG4gICAgbGluZS1oZWlnaHQ6IDEuNzE7XG4gICAgbWFyZ2luOiAwO1xuICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgcGFkZGluZzogMTBweCAxNnB4O1xuICAgIHRleHQtYWxpZ246IGxlZnQ7XG4gICAgdGV4dC1vdmVyZmxvdzogZWxsaXBzaXM7XG4gICAgd2hpdGUtc3BhY2U6IG5vd3JhcDtcbiAgfVxuXG4gIC5wby1ncmlkLWNlbGwtY2VudGVyIHtcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gIH1cblxuICAucG8tZ3JpZC1jZWxsLXJpZ2h0IHtcbiAgICB0ZXh0LWFsaWduOiByaWdodDtcbiAgfVxuXG4gIC5wby1ncmlkLWNlbGwtY29udGVudDpmb2N1cyB7XG4gICAgYm9yZGVyOiBub25lO1xuICAgIG91dGxpbmU6IDFweCBzb2xpZCAjMGM5YWJlO1xuICB9XG5cbiAgLnBvLWdyaWQtY2VsbC1yZXF1aXJlZCB7XG4gICAgYm9yZGVyOiAxcHggZGFzaGVkIHJlZDtcbiAgfVxuXG4gIC5wby1ncmlkLWNlbGwtaW5wdXQge1xuICAgIGJvcmRlcjogMXB4IHNvbGlkICMwYzlhYmU7XG4gICAgYm94LXNoYWRvdzogMHB4IDBweCA0cHggNHB4IHJnYmEoMCwgMCwgMCwgMC4xMCk7XG4gICAgb3V0bGluZTogbm9uZTtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgbWluLXdpZHRoOiAxMDAlO1xuICAgIG1heC13aWR0aDogMTAwJTtcbiAgICB3aWR0aDogMTAwJTtcbiAgfVxuICBgXVxufSlcbmV4cG9ydCBjbGFzcyBQb0dyaWRDZWxsQ29tcG9uZW50IHtcblxuICBwcml2YXRlIF93aWR0aDogKHN0cmluZyB8IG51bWJlcik7XG5cbiAgX3ZhbHVlOiBhbnkgPSAnJztcbiAgZWRpdDogYm9vbGVhbiA9IGZhbHNlO1xuICBlZGl0VmFsdWU6IHN0cmluZyA9ICcnO1xuXG4gIEBJbnB1dCgncC1hbGlnbicpIGFsaWduPzogc3RyaW5nID0gJ2xlZnQnO1xuXG4gIEBJbnB1dCgncC1mcmVlemUnKSBmcmVlemU/OiBib29sZWFuID0gZmFsc2U7XG5cbiAgQElucHV0KCdwLXRhYi1pbmRleCcpIHRhYkluZGV4PzogbnVtYmVyID0gLTE7XG5cbiAgQElucHV0KCdwLXBvc2l0aW9uJykgcG9zaXRpb24/OiBzdHJpbmcgPSAnJztcblxuICBASW5wdXQoJ3Atd2lkdGgnKSBzZXQgd2lkdGgodmFsdWU6IChzdHJpbmcgfCBudW1iZXIpKSB7XG4gICAgdGhpcy5fd2lkdGggPSB2YWx1ZTtcblxuICAgIGlmICh0aGlzLmZyZWV6ZSAmJiAhdGhpcy5fd2lkdGgpIHtcbiAgICAgIHRoaXMuX3dpZHRoID0gMTAwO1xuICAgIH1cbiAgfVxuICBnZXQgd2lkdGgoKTogKHN0cmluZyB8IG51bWJlcikge1xuICAgIHJldHVybiB0aGlzLl93aWR0aCA/IGAke3RoaXMuX3dpZHRofXB4YCA6ICcxMDAlJztcbiAgfVxuXG4gIEBJbnB1dCgncC1yZWFkb25seScpIHJlYWRvbmx5PzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBJbnB1dCgncC1yZXF1aXJlZCcpIHJlcXVpcmVkPzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIEBPdXRwdXQoJ3AtdmFsdWVDaGFuZ2UnKSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICAvLyBASW5wdXQoJ3AtdmFsdWUnKSB2YWx1ZT86IHN0cmluZztcbiAgQElucHV0KCdwLXZhbHVlJykgc2V0IHZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLl92YWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh0aGlzLl92YWx1ZSk7XG4gIH1cbiAgZ2V0IHZhbHVlKCk6IGFueSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZhbHVlO1xuICB9XG5cbiAgQFZpZXdDaGlsZCgnaW5wdXRFbGVtZW50JywgeyBzdGF0aWM6IHRydWUgfSkgaW5wdXRFbGVtZW50OiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjb250ZW50RWxlbWVudCcsIHsgc3RhdGljOiB0cnVlIH0pIGNvbnRlbnRFbGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmKSB7IH1cblxuICBvbktleURvd25Db250ZW50KGV2ZW50OiBhbnkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnb25LZXlEb3duQ29udGVudDogJywgZXZlbnQpO1xuXG4gICAgLy8gQkFDS1NQQUNFIC8gREVMRVRFXG4gICAgaWYgKCghZXZlbnQuY3RybEtleSkgJiYgKChldmVudC5rZXlDb2RlID09PSA4KSB8fCAoZXZlbnQua2V5Q29kZSA9PT0gNDYpKSkge1xuXG4gICAgICBpZiAodGhpcy5yZWFkb25seSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLnZhbHVlID0gJyc7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRU5URVJcbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLm9uRWRpdENlbGwodGhpcy52YWx1ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gQS4uWiAtIDAuLjlcbiAgICBpZiAoKGV2ZW50LmtleUNvZGUgPj0gNjUpICYmIChldmVudC5rZXlDb2RlIDw9IDkwKSB8fCAoZXZlbnQua2V5Q29kZSA+PSA0OCkgJiYgKGV2ZW50LmtleUNvZGUgPD0gNTcpKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5vbkVkaXRDZWxsKGV2ZW50LmtleSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgZGJsY2xpY2soZXZlbnQ6IGFueSkge1xuICAgIC8vIGNvbnNvbGUubG9nKCdkYmxjbGljazogJywgZXZlbnQpO1xuXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIHRoaXMub25FZGl0Q2VsbCh0aGlzLnZhbHVlKTtcbiAgfVxuXG4gIG9uQmx1cklucHV0KGV2ZW50OiBhbnkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnb25CbHVySW5wdXQ6ICcsIGV2ZW50KTtcblxuICAgIHRoaXMudmFsdWUgPSB0aGlzLmVkaXRWYWx1ZTtcbiAgICB0aGlzLmVkaXRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLmVkaXQgPSBmYWxzZTtcbiAgfVxuXG4gIG9uS2V5RG93bklucHV0KGV2ZW50OiBhbnkpIHtcbiAgICAvLyBjb25zb2xlLmxvZygnb25LZXlEb3duSW5wdXQ6ICcsIGV2ZW50KTtcblxuICAgIC8vIEVOVEVSXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy5lZGl0VmFsdWU7XG4gICAgICB0aGlzLmVkaXRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMuZWRpdCA9IGZhbHNlO1xuICAgICAgdGhpcy5jaGFuZ2VEZXRlY3RvclJlZi5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgICB0aGlzLmNvbnRlbnRFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG5cbiAgICAvLyBFU0NBUEVcbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMjcpIHtcbiAgICAgIHRoaXMuZWRpdFZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5lZGl0ID0gZmFsc2U7XG4gICAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICAgIHRoaXMuY29udGVudEVsZW1lbnQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvbkVkaXRDZWxsKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodGhpcy5yZWFkb25seSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZWRpdFZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy5lZGl0ID0gdHJ1ZTtcbiAgICB0aGlzLmNoYW5nZURldGVjdG9yUmVmLmRldGVjdENoYW5nZXMoKTtcbiAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gIH1cblxufVxuIl19