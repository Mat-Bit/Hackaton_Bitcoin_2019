/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { EventEmitter, Input, Output } from '@angular/core';
import { convertToBoolean, convertToInt, uuid } from './../../../utils/util';
import { requiredFailed } from '../validators';
/** @type {?} */
const poCheckboxGroupColumnsDefaultLength = 6;
/** @type {?} */
const poCheckboxGroupColumnsTotalLength = 12;
/**
 * \@description
 *
 * O componente `po-checkbox-group` exibe uma lista de múltipla escolha onde o usuário pode marcar e desmarcar,
 * utilizando a tecla de espaço ou o clique do mouse, várias opções.
 *
 * > Para seleção única, utilize o [**Portinari Radio Group**](/documentation/po-radio-group).
 *
 * Por padrão, o po-checkbox-group retorna um array com os valores dos itens selecionados para o model.
 *
 * ```
 * favorites = ['PO', 'Angular'];
 * ```
 *
 * Na maioria das situações, o array com os objetos setados já atende as necessidades mas, caso o desenvolvedor
 * tenha necessidade de usar um valor indeterminado (`null`), ou seja, nem marcado (`true`) e nem desmarcado (`false`),
 * deve setar a propriedade `p-indeterminate` como `true`.
 *
 * Nesse caso, o po-checkbox-group vai retornar um objeto com todas as opções disponíveis e seus valores.
 *
 * ```
 * favorites = {
 *  PO: true,
 *  Angular: true,
 *  VueJS: false,
 *  React: null // indeterminado
 * };
 * ```
 */
export class PoCheckboxGroupBaseComponent {
    constructor() {
        this.checkedOptions = {};
        this.checkedOptionsList = [];
        this.mdColumns = poCheckboxGroupColumnsDefaultLength;
        this._columns = poCheckboxGroupColumnsDefaultLength;
        this._disabled = false;
        this._indeterminate = false;
        this._required = false;
        // Função para atualizar o `ngModel` do componente, necessário quando não for utilizado dentro da tag form.
        this.ngModelChange = new EventEmitter();
        /**
         * Evento disparado ao alterar valor do campo
         */
        this.change = new EventEmitter();
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Possibilita definir a quantidade de colunas para exibição dos itens do *checkbox*.
     * - É possível exibir as opções entre `1` e `4` colunas.
     * - Para resolução `sm` a colunagem invariavelmente passa para `1` coluna.
     * - Quando se trata de resolução `md` e o valor estabelecido para colunas for superior a `2`,
     * o *grid system* será composto por `2` colunas.
     * - Para evitar a quebra de linha, prefira a utilização de `1` coluna para opções com textos grandes.
     *
     * \@default `2`
     *
     * @param {?} value
     * @return {?}
     */
    set columns(value) {
        /** @type {?} */
        const columns = convertToInt(value, poCheckboxGroupColumnsDefaultLength);
        this._columns = this.getGridSystemColumns(columns, 4);
        this.mdColumns = this.getGridSystemColumns(columns, 2);
    }
    /**
     * @return {?}
     */
    get columns() {
        return this._columns;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Desabilita todos os itens do checkbox.
     *
     * \@default `false`
     * @param {?} value
     * @return {?}
     */
    set disabled(value) {
        this._disabled = convertToBoolean(value);
        this.validateModel(this.checkIndeterminate());
    }
    /**
     * @return {?}
     */
    get disabled() {
        return this._disabled;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Caso exista a necessidade de usar o valor indeterminado (`null`) dentro da lista de opções, é necessário setar
     * a propriedade `p-indeterminate` como `true`, por padrão essa propriedade vem desabilitada (`false`).
     *
     * Quando essa propriedade é setada como `true`, o *po-checkbox-group* passa a devolver um objeto completo para o
     * `ngModel`, diferente do array que contém apenas os valores selecionados.
     *
     * \@default `false`
     * @param {?} indeterminate
     * @return {?}
     */
    set indeterminate(indeterminate) {
        this._indeterminate = convertToBoolean(indeterminate);
    }
    /**
     * @return {?}
     */
    get indeterminate() {
        return this._indeterminate;
    }
    /**
     * \@optional
     *
     * \@description
     * Lista de opções que serão exibidas
     * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoCheckboxGroupOption
     * @param {?} value
     * @return {?}
     */
    set options(value) {
        this._options = Array.isArray(value) ? value : [];
        this.removeDuplicatedOptions();
        this.setCheckboxGroupOptionsView(this.options);
    }
    /**
     * @return {?}
     */
    get options() {
        return this._options;
    }
    /**
     * \@optional
     *
     * \@description
     *
     * Define que o campo será obrigatório.
     *
     * \@default `false`
     * @param {?} required
     * @return {?}
     */
    set required(required) {
        this._required = convertToBoolean(required);
        this.validateModel(this.checkIndeterminate());
    }
    /**
     * @return {?}
     */
    get required() {
        return this._required;
    }
    /**
     * @return {?}
     */
    changeValue() {
        /** @type {?} */
        const value = this.checkIndeterminate();
        if (this.propagateChange) {
            this.propagateChange(value);
        }
        else {
            this.ngModelChange.emit(value);
        }
        this.change.emit(value);
    }
    /**
     * @return {?}
     */
    checkIndeterminate() {
        return this.indeterminate ? this.checkedOptions : this.checkedOptionsList;
    }
    /**
     * @param {?} value
     * @return {?}
     */
    checkOption(value) {
        if (!this._disabled && !value.disabled) {
            this.checkOptionModel(value);
            this.changeValue();
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.propagateChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) { }
    /**
     * @param {?} optionsModel
     * @return {?}
     */
    writeValue(optionsModel) {
        if (optionsModel && this.checkedOptions !== optionsModel) {
            this.generateCheckOptions(optionsModel);
        }
        else {
            this.checkedOptionsList = [];
            this.checkedOptions = {};
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnValidatorChange(fn) {
        this.validatorChange = fn;
    }
    /**
     * @param {?} abstractControl
     * @return {?}
     */
    validate(abstractControl) {
        if ((!this.indeterminate && requiredFailed(this.required, this.disabled, abstractControl.value)) || this.isInvalidIndeterminate()) {
            return {
                required: {
                    valid: false,
                }
            };
        }
    }
    /**
     * @protected
     * @param {?} model
     * @return {?}
     */
    validateModel(model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    }
    /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    checkColumnsRange(columns, maxColumns) {
        /** @type {?} */
        const minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    }
    /**
     * @private
     * @param {?} optionChecked
     * @return {?}
     */
    checkOptionModel(optionChecked) {
        this.checkedOptions[optionChecked.value] = !this.checkedOptions[optionChecked.value];
        if (!this.indeterminate && this.checkedOptionsList.includes(optionChecked.value)) {
            this.checkedOptionsList.splice(this.checkedOptionsList.indexOf(optionChecked.value), 1);
        }
        else if (!this.indeterminate) {
            this.checkedOptionsList.push(optionChecked.value);
        }
    }
    /**
     * @private
     * @param {?} optionsModel
     * @return {?}
     */
    generateCheckOptions(optionsModel) {
        this.checkedOptions = {};
        if (optionsModel instanceof Array) {
            this.checkedOptionsList = optionsModel;
            this.options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            (option) => {
                this.checkedOptions[option.value] = optionsModel.includes(option.value);
            }));
        }
        else {
            this.options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            (option) => {
                optionsModel[option.value] = optionsModel[option.value] === undefined ? false : optionsModel[option.value];
                this.checkedOptions = optionsModel;
            }));
        }
    }
    /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    getGridSystemColumns(columns, maxColumns) {
        /** @type {?} */
        const gridSystemColumns = poCheckboxGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : poCheckboxGroupColumnsDefaultLength;
    }
    /**
     * @private
     * @return {?}
     */
    isInvalidIndeterminate() {
        if (this.indeterminate && this.required && this.checkedOptions) {
            return ((/** @type {?} */ (Object))).values(this.checkedOptions).every((/**
             * @param {?} value
             * @return {?}
             */
            value => value === false));
        }
        return false;
    }
    /**
     * @private
     * @return {?}
     */
    removeDuplicatedOptions() {
        this.options.forEach((/**
         * @param {?} option
         * @param {?} index
         * @return {?}
         */
        (option, index) => {
            /** @type {?} */
            const duplicatedIndex = this.options.findIndex((/**
             * @param {?} optionFind
             * @return {?}
             */
            (optionFind) => optionFind.value === option.value)) === index;
            if (!duplicatedIndex) {
                this.options.splice(this.options.indexOf(option), 1);
            }
        }));
    }
    /**
     * @private
     * @param {?} optionsList
     * @return {?}
     */
    setCheckboxGroupOptionsView(optionsList) {
        this.checkboxGroupOptionsView = optionsList.map((/**
         * @param {?} option
         * @return {?}
         */
        option => {
            return Object.assign({}, option, { id: uuid() });
        }));
    }
}
PoCheckboxGroupBaseComponent.propDecorators = {
    name: [{ type: Input, args: ['name',] }],
    columns: [{ type: Input, args: ['p-columns',] }],
    disabled: [{ type: Input, args: ['p-disabled',] }],
    help: [{ type: Input, args: ['p-help',] }],
    indeterminate: [{ type: Input, args: ['p-indeterminate',] }],
    label: [{ type: Input, args: ['p-label',] }],
    optional: [{ type: Input, args: ['p-optional',] }],
    options: [{ type: Input, args: ['p-options',] }],
    required: [{ type: Input, args: ['p-required',] }],
    ngModelChange: [{ type: Output, args: ['ngModelChange',] }],
    change: [{ type: Output, args: ['p-change',] }]
};
if (false) {
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.checkboxGroupOptionsView;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.checkedOptions;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.checkedOptionsList;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.mdColumns;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.propagateChange;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.validatorChange;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._columns;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._indeterminate;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._options;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._required;
    /**
     * Nome dos checkboxes
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.name;
    /**
     * Texto de apoio do campo
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.help;
    /**
     * Label do campo
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.label;
    /**
     * \@optional
     *
     * \@description
     *
     * Define se a indicação de campo opcional será exibida.
     *
     * > Não será exibida a indicação se:
     * - O campo conter `p-required`;
     * - Não possuir `p-help` e/ou `p-label`.
     *
     * \@default `false`
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.optional;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.ngModelChange;
    /**
     * Evento disparado ao alterar valor do campo
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.change;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hlY2tib3gtZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLWNoZWNrYm94LWdyb3VwL3BvLWNoZWNrYm94LWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFNUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDOztNQUt6QyxtQ0FBbUMsR0FBVyxDQUFDOztNQUMvQyxpQ0FBaUMsR0FBVyxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErQnBELE1BQU0sT0FBTyw0QkFBNEI7SUFBekM7UUFHRSxtQkFBYyxHQUFRLEVBQUUsQ0FBQztRQUN6Qix1QkFBa0IsR0FBUSxFQUFFLENBQUM7UUFDN0IsY0FBUyxHQUFXLG1DQUFtQyxDQUFDO1FBSWhELGFBQVEsR0FBVyxtQ0FBbUMsQ0FBQztRQUN2RCxjQUFTLEdBQWEsS0FBSyxDQUFDO1FBQzVCLG1CQUFjLEdBQWEsS0FBSyxDQUFDO1FBRWpDLGNBQVMsR0FBYSxLQUFLLENBQUM7O1FBaUlYLGtCQUFhLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7Ozs7UUFHakUsV0FBTSxHQUF1QixJQUFJLFlBQVksRUFBTyxDQUFDO0lBOEgzRSxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7SUE5T0MsSUFBd0IsT0FBTyxDQUFDLEtBQWE7O2NBQ3JDLE9BQU8sR0FBRyxZQUFZLENBQUMsS0FBSyxFQUFFLG1DQUFtQyxDQUFDO1FBRXhFLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxD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LElBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFHO1FBQ25DLENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7O21CQTdQQSxLQUFLLFNBQUMsTUFBTTtzQkFpQlosS0FBSyxTQUFDLFdBQVc7dUJBb0JqQixLQUFLLFNBQUMsWUFBWTttQkFXbEIsS0FBSyxTQUFDLFFBQVE7NEJBZWQsS0FBSyxTQUFDLGlCQUFpQjtvQkFTdkIsS0FBSyxTQUFDLFNBQVM7dUJBZWYsS0FBSyxTQUFDLFlBQVk7c0JBU2xCLEtBQUssU0FBQyxXQUFXO3VCQW1CakIsS0FBSyxTQUFDLFlBQVk7NEJBV2xCLE1BQU0sU0FBQyxlQUFlO3FCQUd0QixNQUFNLFNBQUMsVUFBVTs7OztJQS9JbEIsZ0VBQTJEOztJQUMzRCxzREFBeUI7O0lBQ3pCLDBEQUE2Qjs7SUFDN0IsaURBQXdEOztJQUN4RCx1REFBcUI7O0lBQ3JCLHVEQUFxQjs7Ozs7SUFFckIsZ0RBQStEOzs7OztJQUMvRCxpREFBb0M7Ozs7O0lBQ3BDLHNEQUF5Qzs7Ozs7SUFDekMsZ0RBQWdEOzs7OztJQUNoRCxpREFBb0M7Ozs7O0lBR3BDLDRDQUE0Qjs7Ozs7SUFnRDVCLDRDQUErQjs7Ozs7SUF3Qi9CLDZDQUFpQzs7Ozs7Ozs7Ozs7Ozs7O0lBZWpDLGdEQUF1Qzs7SUF1Q3ZDLHFEQUFxRjs7Ozs7SUFHckYsOENBQXlFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IGNvbnZlcnRUb0Jvb2xlYW4sIGNvbnZlcnRUb0ludCwgdXVpZCB9IGZyb20gJy4vLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyByZXF1aXJlZEZhaWxlZCB9IGZyb20gJy4uL3ZhbGlkYXRvcnMnO1xuXG5pbXBvcnQgeyBQb0NoZWNrYm94R3JvdXBPcHRpb24gfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tY2hlY2tib3gtZ3JvdXAtb3B0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb0NoZWNrYm94R3JvdXBPcHRpb25WaWV3IH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWNoZWNrYm94LWdyb3VwLW9wdGlvbi12aWV3LmludGVyZmFjZSc7XG5cbmNvbnN0IHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoOiBudW1iZXIgPSA2O1xuY29uc3QgcG9DaGVja2JveEdyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoOiBudW1iZXIgPSAxMjtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGNvbXBvbmVudGUgYHBvLWNoZWNrYm94LWdyb3VwYCBleGliZSB1bWEgbGlzdGEgZGUgbcO6bHRpcGxhIGVzY29saGEgb25kZSBvIHVzdcOhcmlvIHBvZGUgbWFyY2FyIGUgZGVzbWFyY2FyLFxuICogdXRpbGl6YW5kbyBhIHRlY2xhIGRlIGVzcGHDp28gb3UgbyBjbGlxdWUgZG8gbW91c2UsIHbDoXJpYXMgb3DDp8O1ZXMuXG4gKlxuICogPiBQYXJhIHNlbGXDp8OjbyDDum5pY2EsIHV0aWxpemUgbyBbKipQb3J0aW5hcmkgUmFkaW8gR3JvdXAqKl0oL2RvY3VtZW50YXRpb24vcG8tcmFkaW8tZ3JvdXApLlxuICpcbiAqIFBvciBwYWRyw6NvLCBvIHBvLWNoZWNrYm94LWdyb3VwIHJldG9ybmEgdW0gYXJyYXkgY29tIG9zIHZhbG9yZXMgZG9zIGl0ZW5zIHNlbGVjaW9uYWRvcyBwYXJhIG8gbW9kZWwuXG4gKlxuICogYGBgXG4gKiBmYXZvcml0ZXMgPSBbJ1BPJywgJ0FuZ3VsYXInXTtcbiAqIGBgYFxuICpcbiAqIE5hIG1haW9yaWEgZGFzIHNpdHVhw6fDtWVzLCBvIGFycmF5IGNvbSBvcyBvYmpldG9zIHNldGFkb3MgasOhIGF0ZW5kZSBhcyBuZWNlc3NpZGFkZXMgbWFzLCBjYXNvIG8gZGVzZW52b2x2ZWRvclxuICogdGVuaGEgbmVjZXNzaWRhZGUgZGUgdXNhciB1bSB2YWxvciBpbmRldGVybWluYWRvIChgbnVsbGApLCBvdSBzZWphLCBuZW0gbWFyY2FkbyAoYHRydWVgKSBlIG5lbSBkZXNtYXJjYWRvIChgZmFsc2VgKSxcbiAqIGRldmUgc2V0YXIgYSBwcm9wcmllZGFkZSBgcC1pbmRldGVybWluYXRlYCBjb21vIGB0cnVlYC5cbiAqXG4gKiBOZXNzZSBjYXNvLCBvIHBvLWNoZWNrYm94LWdyb3VwIHZhaSByZXRvcm5hciB1bSBvYmpldG8gY29tIHRvZGFzIGFzIG9ww6fDtWVzIGRpc3BvbsOtdmVpcyBlIHNldXMgdmFsb3Jlcy5cbiAqXG4gKiBgYGBcbiAqIGZhdm9yaXRlcyA9IHtcbiAqICBQTzogdHJ1ZSxcbiAqICBBbmd1bGFyOiB0cnVlLFxuICogIFZ1ZUpTOiBmYWxzZSxcbiAqICBSZWFjdDogbnVsbCAvLyBpbmRldGVybWluYWRvXG4gKiB9O1xuICogYGBgXG4gKi9cbmV4cG9ydCBjbGFzcyBQb0NoZWNrYm94R3JvdXBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIFZhbGlkYXRvciB7XG5cbiAgY2hlY2tib3hHcm91cE9wdGlvbnNWaWV3OiBBcnJheTxQb0NoZWNrYm94R3JvdXBPcHRpb25WaWV3PjtcbiAgY2hlY2tlZE9wdGlvbnM6IGFueSA9IHt9O1xuICBjaGVja2VkT3B0aW9uc0xpc3Q6IGFueSA9IFtdO1xuICBtZENvbHVtbnM6IG51bWJlciA9IHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoO1xuICBwcm9wYWdhdGVDaGFuZ2U6IGFueTtcbiAgdmFsaWRhdG9yQ2hhbmdlOiBhbnk7XG5cbiAgcHJpdmF0ZSBfY29sdW1uczogbnVtYmVyID0gcG9DaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIHByaXZhdGUgX2Rpc2FibGVkPzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9pbmRldGVybWluYXRlPzogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9vcHRpb25zPzogQXJyYXk8UG9DaGVja2JveEdyb3VwT3B0aW9uPjtcbiAgcHJpdmF0ZSBfcmVxdWlyZWQ/OiBib29sZWFuID0gZmFsc2U7XG5cbiAgLyoqIE5vbWUgZG9zIGNoZWNrYm94ZXMgKi9cbiAgQElucHV0KCduYW1lJykgbmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIFBvc3NpYmlsaXRhIGRlZmluaXIgYSBxdWFudGlkYWRlIGRlIGNvbHVuYXMgcGFyYSBleGliacOnw6NvIGRvcyBpdGVucyBkbyAqY2hlY2tib3gqLlxuICAgKiAtIMOJIHBvc3PDrXZlbCBleGliaXIgYXMgb3DDp8O1ZXMgZW50cmUgYDFgIGUgYDRgIGNvbHVuYXMuXG4gICAqIC0gUGFyYSByZXNvbHXDp8OjbyBgc21gIGEgY29sdW5hZ2VtIGludmFyaWF2ZWxtZW50ZSBwYXNzYSBwYXJhIGAxYCBjb2x1bmEuXG4gICAqIC0gUXVhbmRvIHNlIHRyYXRhIGRlIHJlc29sdcOnw6NvIGBtZGAgZSBvIHZhbG9yIGVzdGFiZWxlY2lkbyBwYXJhIGNvbHVuYXMgZm9yIHN1cGVyaW9yIGEgYDJgLFxuICAgKiBvICpncmlkIHN5c3RlbSogc2Vyw6EgY29tcG9zdG8gcG9yIGAyYCBjb2x1bmFzLlxuICAgKiAtIFBhcmEgZXZpdGFyIGEgcXVlYnJhIGRlIGxpbmhhLCBwcmVmaXJhIGEgdXRpbGl6YcOnw6NvIGRlIGAxYCBjb2x1bmEgcGFyYSBvcMOnw7VlcyBjb20gdGV4dG9zIGdyYW5kZXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IGAyYFxuICAgKlxuICAgKi9cbiAgQElucHV0KCdwLWNvbHVtbnMnKSBzZXQgY29sdW1ucyh2YWx1ZTogbnVtYmVyKSB7XG4gICAgY29uc3QgY29sdW1ucyA9IGNvbnZlcnRUb0ludCh2YWx1ZSwgcG9DaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGgpO1xuXG4gICAgdGhpcy5fY29sdW1ucyA9IHRoaXMuZ2V0R3JpZFN5c3RlbUNvbHVtbnMoY29sdW1ucywgNCk7XG4gICAgdGhpcy5tZENvbHVtbnMgPSB0aGlzLmdldEdyaWRTeXN0ZW1Db2x1bW5zKGNvbHVtbnMsIDIpO1xuICB9XG5cbiAgZ2V0IGNvbHVtbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbHVtbnM7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZXNhYmlsaXRhIHRvZG9zIG9zIGl0ZW5zIGRvIGNoZWNrYm94LlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3AtZGlzYWJsZWQnKSBzZXQgZGlzYWJsZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9kaXNhYmxlZCA9IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuXG4gICAgdGhpcy52YWxpZGF0ZU1vZGVsKHRoaXMuY2hlY2tJbmRldGVybWluYXRlKCkpO1xuICB9XG5cbiAgZ2V0IGRpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9kaXNhYmxlZDtcbiAgfVxuXG4gIC8qKiBUZXh0byBkZSBhcG9pbyBkbyBjYW1wbyAqL1xuICBASW5wdXQoJ3AtaGVscCcpIGhlbHA/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQ2FzbyBleGlzdGEgYSBuZWNlc3NpZGFkZSBkZSB1c2FyIG8gdmFsb3IgaW5kZXRlcm1pbmFkbyAoYG51bGxgKSBkZW50cm8gZGEgbGlzdGEgZGUgb3DDp8O1ZXMsIMOpIG5lY2Vzc8OhcmlvIHNldGFyXG4gICAqIGEgcHJvcHJpZWRhZGUgYHAtaW5kZXRlcm1pbmF0ZWAgY29tbyBgdHJ1ZWAsIHBvciBwYWRyw6NvIGVzc2EgcHJvcHJpZWRhZGUgdmVtIGRlc2FiaWxpdGFkYSAoYGZhbHNlYCkuXG4gICAqXG4gICAqIFF1YW5kbyBlc3NhIHByb3ByaWVkYWRlIMOpIHNldGFkYSBjb21vIGB0cnVlYCwgbyAqcG8tY2hlY2tib3gtZ3JvdXAqIHBhc3NhIGEgZGV2b2x2ZXIgdW0gb2JqZXRvIGNvbXBsZXRvIHBhcmEgb1xuICAgKiBgbmdNb2RlbGAsIGRpZmVyZW50ZSBkbyBhcnJheSBxdWUgY29udMOpbSBhcGVuYXMgb3MgdmFsb3JlcyBzZWxlY2lvbmFkb3MuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1pbmRldGVybWluYXRlJykgc2V0IGluZGV0ZXJtaW5hdGUoaW5kZXRlcm1pbmF0ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2luZGV0ZXJtaW5hdGUgPSBjb252ZXJ0VG9Cb29sZWFuKGluZGV0ZXJtaW5hdGUpO1xuICB9XG5cbiAgZ2V0IGluZGV0ZXJtaW5hdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2luZGV0ZXJtaW5hdGU7XG4gIH1cblxuICAvKiogTGFiZWwgZG8gY2FtcG8gKi9cbiAgQElucHV0KCdwLWxhYmVsJykgbGFiZWw/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVmaW5lIHNlIGEgaW5kaWNhw6fDo28gZGUgY2FtcG8gb3BjaW9uYWwgc2Vyw6EgZXhpYmlkYS5cbiAgICpcbiAgICogPiBOw6NvIHNlcsOhIGV4aWJpZGEgYSBpbmRpY2HDp8OjbyBzZTpcbiAgICogLSBPIGNhbXBvIGNvbnRlciBgcC1yZXF1aXJlZGA7XG4gICAqIC0gTsOjbyBwb3NzdWlyIGBwLWhlbHBgIGUvb3UgYHAtbGFiZWxgLlxuICAgKlxuICAgKiBAZGVmYXVsdCBgZmFsc2VgXG4gICAqL1xuICBASW5wdXQoJ3Atb3B0aW9uYWwnKSBvcHRpb25hbDogYm9vbGVhbjtcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBMaXN0YSBkZSBvcMOnw7VlcyBxdWUgc2Vyw6NvIGV4aWJpZGFzXG4gICAqIE5lc3RhIHByb3ByaWVkYWRlIGRldmUgc2VyIGRlZmluaWRvIHVtIGFycmF5IGRlIG9iamV0b3MgcXVlIGltcGxlbWVudGFtIGEgaW50ZXJmYWNlIFBvQ2hlY2tib3hHcm91cE9wdGlvblxuICAgKi9cbiAgQElucHV0KCdwLW9wdGlvbnMnKSBzZXQgb3B0aW9ucyh2YWx1ZTogQXJyYXk8UG9DaGVja2JveEdyb3VwT3B0aW9uPikge1xuICAgIHRoaXMuX29wdGlvbnMgPSBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW107XG4gICAgdGhpcy5yZW1vdmVEdXBsaWNhdGVkT3B0aW9ucygpO1xuICAgIHRoaXMuc2V0Q2hlY2tib3hHcm91cE9wdGlvbnNWaWV3KHRoaXMub3B0aW9ucyk7XG4gIH1cblxuICBnZXQgb3B0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlZmluZSBxdWUgbyBjYW1wbyBzZXLDoSBvYnJpZ2F0w7NyaW8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1yZXF1aXJlZCcpIHNldCByZXF1aXJlZChyZXF1aXJlZDogYm9vbGVhbikge1xuICAgIHRoaXMuX3JlcXVpcmVkID0gY29udmVydFRvQm9vbGVhbihyZXF1aXJlZCk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwodGhpcy5jaGVja0luZGV0ZXJtaW5hdGUoKSk7XG4gIH1cblxuICBnZXQgcmVxdWlyZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVpcmVkO1xuICB9XG5cbiAgLy8gRnVuw6fDo28gcGFyYSBhdHVhbGl6YXIgbyBgbmdNb2RlbGAgZG8gY29tcG9uZW50ZSwgbmVjZXNzw6FyaW8gcXVhbmRvIG7Do28gZm9yIHV0aWxpemFkbyBkZW50cm8gZGEgdGFnIGZvcm0uXG4gIEBPdXRwdXQoJ25nTW9kZWxDaGFuZ2UnKSBuZ01vZGVsQ2hhbmdlPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvKiogRXZlbnRvIGRpc3BhcmFkbyBhbyBhbHRlcmFyIHZhbG9yIGRvIGNhbXBvICovXG4gIEBPdXRwdXQoJ3AtY2hhbmdlJykgY2hhbmdlPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBjaGFuZ2VWYWx1ZSgpIHtcblxuICAgIGNvbnN0IHZhbHVlID0gdGhpcy5jaGVja0luZGV0ZXJtaW5hdGUoKTtcblxuICAgIGlmICh0aGlzLnByb3BhZ2F0ZUNoYW5nZSkge1xuICAgICAgdGhpcy5wcm9wYWdhdGVDaGFuZ2UodmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5nTW9kZWxDaGFuZ2UuZW1pdCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgdGhpcy5jaGFuZ2UuZW1pdCh2YWx1ZSk7XG4gIH1cblxuICBjaGVja0luZGV0ZXJtaW5hdGUoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW5kZXRlcm1pbmF0ZSA/IHRoaXMuY2hlY2tlZE9wdGlvbnMgOiB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdDtcbiAgfVxuXG4gIGNoZWNrT3B0aW9uKHZhbHVlOiBQb0NoZWNrYm94R3JvdXBPcHRpb24pIHtcbiAgICBpZiAoIXRoaXMuX2Rpc2FibGVkICYmICF2YWx1ZS5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5jaGVja09wdGlvbk1vZGVsKHZhbHVlKTtcbiAgICAgIHRoaXMuY2hhbmdlVmFsdWUoKTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSk6IHZvaWQgeyB9XG5cbiAgd3JpdGVWYWx1ZShvcHRpb25zTW9kZWw6IGFueSkge1xuICAgIGlmIChvcHRpb25zTW9kZWwgJiYgdGhpcy5jaGVja2VkT3B0aW9ucyAhPT0gb3B0aW9uc01vZGVsKSB7XG4gICAgICB0aGlzLmdlbmVyYXRlQ2hlY2tPcHRpb25zKG9wdGlvbnNNb2RlbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0ID0gW107XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zID0ge307XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXJPblZhbGlkYXRvckNoYW5nZShmbjogKCkgPT4gdm9pZCkge1xuICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlID0gZm47XG4gIH1cblxuICB2YWxpZGF0ZShhYnN0cmFjdENvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IHsgW2tleTogc3RyaW5nXTogYW55OyB9IHtcblxuICAgIGlmICgoIXRoaXMuaW5kZXRlcm1pbmF0ZSAmJiByZXF1aXJlZEZhaWxlZCh0aGlzLnJlcXVpcmVkLCB0aGlzLmRpc2FibGVkLCBhYnN0cmFjdENvbnRyb2wudmFsdWUpKSB8fCB0aGlzLmlzSW52YWxpZEluZGV0ZXJtaW5hdGUoKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWlyZWQ6IHtcbiAgICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuXG4gIH1cblxuICBwcm90ZWN0ZWQgdmFsaWRhdGVNb2RlbChtb2RlbDogYW55KSB7XG4gICAgaWYgKHRoaXMudmFsaWRhdG9yQ2hhbmdlKSB7XG4gICAgICB0aGlzLnZhbGlkYXRvckNoYW5nZShtb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0NvbHVtbnNSYW5nZShjb2x1bW5zLCBtYXhDb2x1bW5zKTogYm9vbGVhbiB7XG4gICAgY29uc3QgbWluQ29sdW1ucyA9IDE7XG5cbiAgICByZXR1cm4gY29sdW1ucyA+PSBtaW5Db2x1bW5zICYmIGNvbHVtbnMgPD0gbWF4Q29sdW1ucztcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tPcHRpb25Nb2RlbChvcHRpb25DaGVja2VkOiBQb0NoZWNrYm94R3JvdXBPcHRpb24pIHtcbiAgICB0aGlzLmNoZWNrZWRPcHRpb25zW29wdGlvbkNoZWNrZWQudmFsdWVdID0gIXRoaXMuY2hlY2tlZE9wdGlvbnNbb3B0aW9uQ2hlY2tlZC52YWx1ZV07XG5cbiAgICBpZiAoIXRoaXMuaW5kZXRlcm1pbmF0ZSAmJiB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5pbmNsdWRlcyhvcHRpb25DaGVja2VkLnZhbHVlKSkge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3Quc3BsaWNlKHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LmluZGV4T2Yob3B0aW9uQ2hlY2tlZC52YWx1ZSksIDEpO1xuXG4gICAgfSBlbHNlIGlmICghdGhpcy5pbmRldGVybWluYXRlKSB7XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5wdXNoKG9wdGlvbkNoZWNrZWQudmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVDaGVja09wdGlvbnMob3B0aW9uc01vZGVsOiBhbnkpIHtcblxuICAgIHRoaXMuY2hlY2tlZE9wdGlvbnMgPSB7fTtcblxuICAgIGlmIChvcHRpb25zTW9kZWwgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QgPSBvcHRpb25zTW9kZWw7XG5cbiAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb246IFBvQ2hlY2tib3hHcm91cE9wdGlvbikgPT4ge1xuICAgICAgICB0aGlzLmNoZWNrZWRPcHRpb25zW29wdGlvbi52YWx1ZV0gPSBvcHRpb25zTW9kZWwuaW5jbHVkZXMob3B0aW9uLnZhbHVlKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnMuZm9yRWFjaCgob3B0aW9uOiBQb0NoZWNrYm94R3JvdXBPcHRpb24pID0+IHtcbiAgICAgICAgb3B0aW9uc01vZGVsW29wdGlvbi52YWx1ZV0gPSBvcHRpb25zTW9kZWxbb3B0aW9uLnZhbHVlXSA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiBvcHRpb25zTW9kZWxbb3B0aW9uLnZhbHVlXTtcbiAgICAgICAgdGhpcy5jaGVja2VkT3B0aW9ucyA9IG9wdGlvbnNNb2RlbDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0R3JpZFN5c3RlbUNvbHVtbnMoY29sdW1uczogbnVtYmVyLCBtYXhDb2x1bW5zOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IGdyaWRTeXN0ZW1Db2x1bW5zID0gcG9DaGVja2JveEdyb3VwQ29sdW1uc1RvdGFsTGVuZ3RoIC8gY29sdW1ucztcblxuICAgIHJldHVybiB0aGlzLmNoZWNrQ29sdW1uc1JhbmdlKGNvbHVtbnMsIG1heENvbHVtbnMpID8gZ3JpZFN5c3RlbUNvbHVtbnMgOiBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDtcbiAgfVxuXG4gIHByaXZhdGUgaXNJbnZhbGlkSW5kZXRlcm1pbmF0ZSgpIHtcbiAgICBpZiAodGhpcy5pbmRldGVybWluYXRlICYmIHRoaXMucmVxdWlyZWQgJiYgdGhpcy5jaGVja2VkT3B0aW9ucykge1xuICAgICAgcmV0dXJuICg8YW55Pk9iamVjdCkudmFsdWVzKHRoaXMuY2hlY2tlZE9wdGlvbnMpLmV2ZXJ5KHZhbHVlID0+IHZhbHVlID09PSBmYWxzZSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRHVwbGljYXRlZE9wdGlvbnMoKSB7XG4gICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbiwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZWRJbmRleCA9IHRoaXMub3B0aW9ucy5maW5kSW5kZXgoKG9wdGlvbkZpbmQ6IGFueSkgPT4gb3B0aW9uRmluZC52YWx1ZSA9PT0gb3B0aW9uLnZhbHVlKSA9PT0gaW5kZXg7XG4gICAgICBpZiAoIWR1cGxpY2F0ZWRJbmRleCkge1xuICAgICAgICB0aGlzLm9wdGlvbnMuc3BsaWNlKHRoaXMub3B0aW9ucy5pbmRleE9mKG9wdGlvbiksIDEpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRDaGVja2JveEdyb3VwT3B0aW9uc1ZpZXcob3B0aW9uc0xpc3Q6IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvbj4pIHtcbiAgICB0aGlzLmNoZWNrYm94R3JvdXBPcHRpb25zVmlldyA9IG9wdGlvbnNMaXN0Lm1hcChvcHRpb24gPT4ge1xuICAgICAgcmV0dXJuIHsgLi4ub3B0aW9uLCBpZDogdXVpZCgpIH07XG4gICAgfSk7XG4gIH1cblxufVxuIl19