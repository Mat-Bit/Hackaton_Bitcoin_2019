/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import { HttpClient, HttpEventType, HttpRequest, HttpResponse } from '@angular/common/http';
export class PoUploadBaseService {
    /**
     * @param {?} http
     */
    constructor(http) {
        this.http = http;
        this.formField = 'files';
        this.requests = [];
    }
    /**
     * Método responsável por enviar os arquivos ao servidor, conforme o parâmetro URL.
     *
     * @param {?} url URL da requisição a ser efetuada.
     * @param {?} files Arquivos a serem enviados.
     * @param {?} tOnUpload Função a ser executada quando o arquivo for enviado ao servidor.
     * @param {?} uploadCallback Função que será executada enquanto os arquivos estiverem sendo enviados.
     * @param {?} successCallback Função a ser executada quando a requisição for efetuada com sucesso.
     * @param {?} errorCallback Função a ser executada quando a requisição foi efetuada com sucesso.
     * @return {?}
     */
    upload(url, files, tOnUpload, uploadCallback, successCallback, errorCallback) {
        /** @type {?} */
        const filesLength = files.length;
        /** @type {?} */
        const uploadEvent = {
            data: {},
            file: null
        };
        for (let i = 0; i < filesLength; i++) {
            /** @type {?} */
            const formData = new FormData();
            /** @type {?} */
            const file = files[i];
            /** @type {?} */
            const fileName = file.rawFile.name;
            formData.append(this.formField, file.rawFile, fileName);
            // Função upload, onde o desenvolvedor pode enviar dados para a requisição.
            if (tOnUpload) {
                uploadEvent['file'] = file;
                tOnUpload.emit(uploadEvent);
                formData.append('data', JSON.stringify(uploadEvent.data));
            }
            this.sendFile(url, file, formData, uploadCallback, successCallback, errorCallback);
        }
    }
    /**
     * @param {?} url
     * @param {?} file
     * @param {?} formData
     * @param {?} uploadCallback
     * @param {?} successCallback
     * @param {?} errorCallback
     * @return {?}
     */
    sendFile(url, file, formData, uploadCallback, successCallback, errorCallback) {
        /** @type {?} */
        const request = this.getRequest(url, formData).subscribe((/**
         * @param {?} event
         * @return {?}
         */
        event => {
            if (event.type === HttpEventType.UploadProgress) {
                this.addRequest(file, request);
                /** @type {?} */
                const percentDone = Math.round(100 * event.loaded / event.total);
                uploadCallback(file, percentDone);
            }
            else if (event instanceof HttpResponse) {
                // Sucesso, arquivos enviados.
                successCallback(file, event);
            }
        }), (/**
         * @param {?} err
         * @return {?}
         */
        (err) => {
            errorCallback(file, err);
        }));
    }
    /**
     * @param {?} url
     * @param {?} formData
     * @return {?}
     */
    getRequest(url, formData) {
        /** @type {?} */
        const req = new HttpRequest('POST', url, formData, {
            reportProgress: true
        });
        return this.http.request(req);
    }
    /**
     * @param {?} file
     * @param {?} callback
     * @return {?}
     */
    stopRequestByFile(file, callback) {
        /** @type {?} */
        const requestObj = this.requests.find((/**
         * @param {?} req
         * @return {?}
         */
        req => {
            return req.file.uid === file.uid;
        }));
        if (requestObj) {
            /** @type {?} */
            const request = requestObj.request;
            request.unsubscribe();
            this.removeRequest(requestObj);
            callback();
        }
    }
    /**
     * @param {?} requestObj
     * @return {?}
     */
    removeRequest(requestObj) {
        /** @type {?} */
        const index = this.requests.indexOf(requestObj);
        this.requests.splice(index, 1);
    }
    /**
     * @param {?} file
     * @param {?} request
     * @return {?}
     */
    addRequest(file, request) {
        /** @type {?} */
        const hasRequest = this.requests.some((/**
         * @param {?} req
         * @return {?}
         */
        req => {
            return req.file.uid === file.uid;
        }));
        if (!hasRequest) {
            this.requests.push({ file, request });
        }
    }
}
PoUploadBaseService.decorators = [
    { type: Injectable }
];
/** @nocollapse */
PoUploadBaseService.ctorParameters = () => [
    { type: HttpClient }
];
if (false) {
    /** @type {?} */
    PoUploadBaseService.prototype.formField;
    /** @type {?} */
    PoUploadBaseService.prototype.requests;
    /**
     * @type {?}
     * @private
     */
    PoUploadBaseService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLWJhc2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tdXBsb2FkL3BvLXVwbG9hZC1iYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQWdCLE1BQU0sZUFBZSxDQUFDO0FBQ3pELE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFxQixXQUFXLEVBQUUsWUFBWSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFPL0csTUFBTSxPQUFPLG1CQUFtQjs7OztJQUs5QixZQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBSHBDLGNBQVMsR0FBVyxPQUFPLENBQUM7UUFDNUIsYUFBUSxHQUFlLEVBQUUsQ0FBQztJQUVjLENBQUM7Ozs7Ozs7Ozs7OztJQVlsQyxNQUFNLENBQ1gsR0FBVyxFQUNYLEtBQTBCLEVBQzFCLFNBQTRCLEVBQzVCLGNBQTZELEVBQzdELGVBQXlELEVBQ3pELGFBQXVEOztjQUVqRCxXQUFXLEdBQUcsS0FBSyxDQUFDLE1BQU07O2NBQzFCLFdBQVcsR0FBUTtZQUN2QixJQUFJLEVBQUUsRUFBRTtZQUNSLElBQUksRUFBRSxJQUFJO1NBQ1g7UUFFRCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxFQUFFLENBQUMsRUFBRSxFQUFFOztrQkFDOUIsUUFBUSxHQUFhLElBQUksUUFBUSxFQUFFOztrQkFDbkMsSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUM7O2tCQUNmLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUk7WUFFbEMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFeEQsMkVB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LENBQUMsVUFBVSxFQUFFO1lBQ2YsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztTQUNyQztJQUNILENBQUM7OztZQS9HRixVQUFVOzs7O1lBTkYsVUFBVTs7OztJQVNqQix3Q0FBNEI7O0lBQzVCLHVDQUEwQjs7Ozs7SUFFZCxtQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFdmVudFR5cGUsIEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwUmVxdWVzdCwgSHR0cFJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBQb1VwbG9hZEZpbGUgfSBmcm9tICcuL3BvLXVwbG9hZC1maWxlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBQb1VwbG9hZEJhc2VTZXJ2aWNlIHtcblxuICBmb3JtRmllbGQ6IHN0cmluZyA9ICdmaWxlcyc7XG4gIHJlcXVlc3RzOiBBcnJheTxhbnk+ID0gW107XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50KSB7IH1cblxuICAvKipcbiAgICogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yIGVudmlhciBvcyBhcnF1aXZvcyBhbyBzZXJ2aWRvciwgY29uZm9ybWUgbyBwYXLDom1ldHJvIFVSTC5cbiAgICpcbiAgICogQHBhcmFtIHVybCBVUkwgZGEgcmVxdWlzacOnw6NvIGEgc2VyIGVmZXR1YWRhLlxuICAgKiBAcGFyYW0gZmlsZXMgQXJxdWl2b3MgYSBzZXJlbSBlbnZpYWRvcy5cbiAgICogQHBhcmFtIHRPblVwbG9hZCBGdW7Dp8OjbyBhIHNlciBleGVjdXRhZGEgcXVhbmRvIG8gYXJxdWl2byBmb3IgZW52aWFkbyBhbyBzZXJ2aWRvci5cbiAgICogQHBhcmFtIHVwbG9hZENhbGxiYWNrIEZ1bsOnw6NvIHF1ZSBzZXLDoSBleGVjdXRhZGEgZW5xdWFudG8gb3MgYXJxdWl2b3MgZXN0aXZlcmVtIHNlbmRvIGVudmlhZG9zLlxuICAgKiBAcGFyYW0gc3VjY2Vzc0NhbGxiYWNrIEZ1bsOnw6NvIGEgc2VyIGV4ZWN1dGFkYSBxdWFuZG8gYSByZXF1aXNpw6fDo28gZm9yIGVmZXR1YWRhIGNvbSBzdWNlc3NvLlxuICAgKiBAcGFyYW0gZXJyb3JDYWxsYmFjayBGdW7Dp8OjbyBhIHNlciBleGVjdXRhZGEgcXVhbmRvIGEgcmVxdWlzacOnw6NvIGZvaSBlZmV0dWFkYSBjb20gc3VjZXNzby5cbiAgICovXG4gIHB1YmxpYyB1cGxvYWQoXG4gICAgdXJsOiBzdHJpbmcsXG4gICAgZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4sXG4gICAgdE9uVXBsb2FkOiBFdmVudEVtaXR0ZXI8YW55PixcbiAgICB1cGxvYWRDYWxsYmFjazogKGZpbGU6IFBvVXBsb2FkRmlsZSwgcGVyY2VudDogbnVtYmVyKSA9PiB2b2lkLFxuICAgIHN1Y2Nlc3NDYWxsYmFjazogKGZpbGU6IFBvVXBsb2FkRmlsZSwgZXZlbnQ6IGFueSkgPT4gdm9pZCxcbiAgICBlcnJvckNhbGxiYWNrOiAoZmlsZTogUG9VcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkKSB7XG5cbiAgICBjb25zdCBmaWxlc0xlbmd0aCA9IGZpbGVzLmxlbmd0aDtcbiAgICBjb25zdCB1cGxvYWRFdmVudDogYW55ID0ge1xuICAgICAgZGF0YToge30sXG4gICAgICBmaWxlOiBudWxsXG4gICAgfTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXNMZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZm9ybURhdGE6IEZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBjb25zdCBmaWxlID0gZmlsZXNbaV07XG4gICAgICBjb25zdCBmaWxlTmFtZSA9IGZpbGUucmF3RmlsZS5uYW1lO1xuXG4gICAgICBmb3JtRGF0YS5hcHBlbmQodGhpcy5mb3JtRmllbGQsIGZpbGUucmF3RmlsZSwgZmlsZU5hbWUpO1xuXG4gICAgICAvLyBGdW7Dp8OjbyB1cGxvYWQsIG9uZGUgbyBkZXNlbnZvbHZlZG9yIHBvZGUgZW52aWFyIGRhZG9zIHBhcmEgYSByZXF1aXNpw6fDo28uXG4gICAgICBpZiAodE9uVXBsb2FkKSB7XG4gICAgICAgIHVwbG9hZEV2ZW50WydmaWxlJ10gPSBmaWxlO1xuICAgICAgICB0T25VcGxvYWQuZW1pdCh1cGxvYWRFdmVudCk7XG5cbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdkYXRhJywgSlNPTi5zdHJpbmdpZnkodXBsb2FkRXZlbnQuZGF0YSkpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNlbmRGaWxlKHVybCwgZmlsZSwgZm9ybURhdGEsIHVwbG9hZENhbGxiYWNrLCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzZW5kRmlsZShcbiAgICB1cmw6IHN0cmluZyxcbiAgICBmaWxlOiBQb1VwbG9hZEZpbGUsXG4gICAgZm9ybURhdGE6IEZvcm1EYXRhLFxuICAgIHVwbG9hZENhbGxiYWNrOiAoZmlsZTogUG9VcGxvYWRGaWxlLCBwZXJjZW50OiBudW1iZXIpID0+IHZvaWQsXG4gICAgc3VjY2Vzc0NhbGxiYWNrOiAoZmlsZTogUG9VcGxvYWRGaWxlLCBldmVudDogYW55KSA9PiB2b2lkLFxuICAgIGVycm9yQ2FsbGJhY2s6IChmaWxlOiBQb1VwbG9hZEZpbGUsIGV2ZW50OiBhbnkpID0+IHZvaWQpIHtcblxuICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmdldFJlcXVlc3QodXJsLCBmb3JtRGF0YSkuc3Vic2NyaWJlKGV2ZW50ID0+IHtcblxuICAgICAgaWYgKGV2ZW50LnR5cGUgPT09IEh0dHBFdmVudFR5cGUuVXBsb2FkUHJvZ3Jlc3MpIHtcbiAgICAgICAgdGhpcy5hZGRSZXF1ZXN0KGZpbGUsIHJlcXVlc3QpO1xuXG4gICAgICAgIGNvbnN0IHBlcmNlbnREb25lID0gTWF0aC5yb3VuZCgxMDAgKiBldmVudC5sb2FkZWQgLyBldmVudC50b3RhbCk7XG4gICAgICAgIHVwbG9hZENhbGxiYWNrKGZpbGUsIHBlcmNlbnREb25lKTtcblxuICAgICAgfSBlbHNlIGlmIChldmVudCBpbnN0YW5jZW9mIEh0dHBSZXNwb25zZSkge1xuICAgICAgICAvLyBTdWNlc3NvLCBhcnF1aXZvcyBlbnZpYWRvcy5cbiAgICAgICAgc3VjY2Vzc0NhbGxiYWNrKGZpbGUsIGV2ZW50KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIChlcnI6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICBlcnJvckNhbGxiYWNrKGZpbGUsIGVycik7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgZ2V0UmVxdWVzdCh1cmw6IHN0cmluZywgZm9ybURhdGE6IEZvcm1EYXRhKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICBjb25zdCByZXEgPSBuZXcgSHR0cFJlcXVlc3QoJ1BPU1QnLCB1cmwsIGZvcm1EYXRhLCB7XG4gICAgICByZXBvcnRQcm9ncmVzczogdHJ1ZVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KHJlcSk7XG4gIH1cblxuICBwdWJsaWMgc3RvcFJlcXVlc3RCeUZpbGUoZmlsZTogYW55LCBjYWxsYmFjazogKCkgPT4gdm9pZCkge1xuICAgIGNvbnN0IHJlcXVlc3RPYmogPSB0aGlzLnJlcXVlc3RzLmZpbmQocmVxID0+IHtcbiAgICAgIHJldHVybiByZXEuZmlsZS51aWQgPT09IGZpbGUudWlkO1xuICAgIH0pO1xuXG4gICAgaWYgKHJlcXVlc3RPYmopIHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSByZXF1ZXN0T2JqLnJlcXVlc3Q7XG4gICAgICByZXF1ZXN0LnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLnJlbW92ZVJlcXVlc3QocmVxdWVzdE9iaik7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVSZXF1ZXN0KHJlcXVlc3RPYmo6IGFueSkge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZXF1ZXN0cy5pbmRleE9mKHJlcXVlc3RPYmopO1xuICAgIHRoaXMucmVxdWVzdHMuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuXG4gIHB1YmxpYyBhZGRSZXF1ZXN0KGZpbGU6IFBvVXBsb2FkRmlsZSwgcmVxdWVzdDogU3Vic2NyaXB0aW9uKSB7XG4gICAgY29uc3QgaGFzUmVxdWVzdCA9IHRoaXMucmVxdWVzdHMuc29tZShyZXEgPT4ge1xuICAgICAgcmV0dXJuIHJlcS5maWxlLnVpZCA9PT0gZmlsZS51aWQ7XG4gICAgfSk7XG5cbiAgICBpZiAoIWhhc1JlcXVlc3QpIHtcbiAgICAgIHRoaXMucmVxdWVzdHMucHVzaCh7ZmlsZSwgcmVxdWVzdH0pO1xuICAgIH1cbiAgfVxuXG59XG4iXX0=