/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, forwardRef, Renderer2, ViewChild } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { formatBytes, isMobile } from '../../../utils/util';
import { PoButtonComponent } from './../../po-button/po-button.component';
import { PoI18nPipe } from '../../../services/po-i18n/po-i18n.pipe';
import { PoNotificationService } from '../../../services/po-notification/po-notification.service';
import { PoProgressStatus } from '../../po-progress/enums/po-progress-status.enum';
import { PoUploadBaseComponent } from './po-upload-base.component';
import { PoUploadDragDropComponent } from './po-upload-drag-drop/po-upload-drag-drop.component';
import { PoUploadService } from './po-upload.service';
import { PoUploadStatus } from './po-upload-status.enum';
/**
 * \@docsExtends PoUploadBaseComponent
 *
 * \@example
 *
 * <example name="po-upload-basic" title="Portinari Upload Basic">
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.html"> </file>
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-labs" title="Portinari Upload Labs">
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.html"> </file>
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-resume" title="Portinari Upload - Resume">
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.html"> </file>
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-rs" title="Portinari Upload - Realize & Show">
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.html"> </file>
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.ts"> </file>
 * </example>
 */
export class PoUploadComponent extends PoUploadBaseComponent {
    /**
     * @param {?} uploadService
     * @param {?} renderer
     * @param {?} i18nPipe
     * @param {?} notification
     */
    constructor(uploadService, renderer, i18nPipe, notification) {
        super(uploadService);
        this.renderer = renderer;
        this.i18nPipe = i18nPipe;
        this.notification = notification;
        this.infoByUploadStatus = {
            [PoUploadStatus.Uploaded]: {
                text: (/**
                 * @return {?}
                 */
                () => this.literals.sentWithSuccess),
                icon: 'po-icon-ok'
            },
            [PoUploadStatus.Error]: {
                text: (/**
                 * @return {?}
                 */
                () => this.literals.errorOccurred)
            },
            [PoUploadStatus.Uploading]: {
                text: (/**
                 * @param {?} percent
                 * @return {?}
                 */
                percent => percent + '%')
            }
        };
        this.progressStatusByFileStatus = {
            [PoUploadStatus.Uploaded]: PoProgressStatus.Success,
            [PoUploadStatus.Error]: PoProgressStatus.Error
        };
        this.calledByCleanInputValue = false;
    }
    /**
     * @return {?}
     */
    get displayDragDrop() {
        return this.dragDrop && !isMobile();
    }
    /**
     * @return {?}
     */
    get displaySendButton() {
        /** @type {?} */
        const currentFiles = this.currentFiles || [];
        return !this.hideSendButton && !this.autoUpload && (currentFiles.length > 0 && this.hasFileNotUploaded);
    }
    /**
     * @return {?}
     */
    get selectFileButtonLabel() {
        if (this.canHandleDirectory) {
            return this.literals.selectFolder;
        }
        else if (this.isMultiple) {
            return this.literals.selectFiles;
        }
        else {
            return this.literals.selectFile;
        }
    }
    /**
     * @return {?}
     */
    get hasMoreThanFourItems() {
        return this.currentFiles && this.currentFiles.length > 4;
    }
    /**
     * @return {?}
     */
    get hasMultipleFiles() {
        return this.currentFiles && this.currentFiles.length > 1;
    }
    /**
     * @return {?}
     */
    get hasFileNotUploaded() {
        if (Array.isArray(this.currentFiles)) {
            return this.currentFiles.some((/**
             * @param {?} file
             * @return {?}
             */
            file => file.status !== PoUploadStatus.Uploaded));
        }
        return false;
    }
    /**
     * @return {?}
     */
    get isDisabled() {
        /** @type {?} */
        const currentFiles = this.currentFiles || [];
        return !!(this.hasAnyFileUploading(currentFiles) ||
            !this.url ||
            this.disabled ||
            this.isExceededFileLimit(currentFiles.length));
    }
    /**
     * @return {?}
     */
    get maxFiles() {
        return this.isMultiple && this.fileRestrictions && this.fileRestrictions.maxFiles;
    }
    /**
     * @param {?} file
     * @return {?}
     */
    cancel(file) {
        if (file.status === PoUploadStatus.Uploading) {
            return this.stopUpload(file);
        }
        this.removeFile(file);
    }
    /**
     * Método responsável por **limpar** o(s) arquivo(s) selecionado(s).
     * @return {?}
     */
    clear() {
        this.currentFiles = undefined;
        this.updateModel([]);
        this.cleanInputValue();
    }
    /**
     * Função que atribui foco ao componente.
     *
     * Para utilizá-la é necessário ter a instância do componente no DOM, podendo ser utilizado o ViewChild da seguinte forma:
     *
     * ```
     * import { PoUploadComponent } from '\@portinari/portinari-ui';
     *
     * ...
     *
     * \@ViewChild(PoUploadComponent, { static: true }) upload: PoUploadComponent;
     *
     * focusUpload() {
     *   this.upload.focus();
     * }
     * ```
     * @return {?}
     */
    focus() {
        if (!this.disabled) {
            if (this.uploadButton) {
                this.uploadButton.focus();
                return;
            }
            if (this.displayDragDrop) {
                this.poUploadDragDropComponent.focus();
            }
        }
    }
    // Verifica se existe algum arquivo sendo enviado ao serviço.
    /**
     * @param {?} files
     * @return {?}
     */
    hasAnyFileUploading(files) {
        if (files && files.length) {
            return files.some((/**
             * @param {?} file
             * @return {?}
             */
            file => file.status === PoUploadStatus.Uploading));
        }
        return false;
    }
    // retorna se o status do arquivo é diferente de enviado
    /**
     * @param {?} status
     * @return {?}
     */
    isAllowCancelEvent(status) {
        return status !== PoUploadStatus.Uploaded;
    }
    // Função disparada ao selecionar algum arquivo.
    /**
     * @param {?} event
     * @return {?}
     */
    onFileChange(event) {
        // necessário este tratamento quando para IE, pois nele o change é disparado quando o campo é limpado também
        if (this.calledByCleanInputValue) {
            this.calledByCleanInputValue = false;
            return event.preventDefault();
        }
        /** @type {?} */
        const files = event.target.files;
        this.updateFiles(files);
        this.cleanInputValue();
    }
    /**
     * @param {?} files
     * @return {?}
     */
    onFileChangeDragDrop(files) {
        this.updateFiles(files);
    }
    // Remove o arquivo passado por parâmetro da lista dos arquivos correntes.
    /**
     * @param {?} file
     * @return {?}
     */
    removeFile(file) {
        /** @type {?} */
        const index = this.currentFiles.indexOf(file);
        this.currentFiles.splice(index, 1);
        this.updateModel([...this.currentFiles]);
    }
    /**
     * Método responsável por **abrir** a janela para seleção de arquivo(s).
     * @return {?}
     */
    selectFiles() {
        this.calledByCleanInputValue = false;
        this.inputFile.nativeElement.click();
    }
    /**
     * @return {?}
     */
    sendFeedback() {
        if (this.sizeNotAllowed > 0) {
            /** @type {?} */
            const minFileSize = formatBytes(this.fileRestrictions.minFileSize);
            /** @type {?} */
            const maxFileSize = formatBytes(this.fileRestrictions.maxFileSize);
            /** @type {?} */
            const args = [this.sizeNotAllowed, minFileSize || '0', maxFileSize];
            this.setPipeArguments('invalidSize', args);
            this.sizeNotAllowed = 0;
        }
        if (this.extensionNotAllowed > 0) {
            /** @type {?} */
            const allowedExtensionsFormatted = this.fileRestrictions.allowedExtensions.join(', ').toUpperCase();
            /** @type {?} */
            const args = [this.extensionNotAllowed, allowedExtensionsFormatted];
            this.setPipeArguments('invalidFormat', args);
            this.extensionNotAllowed = 0;
        }
        if (this.quantityNotAllowed > 0) {
            /** @type {?} */
            const args = [this.quantityNotAllowed];
            this.setPipeArguments('invalidAmount', args);
            this.quantityNotAllowed = 0;
        }
    }
    /**
     * Método responsável por **enviar** o(s) arquivo(s) selecionado(s).
     * @return {?}
     */
    sendFiles() {
        if (this.currentFiles && this.currentFiles.length) {
            this.uploadFiles(this.currentFiles);
        }
    }
    /**
     * @param {?} canHandleDirectory
     * @return {?}
     */
    setDirectoryAttribute(canHandleDirectory) {
        if (canHandleDirectory) {
            this.renderer.setAttribute(this.inputFile.nativeElement, 'webkitdirectory', 'true');
        }
        else {
            this.renderer.removeAttribute(this.inputFile.nativeElement, 'webkitdirectory');
        }
    }
    // Caso o componente estiver no modo AutoUpload, o arquivo também será removido da lista.
    /**
     * @param {?} file
     * @return {?}
     */
    stopUpload(file) {
        this.uploadService.stopRequestByFile(file, (/**
         * @return {?}
         */
        () => {
            if (this.autoUpload) {
                this.removeFile(file);
            }
            else {
                this.stopUploadHandler(file);
            }
        }));
    }
    /**
     * @param {?} index
     * @param {?} file
     * @return {?}
     */
    trackByFn(index, file) {
        return file.uid;
    }
    // Envia os arquivos passados por parâmetro, exceto os que já foram enviados ao serviço.
    /**
     * @param {?} files
     * @return {?}
     */
    uploadFiles(files) {
        /** @type {?} */
        const filesFiltered = files.filter((/**
         * @param {?} file
         * @return {?}
         */
        file => file.status !== PoUploadStatus.Uploaded));
        this.uploadService.upload(this.url, filesFiltered, this.onUpload, (/**
         * @param {?} file
         * @param {?} percent
         * @return {?}
         */
        (file, percent) => {
            this.uploadingHandler(file, percent);
        }), (/**
         * @param {?} file
         * @param {?} eventResponse
         * @return {?}
         */
        (file, eventResponse) => {
            this.responseHandler(file, PoUploadStatus.Uploaded);
            this.onSuccess.emit(eventResponse);
        }), (/**
         * @param {?} file
         * @param {?} eventError
         * @return {?}
         */
        (file, eventError) => {
            this.responseHandler(file, PoUploadStatus.Error);
            this.onError.emit(eventError);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    cleanInputValue() {
        this.calledByCleanInputValue = true;
        this.inputFile.nativeElement.value = '';
    }
    // função disparada na resposta do sucesso ou error
    /**
     * @private
     * @param {?} file
     * @param {?} status
     * @return {?}
     */
    responseHandler(file, status) {
        file.status = status;
        file.percent = 100;
    }
    // método responsável por setar os argumentos do i18nPipe de acordo com a restrição.
    /**
     * @private
     * @param {?} literalAttributes
     * @param {?=} literalArguments
     * @return {?}
     */
    setPipeArguments(literalAttributes, literalArguments) {
        /** @type {?} */
        const pipeArguments = this.i18nPipe.transform(this.literals[literalAttributes], literalArguments);
        this.notification.information(pipeArguments);
    }
    // Função disparada ao parar um envio de arquivo.
    /**
     * @private
     * @param {?} file
     * @return {?}
     */
    stopUploadHandler(file) {
        file.status = PoUploadStatus.None;
        file.percent = 0;
    }
    /**
     * @private
     * @param {?} files
     * @return {?}
     */
    updateFiles(files) {
        this.currentFiles = this.parseFiles(files);
        this.updateModel([...this.currentFiles]);
        if (this.autoUpload) {
            this.uploadFiles(this.currentFiles);
        }
    }
    // Atualiza o ngModel para os arquivos passados por parâmetro.
    /**
     * @private
     * @param {?} files
     * @return {?}
     */
    updateModel(files) {
        /** @type {?} */
        const modelFiles = this.mapCleanUploadFiles(files);
        this.onModelChange ? this.onModelChange(modelFiles) : this.ngModelChange.emit(modelFiles);
    }
    // Função disparada enquanto o arquivo está sendo enviado ao serviço.
    /**
     * @private
     * @param {?} file
     * @param {?} percent
     * @return {?}
     */
    uploadingHandler(file, percent) {
        file.status = PoUploadStatus.Uploading;
        file.percent = percent;
    }
    // retorna os objetos do array sem as propriedades: percent e displayName
    /**
     * @private
     * @param {?} files
     * @return {?}
     */
    mapCleanUploadFiles(files) {
        /** @type {?} */
        const mapedByUploadFile = (/**
         * @param {?} progressFile
         * @return {?}
         */
        progressFile => {
            const { percent, displayName } = progressFile, uploadFile = tslib_1.__rest(progressFile, ["percent", "displayName"]);
            return uploadFile;
        });
        return files.map(mapedByUploadFile);
    }
}
PoUploadComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-upload',
                template: "<po-field-container\r\n  [p-label]=\"label\"\r\n  [p-help]=\"help\"\r\n  [p-optional]=\"!required && optional\">\r\n\r\n  <div class=\"po-upload\">\r\n    <input\r\n      #inputFile\r\n      class=\"po-upload-input\"\r\n      type=\"file\"\r\n      [accept]=\"allowedExtensions\"\r\n      [attr.name]=\"name\"\r\n      [disabled]=\"isDisabled\"\r\n      [multiple]=\"isMultiple\"\r\n      [required]=\"required\"\r\n      (change)=\"onFileChange($event)\">\r\n\r\n    <po-upload-drag-drop *ngIf=\"displayDragDrop\"\r\n      [p-directory-compatible]=\"canHandleDirectory\"\r\n      [p-disabled]=\"isDisabled\"\r\n      [p-drag-drop-height]=\"dragDropHeight\"\r\n      [p-literals]=\"literals\"\r\n      (p-file-change)=\"onFileChangeDragDrop($event)\"\r\n      (p-select-files)=\"selectFiles()\">\r\n    </po-upload-drag-drop>\r\n\r\n    <po-button *ngIf=\"!hideSelectButton && !displayDragDrop\"\r\n      #uploadButton\r\n      class=\"po-upload-button\"\r\n      for=\"file\"\r\n      [p-disabled]=\"isDisabled\"\r\n      [p-label]=\"selectFileButtonLabel\"\r\n      (p-click)=\"selectFiles()\">\r\n    </po-button>\r\n\r\n    <po-upload-file-restrictions *ngIf=\"fileRestrictions && !hideRestrictionsInfo\"\r\n      class=\"po-upload-file-restrictions\"\r\n      [ngClass]=\"{'po-upload-file-restrictions-drag-drop' : displayDragDrop}\"\r\n      [p-allowed-extensions]=\"fileRestrictions?.allowedExtensions\"\r\n      [p-max-files]=\"maxFiles\"\r\n      [p-max-file-size]=\"fileRestrictions?.maxFileSize\"\r\n      [p-min-file-size]=\"fileRestrictions?.minFileSize\">\r\n    </po-upload-file-restrictions>\r\n\r\n    <div *ngIf=\"currentFiles && currentFiles.length\" class=\"po-upload-progress-container\">\r\n      <po-container\r\n        p-no-shadow\r\n        [p-height]=\"hasMoreThanFourItems ? 280 : 'auto'\"\r\n        [p-no-border]=\"!hasMoreThanFourItems\"\r\n        [p-no-padding]=\"!hasMoreThanFourItems\">\r\n        <div [ngClass]=\"{'po-upload-progress-container-area po-pt-2 po-pl-1': hasMoreThanFourItems}\">\r\n          <po-progress\r\n            *ngFor=\"let file of currentFiles; trackBy: trackByFn\"\r\n            [p-info]=\"infoByUploadStatus[file.status]?.text(file.percent)\"\r\n            [p-info-icon]=\"infoByUploadStatus[file.status]?.icon\"\r\n            [p-status]=\"progressStatusByFileStatus[file.status]\"\r\n            [p-text]=\"file.displayName\"\r\n            [p-value]=\"file.percent\"\r\n            (p-cancel)=\"cancel(file)\"\r\n            (p-retry)=\"uploadFiles([file])\">\r\n          </po-progress>\r\n        </div>\r\n      </po-container>\r\n    </div>\r\n\r\n    <po-button\r\n      *ngIf=\"displaySendButton\"\r\n      class=\"po-upload-send-button\"\r\n      [class.po-mt-3]=\"hasMoreThanFourItems\"\r\n      p-type=\"primary\"\r\n      [p-disabled]=\"hasAnyFileUploading(currentFiles)\"\r\n      [p-label]=\"literals.startSending\"\r\n      (p-click)=\"uploadFiles(currentFiles)\">\r\n    </po-button>\r\n  </div>\r\n\r\n</po-field-container>\r\n",
                providers: [
                    PoI18nPipe,
                    PoUploadService,
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => PoUploadComponent)),
                        multi: true,
                    },
                    {
                        provide: NG_VALIDATORS,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => PoUploadComponent)),
                        multi: true,
                    }
                ]
            }] }
];
/** @nocollapse */
PoUploadComponent.ctorParameters = () => [
    { type: PoUploadService },
    { type: Renderer2 },
    { type: PoI18nPipe },
    { type: PoNotificationService }
];
PoUploadComponent.propDecorators = {
    inputFile: [{ type: ViewChild, args: ['inputFile', { read: ElementRef, static: true },] }],
    poUploadDragDropComponent: [{ type: ViewChild, args: [PoUploadDragDropComponent, { static: false },] }],
    uploadButton: [{ type: ViewChild, args: ['uploadButton', { static: false },] }]
};
if (false) {
    /** @type {?} */
    PoUploadComponent.prototype.infoByUploadStatus;
    /** @type {?} */
    PoUploadComponent.prototype.progressStatusByFileStatus;
    /**
     * @type {?}
     * @private
     */
    PoUploadComponent.prototype.calledByCleanInputValue;
    /**
     * @type {?}
     * @private
     */
    PoUploadComponent.prototype.inputFile;
    /**
     * @type {?}
     * @private
     */
    PoUploadComponent.prototype.poUploadDragDropComponent;
    /**
     * @type {?}
     * @private
     */
    PoUploadComponent.prototype.uploadButton;
    /** @type {?} */
    PoUploadComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PoUploadComponent.prototype.i18nPipe;
    /**
     * @type {?}
     * @private
     */
    PoUploadComponent.prototype.notification;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tdXBsb2FkL3BvLXVwbG9hZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RixPQUFPLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMxRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkRBQTJELENBQUM7QUFDbEcsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saURBQWlELENBQUM7QUFFbkYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0scURBQXFELENBQUM7QUFFaEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2Q3pELE1BQU0sT0FBTyxpQkFBa0IsU0FBUSxxQkFBcUI7Ozs7Ozs7SUEwQjFELFlBQ0UsYUFBOEIsRUFDdkIsUUFBbUIsRUFDbEIsUUFBb0IsRUFDcEIsWUFBbUM7UUFDM0MsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBSGQsYUFBUSxHQUFSLFFB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QUFPLEVBQUUsYUFBYTt3QkFDdEIsV0FBVyxFQUFFLFVBQVU7Ozt3QkFBQyxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsRUFBQzt3QkFDaEQsS0FBSyxFQUFFLElBQUk7cUJBQ1o7aUJBQ0Y7YUFDRjs7OztZQTdDUSxlQUFlO1lBWm9CLFNBQVM7WUFLNUMsVUFBVTtZQUNWLHFCQUFxQjs7O3dCQTBFM0IsU0FBUyxTQUFDLFdBQVcsRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTt3Q0FDeEQsU0FBUyxTQUFDLHlCQUF5QixFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTsyQkFDdEQsU0FBUyxTQUFDLGNBQWMsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7Ozs7SUF0QjVDLCtDQVdFOztJQUVGLHVEQUdFOzs7OztJQUVGLG9EQUFpRDs7Ozs7SUFFakQsc0NBQXlGOzs7OztJQUN6RixzREFBc0g7Ozs7O0lBQ3RILHlDQUFzRjs7SUFJcEYscUNBQTBCOzs7OztJQUMxQixxQ0FBNEI7Ozs7O0lBQzVCLHlDQUEyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgUmVuZGVyZXIyLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTkdfVkFMSURBVE9SUywgTkdfVkFMVUVfQUNDRVNTT1IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5pbXBvcnQgeyBmb3JtYXRCeXRlcywgaXNNb2JpbGUgfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcclxuaW1wb3J0IHsgUG9CdXR0b25Db21wb25lbnQgfSBmcm9tICcuLy4uLy4uL3BvLWJ1dHRvbi9wby1idXR0b24uY29tcG9uZW50JztcclxuaW1wb3J0IHsgUG9JMThuUGlwZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWkxOG4vcG8taTE4bi5waXBlJztcclxuaW1wb3J0IHsgUG9Ob3RpZmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZXMvcG8tbm90aWZpY2F0aW9uL3BvLW5vdGlmaWNhdGlvbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUG9Qcm9ncmVzc1N0YXR1cyB9IGZyb20gJy4uLy4uL3BvLXByb2dyZXNzL2VudW1zL3BvLXByb2dyZXNzLXN0YXR1cy5lbnVtJztcclxuXHJcbmltcG9ydCB7IFBvVXBsb2FkQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tdXBsb2FkLWJhc2UuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudCB9IGZyb20gJy4vcG8tdXBsb2FkLWRyYWctZHJvcC9wby11cGxvYWQtZHJhZy1kcm9wLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IFBvVXBsb2FkRmlsZSB9IGZyb20gJy4vcG8tdXBsb2FkLWZpbGUnO1xyXG5pbXBvcnQgeyBQb1VwbG9hZFNlcnZpY2UgfSBmcm9tICcuL3BvLXVwbG9hZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgUG9VcGxvYWRTdGF0dXMgfSBmcm9tICcuL3BvLXVwbG9hZC1zdGF0dXMuZW51bSc7XHJcblxyXG4vKipcclxuICogQGRvY3NFeHRlbmRzIFBvVXBsb2FkQmFzZUNvbXBvbmVudFxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKlxyXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tdXBsb2FkLWJhc2ljXCIgdGl0bGU9XCJQb3J0aW5hcmkgVXBsb2FkIEJhc2ljXCI+XHJcbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtYmFzaWMvc2FtcGxlLXBvLXVwbG9hZC1iYXNpYy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XHJcbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtYmFzaWMvc2FtcGxlLXBvLXVwbG9hZC1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxyXG4gKiA8L2V4YW1wbGU+XHJcbiAqXHJcbiAqIDxleGFtcGxlIG5hbWU9XCJwby11cGxvYWQtbGFic1wiIHRpdGxlPVwiUG9ydGluYXJpIFVwbG9hZCBMYWJzXCI+XHJcbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtbGFicy9zYW1wbGUtcG8tdXBsb2FkLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWxhYnMvc2FtcGxlLXBvLXVwbG9hZC1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XHJcbiAqIDwvZXhhbXBsZT5cclxuICpcclxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1yZXN1bWVcIiB0aXRsZT1cIlBvcnRpbmFyaSBVcGxvYWQgLSBSZXN1bWVcIj5cclxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUvc2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLXJlc3VtZS9zYW1wbGUtcG8tdXBsb2FkLXJlc3VtZS5jb21wb25lbnQudHNcIj4gPC9maWxlPlxyXG4gKiA8L2V4YW1wbGU+XHJcbiAqXHJcbiAqIDxleGFtcGxlIG5hbWU9XCJwby11cGxvYWQtcnNcIiB0aXRsZT1cIlBvcnRpbmFyaSBVcGxvYWQgLSBSZWFsaXplICYgU2hvd1wiPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLXJzL3NhbXBsZS1wby11cGxvYWQtcnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxyXG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLXJzL3NhbXBsZS1wby11cGxvYWQtcnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cclxuICogPC9leGFtcGxlPlxyXG4gKi9cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdwby11cGxvYWQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnLi9wby11cGxvYWQuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHByb3ZpZGVyczogW1xyXG4gICAgUG9JMThuUGlwZSxcclxuICAgIFBvVXBsb2FkU2VydmljZSxcclxuICAgIHtcclxuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXHJcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFBvVXBsb2FkQ29tcG9uZW50KSxcclxuICAgICAgbXVsdGk6IHRydWUsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBwcm92aWRlOiBOR19WQUxJREFUT1JTLFxyXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb1VwbG9hZENvbXBvbmVudCksXHJcbiAgICAgIG11bHRpOiB0cnVlLFxyXG4gICAgfVxyXG4gIF1cclxufSlcclxuZXhwb3J0IGNsYXNzIFBvVXBsb2FkQ29tcG9uZW50IGV4dGVuZHMgUG9VcGxvYWRCYXNlQ29tcG9uZW50IHtcclxuXHJcbiAgaW5mb0J5VXBsb2FkU3RhdHVzOiB7IFtrZXk6IHN0cmluZyBdOiB7IHRleHQ6IChwZXJjZW50PzogbnVtYmVyKSA9PiBzdHJpbmcsIGljb24/OiBzdHJpbmcgfSB9ID0ge1xyXG4gICAgW1BvVXBsb2FkU3RhdHVzLlVwbG9hZGVkXToge1xyXG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLnNlbnRXaXRoU3VjY2VzcyxcclxuICAgICAgaWNvbjogJ3BvLWljb24tb2snXHJcbiAgICB9LFxyXG4gICAgW1BvVXBsb2FkU3RhdHVzLkVycm9yXToge1xyXG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLmVycm9yT2NjdXJyZWRcclxuICAgIH0sXHJcbiAgICBbUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nXToge1xyXG4gICAgICB0ZXh0OiBwZXJjZW50ID0+IHBlcmNlbnQgKyAnJSdcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBwcm9ncmVzc1N0YXR1c0J5RmlsZVN0YXR1cyA9IHtcclxuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZF06IFBvUHJvZ3Jlc3NTdGF0dXMuU3VjY2VzcyxcclxuICAgIFtQb1VwbG9hZFN0YXR1cy5FcnJvcl06IFBvUHJvZ3Jlc3NTdGF0dXMuRXJyb3JcclxuICB9O1xyXG5cclxuICBwcml2YXRlIGNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlOiBib29sZWFuID0gZmFsc2U7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ2lucHV0RmlsZScsIHtyZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBpbnB1dEZpbGU6IEVsZW1lbnRSZWY7XHJcbiAgQFZpZXdDaGlsZChQb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50LCB7IHN0YXRpYzogZmFsc2UgfSkgcHJpdmF0ZSBwb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50OiBQb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50O1xyXG4gIEBWaWV3Q2hpbGQoJ3VwbG9hZEJ1dHRvbicsIHsgc3RhdGljOiBmYWxzZSB9KSBwcml2YXRlIHVwbG9hZEJ1dHRvbjogUG9CdXR0b25Db21wb25lbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgdXBsb2FkU2VydmljZTogUG9VcGxvYWRTZXJ2aWNlLFxyXG4gICAgcHVibGljIHJlbmRlcmVyOiBSZW5kZXJlcjIsXHJcbiAgICBwcml2YXRlIGkxOG5QaXBlOiBQb0kxOG5QaXBlLFxyXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb246IFBvTm90aWZpY2F0aW9uU2VydmljZSkge1xyXG4gICAgc3VwZXIodXBsb2FkU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGlzcGxheURyYWdEcm9wKCk6IGJvb2xlYW4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZHJhZ0Ryb3AgJiYgIWlzTW9iaWxlKCk7XHJcbiAgfVxyXG5cclxuICBnZXQgZGlzcGxheVNlbmRCdXR0b24oKTogYm9vbGVhbiB7XHJcbiAgICBjb25zdCBjdXJyZW50RmlsZXMgPSB0aGlzLmN1cnJlbnRGaWxlcyB8fCBbXTtcclxuICAgIHJldHVybiAhdGhpcy5oaWRlU2VuZEJ1dHRvbiAmJiAhdGhpcy5hdXRvVXBsb2FkICYmIChjdXJyZW50RmlsZXMubGVuZ3RoID4gMCAmJiB0aGlzLmhhc0ZpbGVOb3RVcGxvYWRlZCk7XHJcbiAgfVxyXG5cclxuICBnZXQgc2VsZWN0RmlsZUJ1dHRvbkxhYmVsKCkge1xyXG4gICAgaWYgKHRoaXMuY2FuSGFuZGxlRGlyZWN0b3J5KSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZvbGRlcjtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5pc011bHRpcGxlKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZpbGVzO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMuc2VsZWN0RmlsZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldCBoYXNNb3JlVGhhbkZvdXJJdGVtcygpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlcyAmJiB0aGlzLmN1cnJlbnRGaWxlcy5sZW5ndGggPiA0O1xyXG4gIH1cclxuXHJcbiAgZ2V0IGhhc011bHRpcGxlRmlsZXMoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RmlsZXMgJiYgdGhpcy5jdXJyZW50RmlsZXMubGVuZ3RoID4gMTtcclxuICB9XHJcblxyXG4gIGdldCBoYXNGaWxlTm90VXBsb2FkZWQoKTogYm9vbGVhbiB7XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmN1cnJlbnRGaWxlcykpIHtcclxuICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLnN0YXR1cyAhPT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGdldCBpc0Rpc2FibGVkKCk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgY3VycmVudEZpbGVzID0gdGhpcy5jdXJyZW50RmlsZXMgfHwgW107XHJcblxyXG4gICAgcmV0dXJuICEhKHRoaXMuaGFzQW55RmlsZVVwbG9hZGluZyhjdXJyZW50RmlsZXMpIHx8XHJcbiAgICAhdGhpcy51cmwgfHxcclxuICAgIHRoaXMuZGlzYWJsZWQgfHxcclxuICAgIHRoaXMuaXNFeGNlZWRlZEZpbGVMaW1pdChjdXJyZW50RmlsZXMubGVuZ3RoKSk7XHJcbiAgfVxyXG5cclxuICBnZXQgbWF4RmlsZXMoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLmlzTXVsdGlwbGUgJiYgdGhpcy5maWxlUmVzdHJpY3Rpb25zICYmIHRoaXMuZmlsZVJlc3RyaWN0aW9ucy5tYXhGaWxlcztcclxuICB9XHJcblxyXG4gIGNhbmNlbChmaWxlOiBQb1VwbG9hZEZpbGUpIHtcclxuICAgIGlmIChmaWxlLnN0YXR1cyA9PT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLnN0b3BVcGxvYWQoZmlsZSk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZW1vdmVGaWxlKGZpbGUpO1xyXG4gIH1cclxuXHJcbiAgLyoqIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciAqKmxpbXBhcioqIG8ocykgYXJxdWl2byhzKSBzZWxlY2lvbmFkbyhzKS4gKi9cclxuICBjbGVhcigpIHtcclxuICAgIHRoaXMuY3VycmVudEZpbGVzID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy51cGRhdGVNb2RlbChbXSk7XHJcbiAgICB0aGlzLmNsZWFuSW5wdXRWYWx1ZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRnVuw6fDo28gcXVlIGF0cmlidWkgZm9jbyBhbyBjb21wb25lbnRlLlxyXG4gICAqXHJcbiAgICogUGFyYSB1dGlsaXrDoS1sYSDDqSBuZWNlc3PDoXJpbyB0ZXIgYSBpbnN0w6JuY2lhIGRvIGNvbXBvbmVudGUgbm8gRE9NLCBwb2RlbmRvIHNlciB1dGlsaXphZG8gbyBWaWV3Q2hpbGQgZGEgc2VndWludGUgZm9ybWE6XHJcbiAgICpcclxuICAgKiBgYGBcclxuICAgKiBpbXBvcnQgeyBQb1VwbG9hZENvbXBvbmVudCB9IGZyb20gJ0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpJztcclxuICAgKlxyXG4gICAqIC4uLlxyXG4gICAqXHJcbiAgICogQFZpZXdDaGlsZChQb1VwbG9hZENvbXBvbmVudCwgeyBzdGF0aWM6IHRydWUgfSkgdXBsb2FkOiBQb1VwbG9hZENvbXBvbmVudDtcclxuICAgKlxyXG4gICAqIGZvY3VzVXBsb2FkKCkge1xyXG4gICAqICAgdGhpcy51cGxvYWQuZm9jdXMoKTtcclxuICAgKiB9XHJcbiAgICogYGBgXHJcbiAgICovXHJcbiAgZm9jdXMoKSB7XHJcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgaWYgKHRoaXMudXBsb2FkQnV0dG9uKSB7XHJcbiAgICAgICAgdGhpcy51cGxvYWRCdXR0b24uZm9jdXMoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLmRpc3BsYXlEcmFnRHJvcCkge1xyXG4gICAgICAgIHRoaXMucG9VcGxvYWREcmFnRHJvcENvbXBvbmVudC5mb2N1cygpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBWZXJpZmljYSBzZSBleGlzdGUgYWxndW0gYXJxdWl2byBzZW5kbyBlbnZpYWRvIGFvIHNlcnZpw6dvLlxyXG4gIGhhc0FueUZpbGVVcGxvYWRpbmcoZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4pIHtcclxuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGgpIHtcclxuICAgICAgcmV0dXJuIGZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLnN0YXR1cyA9PT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkaW5nKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvLyByZXRvcm5hIHNlIG8gc3RhdHVzIGRvIGFycXVpdm8gw6kgZGlmZXJlbnRlIGRlIGVudmlhZG9cclxuICBpc0FsbG93Q2FuY2VsRXZlbnQoc3RhdHVzOiBQb1VwbG9hZFN0YXR1cykge1xyXG4gICAgcmV0dXJuIHN0YXR1cyAhPT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQ7XHJcbiAgfVxyXG5cclxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgYW8gc2VsZWNpb25hciBhbGd1bSBhcnF1aXZvLlxyXG4gIG9uRmlsZUNoYW5nZShldmVudCk6IHZvaWQge1xyXG5cclxuICAgIC8vIG5lY2Vzc8OhcmlvIGVzdGUgdHJhdGFtZW50byBxdWFuZG8gcGFyYSBJRSwgcG9pcyBuZWxlIG8gY2hhbmdlIMOpIGRpc3BhcmFkbyBxdWFuZG8gbyBjYW1wbyDDqSBsaW1wYWRvIHRhbWLDqW1cclxuICAgIGlmICh0aGlzLmNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlKSB7XHJcbiAgICAgIHRoaXMuY2FsbGVkQnlDbGVhbklucHV0VmFsdWUgPSBmYWxzZTtcclxuICAgICAgcmV0dXJuIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXM7XHJcbiAgICB0aGlzLnVwZGF0ZUZpbGVzKGZpbGVzKTtcclxuXHJcbiAgICB0aGlzLmNsZWFuSW5wdXRWYWx1ZSgpO1xyXG4gIH1cclxuXHJcbiAgb25GaWxlQ2hhbmdlRHJhZ0Ryb3AoZmlsZXMpIHtcclxuICAgIHRoaXMudXBkYXRlRmlsZXMoZmlsZXMpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmVtb3ZlIG8gYXJxdWl2byBwYXNzYWRvIHBvciBwYXLDom1ldHJvIGRhIGxpc3RhIGRvcyBhcnF1aXZvcyBjb3JyZW50ZXMuXHJcbiAgcmVtb3ZlRmlsZShmaWxlKTogdm9pZCB7XHJcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY3VycmVudEZpbGVzLmluZGV4T2YoZmlsZSk7XHJcbiAgICB0aGlzLmN1cnJlbnRGaWxlcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG5cclxuICAgIHRoaXMudXBkYXRlTW9kZWwoWy4uLnRoaXMuY3VycmVudEZpbGVzXSk7XHJcbiAgfVxyXG5cclxuICAvKiogTcOpdG9kbyByZXNwb25zw6F2ZWwgcG9yICoqYWJyaXIqKiBhIGphbmVsYSBwYXJhIHNlbGXDp8OjbyBkZSBhcnF1aXZvKHMpLiAqL1xyXG4gIHNlbGVjdEZpbGVzKCkge1xyXG4gICAgdGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSA9IGZhbHNlO1xyXG4gICAgdGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudC5jbGljaygpO1xyXG4gIH1cclxuXHJcbiAgc2VuZEZlZWRiYWNrKCk6IHZvaWQge1xyXG5cclxuICAgIGlmICh0aGlzLnNpemVOb3RBbGxvd2VkID4gMCkge1xyXG4gICAgICBjb25zdCBtaW5GaWxlU2l6ZSA9IGZvcm1hdEJ5dGVzKHRoaXMuZmlsZVJlc3RyaWN0aW9ucy5taW5GaWxlU2l6ZSk7XHJcbiAgICAgIGNvbnN0IG1heEZpbGVTaXplID0gZm9ybWF0Qnl0ZXModGhpcy5maWxlUmVzdHJpY3Rpb25zLm1heEZpbGVTaXplKTtcclxuICAgICAgY29uc3QgYXJncyA9IFsgdGhpcy5zaXplTm90QWxsb3dlZCwgbWluRmlsZVNpemUgfHwgJzAnLCBtYXhGaWxlU2l6ZSBdO1xyXG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRTaXplJywgYXJncyk7XHJcbiAgICAgIHRoaXMuc2l6ZU5vdEFsbG93ZWQgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmV4dGVuc2lvbk5vdEFsbG93ZWQgPiAwKSB7XHJcbiAgICAgIGNvbnN0IGFsbG93ZWRFeHRlbnNpb25zRm9ybWF0dGVkID0gdGhpcy5maWxlUmVzdHJpY3Rpb25zLmFsbG93ZWRFeHRlbnNpb25zLmpvaW4oJywgJykudG9VcHBlckNhc2UoKTtcclxuICAgICAgY29uc3QgYXJncyA9IFsgdGhpcy5leHRlbnNpb25Ob3RBbGxvd2VkLCBhbGxvd2VkRXh0ZW5zaW9uc0Zvcm1hdHRlZCBdO1xyXG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRGb3JtYXQnLCBhcmdzKTtcclxuICAgICAgdGhpcy5leHRlbnNpb25Ob3RBbGxvd2VkID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5xdWFudGl0eU5vdEFsbG93ZWQgPiAwKSB7XHJcbiAgICAgIGNvbnN0IGFyZ3MgPSBbIHRoaXMucXVhbnRpdHlOb3RBbGxvd2VkIF07XHJcbiAgICAgIHRoaXMuc2V0UGlwZUFyZ3VtZW50cygnaW52YWxpZEFtb3VudCcsIGFyZ3MpO1xyXG4gICAgICB0aGlzLnF1YW50aXR5Tm90QWxsb3dlZCA9IDA7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgLyoqIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciAqKmVudmlhcioqIG8ocykgYXJxdWl2byhzKSBzZWxlY2lvbmFkbyhzKS4gKi9cclxuICBzZW5kRmlsZXMoKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jdXJyZW50RmlsZXMgJiYgdGhpcy5jdXJyZW50RmlsZXMubGVuZ3RoKSB7XHJcblxyXG4gICAgICB0aGlzLnVwbG9hZEZpbGVzKHRoaXMuY3VycmVudEZpbGVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNldERpcmVjdG9yeUF0dHJpYnV0ZShjYW5IYW5kbGVEaXJlY3Rvcnk6IGJvb2xlYW4pIHtcclxuICAgIGlmIChjYW5IYW5kbGVEaXJlY3RvcnkpIHtcclxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudCwgJ3dlYmtpdGRpcmVjdG9yeScsICd0cnVlJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUF0dHJpYnV0ZSh0aGlzLmlucHV0RmlsZS5uYXRpdmVFbGVtZW50LCAnd2Via2l0ZGlyZWN0b3J5Jyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBDYXNvIG8gY29tcG9uZW50ZSBlc3RpdmVyIG5vIG1vZG8gQXV0b1VwbG9hZCwgbyBhcnF1aXZvIHRhbWLDqW0gc2Vyw6EgcmVtb3ZpZG8gZGEgbGlzdGEuXHJcbiAgc3RvcFVwbG9hZChmaWxlOiBQb1VwbG9hZEZpbGUpIHtcclxuICAgIHRoaXMudXBsb2FkU2VydmljZS5zdG9wUmVxdWVzdEJ5RmlsZShmaWxlLCAoKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLmF1dG9VcGxvYWQpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZUZpbGUoZmlsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9wVXBsb2FkSGFuZGxlcihmaWxlKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICB0cmFja0J5Rm4oaW5kZXgsIGZpbGU6IFBvVXBsb2FkRmlsZSkge1xyXG4gICAgcmV0dXJuIGZpbGUudWlkO1xyXG4gIH1cclxuXHJcbiAgLy8gRW52aWEgb3MgYXJxdWl2b3MgcGFzc2Fkb3MgcG9yIHBhcsOibWV0cm8sIGV4Y2V0byBvcyBxdWUgasOhIGZvcmFtIGVudmlhZG9zIGFvIHNlcnZpw6dvLlxyXG4gIHVwbG9hZEZpbGVzKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KSB7XHJcbiAgICBjb25zdCBmaWxlc0ZpbHRlcmVkID0gZmlsZXMuZmlsdGVyKGZpbGUgPT4gZmlsZS5zdGF0dXMgIT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkKTtcclxuXHJcbiAgICB0aGlzLnVwbG9hZFNlcnZpY2UudXBsb2FkKHRoaXMudXJsLCBmaWxlc0ZpbHRlcmVkLCB0aGlzLm9uVXBsb2FkLFxyXG4gICAgICAoZmlsZSwgcGVyY2VudCk6IGFueSA9PiB7IC8vIFVQTE9BRElOR1xyXG4gICAgICAgIHRoaXMudXBsb2FkaW5nSGFuZGxlcihmaWxlLCBwZXJjZW50KTtcclxuXHJcbiAgICAgIH0sIChmaWxlLCBldmVudFJlc3BvbnNlKTogYW55ID0+IHsgLy8gU1VDQ0VTU1xyXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkKTtcclxuICAgICAgICB0aGlzLm9uU3VjY2Vzcy5lbWl0KGV2ZW50UmVzcG9uc2UpO1xyXG5cclxuICAgICAgfSwgKGZpbGUsIGV2ZW50RXJyb3IpOiBhbnkgPT4geyAvLyBFcnJvclxyXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLkVycm9yKTtcclxuICAgICAgICB0aGlzLm9uRXJyb3IuZW1pdChldmVudEVycm9yKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjbGVhbklucHV0VmFsdWUoKSB7XHJcbiAgICB0aGlzLmNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlID0gdHJ1ZTtcclxuICAgIHRoaXMuaW5wdXRGaWxlLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcclxuICB9XHJcblxyXG4gIC8vIGZ1bsOnw6NvIGRpc3BhcmFkYSBuYSByZXNwb3N0YSBkbyBzdWNlc3NvIG91IGVycm9yXHJcbiAgcHJpdmF0ZSByZXNwb25zZUhhbmRsZXIoZmlsZTogUG9VcGxvYWRGaWxlLCBzdGF0dXM6IFBvVXBsb2FkU3RhdHVzKSB7XHJcbiAgICBmaWxlLnN0YXR1cyA9IHN0YXR1cztcclxuICAgIGZpbGUucGVyY2VudCA9IDEwMDtcclxuICB9XHJcblxyXG4gIC8vIG3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciBzZXRhciBvcyBhcmd1bWVudG9zIGRvIGkxOG5QaXBlIGRlIGFjb3JkbyBjb20gYSByZXN0cmnDp8Ojby5cclxuICBwcml2YXRlIHNldFBpcGVBcmd1bWVudHMobGl0ZXJhbEF0dHJpYnV0ZXM6IHN0cmluZywgbGl0ZXJhbEFyZ3VtZW50cz8pIHtcclxuICAgIGNvbnN0IHBpcGVBcmd1bWVudHMgPSB0aGlzLmkxOG5QaXBlLnRyYW5zZm9ybSh0aGlzLmxpdGVyYWxzW2xpdGVyYWxBdHRyaWJ1dGVzXSwgbGl0ZXJhbEFyZ3VtZW50cyk7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvbi5pbmZvcm1hdGlvbihwaXBlQXJndW1lbnRzKTtcclxuICB9XHJcblxyXG4gIC8vIEZ1bsOnw6NvIGRpc3BhcmFkYSBhbyBwYXJhciB1bSBlbnZpbyBkZSBhcnF1aXZvLlxyXG4gIHByaXZhdGUgc3RvcFVwbG9hZEhhbmRsZXIoZmlsZTogUG9VcGxvYWRGaWxlKSB7XHJcbiAgICBmaWxlLnN0YXR1cyA9IFBvVXBsb2FkU3RhdHVzLk5vbmU7XHJcbiAgICBmaWxlLnBlcmNlbnQgPSAwO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVGaWxlcyhmaWxlcykge1xyXG4gICAgdGhpcy5jdXJyZW50RmlsZXMgPSB0aGlzLnBhcnNlRmlsZXMoZmlsZXMpO1xyXG5cclxuICAgIHRoaXMudXBkYXRlTW9kZWwoWy4uLnRoaXMuY3VycmVudEZpbGVzXSk7XHJcblxyXG4gICAgaWYgKHRoaXMuYXV0b1VwbG9hZCkge1xyXG4gICAgICB0aGlzLnVwbG9hZEZpbGVzKHRoaXMuY3VycmVudEZpbGVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIEF0dWFsaXphIG8gbmdNb2RlbCBwYXJhIG9zIGFycXVpdm9zIHBhc3NhZG9zIHBvciBwYXLDom1ldHJvLlxyXG4gIHByaXZhdGUgdXBkYXRlTW9kZWwoZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4pIHtcclxuICAgIGNvbnN0IG1vZGVsRmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4gPSB0aGlzLm1hcENsZWFuVXBsb2FkRmlsZXMoZmlsZXMpO1xyXG4gICAgdGhpcy5vbk1vZGVsQ2hhbmdlID8gdGhpcy5vbk1vZGVsQ2hhbmdlKG1vZGVsRmlsZXMpIDogdGhpcy5uZ01vZGVsQ2hhbmdlLmVtaXQobW9kZWxGaWxlcyk7XHJcbiAgfVxyXG5cclxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgZW5xdWFudG8gbyBhcnF1aXZvIGVzdMOhIHNlbmRvIGVudmlhZG8gYW8gc2VydmnDp28uXHJcbiAgcHJpdmF0ZSB1cGxvYWRpbmdIYW5kbGVyKGZpbGU6IGFueSwgcGVyY2VudDogbnVtYmVyKSB7XHJcbiAgICBmaWxlLnN0YXR1cyA9IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGluZztcclxuICAgIGZpbGUucGVyY2VudCA9IHBlcmNlbnQ7XHJcbiAgfVxyXG5cclxuICAvLyByZXRvcm5hIG9zIG9iamV0b3MgZG8gYXJyYXkgc2VtIGFzIHByb3ByaWVkYWRlczogcGVyY2VudCBlIGRpc3BsYXlOYW1lXHJcbiAgcHJpdmF0ZSBtYXBDbGVhblVwbG9hZEZpbGVzKGZpbGVzOiBBcnJheTxQb1VwbG9hZEZpbGU+KTogQXJyYXk8UG9VcGxvYWRGaWxlPiB7XHJcbiAgICBjb25zdCBtYXBlZEJ5VXBsb2FkRmlsZSA9IHByb2dyZXNzRmlsZSA9PiB7XHJcbiAgICAgIGNvbnN0IHsgcGVyY2VudCwgZGlzcGxheU5hbWUsIC4uLnVwbG9hZEZpbGUgfSA9IHByb2dyZXNzRmlsZTtcclxuXHJcbiAgICAgIHJldHVybiB1cGxvYWRGaWxlO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gZmlsZXMubWFwKG1hcGVkQnlVcGxvYWRGaWxlKTtcclxuICB9XHJcbn1cclxuIl19