/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectorRef, Component, ElementRef, Renderer2, ViewChild } from '@angular/core';
import { animate, AnimationBuilder, keyframes, style } from '@angular/animations';
import { PoNavbarBaseComponent } from './po-navbar-base.component';
import { PoNavbarItemsComponent } from './po-navbar-items/po-navbar-items.component';
/** @type {?} */
const poNavbarNavigationWidth = 88;
/** @type {?} */
const poNavbarMenuMedia = 768;
/** @type {?} */
const poNavbarMatchMedia = `(max-width: ${poNavbarMenuMedia}px)`;
/** @type {?} */
const poNavbarTiming = '250ms ease';
/**
 * \@docsExtends PoNavbarBaseComponent
 */
export class PoNavbarComponent extends PoNavbarBaseComponent {
    /**
     * @param {?} renderer
     * @param {?} builder
     * @param {?} changeDetector
     */
    constructor(renderer, builder, changeDetector) {
        super();
        this.renderer = renderer;
        this.builder = builder;
        this.changeDetector = changeDetector;
        this.showItemsNavigation = false;
        this.offset = 0;
        this.onMediaQueryChange = (/**
         * @param {?} changed
         * @return {?}
         */
        changed => {
            this.changeNavbarMenuItems(changed.matches, this.menuItems, this.items, this.literals.navbarLinks);
        });
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.displayItemsNavigation.bind(this));
    }
    /**
     * @return {?}
     */
    get navbarItemNavigationDisableLeft() {
        return this.offset === 0;
    }
    /**
     * @return {?}
     */
    get navbarItemNavigationDisableRight() {
        return this.disableRight && this.offset !== 0;
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.displayItemsNavigation();
        if (this.menu) {
            this.initNavbarMenu();
        }
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.mediaQuery) {
            this.mediaQuery.removeListener(this.onMediaQueryChange);
        }
    }
    /**
     * @param {?} orientation
     * @return {?}
     */
    navigateItems(orientation) {
        orientation === 'left' ? this.navigateLeft() : this.navigateRight();
        this.animate(this.offset);
    }
    /**
     * @private
     * @return {?}
     */
    allNavbarItemsWidth() {
        return this.navbarItems.allNavbarItems.reduce((/**
         * @param {?} previous
         * @param {?} current
         * @return {?}
         */
        (previous, current) => previous + current.nativeElement.offsetWidth), 0);
    }
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    animate(offset) {
        /** @type {?} */
        const animation = this.buildTransitionAnimation(offset);
        this.player = animation.create(this.navbarItems.navbarItemsContainer.nativeElement);
        this.player.play();
    }
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    buildTransitionAnimation(offset) {
        return this.builder.build([
            animate(poNavbarTiming, keyframes([style({ transform: `translateX(${-offset}px)` })]))
        ]);
    }
    /**
     * @private
     * @param {?} isCollapsedMedia
     * @param {?} menuItems
     * @param {?} navbarItems
     * @param {?} label
     * @return {?}
     */
    changeNavbarMenuItems(isCollapsedMedia, menuItems, navbarItems, label) {
        if (isCollapsedMedia) {
            /** @type {?} */
            const subItems = [{ label, subItems: navbarItems }];
            this.menu.menus = [...subItems, ...menuItems];
        }
        else {
            this.menu.menus = menuItems;
        }
    }
    /**
     * @private
     * @return {?}
     */
    calculateLeftNavigation() {
        /** @type {?} */
        let calculatedOffset;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        navbarItem => {
            /** @type {?} */
            const navbarItemOffset = navbarItem.nativeElement.offsetLeft;
            /** @type {?} */
            const navbarItemWidth = navbarItem.nativeElement.offsetWidth;
            if (navbarItemOffset >= this.offset) {
                calculatedOffset = navbarItemOffset - (this.navbarItemsWidth() - navbarItemWidth);
                return true;
            }
        }));
        return calculatedOffset;
    }
    /**
     * @private
     * @param {?} itemBreakPoint
     * @return {?}
     */
    calculateRightNavigation(itemBreakPoint) {
        /** @type {?} */
        let calculatedOffset;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        navbarItem => {
            /** @type {?} */
            const offsetLeft = navbarItem.nativeElement.offsetLeft;
            /** @type {?} */
            const finalPosition = navbarItem.nativeElement.offsetWidth + offsetLeft;
            if (itemBreakPoint < finalPosition) {
                calculatedOffset = offsetLeft;
                return true;
            }
        }));
        return calculatedOffset;
    }
    /**
     * @private
     * @return {?}
     */
    displayItemsNavigation() {
        this.showItemsNavigation = this.navbarItemsWidth() < this.allNavbarItemsWidth() + poNavbarNavigationWidth;
        this.changeDetector.detectChanges();
        if (this.offset !== 0) {
            this.setOffsetToZero();
            this.animate(this.offset);
        }
    }
    /**
     * @private
     * @return {?}
     */
    initNavbarMenu() {
        this.mediaQuery = window.matchMedia(poNavbarMatchMedia);
        this.menuItems = this.menu.menus;
        if (window.innerWidth < poNavbarMenuMedia) {
            this.changeNavbarMenuItems(true, this.menuItems, this.items, this.literals.navbarLinks);
        }
        this.validateMenuLogo();
        this.mediaQuery.addListener(this.onMediaQueryChange);
    }
    /**
     * @private
     * @return {?}
     */
    navbarItemsWidth() {
        return this.navbarItemsElement.nativeElement.offsetWidth;
    }
    /**
     * @private
     * @return {?}
     */
    navigateLeft() {
        this.disableRight = false;
        this.offset = this.calculateLeftNavigation();
        if (this.offset < 0) {
            this.setOffsetToZero();
        }
    }
    /**
     * @private
     * @return {?}
     */
    navigateRight() {
        /** @type {?} */
        const maxAllowedOffset = this.allNavbarItemsWidth() - this.navbarItemsWidth();
        /** @type {?} */
        const itemBreakPoint = this.offset + this.navbarItemsWidth();
        this.offset = this.calculateRightNavigation(itemBreakPoint);
        this.validateMaxOffset(maxAllowedOffset);
    }
    /**
     * @private
     * @return {?}
     */
    setOffsetToZero() {
        this.offset = 0;
    }
    /**
     * @private
     * @param {?} maxAllowedOffset
     * @return {?}
     */
    validateMaxOffset(maxAllowedOffset) {
        if (this.offset >= maxAllowedOffset) {
            this.offset = maxAllowedOffset;
            this.disableRight = true;
        }
    }
    /**
     * @protected
     * @return {?}
     */
    validateMenuLogo() {
        if (this.menu.logo && this.logo) {
            this.menu.logo = undefined;
            this.menu.changeDetector.detectChanges();
        }
    }
}
PoNavbarComponent.decorators = [
    { type: Component, args: [{
                selector: 'po-navbar',
                template: "<header class=\"po-navbar\"\n  [ngClass]=\"{'po-navbar-shadow' : shadow}\">\n\n  <po-navbar-logo\n    class=\"po-navbar-logo\"\n    [ngClass]=\"{'po-navbar-logo-menu' : !!menu, 'po-navbar-no-logo' : !logo }\"\n    [p-logo]=\"logo\">\n  </po-navbar-logo>\n\n  <po-navbar-items\n    class=\"po-navbar-items\"\n    [p-items]=\"items\">\n  </po-navbar-items>\n\n  <po-navbar-item-navigation *ngIf=\"showItemsNavigation\"\n    class=\"po-navbar-item-navigation\"\n    [p-disable-left]=\"navbarItemNavigationDisableLeft\"\n    [p-disable-right]=\"navbarItemNavigationDisableRight\"\n    (p-click)=\"navigateItems($event)\">\n  </po-navbar-item-navigation>\n\n  <po-navbar-actions\n    class=\"po-navbar-actions\"\n    [p-icon-actions]=\"iconActions\">\n  </po-navbar-actions>\n\n</header>\n\n<po-menu *ngIf=\"!menu\"\n  [p-menus]=\"items\">\n</po-menu>"
            }] }
];
/** @nocollapse */
PoNavbarComponent.ctorParameters = () => [
    { type: Renderer2 },
    { type: AnimationBuilder },
    { type: ChangeDetectorRef }
];
PoNavbarComponent.propDecorators = {
    navbarItemsElement: [{ type: ViewChild, args: [PoNavbarItemsComponent, { read: ElementRef, static: true },] }],
    navbarItems: [{ type: ViewChild, args: [PoNavbarItemsComponent, { static: true },] }]
};
if (false) {
    /** @type {?} */
    PoNavbarComponent.prototype.disableRight;
    /** @type {?} */
    PoNavbarComponent.prototype.showItemsNavigation;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.mediaQuery;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.offset;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.player;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.menuItems;
    /**
     * @type {?}
     * @protected
     */
    PoNavbarComponent.prototype.windowResizeListener;
    /** @type {?} */
    PoNavbarComponent.prototype.navbarItemsElement;
    /** @type {?} */
    PoNavbarComponent.prototype.navbarItems;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.onMediaQueryChange;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.builder;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbmF2YmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tbmF2YmFyL3BvLW5hdmJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBaUIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBYSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3pILE9BQU8sRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQXFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUdySCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUVuRSxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSw2Q0FBNkMsQ0FBQzs7TUFFL0UsdUJBQXVCLEdBQUcsRUFBRTs7TUFDNUIsaUJBQWlCLEdBQUcsR0FBRzs7TUFDdkIsa0JBQWtCLEdBQUcsZUFBZSxpQkFBaUIsS0FBSzs7TUFDMUQsY0FBYyxHQUFHLFlBQVk7Ozs7QUFTbkMsTUFBTSxPQUFPLGlCQUFrQixTQUFRLHFCQUFxQjs7Ozs7O0lBd0IxRCxZQUFvQixRQUFtQixFQUFVLE9BQXlCLEVBQVUsY0FBaUM7UUFDbkgsS0FBSyxFQUFFLENBQUM7UUFEVSxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQVUsWUFBTyxHQUFQLE9BQU8sQ0FBa0I7UUFBVSxtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFyQnJILHdCQUFtQixHQUFZLEtBQUssQ0FBQztRQUc3QixXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBMEpuQix1QkFBa0I7Ozs7UUFBRyxPQUFPLENBQUMsRUFBRTtZQUNyQyxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFB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IHsgQWZ0ZXJWaWV3SW5pdCwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgT25EZXN0cm95LCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgYW5pbWF0ZSwgQW5pbWF0aW9uQnVpbGRlciwgQW5pbWF0aW9uRmFjdG9yeSwgQW5pbWF0aW9uUGxheWVyLCBrZXlmcmFtZXMsIHN0eWxlIH0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5cbmltcG9ydCB7IFBvTWVudUl0ZW0gfSBmcm9tICcuLi9wby1tZW51JztcbmltcG9ydCB7IFBvTmF2YmFyQmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tbmF2YmFyLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvTmF2YmFySXRlbSB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1uYXZiYXItaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9OYXZiYXJJdGVtc0NvbXBvbmVudCB9IGZyb20gJy4vcG8tbmF2YmFyLWl0ZW1zL3BvLW5hdmJhci1pdGVtcy5jb21wb25lbnQnO1xuXG5jb25zdCBwb05hdmJhck5hdmlnYXRpb25XaWR0aCA9IDg4O1xuY29uc3QgcG9OYXZiYXJNZW51TWVkaWEgPSA3Njg7XG5jb25zdCBwb05hdmJhck1hdGNoTWVkaWEgPSBgKG1heC13aWR0aDogJHtwb05hdmJhck1lbnVNZWRpYX1weClgO1xuY29uc3QgcG9OYXZiYXJUaW1pbmcgPSAnMjUwbXMgZWFzZSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvTmF2YmFyQmFzZUNvbXBvbmVudFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby1uYXZiYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tbmF2YmFyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb05hdmJhckNvbXBvbmVudCBleHRlbmRzIFBvTmF2YmFyQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cbiAgZGlzYWJsZVJpZ2h0OiBib29sZWFuO1xuICBzaG93SXRlbXNOYXZpZ2F0aW9uOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBtZWRpYVF1ZXJ5OiBhbnk7XG4gIHByaXZhdGUgb2Zmc2V0OiBudW1iZXIgPSAwO1xuICBwcml2YXRlIHBsYXllcjogQW5pbWF0aW9uUGxheWVyO1xuICBwcml2YXRlIG1lbnVJdGVtczogQXJyYXk8UG9NZW51SXRlbT47XG5cbiAgcHJvdGVjdGVkIHdpbmRvd1Jlc2l6ZUxpc3RlbmVyOiAoKSA9PiB2b2lkO1xuXG4gIGdldCBuYXZiYXJJdGVtTmF2aWdhdGlvbkRpc2FibGVMZWZ0KCkge1xuICAgIHJldHVybiB0aGlzLm9mZnNldCA9PT0gMDtcbiAgfVxuXG4gIGdldCBuYXZiYXJJdGVtTmF2aWdhdGlvbkRpc2FibGVSaWdodCgpIHtcbiAgICByZXR1cm4gdGhpcy5kaXNhYmxlUmlnaHQgJiYgdGhpcy5vZmZzZXQgIT09IDA7XG4gIH1cblxuICBAVmlld0NoaWxkKFBvTmF2YmFySXRlbXNDb21wb25lbnQsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pIG5hdmJhckl0ZW1zRWxlbWVudDogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkKFBvTmF2YmFySXRlbXNDb21wb25lbnQsIHsgc3RhdGljOiB0cnVlIH0pIG5hdmJhckl0ZW1zOiBQb05hdmJhckl0ZW1zQ29tcG9uZW50O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMiwgcHJpdmF0ZSBidWlsZGVyOiBBbmltYXRpb25CdWlsZGVyLCBwcml2YXRlIGNoYW5nZURldGVjdG9yOiBDaGFuZ2VEZXRlY3RvclJlZikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lciA9IHRoaXMucmVuZGVyZXIubGlzdGVuKHdpbmRvdywgJ3Jlc2l6ZScsIHRoaXMuZGlzcGxheUl0ZW1zTmF2aWdhdGlvbi5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmRpc3BsYXlJdGVtc05hdmlnYXRpb24oKTtcblxuICAgIGlmICh0aGlzLm1lbnUpIHtcbiAgICAgIHRoaXMuaW5pdE5hdmJhck1lbnUoKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5tZWRpYVF1ZXJ5KSB7XG4gICAgICB0aGlzLm1lZGlhUXVlcnkucmVtb3ZlTGlzdGVuZXIodGhpcy5vbk1lZGlhUXVlcnlDaGFuZ2UpO1xuICAgIH1cbiAgfVxuXG4gIG5hdmlnYXRlSXRlbXMob3JpZW50YXRpb246IHN0cmluZykge1xuICAgIG9yaWVudGF0aW9uID09PSAnbGVmdCcgPyB0aGlzLm5hdmlnYXRlTGVmdCgpIDogdGhpcy5uYXZpZ2F0ZVJpZ2h0KCk7XG5cbiAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICB9XG5cbiAgcHJpdmF0ZSBhbGxOYXZiYXJJdGVtc1dpZHRoKCkge1xuICAgIHJldHVybiB0aGlzLm5hdmJhckl0ZW1zLmFsbE5hdmJhckl0ZW1zLnJlZHVjZSgocHJldmlvdXM6IGFueSwgY3VycmVudDogYW55KSA9PiBwcmV2aW91cyArIGN1cnJlbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCwgMCk7XG4gIH1cblxuICBwcml2YXRlIGFuaW1hdGUob2Zmc2V0OiBudW1iZXIpIHtcbiAgICBjb25zdCBhbmltYXRpb246IEFuaW1hdGlvbkZhY3RvcnkgPSB0aGlzLmJ1aWxkVHJhbnNpdGlvbkFuaW1hdGlvbihvZmZzZXQpO1xuXG4gICAgdGhpcy5wbGF5ZXIgPSBhbmltYXRpb24uY3JlYXRlKHRoaXMubmF2YmFySXRlbXMubmF2YmFySXRlbXNDb250YWluZXIubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy5wbGF5ZXIucGxheSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFRyYW5zaXRpb25BbmltYXRpb24ob2Zmc2V0OiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5idWlsZGVyLmJ1aWxkKFtcbiAgICAgIGFuaW1hdGUoXG4gICAgICAgIHBvTmF2YmFyVGltaW5nLFxuICAgICAgICBrZXlmcmFtZXMoW3N0eWxlKHsgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWCgkey1vZmZzZXR9cHgpYCB9KV0pXG4gICAgICApXG4gICAgXSk7XG4gIH1cblxuICBwcml2YXRlIGNoYW5nZU5hdmJhck1lbnVJdGVtcyhpc0NvbGxhcHNlZE1lZGlhOiBhbnksIG1lbnVJdGVtczogQXJyYXk8UG9NZW51SXRlbT4sIG5hdmJhckl0ZW1zOiBBcnJheTxQb05hdmJhckl0ZW0+LCBsYWJlbDogc3RyaW5nKSB7XG5cbiAgICBpZiAoaXNDb2xsYXBzZWRNZWRpYSkge1xuICAgICAgY29uc3Qgc3ViSXRlbXMgPSBbeyBsYWJlbCwgc3ViSXRlbXM6IG5hdmJhckl0ZW1zIH1dO1xuICAgICAgdGhpcy5tZW51Lm1lbnVzID0gWy4uLnN1Ykl0ZW1zLCAuLi5tZW51SXRlbXNdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm1lbnUubWVudXMgPSBtZW51SXRlbXM7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVMZWZ0TmF2aWdhdGlvbigpIHtcblxuICAgIGxldCBjYWxjdWxhdGVkT2Zmc2V0OiBudW1iZXI7XG5cbiAgICB0aGlzLm5hdmJhckl0ZW1zLmFsbE5hdmJhckl0ZW1zLnNvbWUobmF2YmFySXRlbSA9PiB7XG4gICAgICBjb25zdCBuYXZiYXJJdGVtT2Zmc2V0ID0gbmF2YmFySXRlbS5uYXRpdmVFbGVtZW50Lm9mZnNldExlZnQ7XG4gICAgICBjb25zdCBuYXZiYXJJdGVtV2lkdGggPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG5cbiAgICAgIGlmIChuYXZiYXJJdGVtT2Zmc2V0ID49IHRoaXMub2Zmc2V0KSB7XG4gICAgICAgIGNhbGN1bGF0ZWRPZmZzZXQgPSBuYXZiYXJJdGVtT2Zmc2V0IC0gKHRoaXMubmF2YmFySXRlbXNXaWR0aCgpIC0gbmF2YmFySXRlbVdpZHRoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNhbGN1bGF0ZWRPZmZzZXQ7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJpZ2h0TmF2aWdhdGlvbihpdGVtQnJlYWtQb2ludDogbnVtYmVyKSB7XG5cbiAgICBsZXQgY2FsY3VsYXRlZE9mZnNldDogbnVtYmVyO1xuXG4gICAgdGhpcy5uYXZiYXJJdGVtcy5hbGxOYXZiYXJJdGVtcy5zb21lKG5hdmJhckl0ZW0gPT4ge1xuICAgICAgY29uc3Qgb2Zmc2V0TGVmdCA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuICAgICAgY29uc3QgZmluYWxQb3NpdGlvbiA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aCArIG9mZnNldExlZnQ7XG5cbiAgICAgIGlmIChpdGVtQnJlYWtQb2ludCA8IGZpbmFsUG9zaXRpb24pIHtcbiAgICAgICAgY2FsY3VsYXRlZE9mZnNldCA9IG9mZnNldExlZnQ7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgcmV0dXJuIGNhbGN1bGF0ZWRPZmZzZXQ7XG4gIH1cblxuICBwcml2YXRlIGRpc3BsYXlJdGVtc05hdmlnYXRpb24oKSB7XG4gICAgdGhpcy5zaG93SXRlbXNOYXZpZ2F0aW9uID0gdGhpcy5uYXZiYXJJdGVtc1dpZHRoKCkgPCB0aGlzLmFsbE5hdmJhckl0ZW1zV2lkdGgoKSArIHBvTmF2YmFyTmF2aWdhdGlvbldpZHRoO1xuXG4gICAgdGhpcy5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG5cbiAgICBpZiAodGhpcy5vZmZzZXQgIT09IDApIHtcbiAgICAgIHRoaXMuc2V0T2Zmc2V0VG9aZXJvKCk7XG4gICAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5pdE5hdmJhck1lbnUoKSB7XG4gICAgdGhpcy5tZWRpYVF1ZXJ5ID0gd2luZG93Lm1hdGNoTWVkaWEocG9OYXZiYXJNYXRjaE1lZGlhKTtcbiAgICB0aGlzLm1lbnVJdGVtcyA9IHRoaXMubWVudS5tZW51cztcblxuICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8IHBvTmF2YmFyTWVudU1lZGlhKSB7XG4gICAgICB0aGlzLmNoYW5nZU5hdmJhck1lbnVJdGVtcyh0cnVlLCB0aGlzLm1lbnVJdGVtcywgdGhpcy5pdGVtcywgdGhpcy5saXRlcmFscy5uYXZiYXJMaW5rcyk7XG4gICAgfVxuXG4gICAgdGhpcy52YWxpZGF0ZU1lbnVMb2dvKCk7XG5cbiAgICB0aGlzLm1lZGlhUXVlcnkuYWRkTGlzdGVuZXIodGhpcy5vbk1lZGlhUXVlcnlDaGFuZ2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBuYXZiYXJJdGVtc1dpZHRoKCkge1xuICAgIHJldHVybiB0aGlzLm5hdmJhckl0ZW1zRWxlbWVudC5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuICB9XG5cbiAgcHJpdmF0ZSBuYXZpZ2F0ZUxlZnQoKSB7XG4gICAgdGhpcy5kaXNhYmxlUmlnaHQgPSBmYWxzZTtcblxuICAgIHRoaXMub2Zmc2V0ID0gdGhpcy5jYWxjdWxhdGVMZWZ0TmF2aWdhdGlvbigpO1xuXG4gICAgaWYgKHRoaXMub2Zmc2V0IDwgMCkge1xuICAgICAgdGhpcy5zZXRPZmZzZXRUb1plcm8oKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIG5hdmlnYXRlUmlnaHQoKSB7XG5cbiAgICBjb25zdCBtYXhBbGxvd2VkT2Zmc2V0ID0gdGhpcy5hbGxOYXZiYXJJdGVtc1dpZHRoKCkgLSB0aGlzLm5hdmJhckl0ZW1zV2lkdGgoKTtcbiAgICBjb25zdCBpdGVtQnJlYWtQb2ludCA9IHRoaXMub2Zmc2V0ICsgdGhpcy5uYXZiYXJJdGVtc1dpZHRoKCk7XG5cbiAgICB0aGlzLm9mZnNldCA9IHRoaXMuY2FsY3VsYXRlUmlnaHROYXZpZ2F0aW9uKGl0ZW1CcmVha1BvaW50KTtcblxuICAgIHRoaXMudmFsaWRhdGVNYXhPZmZzZXQobWF4QWxsb3dlZE9mZnNldCk7XG4gIH1cblxuICBwcml2YXRlIG9uTWVkaWFRdWVyeUNoYW5nZSA9IGNoYW5nZWQgPT4ge1xuICAgIHRoaXMuY2hhbmdlTmF2YmFyTWVudUl0ZW1zKGNoYW5nZWQubWF0Y2hlcywgdGhpcy5tZW51SXRlbXMsIHRoaXMuaXRlbXMsIHRoaXMubGl0ZXJhbHMubmF2YmFyTGlua3MpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRPZmZzZXRUb1plcm8oKSB7XG4gICAgdGhpcy5vZmZzZXQgPSAwO1xuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZU1heE9mZnNldChtYXhBbGxvd2VkT2Zmc2V0OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5vZmZzZXQgPj0gbWF4QWxsb3dlZE9mZnNldCkge1xuICAgICAgdGhpcy5vZmZzZXQgPSBtYXhBbGxvd2VkT2Zmc2V0O1xuICAgICAgdGhpcy5kaXNhYmxlUmlnaHQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCB2YWxpZGF0ZU1lbnVMb2dvKCkge1xuICAgIGlmICh0aGlzLm1lbnUubG9nbyAmJiB0aGlzLmxvZ28pIHtcbiAgICAgIHRoaXMubWVudS5sb2dvID0gdW5kZWZpbmVkO1xuICAgICAgdGhpcy5tZW51LmNoYW5nZURldGVjdG9yLmRldGVjdENoYW5nZXMoKTtcbiAgICB9XG4gIH1cblxufVxuIl19