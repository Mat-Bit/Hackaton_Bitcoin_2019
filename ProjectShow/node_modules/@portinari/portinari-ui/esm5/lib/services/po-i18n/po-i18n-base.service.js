/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { HttpClient } from '@angular/common/http';
import { Inject } from '@angular/core';
import { Observable } from 'rxjs';
import { isLanguage, reloadCurrentPage } from '../../utils/util';
import { PoLanguageService } from '../po-language/po-language.service';
import { I18N_CONFIG } from './po-i18n-config-injection-token';
/**
 * \@description
 *
 * O serviço `PoI18nService` possibilita utilizar múltiplos idiomas e contextos na aplicação.
 *
 * > Antes da utilização do serviço, é necessário realizar a
 * [importação e configuração do módulo `PoI18nModule`](/documentation/po-i18n#i18n-config).
 *
 * **Utilização do serviço `PoI18nService`:**
 *
 * Para utilizar o serviço basta importá-lo nos componentes que necessitarem de literais e fazer a injeção de
 * dependência no construtor:
 * ```
 *  import { PoI18nService } from '\@portinari/portinari-ui';
 *  ...
 *  constructor(private poI18nService: PoI18nService) { }
 *  ...
 * ```
 *
 * Por fim realizar a busca pelas literais, inscrevendo-se no [Observable](https://angular.io/guide/observables) pelo
 * método `getLiterals()`.
 *
 * > O método `getLiterals()` pode receber um objeto do tipo da interface `PoI18nLiterals` como parâmetro,
 * porém, nenhuma das propriedades são obrigatórias. Caso nenhum parâmetro seja passado, serão buscadas
 * todas as literais do contexto definido com padrão, no idioma definido como padrão.
 *
 * Exemplos de requisição:
 * ```
 * literals = {};
 * literalsEn = {};
 * literalsCrm = {};
 *
 * constructor(private poI18nService: PoI18nService) {
 *   poI18nService.getLiterals()
 *     .subscribe((literals) => {
 *       this.literals = literals;
 *     });
 *
 *   poI18nService.getLiterals({context: 'crm', literals: ['add', 'remove']})
 *     .subscribe((literals) => {
 *       this.literalsCrm = literals;
 *     });
 *
 *   poI18nService.getLiterals({language: 'en-us'})
 *     .subscribe((literals) => {
 *       this.literalsEn = literals;
 *     });
 * }
 * ```
 *
 * Para apresentar as literais capturadas acima no HTML do componente, deve-se utilizar o
 * seguinte código:
 *
 * <pre ngNonBindable>
 * {{ literals?.add }}
 * {{ literals?.remove }}
 * </pre>
 *
 * Caso as literais contenham variáveis que precisem ser substituídas, pode-se utilizar o *pipe* `poI18n`.
 * É possível informar propriedades do componente como `name` e `nickname` ou
 * informar o valor diretamente com "" ou número, conforme o exemplo abaixo:
 *
 * <pre ngNonBindable>
 * {{ literals?.people | poI18n:[120] }}
 * {{ literals?.greeting | poI18n:[name, nickname] }}
 * {{ literals?.greeting | poI18n:["Brad", "Green"] }}
 * </pre>
 *
 * > É importante o uso do operador `?` (Elvis) para evitar erros enquanto as literais não forem carregadas.
 *
 * ### Teste unitário
 *
 * Abaixo segue um exemplo de *setup* inicial de teste unitário do *AppComponent* que utiliza o `PoI18nService`:
 *
 * ```
 * import { async, TestBed } from '\@angular/core/testing';
 * import { HttpClientTestingModule } from '\@angular/common/http/testing';
 *
 * import { PoI18nModule } from '\@portinari/portinari-ui';
 *
 * import { AppComponent } from './app.component';
 *
 * describe('AppComponent', () => {
 *   const anotherPT = {
 *     text: 'texto',
 *     add: 'adicionar',
 *     remove: 'remover'
 *   };
 *
 *   const generalPT = {
 *     text: 'texto',
 *     add: 'adicionar',
 *     remove: 'remover'
 *   };
 *
 *   const config = {
 *     default: {
 *       language: 'pt-BR',
 *       context: 'general',
 *       cache: false
 *     },
 *     contexts: {
 *       general: {
 *         'pt-br': generalPT
 *       },
 *       another: {
 *         'pt-br': anotherPT
 *       }
 *     }
 *   };
 *
 *   beforeEach(async(() => {
 *     TestBed.configureTestingModule({
 *       declarations: [
 *         AppComponent
 *       ],
 *       imports: [
 *         HttpClientTestingModule,
 *         PoI18nModule.config(config)
 *       ]
 *     }).compileComponents();
 *   }));
 *
 *   it('should create the app', async(() => {
 *     const fixture = TestBed.createComponent(AppComponent);
 *     const app = fixture.debugElement.componentInstance;
 *
 *     expect(app).toBeTruthy();
 *   }));
 *
 * });
 * ```
 */
var PoI18nBaseService = /** @class */ (function () {
    function PoI18nBaseService(config, http, languageService) {
        this.config = config;
        this.http = http;
        this.languageService = languageService;
        this.varI18n = {};
        this.useCache = false;
        this.servicesContext = {};
        this.setConfig(config);
    }
    /**
     * <a id="get-language"></a>
     * Método que retorna o idioma padrão ativo.
     *
     * A busca deste idioma pelo método será feita na seguinte ordem:
     *
     *   1 - o idioma que foi armazenado no *localStorage*, através do método [`setLanguage()`](documentation/po-i18n#setLanguage).
     *
     *   2 - o valor inserido no módulo do i18n através do parâmetro `config`, sendo o idioma inserido na propriedade
     * `language` da interface [`PoI18nConfigDefault`](documentation/po-i18n#poI18nConfigDefault).
     *
     *   3 - o idioma do navegador utilizado.
     *
     * > Caso o idioma do navegador não seja suportado pelo PO (`pt`, `en` ou `es`), será retornado valor `pt`.
     *
     * **Retorno:**
     *
     * `string` com a sigla do idioma padrão.
     */
    /**
     * <a id="get-language"></a>
     * Método que retorna o idioma padrão ativo.
     *
     * A busca deste idioma pelo método será feita na seguinte ordem:
     *
     *   1 - o idioma que foi armazenado no *localStorage*, através do método [`setLanguage()`](documentation/po-i18n#setLanguage).
     *
     *   2 - o valor inserido no módulo do i18n através do parâmetro `config`, sendo o idioma inserido na propriedade
     * `language` da interface [`PoI18nConfigDefault`](documentation/po-i18n#poI18nConfigDefault).
     *
     *   3 - o idioma do navegador utilizado.
     *
     * > Caso o idioma do navegador não seja suportado pelo PO (`pt`, `en` ou `es`), será retornado valor `pt`.
     *
     * **Retorno:**
     *
     * `string` com a sigla do idioma padrão.
     * @return {?}
     */
    PoI18nBaseService.prototype.getLanguage = /**
     * <a id="get-language"></a>
     * Método que retorna o idioma padrão ativo.
     *
     * A busca deste idioma pelo método será feita na seguinte ordem:
     *
     *   1 - o idioma que foi armazenado no *localStorage*, através do método [`setLanguage()`](documentation/po-i18n#setLanguage).
     *
     *   2 - o valor inserido no módulo do i18n através do parâmetro `config`, sendo o idioma inserido na propriedade
     * `language` da interface [`PoI18nConfigDefault`](documentation/po-i18n#poI18nConfigDefault).
     *
     *   3 - o idioma do navegador utilizado.
     *
     * > Caso o idioma do navegador não seja suportado pelo PO (`pt`, `en` ou `es`), será retornado valor `pt`.
     *
     * **Retorno:**
     *
     * `string` com a sigla do idioma padrão.
     * @return {?}
     */
    function () {
        return this.languageService.getLanguage();
    };
    /**
     * Método que retorna o idioma padrão ativo, com somente a abreviação do idioma (duas primeiras letras).
     * Por exemplo: "pt" ou "es".
     *
     * A busca deste idioma é baseada no método [**getLanguage()**](/documentation/po-i18n#get-language).
     *
     * **Retorno:**
     *
     * `string` com a sigla do idioma padrão.
     */
    /**
     * Método que retorna o idioma padrão ativo, com somente a abreviação do idioma (duas primeiras letras).
     * Por exemplo: "pt" ou "es".
     *
     * A busca deste idioma é baseada no método [**getLanguage()**](/documentation/po-i18n#get-language).
     *
     * **Retorno:**
     *
     * `string` com a sigla do idioma padrão.
     * @return {?}
     */
    PoI18nBaseService.prototype.getShortLanguage = /**
     * Método que retorna o idioma padrão ativo, com somente a abreviação do idioma (duas primeiras letras).
     * Por exemplo: "pt" ou "es".
     *
     * A busca deste idioma é baseada no método [**getLanguage()**](/documentation/po-i18n#get-language).
     *
     * **Retorno:**
     *
     * `string` com a sigla do idioma padrão.
     * @return {?}
     */
    function () {
        return this.languageService.getShortLanguage();
    };
    /**
     * <a id="setLanguage"></a>
     * Método para alterar o idioma padrão do módulo do i18n.
     *
     * Ao utilizar este método, o idioma ficará gravado no armazenamento local do navegador, que será utilizado pelo
     * serviço do `i18n` para buscar as literais no idioma padrão.
     *
     * @param language {string} Sigla do idioma.
     *
     * Esta sigla deve ser composta por duas letras representando o idioma,
     * podendo ser adicionado outras duas letras representando o país, por exemplo: `pt`, `pt-BR`, `pt-br`, `en` ou `en-US`.
     *
     * > Caso seja informado um valor diferente deste padrão, o mesmo será ignorado.
     *
     * @param reload {boolean} Indica se a página atual poderá ser recarregada após a alteração do idioma.
     *
     * Este recurso pode ser útil para os usuários que utilizam o método `getLiterals()` do serviço do i18n para poder
     * buscar novamente as literais no novo idioma configurado.
     */
    /**
     * <a id="setLanguage"></a>
     * Método para alterar o idioma padrão do módulo do i18n.
     *
     * Ao utilizar este método, o idioma ficará gravado no armazenamento local do navegador, que será utilizado pelo
     * serviço do `i18n` para buscar as literais no idioma padrão.
     *
     * @param {?} language {string} Sigla do idioma.
     *
     * Esta sigla deve ser composta por duas letras representando o idioma,
     * podendo ser adicionado outras duas letras representando o país, por exemplo: `pt`, `pt-BR`, `pt-br`, `en` ou `en-US`.
     *
     * > Caso seja informado um valor diferente deste padrão, o mesmo será ignorado.
     *
     * @param {?=} reload {boolean} Indica se a página atual poderá ser recarregada após a alteração do idioma.
     *
     * Este recurso pode ser útil para os usuários que utilizam o método `getLiterals()` do serviço do i18n para poder
     * buscar novamente as literais no novo idioma configurado.
     * @return {?}
     */
    PoI18nBaseService.prototype.setLanguage = /**
     * <a id="setLanguage"></a>
     * Método para alterar o idioma padrão do módulo do i18n.
     *
     * Ao utilizar este método, o idioma ficará gravado no armazenamento local do navegador, que será utilizado pelo
     * serviço do `i18n` para buscar as literais no idioma padrão.
     *
     * @param {?} language {string} Sigla do idioma.
     *
     * Esta sigla deve ser composta por duas letras representando o idioma,
     * podendo ser adicionado outras duas letras representando o país, por exemplo: `pt`, `pt-BR`, `pt-br`, `en` ou `en-US`.
     *
     * > Caso seja informado um valor diferente deste padrão, o mesmo será ignorado.
     *
     * @param {?=} reload {boolean} Indica se a página atual poderá ser recarregada após a alteração do idioma.
     *
     * Este recurso pode ser útil para os usuários que utilizam o método `getLiterals()` do serviço do i18n para poder
     * buscar novamente as literais no novo idioma configurado.
     * @return {?}
     */
    function (language, reload) {
        if (!isLanguage(language)) {
            return;
        }
        this.languageService.setLanguage(language);
        if (reload) {
            reloadCurrentPage();
        }
    };
    /**
     * @private
     * @param {?} config
     * @return {?}
     */
    PoI18nBaseService.prototype.setConfig = /**
     * @private
     * @param {?} config
     * @return {?}
     */
    function (config) {
        // Seta as configurações padrões definidas no importação do módulo
        if (config['default']) {
            this.languageService.setLanguageDefault(config['default']['language']);
            this.contextDefault = (config['default']['context']) ? config['default']['context'] : '';
            this.useCache = (config['default']['cache']) ? config['default']['cache'] : false;
        }
        // Carrega a lista dos contextos e as contantes informadas
        if (config['contexts']) {
            this.setVarI18n(config['contexts']);
            // Se nenhum contexto foi definido como padrão,
            // então define o primeiro contexto
            if (!this.contextDefault) {
                for (var context in config['contexts']) {
                    if (this.config['contexts'].hasOwnProperty(context)) {
                        this.contextDefault = context;
                        break;
                    }
                }
            }
        }
    };
    /**
     * @param {?=} options
     * @return {?}
     */
    PoI18nBaseService.prototype.getLiterals = /**
     * @param {?=} options
     * @return {?}
     */
    function (options) {
        var _this = this;
        if (options === void 0) { options = {}; }
        /** @type {?} */
        var language = options['language'] ? options['language'].toLowerCase() : this.getLanguage();
        /** @type {?} */
        var context = (options['context']) ? options['context'] : this.contextDefault;
        /** @type {?} */
        var literals = (options['literals']) ? options['literals'] : [];
        return new Observable((/**
         * @param {?} observer
         * @return {?}
         */
        function (observer) {
            if (_this.servicesContext[context]) {
                // Faz o processo de busca de um contexto que contém serviço
                _this.getLiteralsFromContextService(language, context, literals, observer);
            }
            else {
                // Faz o processo de busca de um contexto que utiliza constante
                _this.getLiteralsFromContextConstant(language, context, literals, observer);
            }
        }));
    };
    // Processo de busca de um contexto que contém serviço.
    //    1 - Procura na variável I18n deste serviço
    //    2 - Procura no local storage (Se o cache estiver definido como true na configuração do módulo)
    //    3 - Dispara o serviço, mesmo que já tenha encontrado no local storage, para garantir a atualização
    //    4 - Se nenhuma literal for encontrada, então busca em pt-br
    // Processo de busca de um contexto que contém serviço.
    //    1 - Procura na variável I18n deste serviço
    //    2 - Procura no local storage (Se o cache estiver definido como true na configuração do módulo)
    //    3 - Dispara o serviço, mesmo que já tenha encontrado no local storage, para garantir a atualização
    //    4 - Se nenhuma literal for encontrada, então busca em pt-br
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} observer
     * @param {?=} translations
     * @param {?=} languageAlternative
     * @return {?}
     */
    PoI18nBaseService.prototype.getLiteralsFromContextService = 
    // Processo de busca de um contexto que contém serviço.
    //    1 - Procura na variável I18n deste serviço
    //    2 - Procura no local storage (Se o cache estiver definido como true na configuração do módulo)
    //    3 - Dispara o serviço, mesmo que já tenha encontrado no local storage, para garantir a atualização
    //    4 - Se nenhuma literal for encontrada, então busca em pt-br
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} observer
     * @param {?=} translations
     * @param {?=} languageAlternative
     * @return {?}
     */
    function (language, context, literals, observer, translations, languageAlternative) {
        if (translations === void 0) { translations = {}; }
        if (languageAlternative === void 0) { languageAlternative = null; }
        // Idioma usado para tentar buscar as literais faltantes
        /** @type {?} */
        var languageSearch = (languageAlternative) ? languageAlternative : language;
        translations = this.mergeObject(translations, this.searchInVarI18n(languageSearch, context, literals));
        if (this.countObject(translations) > 0) {
            observer.next(translations);
        }
        // realiza a busca no localStorage e em seguida no serviço
        this.getLiteralsLocalStorageAndCache(languageSearch, context, literals, observer, translations, languageAlternative);
    };
    // Procura no local storage e em seguida no serviço
    // Caso não encontre nem no serviço, recomeça a busca em pt-br
    // Procura no local storage e em seguida no serviço
    // Caso não encontre nem no serviço, recomeça a busca em pt-br
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} observer
     * @param {?} translations
     * @param {?=} languageAlternative
     * @return {?}
     */
    PoI18nBaseService.prototype.getLiteralsLocalStorageAndCache = 
    // Procura no local storage e em seguida no serviço
    // Caso não encontre nem no serviço, recomeça a busca em pt-br
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} observer
     * @param {?} translations
     * @param {?=} languageAlternative
     * @return {?}
     */
    function (language, context, literals, observer, translations, languageAlternative) {
        var _this = this;
        if (languageAlternative === void 0) { languageAlternative = null; }
        /** @type {?} */
        var languageSearch = (languageAlternative) ? languageAlternative : language;
        /** @type {?} */
        var translationTemp;
        // Verifica se usa cache
        if (this.useCache) {
            translationTemp = this.searchInLocalStorage(languageSearch, context, literals);
            if (this.countObject(translationTemp) > 0) {
                this.updateVarI18n(language, context, translationTemp);
                translations = this.mergeObject(translationTemp, translations);
                observer.next(translations);
            }
        }
        // Busca do Serviço
        this.getHttpService(this.servicesContext[context], languageSearch, literals)
            .subscribe((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (response) {
                _this.updateLocalStorage(language, context, response);
                _this.updateVarI18n(language, context, response);
                translationTemp = _this.searchInVarI18n(language, context, literals);
                translations = _this.mergeObject(translationTemp, translations);
                observer.next(translations);
            }
            // Se não encontrou todas as literais pesquisadas no idioma
            // Então refaz o processo procurando em português
            if (literals.length > _this.countObject(translations)) {
                if (languageAlternative === 'pt-br') {
                    // Se não encontrou nem em português, então retorna o nome das literais
                    translations = _this.completeFaultLiterals(language, context, literals, translations);
                    _this.updateLocalStorage(language, context, translations);
                    _this.updateVarI18n(language, context, translations);
                    observer.next(translations);
                }
                else {
                    _this.getLiteralsFromContextService(language, context, literals, observer, translations, 'pt-br');
                }
            }
        }));
    };
    // Procura pela lista de literais
    // Se não encontrar todas, procura em pt-br
    // Procura pela lista de literais
    // Se não encontrar todas, procura em pt-br
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} observer
     * @param {?=} translations
     * @return {?}
     */
    PoI18nBaseService.prototype.getLiteralsFromContextConstant = 
    // Procura pela lista de literais
    // Se não encontrar todas, procura em pt-br
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} observer
     * @param {?=} translations
     * @return {?}
     */
    function (language, context, literals, observer, translations) {
        if (translations === void 0) { translations = {}; }
        translations = this.mergeObject(translations, this.searchInVarI18n(language, context, literals));
        if (this.countObject(translations) > 0) {
            observer.next(translations);
        }
        // Se foi pesquisado por literais
        if (literals.length > 0) {
            // Se não encontrou todas as literais pesquisadas no idioma, procura em português
            if (literals.length > this.countObject(translations)) {
                if (language === 'pt-br') {
                    // Se não encontrou nem em português, então retorna o nome das literais
                    translations = this.completeFaultLiterals(language, context, literals, translations);
                    observer.next(translations);
                }
                else {
                    this.getLiteralsFromContextConstant('pt-br', context, literals, observer, translations);
                }
            }
        }
        else {
            // Se não encontrar nenhuma literal, procura em português
            if (this.countObject(translations) === 0 && language !== 'pt-br') {
                this.getLiteralsFromContextConstant('pt-br', context, literals, observer, translations);
            }
            // caso não informar literais e não houver tradução
            observer.next(translations);
            observer.complete();
        }
    };
    // Busca pelas literais no local storage
    // Busca pelas literais no local storage
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @return {?}
     */
    PoI18nBaseService.prototype.searchInLocalStorage = 
    // Busca pelas literais no local storage
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @return {?}
     */
    function (language, context, literals) {
        /** @type {?} */
        var translations = {};
        if (literals.length > 0) {
            for (var i = 0; i < literals.length; i++) {
                /** @type {?} */
                var literal = literals[i];
                /** @type {?} */
                var translation = localStorage.getItem(language + '-' + context + '-' + literal);
                if (translation) {
                    translations[literal] = translation;
                }
            }
        }
        return translations;
    };
    // Busca pelas literais na variável do serviço
    // Busca pelas literais na variável do serviço
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @return {?}
     */
    PoI18nBaseService.prototype.searchInVarI18n = 
    // Busca pelas literais na variável do serviço
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @return {?}
     */
    function (language, context, literals) {
        /** @type {?} */
        var translations = {};
        if (this.varI18n[language] && this.varI18n[language][context]) {
            /** @type {?} */
            var content = this.varI18n[language][context];
            if (literals.length > 0) {
                // Busca as literais desejadas
                for (var i = 0; i < literals.length; i++) {
                    /** @type {?} */
                    var literal = literals[i];
                    if (content.hasOwnProperty(literal)) {
                        translations[literal] = content[literal];
                    }
                }
            }
            else {
                // Atribui todas as literais
                translations = tslib_1.__assign({}, content);
            }
        }
        return translations;
    };
    // Atualiza o local storage
    // Atualiza o local storage
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} data
     * @return {?}
     */
    PoI18nBaseService.prototype.updateLocalStorage = 
    // Atualiza o local storage
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} data
     * @return {?}
     */
    function (language, context, data) {
        if (this.useCache) {
            for (var literal in data) {
                if (data.hasOwnProperty(literal)) {
                    localStorage.setItem(language + '-' + context + '-' + literal, data[literal]);
                }
            }
        }
    };
    // Atualiza a variável local com as literais com os objetos passados na configuração
    // Atualiza a variável local com as literais com os objetos passados na configuração
    /**
     * @private
     * @param {?} contexts
     * @return {?}
     */
    PoI18nBaseService.prototype.setVarI18n = 
    // Atualiza a variável local com as literais com os objetos passados na configuração
    /**
     * @private
     * @param {?} contexts
     * @return {?}
     */
    function (contexts) {
        // Percorre os contextos
        for (var context in contexts) {
            if (contexts.hasOwnProperty(context)) {
                /** @type {?} */
                var contextContent = contexts[context];
                // Percorre os idiomas dentro do contexto
                for (var language in contextContent) {
                    if (contextContent.hasOwnProperty(language)) {
                        /** @type {?} */
                        var languageContent = contextContent[language];
                        if (language === 'url') {
                            this.servicesContext[context] = languageContent;
                        }
                        else {
                            this.updateVarI18n(language, context, languageContent);
                        }
                    }
                }
            }
        }
    };
    // Atualiza a variável local com as literais idioma e contexto
    // Atualiza a variável local com as literais idioma e contexto
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} data
     * @return {?}
     */
    PoI18nBaseService.prototype.updateVarI18n = 
    // Atualiza a variável local com as literais idioma e contexto
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} data
     * @return {?}
     */
    function (language, context, data) {
        var _a;
        language = language.toLowerCase();
        if (!this.varI18n[language]) {
            this.varI18n[language] = (_a = {}, _a[context] = {}, _a);
        }
        if (!this.varI18n[language][context]) {
            this.varI18n[language][context] = {};
        }
        // Cria ou atualiza o contexto dentro do storage
        this.varI18n[language][context] = this.mergeObject(data, this.varI18n[language][context]);
    };
    /**
     * @private
     * @param {?} url
     * @param {?} language
     * @param {?} literals
     * @return {?}
     */
    PoI18nBaseService.prototype.getHttpService = /**
     * @private
     * @param {?} url
     * @param {?} language
     * @param {?} literals
     * @return {?}
     */
    function (url, language, literals) {
        /** @type {?} */
        var param = '?language=' + language;
        if (literals.length > 0) {
            param += '&literals=' + literals.join();
        }
        // Remove a barra final do endereço
        url = (url.lastIndexOf('/') === url.length - 1) ? url.substr(0, url.length - 1) : url;
        return this.http.get(url + param);
    };
    // Completa com o nome da literais, as que não foram encontradas
    // Completa com o nome da literais, as que não foram encontradas
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} translations
     * @return {?}
     */
    PoI18nBaseService.prototype.completeFaultLiterals = 
    // Completa com o nome da literais, as que não foram encontradas
    /**
     * @private
     * @param {?} language
     * @param {?} context
     * @param {?} literals
     * @param {?} translations
     * @return {?}
     */
    function (language, context, literals, translations) {
        for (var i = 0; i < literals.length; i++) {
            /** @type {?} */
            var literal = literals[i];
            if (!translations[literal]) {
                translations[literal] = literal;
            }
        }
        return translations;
    };
    // Conta os atributos do objeto
    // Conta os atributos do objeto
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    PoI18nBaseService.prototype.countObject = 
    // Conta os atributos do objeto
    /**
     * @private
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        return Object.keys(obj).length;
    };
    // Faz o merge dos objetos, sempre dando preferência para o primeiro objeto de parâmetro
    // Faz o merge dos objetos, sempre dando preferência para o primeiro objeto de parâmetro
    /**
     * @private
     * @param {?} objPermanent
     * @param {?} obj
     * @return {?}
     */
    PoI18nBaseService.prototype.mergeObject = 
    // Faz o merge dos objetos, sempre dando preferência para o primeiro objeto de parâmetro
    /**
     * @private
     * @param {?} objPermanent
     * @param {?} obj
     * @return {?}
     */
    function (objPermanent, obj) {
        return tslib_1.__assign({}, obj, objPermanent);
    };
    /** @nocollapse */
    PoI18nBaseService.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [I18N_CONFIG,] }] },
        { type: HttpClient, decorators: [{ type: Inject, args: [HttpClient,] }] },
        { type: PoLanguageService }
    ]; };
    return PoI18nBaseService;
}());
export { PoI18nBaseService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.varI18n;
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.contextDefault;
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.useCache;
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.servicesContext;
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.config;
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.http;
    /**
     * @type {?}
     * @private
     */
    PoI18nBaseService.prototype.languageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8taTE4bi1iYXNlLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9wby1pMThuL3BvLWkxOG4tYmFzZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkMsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVsQyxPQUFPLEVBQUUsVUFBVSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDakUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFFdkUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBJL0Q7SUFVRSwyQkFDK0IsTUFBcUIsRUFDdEIsSUFBaUIsRUFDckMsZUFBbUM7UUFGZCxXQUFNLEdBQU4sTUFBTSxDQUFlO1FBQ3RCLFNBQUksR0FBSixJQUFJLENBQWE7UUFDckMsb0JBQWUsR0FBZixlQUFlLENBQW9CO1FBWHJDLFlBQU8sR0FBUSxFQUFFLENBQUM7UUFJbEIsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUUxQixvQkFBZSxHQUFRLEVBQUUsQ0FBQztRQU9oQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7Ozs7Ozs7Ozs7Ozs7Ozs7O09Ba0JHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFDSCx1Q0FBVzs7Ozs7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OztJQUUvQixxQ0FBa0M7Ozs7O0lBRWxDLDRDQUFrQzs7Ozs7SUFHaEMsbUNBQWtEOzs7OztJQUNsRCxpQ0FBNkM7Ozs7O0lBQzdDLDRDQUEyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBpc0xhbmd1YWdlLCByZWxvYWRDdXJyZW50UGFnZSB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcblxuaW1wb3J0IHsgSTE4Tl9DT05GSUcgfSBmcm9tICcuL3BvLWkxOG4tY29uZmlnLWluamVjdGlvbi10b2tlbic7XG5pbXBvcnQgeyBQb0kxOG5Db25maWcgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8taTE4bi1jb25maWcuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvSTE4bkxpdGVyYWxzIH0gZnJvbSAnLi9pbnRlcmZhY2VzL3BvLWkxOG4tbGl0ZXJhbHMuaW50ZXJmYWNlJztcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIHNlcnZpw6dvIGBQb0kxOG5TZXJ2aWNlYCBwb3NzaWJpbGl0YSB1dGlsaXphciBtw7psdGlwbG9zIGlkaW9tYXMgZSBjb250ZXh0b3MgbmEgYXBsaWNhw6fDo28uXG4gKlxuICogPiBBbnRlcyBkYSB1dGlsaXphw6fDo28gZG8gc2VydmnDp28sIMOpIG5lY2Vzc8OhcmlvIHJlYWxpemFyIGFcbiAqIFtpbXBvcnRhw6fDo28gZSBjb25maWd1cmHDp8OjbyBkbyBtw7NkdWxvIGBQb0kxOG5Nb2R1bGVgXSgvZG9jdW1lbnRhdGlvbi9wby1pMThuI2kxOG4tY29uZmlnKS5cbiAqXG4gKiAqKlV0aWxpemHDp8OjbyBkbyBzZXJ2acOnbyBgUG9JMThuU2VydmljZWA6KipcbiAqXG4gKiBQYXJhIHV0aWxpemFyIG8gc2VydmnDp28gYmFzdGEgaW1wb3J0w6EtbG8gbm9zIGNvbXBvbmVudGVzIHF1ZSBuZWNlc3NpdGFyZW0gZGUgbGl0ZXJhaXMgZSBmYXplciBhIGluamXDp8OjbyBkZVxuICogZGVwZW5kw6puY2lhIG5vIGNvbnN0cnV0b3I6XG4gKiBgYGBcbiAqICBpbXBvcnQgeyBQb0kxOG5TZXJ2aWNlIH0gZnJvbSAnQHBvcnRpbmFyaS9wb3J0aW5hcmktdWknO1xuICogIC4uLlxuICogIGNvbnN0cnVjdG9yKHByaXZhdGUgcG9JMThuU2VydmljZTogUG9JMThuU2VydmljZSkgeyB9XG4gKiAgLi4uXG4gKiBgYGBcbiAqXG4gKiBQb3IgZmltIHJlYWxpemFyIGEgYnVzY2EgcGVsYXMgbGl0ZXJhaXMsIGluc2NyZXZlbmRvLXNlIG5vIFtPYnNlcnZhYmxlXShodHRwczovL2FuZ3VsYXIuaW8vZ3VpZGUvb2JzZXJ2YWJsZXMpIHBlbG9cbiAqIG3DqXRvZG8gYGdldExpdGVyYWxzKClgLlxuICpcbiAqID4gTyBtw6l0b2RvIGBnZXRMaXRlcmFscygpYCBwb2RlIHJlY2ViZXIgdW0gb2JqZXRvIGRvIHRpcG8gZGEgaW50ZXJmYWNlIGBQb0kxOG5MaXRlcmFsc2AgY29tbyBwYXLDom1ldHJvLFxuICogcG9yw6ltLCBuZW5odW1hIGRhcyBwcm9wcmllZGFkZXMgc8OjbyBvYnJpZ2F0w7NyaWFzLiBDYXNvIG5lbmh1bSBwYXLDom1ldHJvIHNlamEgcGFzc2Fkbywgc2Vyw6NvIGJ1c2NhZGFzXG4gKiB0b2RhcyBhcyBsaXRlcmFpcyBkbyBjb250ZXh0byBkZWZpbmlkbyBjb20gcGFkcsOjbywgbm8gaWRpb21hIGRlZmluaWRvIGNvbW8gcGFkcsOjby5cbiAqXG4gKiBFeGVtcGxvcyBkZSByZXF1aXNpw6fDo286XG4gKiBgYGBcbiAqIGxpdGVyYWxzID0ge307XG4gKiBsaXRlcmFsc0VuID0ge307XG4gKiBsaXRlcmFsc0NybSA9IHt9O1xuICpcbiAqIGNvbnN0cnVjdG9yKHByaXZhdGUgcG9JMThuU2VydmljZTogUG9JMThuU2VydmljZSkge1xuICogICBwb0kxOG5TZXJ2aWNlLmdldExpdGVyYWxzKClcbiAqICAgICAuc3Vic2NyaWJlKChsaXRlcmFscykgPT4ge1xuICogICAgICAgdGhpcy5saXRlcmFscyA9IGxpdGVyYWxzO1xuICogICAgIH0pO1xuICpcbiAqICAgcG9JMThuU2VydmljZS5nZXRMaXRlcmFscyh7Y29udGV4dDogJ2NybScsIGxpdGVyYWxzOiBbJ2FkZCcsICdyZW1vdmUnXX0pXG4gKiAgICAgLnN1YnNjcmliZSgobGl0ZXJhbHMpID0+IHtcbiAqICAgICAgIHRoaXMubGl0ZXJhbHNDcm0gPSBsaXRlcmFscztcbiAqICAgICB9KTtcbiAqXG4gKiAgIHBvSTE4blNlcnZpY2UuZ2V0TGl0ZXJhbHMoe2xhbmd1YWdlOiAnZW4tdXMnfSlcbiAqICAgICAuc3Vic2NyaWJlKChsaXRlcmFscykgPT4ge1xuICogICAgICAgdGhpcy5saXRlcmFsc0VuID0gbGl0ZXJhbHM7XG4gKiAgICAgfSk7XG4gKiB9XG4gKiBgYGBcbiAqXG4gKiBQYXJhIGFwcmVzZW50YXIgYXMgbGl0ZXJhaXMgY2FwdHVyYWRhcyBhY2ltYSBubyBIVE1MIGRvIGNvbXBvbmVudGUsIGRldmUtc2UgdXRpbGl6YXIgb1xuICogc2VndWludGUgY8OzZGlnbzpcbiAqXG4gKiA8cHJlIG5nTm9uQmluZGFibGU+XG4gKiB7eyBsaXRlcmFscz8uYWRkIH19XG4gKiB7eyBsaXRlcmFscz8ucmVtb3ZlIH19XG4gKiA8L3ByZT5cbiAqXG4gKiBDYXNvIGFzIGxpdGVyYWlzIGNvbnRlbmhhbSB2YXJpw6F2ZWlzIHF1ZSBwcmVjaXNlbSBzZXIgc3Vic3RpdHXDrWRhcywgcG9kZS1zZSB1dGlsaXphciBvICpwaXBlKiBgcG9JMThuYC5cbiAqIMOJIHBvc3PDrXZlbCBpbmZvcm1hciBwcm9wcmllZGFkZXMgZG8gY29tcG9uZW50ZSBjb21vIGBuYW1lYCBlIGBuaWNrbmFtZWAgb3VcbiAqIGluZm9ybWFyIG8gdmFsb3IgZGlyZXRhbWVudGUgY29tIFwiXCIgb3UgbsO6bWVybywgY29uZm9ybWUgbyBleGVtcGxvIGFiYWl4bzpcbiAqXG4gKiA8cHJlIG5nTm9uQmluZGFibGU+XG4gKiB7eyBsaXRlcmFscz8ucGVvcGxlIHwgcG9JMThuOlsxMjBdIH19XG4gKiB7eyBsaXRlcmFscz8uZ3JlZXRpbmcgfCBwb0kxOG46W25hbWUsIG5pY2tuYW1lXSB9fVxuICoge3sgbGl0ZXJhbHM/LmdyZWV0aW5nIHwgcG9JMThuOltcIkJyYWRcIiwgXCJHcmVlblwiXSB9fVxuICogPC9wcmU+XG4gKlxuICogPiDDiSBpbXBvcnRhbnRlIG8gdXNvIGRvIG9wZXJhZG9yIGA/YCAoRWx2aXMpIHBhcmEgZXZpdGFyIGVycm9zIGVucXVhbnRvIGFzIGxpdGVyYWlzIG7Do28gZm9yZW0gY2FycmVnYWRhcy5cbiAqXG4gKiAjIyMgVGVzdGUgdW5pdMOhcmlvXG4gKlxuICogQWJhaXhvIHNlZ3VlIHVtIGV4ZW1wbG8gZGUgKnNldHVwKiBpbmljaWFsIGRlIHRlc3RlIHVuaXTDoXJpbyBkbyAqQXBwQ29tcG9uZW50KiBxdWUgdXRpbGl6YSBvIGBQb0kxOG5TZXJ2aWNlYDpcbiAqXG4gKiBgYGBcbiAqIGltcG9ydCB7IGFzeW5jLCBUZXN0QmVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS90ZXN0aW5nJztcbiAqIGltcG9ydCB7IEh0dHBDbGllbnRUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAvdGVzdGluZyc7XG4gKlxuICogaW1wb3J0IHsgUG9JMThuTW9kdWxlIH0gZnJvbSAnQHBvcnRpbmFyaS9wb3J0aW5hcmktdWknO1xuICpcbiAqIGltcG9ydCB7IEFwcENvbXBvbmVudCB9IGZyb20gJy4vYXBwLmNvbXBvbmVudCc7XG4gKlxuICogZGVzY3JpYmUoJ0FwcENvbXBvbmVudCcsICgpID0+IHtcbiAqICAgY29uc3QgYW5vdGhlclBUID0ge1xuICogICAgIHRleHQ6ICd0ZXh0bycsXG4gKiAgICAgYWRkOiAnYWRpY2lvbmFyJyxcbiAqICAgICByZW1vdmU6ICdyZW1vdmVyJ1xuICogICB9O1xuICpcbiAqICAgY29uc3QgZ2VuZXJhbFBUID0ge1xuICogICAgIHRleHQ6ICd0ZXh0bycsXG4gKiAgICAgYWRkOiAnYWRpY2lvbmFyJyxcbiAqICAgICByZW1vdmU6ICdyZW1vdmVyJ1xuICogICB9O1xuICpcbiAqICAgY29uc3QgY29uZmlnID0ge1xuICogICAgIGRlZmF1bHQ6IHtcbiAqICAgICAgIGxhbmd1YWdlOiAncHQtQlInLFxuICogICAgICAgY29udGV4dDogJ2dlbmVyYWwnLFxuICogICAgICAgY2FjaGU6IGZhbHNlXG4gKiAgICAgfSxcbiAqICAgICBjb250ZXh0czoge1xuICogICAgICAgZ2VuZXJhbDoge1xuICogICAgICAgICAncHQtYnInOiBnZW5lcmFsUFRcbiAqICAgICAgIH0sXG4gKiAgICAgICBhbm90aGVyOiB7XG4gKiAgICAgICAgICdwdC1icic6IGFub3RoZXJQVFxuICogICAgICAgfVxuICogICAgIH1cbiAqICAgfTtcbiAqXG4gKiAgIGJlZm9yZUVhY2goYXN5bmMoKCkgPT4ge1xuICogICAgIFRlc3RCZWQuY29uZmlndXJlVGVzdGluZ01vZHVsZSh7XG4gKiAgICAgICBkZWNsYXJhdGlvbnM6IFtcbiAqICAgICAgICAgQXBwQ29tcG9uZW50XG4gKiAgICAgICBdLFxuICogICAgICAgaW1wb3J0czogW1xuICogICAgICAgICBIdHRwQ2xpZW50VGVzdGluZ01vZHVsZSxcbiAqICAgICAgICAgUG9JMThuTW9kdWxlLmNvbmZpZyhjb25maWcpXG4gKiAgICAgICBdXG4gKiAgICAgfSkuY29tcGlsZUNvbXBvbmVudHMoKTtcbiAqICAgfSkpO1xuICpcbiAqICAgaXQoJ3Nob3VsZCBjcmVhdGUgdGhlIGFwcCcsIGFzeW5jKCgpID0+IHtcbiAqICAgICBjb25zdCBmaXh0dXJlID0gVGVzdEJlZC5jcmVhdGVDb21wb25lbnQoQXBwQ29tcG9uZW50KTtcbiAqICAgICBjb25zdCBhcHAgPSBmaXh0dXJlLmRlYnVnRWxlbWVudC5jb21wb25lbnRJbnN0YW5jZTtcbiAqXG4gKiAgICAgZXhwZWN0KGFwcCkudG9CZVRydXRoeSgpO1xuICogICB9KSk7XG4gKlxuICogfSk7XG4gKiBgYGBcbiAqL1xuXG5leHBvcnQgY2xhc3MgUG9JMThuQmFzZVNlcnZpY2Uge1xuXG4gIHByaXZhdGUgdmFySTE4bjogYW55ID0ge307XG5cbiAgcHJpdmF0ZSBjb250ZXh0RGVmYXVsdDogc3RyaW5nO1xuXG4gIHByaXZhdGUgdXNlQ2FjaGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIHNlcnZpY2VzQ29udGV4dDogYW55ID0ge307XG5cbiAgY29uc3RydWN0b3IoXG4gICAgQEluamVjdChJMThOX0NPTkZJRykgcHJpdmF0ZSBjb25maWc/OiBQb0kxOG5Db25maWcsXG4gICAgQEluamVjdChIdHRwQ2xpZW50KSBwcml2YXRlIGh0dHA/OiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlPzogUG9MYW5ndWFnZVNlcnZpY2UpIHtcblxuICAgIHRoaXMuc2V0Q29uZmlnKGNvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogPGEgaWQ9XCJnZXQtbGFuZ3VhZ2VcIj48L2E+XG4gICAqIE3DqXRvZG8gcXVlIHJldG9ybmEgbyBpZGlvbWEgcGFkcsOjbyBhdGl2by5cbiAgICpcbiAgICogQSBidXNjYSBkZXN0ZSBpZGlvbWEgcGVsbyBtw6l0b2RvIHNlcsOhIGZlaXRhIG5hIHNlZ3VpbnRlIG9yZGVtOlxuICAgKlxuICAgKiAgIDEgLSBvIGlkaW9tYSBxdWUgZm9pIGFybWF6ZW5hZG8gbm8gKmxvY2FsU3RvcmFnZSosIGF0cmF2w6lzIGRvIG3DqXRvZG8gW2BzZXRMYW5ndWFnZSgpYF0oZG9jdW1lbnRhdGlvbi9wby1pMThuI3NldExhbmd1YWdlKS5cbiAgICpcbiAgICogICAyIC0gbyB2YWxvciBpbnNlcmlkbyBubyBtw7NkdWxvIGRvIGkxOG4gYXRyYXbDqXMgZG8gcGFyw6JtZXRybyBgY29uZmlnYCwgc2VuZG8gbyBpZGlvbWEgaW5zZXJpZG8gbmEgcHJvcHJpZWRhZGVcbiAgICogYGxhbmd1YWdlYCBkYSBpbnRlcmZhY2UgW2BQb0kxOG5Db25maWdEZWZhdWx0YF0oZG9jdW1lbnRhdGlvbi9wby1pMThuI3BvSTE4bkNvbmZpZ0RlZmF1bHQpLlxuICAgKlxuICAgKiAgIDMgLSBvIGlkaW9tYSBkbyBuYXZlZ2Fkb3IgdXRpbGl6YWRvLlxuICAgKlxuICAgKiA+IENhc28gbyBpZGlvbWEgZG8gbmF2ZWdhZG9yIG7Do28gc2VqYSBzdXBvcnRhZG8gcGVsbyBQTyAoYHB0YCwgYGVuYCBvdSBgZXNgKSwgc2Vyw6EgcmV0b3JuYWRvIHZhbG9yIGBwdGAuXG4gICAqXG4gICAqICoqUmV0b3JubzoqKlxuICAgKlxuICAgKiBgc3RyaW5nYCBjb20gYSBzaWdsYSBkbyBpZGlvbWEgcGFkcsOjby5cbiAgICovXG4gIGdldExhbmd1YWdlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubGFuZ3VhZ2VTZXJ2aWNlLmdldExhbmd1YWdlKCk7XG4gIH1cblxuICAvKipcbiAgICogTcOpdG9kbyBxdWUgcmV0b3JuYSBvIGlkaW9tYSBwYWRyw6NvIGF0aXZvLCBjb20gc29tZW50ZSBhIGFicmV2aWHDp8OjbyBkbyBpZGlvbWEgKGR1YXMgcHJpbWVpcmFzIGxldHJhcykuXG4gICAqIFBvciBleGVtcGxvOiBcInB0XCIgb3UgXCJlc1wiLlxuICAgKlxuICAgKiBBIGJ1c2NhIGRlc3RlIGlkaW9tYSDDqSBiYXNlYWRhIG5vIG3DqXRvZG8gWyoqZ2V0TGFuZ3VhZ2UoKSoqXSgvZG9jdW1lbnRhdGlvbi9wby1pMThuI2dldC1sYW5ndWFnZSkuXG4gICAqXG4gICAqICoqUmV0b3JubzoqKlxuICAgKlxuICAgKiBgc3RyaW5nYCBjb20gYSBzaWdsYSBkbyBpZGlvbWEgcGFkcsOjby5cbiAgICovXG4gIGdldFNob3J0TGFuZ3VhZ2UoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5sYW5ndWFnZVNlcnZpY2UuZ2V0U2hvcnRMYW5ndWFnZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIDxhIGlkPVwic2V0TGFuZ3VhZ2VcIj48L2E+XG4gICAqIE3DqXRvZG8gcGFyYSBhbHRlcmFyIG8gaWRpb21hIHBhZHLDo28gZG8gbcOzZHVsbyBkbyBpMThuLlxuICAgKlxuICAgKiBBbyB1dGlsaXphciBlc3RlIG3DqXRvZG8sIG8gaWRpb21hIGZpY2Fyw6EgZ3JhdmFkbyBubyBhcm1hemVuYW1lbnRvIGxvY2FsIGRvIG5hdmVnYWRvciwgcXVlIHNlcsOhIHV0aWxpemFkbyBwZWxvXG4gICAqIHNlcnZpw6dvIGRvIGBpMThuYCBwYXJhIGJ1c2NhciBhcyBsaXRlcmFpcyBubyBpZGlvbWEgcGFkcsOjby5cbiAgICpcbiAgICogQHBhcmFtIGxhbmd1YWdlIHtzdHJpbmd9IFNpZ2xhIGRvIGlkaW9tYS5cbiAgICpcbiAgICogRXN0YSBzaWdsYSBkZXZlIHNlciBjb21wb3N0YSBwb3IgZHVhcyBsZXRyYXMgcmVwcmVzZW50YW5kbyBvIGlkaW9tYSxcbiAgICogcG9kZW5kbyBzZXIgYWRpY2lvbmFkbyBvdXRyYXMgZHVhcyBsZXRyYXMgcmVwcmVzZW50YW5kbyBvIHBhw61zLCBwb3IgZXhlbXBsbzogYHB0YCwgYHB0LUJSYCwgYHB0LWJyYCwgYGVuYCBvdSBgZW4tVVNgLlxuICAgKlxuICAgKiA+IENhc28gc2VqYSBpbmZvcm1hZG8gdW0gdmFsb3IgZGlmZXJlbnRlIGRlc3RlIHBhZHLDo28sIG8gbWVzbW8gc2Vyw6EgaWdub3JhZG8uXG4gICAqXG4gICAqIEBwYXJhbSByZWxvYWQge2Jvb2xlYW59IEluZGljYSBzZSBhIHDDoWdpbmEgYXR1YWwgcG9kZXLDoSBzZXIgcmVjYXJyZWdhZGEgYXDDs3MgYSBhbHRlcmHDp8OjbyBkbyBpZGlvbWEuXG4gICAqXG4gICAqIEVzdGUgcmVjdXJzbyBwb2RlIHNlciDDunRpbCBwYXJhIG9zIHVzdcOhcmlvcyBxdWUgdXRpbGl6YW0gbyBtw6l0b2RvIGBnZXRMaXRlcmFscygpYCBkbyBzZXJ2acOnbyBkbyBpMThuIHBhcmEgcG9kZXJcbiAgICogYnVzY2FyIG5vdmFtZW50ZSBhcyBsaXRlcmFpcyBubyBub3ZvIGlkaW9tYSBjb25maWd1cmFkby5cbiAgICovXG4gIHNldExhbmd1YWdlKGxhbmd1YWdlOiBzdHJpbmcsIHJlbG9hZD86IGJvb2xlYW4pOiB2b2lkIHtcblxuICAgIGlmICghaXNMYW5ndWFnZShsYW5ndWFnZSkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxhbmd1YWdlU2VydmljZS5zZXRMYW5ndWFnZShsYW5ndWFnZSk7XG5cbiAgICBpZiAocmVsb2FkKSB7XG4gICAgICByZWxvYWRDdXJyZW50UGFnZSgpO1xuICAgIH1cblxuICB9XG5cbiAgcHJpdmF0ZSBzZXRDb25maWcoY29uZmlnOiBQb0kxOG5Db25maWcpIHtcbiAgICAvLyBTZXRhIGFzIGNvbmZpZ3VyYcOnw7VlcyBwYWRyw7VlcyBkZWZpbmlkYXMgbm8gaW1wb3J0YcOnw6NvIGRvIG3Ds2R1bG9cbiAgICBpZiAoY29uZmlnWydkZWZhdWx0J10pIHtcblxuICAgICAgdGhpcy5sYW5ndWFnZVNlcnZpY2Uuc2V0TGFuZ3VhZ2VEZWZhdWx0KGNvbmZpZ1snZGVmYXVsdCddWydsYW5ndWFnZSddKTtcblxuICAgICAgdGhpcy5jb250ZXh0RGVmYXVsdCA9IChjb25maWdbJ2RlZmF1bHQnXVsnY29udGV4dCddKSA/IGNvbmZpZ1snZGVmYXVsdCddWydjb250ZXh0J10gOiAnJztcbiAgICAgIHRoaXMudXNlQ2FjaGUgPSAoY29uZmlnWydkZWZhdWx0J11bJ2NhY2hlJ10pID8gY29uZmlnWydkZWZhdWx0J11bJ2NhY2hlJ10gOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDYXJyZWdhIGEgbGlzdGEgZG9zIGNvbnRleHRvcyBlIGFzIGNvbnRhbnRlcyBpbmZvcm1hZGFzXG4gICAgaWYgKGNvbmZpZ1snY29udGV4dHMnXSkge1xuICAgICAgdGhpcy5zZXRWYXJJMThuKGNvbmZpZ1snY29udGV4dHMnXSk7XG5cbiAgICAgIC8vIFNlIG5lbmh1bSBjb250ZXh0byBmb2kgZGVmaW5pZG8gY29tbyBwYWRyw6NvLFxuICAgICAgLy8gZW50w6NvIGRlZmluZSBvIHByaW1laXJvIGNvbnRleHRvXG4gICAgICBpZiAoIXRoaXMuY29udGV4dERlZmF1bHQpIHtcbiAgICAgICAgZm9yIChjb25zdCBjb250ZXh0IGluIGNvbmZpZ1snY29udGV4dHMnXSkge1xuICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ1snY29udGV4dHMnXS5oYXNPd25Qcm9wZXJ0eShjb250ZXh0KSkge1xuICAgICAgICAgICAgdGhpcy5jb250ZXh0RGVmYXVsdCA9IGNvbnRleHQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXRMaXRlcmFscyhvcHRpb25zOiBQb0kxOG5MaXRlcmFscyA9IHt9KTogT2JzZXJ2YWJsZTxvYmplY3Q+IHtcbiAgICBjb25zdCBsYW5ndWFnZSA9IG9wdGlvbnNbJ2xhbmd1YWdlJ10gPyBvcHRpb25zWydsYW5ndWFnZSddLnRvTG93ZXJDYXNlKCkgOiB0aGlzLmdldExhbmd1YWdlKCk7XG4gICAgY29uc3QgY29udGV4dCA9IChvcHRpb25zWydjb250ZXh0J10pID8gb3B0aW9uc1snY29udGV4dCddIDogdGhpcy5jb250ZXh0RGVmYXVsdDtcbiAgICBjb25zdCBsaXRlcmFsczogQXJyYXk8c3RyaW5nPiA9IChvcHRpb25zWydsaXRlcmFscyddKSA/IG9wdGlvbnNbJ2xpdGVyYWxzJ10gOiBbXTtcblxuICAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XG4gICAgICBpZiAodGhpcy5zZXJ2aWNlc0NvbnRleHRbY29udGV4dF0pIHtcbiAgICAgICAgLy8gRmF6IG8gcHJvY2Vzc28gZGUgYnVzY2EgZGUgdW0gY29udGV4dG8gcXVlIGNvbnTDqW0gc2VydmnDp29cbiAgICAgICAgdGhpcy5nZXRMaXRlcmFsc0Zyb21Db250ZXh0U2VydmljZShsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZheiBvIHByb2Nlc3NvIGRlIGJ1c2NhIGRlIHVtIGNvbnRleHRvIHF1ZSB1dGlsaXphIGNvbnN0YW50ZVxuICAgICAgICB0aGlzLmdldExpdGVyYWxzRnJvbUNvbnRleHRDb25zdGFudChsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIFByb2Nlc3NvIGRlIGJ1c2NhIGRlIHVtIGNvbnRleHRvIHF1ZSBjb250w6ltIHNlcnZpw6dvLlxuICAvLyAgICAxIC0gUHJvY3VyYSBuYSB2YXJpw6F2ZWwgSTE4biBkZXN0ZSBzZXJ2acOnb1xuICAvLyAgICAyIC0gUHJvY3VyYSBubyBsb2NhbCBzdG9yYWdlIChTZSBvIGNhY2hlIGVzdGl2ZXIgZGVmaW5pZG8gY29tbyB0cnVlIG5hIGNvbmZpZ3VyYcOnw6NvIGRvIG3Ds2R1bG8pXG4gIC8vICAgIDMgLSBEaXNwYXJhIG8gc2VydmnDp28sIG1lc21vIHF1ZSBqw6EgdGVuaGEgZW5jb250cmFkbyBubyBsb2NhbCBzdG9yYWdlLCBwYXJhIGdhcmFudGlyIGEgYXR1YWxpemHDp8Ojb1xuICAvLyAgICA0IC0gU2UgbmVuaHVtYSBsaXRlcmFsIGZvciBlbmNvbnRyYWRhLCBlbnTDo28gYnVzY2EgZW0gcHQtYnJcbiAgcHJpdmF0ZSBnZXRMaXRlcmFsc0Zyb21Db250ZXh0U2VydmljZShsYW5ndWFnZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXRlcmFsczogQXJyYXk8c3RyaW5nPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlcjogYW55LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uczogYW55ID0ge30sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFuZ3VhZ2VBbHRlcm5hdGl2ZTogc3RyaW5nID0gbnVsbCkge1xuXG4gICAgLy8gSWRpb21hIHVzYWRvIHBhcmEgdGVudGFyIGJ1c2NhciBhcyBsaXRlcmFpcyBmYWx0YW50ZXNcbiAgICBjb25zdCBsYW5ndWFnZVNlYXJjaCA9IChsYW5ndWFnZUFsdGVybmF0aXZlKSA/IGxhbmd1YWdlQWx0ZXJuYXRpdmUgOiBsYW5ndWFnZTtcblxuICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMubWVyZ2VPYmplY3QodHJhbnNsYXRpb25zLCB0aGlzLnNlYXJjaEluVmFySTE4bihsYW5ndWFnZVNlYXJjaCwgY29udGV4dCwgbGl0ZXJhbHMpKTtcblxuICAgIGlmICh0aGlzLmNvdW50T2JqZWN0KHRyYW5zbGF0aW9ucykgPiAwKSB7XG4gICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgfVxuXG4gICAgLy8gcmVhbGl6YSBhIGJ1c2NhIG5vIGxvY2FsU3RvcmFnZSBlIGVtIHNlZ3VpZGEgbm8gc2VydmnDp29cbiAgICB0aGlzLmdldExpdGVyYWxzTG9jYWxTdG9yYWdlQW5kQ2FjaGUobGFuZ3VhZ2VTZWFyY2gsIGNvbnRleHQsIGxpdGVyYWxzLCBvYnNlcnZlciwgdHJhbnNsYXRpb25zLCBsYW5ndWFnZUFsdGVybmF0aXZlKTtcbiAgfVxuXG4gIC8vIFByb2N1cmEgbm8gbG9jYWwgc3RvcmFnZSBlIGVtIHNlZ3VpZGEgbm8gc2VydmnDp29cbiAgLy8gQ2FzbyBuw6NvIGVuY29udHJlIG5lbSBubyBzZXJ2acOnbywgcmVjb21lw6dhIGEgYnVzY2EgZW0gcHQtYnJcbiAgcHJpdmF0ZSBnZXRMaXRlcmFsc0xvY2FsU3RvcmFnZUFuZENhY2hlKGxhbmd1YWdlOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXRlcmFsczogQXJyYXk8c3RyaW5nPixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyOiBhbnksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbnM6IGFueSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlQWx0ZXJuYXRpdmU6IHN0cmluZyA9IG51bGwpIHtcblxuICAgIGNvbnN0IGxhbmd1YWdlU2VhcmNoID0gKGxhbmd1YWdlQWx0ZXJuYXRpdmUpID8gbGFuZ3VhZ2VBbHRlcm5hdGl2ZSA6IGxhbmd1YWdlO1xuICAgIGxldCB0cmFuc2xhdGlvblRlbXA7XG4gICAgLy8gVmVyaWZpY2Egc2UgdXNhIGNhY2hlXG4gICAgaWYgKHRoaXMudXNlQ2FjaGUpIHtcbiAgICAgIHRyYW5zbGF0aW9uVGVtcCA9IHRoaXMuc2VhcmNoSW5Mb2NhbFN0b3JhZ2UobGFuZ3VhZ2VTZWFyY2gsIGNvbnRleHQsIGxpdGVyYWxzKTtcbiAgICAgIGlmICh0aGlzLmNvdW50T2JqZWN0KHRyYW5zbGF0aW9uVGVtcCkgPiAwKSB7XG4gICAgICAgIHRoaXMudXBkYXRlVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgdHJhbnNsYXRpb25UZW1wKTtcbiAgICAgICAgdHJhbnNsYXRpb25zID0gdGhpcy5tZXJnZU9iamVjdCh0cmFuc2xhdGlvblRlbXAsIHRyYW5zbGF0aW9ucyk7XG4gICAgICAgIG9ic2VydmVyLm5leHQodHJhbnNsYXRpb25zKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBCdXNjYSBkbyBTZXJ2acOnb1xuICAgIHRoaXMuZ2V0SHR0cFNlcnZpY2UodGhpcy5zZXJ2aWNlc0NvbnRleHRbY29udGV4dF0sIGxhbmd1YWdlU2VhcmNoLCBsaXRlcmFscylcbiAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgIHJlc3BvbnNlID0+IHtcbiAgICAgICAgICBpZiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTG9jYWxTdG9yYWdlKGxhbmd1YWdlLCBjb250ZXh0LCByZXNwb25zZSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVZhckkxOG4obGFuZ3VhZ2UsIGNvbnRleHQsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHRyYW5zbGF0aW9uVGVtcCA9IHRoaXMuc2VhcmNoSW5WYXJJMThuKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscyk7XG4gICAgICAgICAgICB0cmFuc2xhdGlvbnMgPSB0aGlzLm1lcmdlT2JqZWN0KHRyYW5zbGF0aW9uVGVtcCwgdHJhbnNsYXRpb25zKTtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQodHJhbnNsYXRpb25zKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSB0b2RhcyBhcyBsaXRlcmFpcyBwZXNxdWlzYWRhcyBubyBpZGlvbWFcbiAgICAgICAgICAvLyBFbnTDo28gcmVmYXogbyBwcm9jZXNzbyBwcm9jdXJhbmRvIGVtIHBvcnR1Z3XDqnNcbiAgICAgICAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gdGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpKSB7XG4gICAgICAgICAgICBpZiAobGFuZ3VhZ2VBbHRlcm5hdGl2ZSA9PT0gJ3B0LWJyJykge1xuICAgICAgICAgICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSBuZW0gZW0gcG9ydHVndcOqcywgZW50w6NvIHJldG9ybmEgbyBub21lIGRhcyBsaXRlcmFpc1xuICAgICAgICAgICAgICB0cmFuc2xhdGlvbnMgPSB0aGlzLmNvbXBsZXRlRmF1bHRMaXRlcmFscyhsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMsIHRyYW5zbGF0aW9ucyk7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlTG9jYWxTdG9yYWdlKGxhbmd1YWdlLCBjb250ZXh0LCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVZhckkxOG4obGFuZ3VhZ2UsIGNvbnRleHQsIHRyYW5zbGF0aW9ucyk7XG4gICAgICAgICAgICAgIG9ic2VydmVyLm5leHQodHJhbnNsYXRpb25zKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMuZ2V0TGl0ZXJhbHNGcm9tQ29udGV4dFNlcnZpY2UobGFuZ3VhZ2UsIGNvbnRleHQsIGxpdGVyYWxzLCBvYnNlcnZlciwgdHJhbnNsYXRpb25zLCAncHQtYnInKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICB9XG5cbiAgLy8gUHJvY3VyYSBwZWxhIGxpc3RhIGRlIGxpdGVyYWlzXG4gIC8vIFNlIG7Do28gZW5jb250cmFyIHRvZGFzLCBwcm9jdXJhIGVtIHB0LWJyXG4gIHByaXZhdGUgZ2V0TGl0ZXJhbHNGcm9tQ29udGV4dENvbnN0YW50KGxhbmd1YWdlOiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6IHN0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGl0ZXJhbHM6IEFycmF5PHN0cmluZz4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyOiBhbnksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zbGF0aW9uczogYW55ID0ge30pIHtcblxuICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMubWVyZ2VPYmplY3QodHJhbnNsYXRpb25zLCB0aGlzLnNlYXJjaEluVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgbGl0ZXJhbHMpKTtcbiAgICBpZiAodGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpID4gMCkge1xuICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgIH1cblxuICAgIC8vIFNlIGZvaSBwZXNxdWlzYWRvIHBvciBsaXRlcmFpc1xuICAgIGlmIChsaXRlcmFscy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSB0b2RhcyBhcyBsaXRlcmFpcyBwZXNxdWlzYWRhcyBubyBpZGlvbWEsIHByb2N1cmEgZW0gcG9ydHVndcOqc1xuICAgICAgaWYgKGxpdGVyYWxzLmxlbmd0aCA+IHRoaXMuY291bnRPYmplY3QodHJhbnNsYXRpb25zKSkge1xuICAgICAgICBpZiAobGFuZ3VhZ2UgPT09ICdwdC1icicpIHtcbiAgICAgICAgICAvLyBTZSBuw6NvIGVuY29udHJvdSBuZW0gZW0gcG9ydHVndcOqcywgZW50w6NvIHJldG9ybmEgbyBub21lIGRhcyBsaXRlcmFpc1xuICAgICAgICAgIHRyYW5zbGF0aW9ucyA9IHRoaXMuY29tcGxldGVGYXVsdExpdGVyYWxzKGxhbmd1YWdlLCBjb250ZXh0LCBsaXRlcmFscywgdHJhbnNsYXRpb25zKTtcbiAgICAgICAgICBvYnNlcnZlci5uZXh0KHRyYW5zbGF0aW9ucyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5nZXRMaXRlcmFsc0Zyb21Db250ZXh0Q29uc3RhbnQoJ3B0LWJyJywgY29udGV4dCwgbGl0ZXJhbHMsIG9ic2VydmVyLCB0cmFuc2xhdGlvbnMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNlIG7Do28gZW5jb250cmFyIG5lbmh1bWEgbGl0ZXJhbCwgcHJvY3VyYSBlbSBwb3J0dWd1w6pzXG4gICAgICBpZiAodGhpcy5jb3VudE9iamVjdCh0cmFuc2xhdGlvbnMpID09PSAwICYmIGxhbmd1YWdlICE9PSAncHQtYnInKSB7XG4gICAgICAgIHRoaXMuZ2V0TGl0ZXJhbHNGcm9tQ29udGV4dENvbnN0YW50KCdwdC1icicsIGNvbnRleHQsIGxpdGVyYWxzLCBvYnNlcnZlciwgdHJhbnNsYXRpb25zKTtcbiAgICAgIH1cblxuICAgICAgLy8gY2FzbyBuw6NvIGluZm9ybWFyIGxpdGVyYWlzIGUgbsOjbyBob3V2ZXIgdHJhZHXDp8Ojb1xuICAgICAgb2JzZXJ2ZXIubmV4dCh0cmFuc2xhdGlvbnMpO1xuICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICB9XG4gIH1cblxuICAvLyBCdXNjYSBwZWxhcyBsaXRlcmFpcyBubyBsb2NhbCBzdG9yYWdlXG4gIHByaXZhdGUgc2VhcmNoSW5Mb2NhbFN0b3JhZ2UobGFuZ3VhZ2U6IHN0cmluZywgY29udGV4dDogc3RyaW5nLCBsaXRlcmFsczogQXJyYXk8c3RyaW5nPik6IGFueSB7XG4gICAgY29uc3QgdHJhbnNsYXRpb25zOiBhbnkgPSB7fTtcblxuICAgIGlmIChsaXRlcmFscy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpdGVyYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGxpdGVyYWwgPSBsaXRlcmFsc1tpXTtcbiAgICAgICAgY29uc3QgdHJhbnNsYXRpb24gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShsYW5ndWFnZSArICctJyArIGNvbnRleHQgKyAnLScgKyBsaXRlcmFsKTtcbiAgICAgICAgaWYgKHRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgdHJhbnNsYXRpb25zW2xpdGVyYWxdID0gdHJhbnNsYXRpb247XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zbGF0aW9ucztcbiAgfVxuXG4gIC8vIEJ1c2NhIHBlbGFzIGxpdGVyYWlzIG5hIHZhcmnDoXZlbCBkbyBzZXJ2acOnb1xuICBwcml2YXRlIHNlYXJjaEluVmFySTE4bihsYW5ndWFnZTogc3RyaW5nLCBjb250ZXh0OiBzdHJpbmcsIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+KTogYW55IHtcbiAgICBsZXQgdHJhbnNsYXRpb25zOiBhbnkgPSB7fTtcblxuICAgIGlmICh0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdICYmIHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0pIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdW2NvbnRleHRdO1xuXG4gICAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBCdXNjYSBhcyBsaXRlcmFpcyBkZXNlamFkYXNcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXRlcmFscy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IGxpdGVyYWwgPSBsaXRlcmFsc1tpXTtcbiAgICAgICAgICBpZiAoY29udGVudC5oYXNPd25Qcm9wZXJ0eShsaXRlcmFsKSkge1xuICAgICAgICAgICAgdHJhbnNsYXRpb25zW2xpdGVyYWxdID0gY29udGVudFtsaXRlcmFsXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEF0cmlidWkgdG9kYXMgYXMgbGl0ZXJhaXNcbiAgICAgICAgdHJhbnNsYXRpb25zID0geyAuLi5jb250ZW50IH07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2xhdGlvbnM7XG4gIH1cblxuICAvLyBBdHVhbGl6YSBvIGxvY2FsIHN0b3JhZ2VcbiAgcHJpdmF0ZSB1cGRhdGVMb2NhbFN0b3JhZ2UobGFuZ3VhZ2U6IHN0cmluZywgY29udGV4dDogc3RyaW5nLCBkYXRhOiBhbnkpIHtcbiAgICBpZiAodGhpcy51c2VDYWNoZSkge1xuICAgICAgZm9yIChjb25zdCBsaXRlcmFsIGluIGRhdGEpIHtcbiAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkobGl0ZXJhbCkpIHtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsYW5ndWFnZSArICctJyArIGNvbnRleHQgKyAnLScgKyBsaXRlcmFsLCBkYXRhW2xpdGVyYWxdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEF0dWFsaXphIGEgdmFyacOhdmVsIGxvY2FsIGNvbSBhcyBsaXRlcmFpcyBjb20gb3Mgb2JqZXRvcyBwYXNzYWRvcyBuYSBjb25maWd1cmHDp8Ojb1xuICBwcml2YXRlIHNldFZhckkxOG4oY29udGV4dHM6IGFueSkge1xuICAgIC8vIFBlcmNvcnJlIG9zIGNvbnRleHRvc1xuICAgIGZvciAoY29uc3QgY29udGV4dCBpbiBjb250ZXh0cykge1xuICAgICAgaWYgKGNvbnRleHRzLmhhc093blByb3BlcnR5KGNvbnRleHQpKSB7XG4gICAgICAgIGNvbnN0IGNvbnRleHRDb250ZW50ID0gY29udGV4dHNbY29udGV4dF07XG5cbiAgICAgICAgLy8gUGVyY29ycmUgb3MgaWRpb21hcyBkZW50cm8gZG8gY29udGV4dG9cbiAgICAgICAgZm9yIChjb25zdCBsYW5ndWFnZSBpbiBjb250ZXh0Q29udGVudCkge1xuICAgICAgICAgIGlmIChjb250ZXh0Q29udGVudC5oYXNPd25Qcm9wZXJ0eShsYW5ndWFnZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhbmd1YWdlQ29udGVudCA9IGNvbnRleHRDb250ZW50W2xhbmd1YWdlXTtcblxuICAgICAgICAgICAgaWYgKGxhbmd1YWdlID09PSAndXJsJykge1xuICAgICAgICAgICAgICB0aGlzLnNlcnZpY2VzQ29udGV4dFtjb250ZXh0XSA9IGxhbmd1YWdlQ29udGVudDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlVmFySTE4bihsYW5ndWFnZSwgY29udGV4dCwgbGFuZ3VhZ2VDb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBBdHVhbGl6YSBhIHZhcmnDoXZlbCBsb2NhbCBjb20gYXMgbGl0ZXJhaXMgaWRpb21hIGUgY29udGV4dG9cbiAgcHJpdmF0ZSB1cGRhdGVWYXJJMThuKGxhbmd1YWdlOiBzdHJpbmcsIGNvbnRleHQ6IHN0cmluZywgZGF0YTogYW55KSB7XG4gICAgbGFuZ3VhZ2UgPSBsYW5ndWFnZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgaWYgKCF0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdKSB7XG4gICAgICB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdID0ge1tjb250ZXh0XToge319O1xuICAgIH1cbiAgICBpZiAoIXRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0pIHtcbiAgICAgIHRoaXMudmFySTE4bltsYW5ndWFnZV1bY29udGV4dF0gPSB7fTtcbiAgICB9XG5cbiAgICAvLyBDcmlhIG91IGF0dWFsaXphIG8gY29udGV4dG8gZGVudHJvIGRvIHN0b3JhZ2VcbiAgICB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdW2NvbnRleHRdID0gdGhpcy5tZXJnZU9iamVjdChkYXRhLCB0aGlzLnZhckkxOG5bbGFuZ3VhZ2VdW2NvbnRleHRdKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0SHR0cFNlcnZpY2UodXJsOiBzdHJpbmcsIGxhbmd1YWdlOiBzdHJpbmcsIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+KTogT2JzZXJ2YWJsZTxvYmplY3Q+IHtcbiAgICBsZXQgcGFyYW0gPSAnP2xhbmd1YWdlPScgKyBsYW5ndWFnZTtcbiAgICBpZiAobGl0ZXJhbHMubGVuZ3RoID4gMCkge1xuICAgICAgcGFyYW0gKz0gJyZsaXRlcmFscz0nICsgbGl0ZXJhbHMuam9pbigpO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhIGJhcnJhIGZpbmFsIGRvIGVuZGVyZcOnb1xuICAgIHVybCA9ICh1cmwubGFzdEluZGV4T2YoJy8nKSA9PT0gdXJsLmxlbmd0aCAtIDEpID8gdXJsLnN1YnN0cigwLCB1cmwubGVuZ3RoIC0gMSkgOiB1cmw7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwgKyBwYXJhbSk7XG4gIH1cblxuICAvLyBDb21wbGV0YSBjb20gbyBub21lIGRhIGxpdGVyYWlzLCBhcyBxdWUgbsOjbyBmb3JhbSBlbmNvbnRyYWRhc1xuICBwcml2YXRlIGNvbXBsZXRlRmF1bHRMaXRlcmFscyhsYW5ndWFnZTogc3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBzdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpdGVyYWxzOiBBcnJheTxzdHJpbmc+LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbnM6IGFueSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGl0ZXJhbHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGxpdGVyYWwgPSBsaXRlcmFsc1tpXTtcbiAgICAgIGlmICghdHJhbnNsYXRpb25zW2xpdGVyYWxdKSB7XG4gICAgICAgIHRyYW5zbGF0aW9uc1tsaXRlcmFsXSA9IGxpdGVyYWw7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cmFuc2xhdGlvbnM7XG4gIH1cblxuICAvLyBDb250YSBvcyBhdHJpYnV0b3MgZG8gb2JqZXRvXG4gIHByaXZhdGUgY291bnRPYmplY3Qob2JqOiBvYmplY3QpIHtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7XG4gIH1cblxuICAvLyBGYXogbyBtZXJnZSBkb3Mgb2JqZXRvcywgc2VtcHJlIGRhbmRvIHByZWZlcsOqbmNpYSBwYXJhIG8gcHJpbWVpcm8gb2JqZXRvIGRlIHBhcsOibWV0cm9cbiAgcHJpdmF0ZSBtZXJnZU9iamVjdChvYmpQZXJtYW5lbnQ6IGFueSwgb2JqOiBhbnkpIHtcbiAgICByZXR1cm4geyAuLi5vYmosIC4uLm9ialBlcm1hbmVudCB9O1xuICB9XG59XG4iXX0=