/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { poChartAngleStepInterval, poChartCompleteCircle, poChartPadding, poChartStartAngle } from './po-chart-circular.constant';
import { PoChartDynamicTypeComponent } from '../po-chart-dynamic-type.component';
import { PoChartType } from '../../enums/po-chart-type.enum';
import { PoSeriesTextBlack } from '../../po-chart-colors.constant';
/** @type {?} */
var poChartBlackColor = '#000000';
/** @type {?} */
var poChartWhiteColor = '#ffffff';
var PoChartCircular = /** @class */ (function (_super) {
    tslib_1.__extends(PoChartCircular, _super);
    function PoChartCircular(el, ngZone, renderer) {
        var _this = _super.call(this) || this;
        _this.el = el;
        _this.ngZone = ngZone;
        _this.renderer = renderer;
        _this.chartItemsEndAngleList = [];
        _this.svgPathElementsList = [];
        _this.svgTextElementsList = [];
        return _this;
    }
    Object.defineProperty(PoChartCircular.prototype, "series", {
        get: /**
         * @return {?}
         */
        function () {
            return this._series;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._series = this.getSeriesWithValue(value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @param {?} value
     * @param {?} totalValue
     * @return {?}
     */
    PoChartCircular.calculateEndAngle = /**
     * @private
     * @param {?} value
     * @param {?} totalValue
     * @return {?}
     */
    function (value, totalValue) {
        return value / totalValue * (Math.PI * 2);
    };
    /**
     * @return {?}
     */
    PoChartCircular.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.removeWindowResizeListener();
        this.removeWindowScrollListener();
        this.animationRunning = false;
    };
    /**
     * @return {?}
     */
    PoChartCircular.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.chartInitSetup();
        this.setEventListeners();
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.animationSetup = /**
     * @private
     * @return {?}
     */
    function () {
        this.chartItemStartAngle = poChartStartAngle;
        this.chartItemEndAngle = this.chartItemsEndAngleList[0];
        this.animationRunning = true;
        this.drawPathInit();
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.calculateAngleRadians = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.series.forEach((/**
         * @param {?} serie
         * @param {?} index
         * @return {?}
         */
        function (serie, index) {
            return _this.chartItemsEndAngleList[index] = PoChartCircular.calculateEndAngle(serie.value, _this.totalValue);
        }));
    };
    /**
     * @private
     * @param {?} angleCurrentPosition
     * @return {?}
     */
    PoChartCircular.prototype.calculateCurrentEndAngle = /**
     * @private
     * @param {?} angleCurrentPosition
     * @return {?}
     */
    function (angleCurrentPosition) {
        /** @type {?} */
        var isSerieDrawCompleted = this.chartItemStartAngle + angleCurrentPosition > this.chartItemStartAngle + this.chartItemEndAngle;
        if (isSerieDrawCompleted) {
            return (this.chartItemStartAngle + this.chartItemEndAngle) - poChartCompleteCircle;
        }
        else {
            return this.chartItemStartAngle + angleCurrentPosition;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.calculateSVGDimensions = /**
     * @private
     * @return {?}
     */
    function () {
        this.calculateSVGContainerDimensions(this.chartWrapper, this.chartHeader, this.chartLegend);
        this.setInnerRadius();
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    PoChartCircular.prototype.changeTooltipPosition = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.tooltipElement && this.tooltipElement.classList.contains('po-invisible')) {
            this.showTooltip();
        }
        /** @type {?} */
        var tooltipPositions = this.setTooltipPositions(event);
        this.renderer.setStyle(this.tooltipElement, 'left', tooltipPositions.left + "px");
        this.renderer.setStyle(this.tooltipElement, 'top', tooltipPositions.top + "px");
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.chartInitSetup = /**
     * @private
     * @return {?}
     */
    function () {
        this.calculateSVGDimensions();
        this.calculateTotalValue();
        this.calculateAngleRadians();
        this.createSVGElements();
        this.animationSetup();
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.checkingIfScrollsWithPoPage = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var poPageContent = document.getElementsByClassName('po-page-content');
        return poPageContent.length ? poPageContent[0] : window;
    };
    /**
     * @private
     * @param {?} serie
     * @param {?} svgPathsWrapper
     * @return {?}
     */
    PoChartCircular.prototype.createPath = /**
     * @private
     * @param {?} serie
     * @param {?} svgPathsWrapper
     * @return {?}
     */
    function (serie, svgPathsWrapper) {
        /** @type {?} */
        var svgPath = this.renderer.createElement('svg:path', 'svg');
        this.renderer.setAttribute(svgPath, 'class', 'po-path-item');
        this.renderer.setAttribute(svgPath, 'fill', serie.color);
        this.setTooltipAttributes(svgPath, serie);
        svgPathsWrapper.appendChild(svgPath);
        this.renderer.appendChild(this.svgElement, svgPathsWrapper);
        this.svgPathElementsList.push(svgPath);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.createPaths = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var svgPathsWrapper = this.renderer.createElement('svg:g', 'svg');
        this.series.forEach((/**
         * @param {?} serie
         * @return {?}
         */
        function (serie) { return _this.createPath(serie, svgPathsWrapper); }));
    };
    /**
     * @private
     * @param {?} serie
     * @return {?}
     */
    PoChartCircular.prototype.createText = /**
     * @private
     * @param {?} serie
     * @return {?}
     */
    function (serie) {
        var value = serie.value;
        /** @type {?} */
        var svgG = this.renderer.createElement('svg:g', 'svg');
        /** @type {?} */
        var svgText = this.renderer.createElement('svg:text', 'svg');
        /** @type {?} */
        var fontSize = this.getFontSize();
        /** @type {?} */
        var textColor = this.getTextColor(serie.color);
        svgText.textContent = this.getPercentValue(value, this.totalValue) + '%';
        this.renderer.setAttribute(svgText, 'class', 'po-path-item');
        this.renderer.setAttribute(svgText, 'fill', textColor);
        this.renderer.setAttribute(svgText, 'font-size', fontSize);
        this.renderer.setAttribute(svgText, 'fill-opacity', '0');
        this.setTooltipAttributes(svgText, serie);
        this.renderer.appendChild(svgG, svgText);
        this.renderer.appendChild(this.svgElement, svgG);
        this.svgTextElementsList.push(svgText);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.createTexts = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.type === PoChartType.Donut) {
            this.series.forEach((/**
             * @param {?} serie
             * @return {?}
             */
            function (serie) { return _this.createText(serie); }));
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.createSVGElements = /**
     * @private
     * @return {?}
     */
    function () {
        this.svgElement = this.renderer.createElement('svg:svg', 'svg');
        this.renderer.setAttribute(this.svgElement, 'viewBox', "0 0 " + this.chartWrapper + " " + this.centerX * 2);
        this.renderer.setAttribute(this.svgElement, 'preserveAspectRatio', 'xMidYMin meet');
        this.renderer.setAttribute(this.svgElement, 'class', 'po-chart-svg-element');
        this.renderer.setAttribute(this.svgElement, 'width', "" + (this.chartWrapper - poChartPadding * 2));
        this.renderer.setAttribute(this.svgElement, 'height', "" + this.svgHeight);
        this.svgContainer.nativeElement.appendChild(this.svgElement);
        this.createPaths();
        this.createTexts();
    };
    /**
     * @private
     * @param {?} path
     * @param {?} chartItemStartAngle
     * @param {?} chartItemEndAngle
     * @return {?}
     */
    PoChartCircular.prototype.drawPath = /**
     * @private
     * @param {?} path
     * @param {?} chartItemStartAngle
     * @param {?} chartItemEndAngle
     * @return {?}
     */
    function (path, chartItemStartAngle, chartItemEndAngle) {
        /** @type {?} */
        var largeArc = chartItemEndAngle - chartItemStartAngle > Math.PI;
        /** @type {?} */
        var sinAlpha = Math.sin(chartItemStartAngle);
        /** @type {?} */
        var cosAlpha = Math.cos(chartItemStartAngle);
        /** @type {?} */
        var sinBeta = Math.sin(chartItemEndAngle);
        /** @type {?} */
        var cosBeta = Math.cos(chartItemEndAngle);
        /** @type {?} */
        var startX = this.centerX + cosAlpha * this.centerX;
        /** @type {?} */
        var startY = this.centerX + sinAlpha * this.centerX;
        /** @type {?} */
        var endX = this.centerX + cosBeta * this.centerX;
        /** @type {?} */
        var endY = this.centerX + sinBeta * this.centerX;
        /** @type {?} */
        var startInnerX = this.centerX + cosAlpha * this.innerRadius;
        /** @type {?} */
        var startInnerY = this.centerX + sinAlpha * this.innerRadius;
        /** @type {?} */
        var endInnerX = this.centerX + cosBeta * this.innerRadius;
        /** @type {?} */
        var endInnerY = this.centerX + sinBeta * this.innerRadius;
        /** @type {?} */
        var pathCoordinates = [
            'M', startX, startY,
            'A', this.centerX, this.centerX, 0, largeArc ? '1,1' : '0,1', endX, endY,
            'L', endInnerX, endInnerY,
            'A', this.innerRadius, this.innerRadius, 0, largeArc ? '1,0' : '0,0', startInnerX, startInnerY,
            'Z'
        ].join(' ');
        return path.setAttribute('d', pathCoordinates);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.drawPathInit = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        if (!this.animationRunning) {
            return;
        }
        else {
            this.ngZone.runOutsideAngular((/**
             * @return {?}
             */
            function () { return _this.drawSeries(); }));
        }
    };
    /**
     * @private
     * @param {?=} currentSerieIndex
     * @param {?=} angleCurrentPosition
     * @return {?}
     */
    PoChartCircular.prototype.drawSeries = /**
     * @private
     * @param {?=} currentSerieIndex
     * @param {?=} angleCurrentPosition
     * @return {?}
     */
    function (currentSerieIndex, angleCurrentPosition) {
        if (currentSerieIndex === void 0) { currentSerieIndex = 0; }
        if (angleCurrentPosition === void 0) { angleCurrentPosition = 0; }
        /** @type {?} */
        var isFinishedDrawingCurrentSeries = angleCurrentPosition > this.chartItemEndAngle;
        /** @type {?} */
        var isFinishedDrawingAllSeries = currentSerieIndex === this.svgPathElementsList.length;
        if (isFinishedDrawingAllSeries) {
            return;
        }
        if (isFinishedDrawingCurrentSeries) {
            this.chartItemStartAngle = this.chartItemStartAngle + this.chartItemEndAngle;
            currentSerieIndex++;
            this.chartItemEndAngle = this.chartItemsEndAngleList[currentSerieIndex];
            angleCurrentPosition = 0;
        }
        else {
            angleCurrentPosition += poChartAngleStepInterval;
            this.drawPath(this.svgPathElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
            this.setTextProperties(this.svgTextElementsList[currentSerieIndex], this.chartItemStartAngle, this.calculateCurrentEndAngle(angleCurrentPosition));
        }
        window.requestAnimationFrame(this.drawSeries.bind(this, currentSerieIndex, angleCurrentPosition));
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    PoChartCircular.prototype.emitEventOnEnter = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.onSerieHover.next(event);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.getFontSize = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var fontSizePorcent = 0.04;
        /** @type {?} */
        var fontSize = fontSizePorcent * this.chartWrapper;
        return fontSize.toFixed(0) + "px";
    };
    /**
     * @private
     * @param {?} value
     * @param {?} totalValue
     * @return {?}
     */
    PoChartCircular.prototype.getPercentValue = /**
     * @private
     * @param {?} value
     * @param {?} totalValue
     * @return {?}
     */
    function (value, totalValue) {
        /** @type {?} */
        var percentValue = (value / totalValue) * 100;
        // caso tiver mais que duas casas decimais, fixa até duas, ex: 10.6575 => 10.65
        // se não retorna o valor com parsefloat que remove casa decimal desencessaria, ex: 10.60 => 10.6
        /** @type {?} */
        var floatPercentValue = this.isMoreThanTwoDecimalsPlaces(percentValue) ?
            parseFloat(percentValue.toFixed(2)) : parseFloat((/** @type {?} */ (percentValue)));
        return String(floatPercentValue).replace('.', ',');
    };
    /**
     * @private
     * @param {?} series
     * @return {?}
     */
    PoChartCircular.prototype.getSeriesWithValue = /**
     * @private
     * @param {?} series
     * @return {?}
     */
    function (series) {
        var _this = this;
        /** @type {?} */
        var newSeries = [];
        series.forEach((/**
         * @param {?} serie
         * @param {?} index
         * @return {?}
         */
        function (serie, index) {
            if (serie.value > 0) {
                newSeries.push(tslib_1.__assign({}, serie, { color: _this.colors[index] }));
            }
        }));
        return newSeries;
    };
    /**
     * @private
     * @param {?} color
     * @return {?}
     */
    PoChartCircular.prototype.getTextColor = /**
     * @private
     * @param {?} color
     * @return {?}
     */
    function (color) {
        if (PoSeriesTextBlack.includes(color)) {
            return poChartBlackColor;
        }
        return poChartWhiteColor;
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    PoChartCircular.prototype.getTooltipValue = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (this.type === PoChartType.Pie) {
            return value.toString();
        }
        return this.getPercentValue(value, this.totalValue) + '%';
    };
    /**
     * @private
     * @param {?=} value
     * @return {?}
     */
    PoChartCircular.prototype.isMoreThanTwoDecimalsPlaces = /**
     * @private
     * @param {?=} value
     * @return {?}
     */
    function (value) {
        if (value === void 0) { value = 0; }
        var _a = tslib_1.__read(value.toString().split('.'), 2), valueAfterDot = _a[1];
        return valueAfterDot && valueAfterDot.length > 2;
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.onMouseClick = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var serieOnClick = { category: this.chartElementCategory, value: this.chartElementValue };
        this.onSerieClick.next(serieOnClick);
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    PoChartCircular.prototype.onMouseEnter = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.tooltipElement = this.chartBody.nativeElement.lastChild;
        this.chartElementCategory = event.target.getAttributeNS(null, 'data-tooltip-category');
        this.chartElementValue = event.target.getAttributeNS(null, 'data-tooltip-value');
        this.tooltipText = event.target.getAttributeNS(null, 'data-tooltip-text');
        this.showTooltip();
        this.changeTooltipPosition(event);
        /** @type {?} */
        var serieOnEnter = { category: this.chartElementCategory, value: this.chartElementValue };
        this.emitEventOnEnter(serieOnEnter);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.onWindowResize = /**
     * @private
     * @return {?}
     */
    function () {
        this.calculateSVGDimensions();
        this.renderer.setAttribute(this.svgElement, 'width', "" + (this.chartWrapper - poChartPadding * 2));
        this.renderer.setAttribute(this.svgElement, 'height', "" + this.svgHeight);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.removeTooltip = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.tooltipElement) {
            this.renderer.addClass(this.tooltipElement, 'po-invisible');
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.removeWindowResizeListener = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.windowResizeListener) {
            this.windowResizeListener();
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.removeWindowScrollListener = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.windowScrollListener) {
            this.windowScrollListener();
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.setEventListeners = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var chartSeries = this.el.nativeElement.querySelectorAll('.po-path-item');
        chartSeries = Array.from(chartSeries);
        chartSeries.forEach((/**
         * @param {?} serie
         * @return {?}
         */
        function (serie) {
            _this.renderer.listen(serie, 'click', _this.onMouseClick.bind(_this));
            _this.renderer.listen(serie, 'mouseenter', _this.onMouseEnter.bind(_this));
            _this.renderer.listen(serie, 'mousemove', _this.changeTooltipPosition.bind(_this));
            _this.renderer.listen(serie, 'mouseleave', _this.removeTooltip.bind(_this));
        }));
        this.windowResizeListener = this.renderer.listen(window, 'resize', this.onWindowResize.bind(this));
        this.windowScrollListener = this.renderer.listen(this.checkingIfScrollsWithPoPage(), 'scroll', this.removeTooltip.bind(this));
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.setInnerRadius = /**
     * @private
     * @return {?}
     */
    function () {
        // tamanho da largua da serie proporcional ao grafico, o valor 0.27 fica proximo de 32px
        /** @type {?} */
        var serieWidth = 0.27;
        this.innerRadius = this.type === PoChartType.Pie ? 0 : this.centerX - (this.centerX * serieWidth);
    };
    /**
     * @private
     * @param {?} text
     * @param {?} startAngle
     * @param {?} endAngle
     * @return {?}
     */
    PoChartCircular.prototype.setTextProperties = /**
     * @private
     * @param {?} text
     * @param {?} startAngle
     * @param {?} endAngle
     * @return {?}
     */
    function (text, startAngle, endAngle) {
        if (this.type === PoChartType.Donut) {
            // utilizado para recuperar o angulo do meio, entre o inicio e fim para centralizar o texto
            /** @type {?} */
            var centerAngle = (startAngle + endAngle) / 2;
            /** @type {?} */
            var textBox = text.getBBox();
            /** @type {?} */
            var halfTextWidth = textBox.width / 2;
            /** @type {?} */
            var halfTextHeight = textBox.height / 2;
            // radius interno (circulo branco) + a metade da diferença entre tamanho do centro e radius interno
            /** @type {?} */
            var radius = this.innerRadius + (this.centerX - this.innerRadius) / 2;
            /** @type {?} */
            var xCoordinate = radius * Math.cos(centerAngle) + this.centerX - (halfTextWidth);
            /** @type {?} */
            var yCoordinate = radius * Math.sin(centerAngle) + this.centerX + (halfTextHeight / 2);
            text.setAttribute('x', xCoordinate);
            text.setAttribute('y', yCoordinate);
            text.setAttribute('fill-opacity', '1');
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    PoChartCircular.prototype.setTooltipPositions = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var displacement = 8;
        return {
            left: event.clientX - this.tooltipElement.offsetWidth / 2,
            top: event.clientY - this.tooltipElement.offsetHeight - displacement
        };
    };
    /**
     * @private
     * @param {?} svgElement
     * @param {?} serie
     * @return {?}
     */
    PoChartCircular.prototype.setTooltipAttributes = /**
     * @private
     * @param {?} svgElement
     * @param {?} serie
     * @return {?}
     */
    function (svgElement, serie) {
        var value = serie.value, category = serie.category, tooltip = serie.tooltip;
        /** @type {?} */
        var tooltipValue = this.getTooltipValue(value);
        this.renderer.setAttribute(svgElement, 'data-tooltip-category', category);
        this.renderer.setAttribute(svgElement, 'data-tooltip-value', "" + value);
        this.renderer.setAttribute(svgElement, 'data-tooltip-text', tooltip || category + ": " + tooltipValue);
    };
    /**
     * @private
     * @return {?}
     */
    PoChartCircular.prototype.showTooltip = /**
     * @private
     * @return {?}
     */
    function () {
        this.renderer.removeClass(this.tooltipElement, 'po-invisible');
    };
    return PoChartCircular;
}(PoChartDynamicTypeComponent));
export { PoChartCircular };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype._series;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.animationRunning;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.chartItemEndAngle;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.chartItemStartAngle;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.chartItemsEndAngleList;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.svgPathElementsList;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.svgTextElementsList;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.el;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.ngZone;
    /**
     * @type {?}
     * @private
     */
    PoChartCircular.prototype.renderer;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQtY2lyY3VsYXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWNoYXJ0L3BvLWNoYXJ0LXR5cGVzL3BvLWNoYXJ0LWNpcmN1bGFyL3BvLWNoYXJ0LWNpcmN1bGFyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBRUEsT0FBTyxFQUNMLHdCQUF3QixFQUN4QixxQkFBcUIsRUFDckIsY0FBYyxFQUNkLGlCQUFpQixFQUNsQixNQUFNLDhCQUE4QixDQUFDO0FBQ3RDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUk3RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7SUFFN0QsaUJBQWlCLEdBQUcsU0FBUzs7SUFDN0IsaUJBQWlCLEdBQUcsU0FBUztBQUVuQztJQUFxQywyQ0FBMkI7SUF1QjlELHlCQUFvQixFQUFjLEVBQVUsTUFBYyxFQUFVLFFBQW1CO1FBQXZGLFlBQ0UsaUJBQU8sU0FDUjtRQUZtQixRQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsWUFBTSxHQUFOLE1BQU0sQ0FBUTtRQUFVLGNBQVEsR0FBUixRQUFRLENBQVc7UUFoQi9FLDRCQUFzQixHQUFrQixFQUFFLENBQUM7UUFDM0MseUJBQW1CLEdBQWtCLEVBQUUsQ0FBQztRQUN4Qyx5QkFBbUIsR0FBa0IsRUFBRSxDQUFDOztJQWdCaEQsQ0FBQztJQWRELHNCQUFJLG1DQUFNOzs7O1FBSVY7WUFDRSxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDdEIsQ0FBQzs7Ozs7UUFORCxVQUFXLEtBQW1EO1lBQzVELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELENBQUM7OztPQUFBOzs7Ozs7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LDhDQUFnRDs7Ozs7SUFjcEMsNkJBQXNCOzs7OztJQUFFLGlDQUFzQjs7Ozs7SUFBRSxtQ0FBMkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbGVtZW50UmVmLCBOZ1pvbmUsIE9uRGVzdHJveSwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHtcbiAgcG9DaGFydEFuZ2xlU3RlcEludGVydmFsLFxuICBwb0NoYXJ0Q29tcGxldGVDaXJjbGUsXG4gIHBvQ2hhcnRQYWRkaW5nLFxuICBwb0NoYXJ0U3RhcnRBbmdsZVxufSBmcm9tICcuL3BvLWNoYXJ0LWNpcmN1bGFyLmNvbnN0YW50JztcbmltcG9ydCB7IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCB9IGZyb20gJy4uL3BvLWNoYXJ0LWR5bmFtaWMtdHlwZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9DaGFydFR5cGUgfSBmcm9tICcuLi8uLi9lbnVtcy9wby1jaGFydC10eXBlLmVudW0nO1xuaW1wb3J0IHsgUG9DaXJjdWxhckNoYXJ0U2VyaWVzIH0gZnJvbSAnLi9wby1jaGFydC1jaXJjdWxhci1zZXJpZXMuaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvRG9udXRDaGFydFNlcmllcyB9IGZyb20gJy4uL3BvLWNoYXJ0LWRvbnV0L3BvLWNoYXJ0LWRvbnV0LXNlcmllcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9QaWVDaGFydFNlcmllcyB9IGZyb20gJy4uL3BvLWNoYXJ0LXBpZS9wby1jaGFydC1waWUtc2VyaWVzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb1Nlcmllc1RleHRCbGFjayB9IGZyb20gJy4uLy4uL3BvLWNoYXJ0LWNvbG9ycy5jb25zdGFudCc7XG5cbmNvbnN0IHBvQ2hhcnRCbGFja0NvbG9yID0gJyMwMDAwMDAnO1xuY29uc3QgcG9DaGFydFdoaXRlQ29sb3IgPSAnI2ZmZmZmZic7XG5cbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q2lyY3VsYXIgZXh0ZW5kcyBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgcHJpdmF0ZSBfc2VyaWVzOiBBcnJheTxQb1BpZUNoYXJ0U2VyaWVzIHwgUG9Eb251dENoYXJ0U2VyaWVzPjtcblxuICBwcml2YXRlIGFuaW1hdGlvblJ1bm5pbmc6IGJvb2xlYW47XG4gIHByaXZhdGUgY2hhcnRJdGVtRW5kQW5nbGU6IG51bWJlcjtcbiAgcHJpdmF0ZSBjaGFydEl0ZW1TdGFydEFuZ2xlOiBudW1iZXI7XG4gIHByaXZhdGUgY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdDogQXJyYXk8bnVtYmVyPiA9IFtdO1xuICBwcml2YXRlIHN2Z1BhdGhFbGVtZW50c0xpc3Q6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgcHJpdmF0ZSBzdmdUZXh0RWxlbWVudHNMaXN0OiBBcnJheTxzdHJpbmc+ID0gW107XG5cbiAgc2V0IHNlcmllcyh2YWx1ZTogQXJyYXk8UG9QaWVDaGFydFNlcmllcyB8IFBvRG9udXRDaGFydFNlcmllcz4pIHtcbiAgICB0aGlzLl9zZXJpZXMgPSB0aGlzLmdldFNlcmllc1dpdGhWYWx1ZSh2YWx1ZSk7XG4gIH1cblxuICBnZXQgc2VyaWVzKCkge1xuICAgIHJldHVybiB0aGlzLl9zZXJpZXM7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBjYWxjdWxhdGVFbmRBbmdsZSh2YWx1ZTogbnVtYmVyLCB0b3RhbFZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB2YWx1ZSAvIHRvdGFsVmFsdWUgKiAoTWF0aC5QSSAqIDIpO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZiwgcHJpdmF0ZSBuZ1pvbmU6IE5nWm9uZSwgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gICAgc3VwZXIoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMucmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgICB0aGlzLnJlbW92ZVdpbmRvd1Njcm9sbExpc3RlbmVyKCk7XG4gICAgdGhpcy5hbmltYXRpb25SdW5uaW5nID0gZmFsc2U7XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmNoYXJ0SW5pdFNldHVwKCk7XG4gICAgdGhpcy5zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRpb25TZXR1cCgpIHtcbiAgICB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgPSBwb0NoYXJ0U3RhcnRBbmdsZTtcbiAgICB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlID0gdGhpcy5jaGFydEl0ZW1zRW5kQW5nbGVMaXN0WzBdO1xuICAgIHRoaXMuYW5pbWF0aW9uUnVubmluZyA9IHRydWU7XG4gICAgdGhpcy5kcmF3UGF0aEluaXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQW5nbGVSYWRpYW5zKCkge1xuICAgIHRoaXMuc2VyaWVzLmZvckVhY2goKHNlcmllLCBpbmRleCkgPT5cbiAgICAgIHRoaXMuY2hhcnRJdGVtc0VuZEFuZ2xlTGlzdFtpbmRleF0gPSBQb0NoYXJ0Q2lyY3VsYXIuY2FsY3VsYXRlRW5kQW5nbGUoc2VyaWUudmFsdWUsIHRoaXMudG90YWxWYWx1ZSlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb246IG51bWJlcikge1xuICAgIGNvbnN0IGlzU2VyaWVEcmF3Q29tcGxldGVkID0gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuXG4gICAgaWYgKGlzU2VyaWVEcmF3Q29tcGxldGVkKSB7XG4gICAgICByZXR1cm4gKHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSArIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUpIC0gcG9DaGFydENvbXBsZXRlQ2lyY2xlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlICsgYW5nbGVDdXJyZW50UG9zaXRpb247XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVTVkdEaW1lbnNpb25zKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHQ29udGFpbmVyRGltZW5zaW9ucyh0aGlzLmNoYXJ0V3JhcHBlciwgdGhpcy5jaGFydEhlYWRlciwgdGhpcy5jaGFydExlZ2VuZCk7XG5cbiAgICB0aGlzLnNldElubmVyUmFkaXVzKCk7XG4gIH1cblxuICBwcml2YXRlIGNoYW5nZVRvb2x0aXBQb3NpdGlvbihldmVudDogTW91c2VFdmVudCkge1xuICAgIGlmICh0aGlzLnRvb2x0aXBFbGVtZW50ICYmIHRoaXMudG9vbHRpcEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwby1pbnZpc2libGUnKSkge1xuICAgICAgdGhpcy5zaG93VG9vbHRpcCgpO1xuICAgIH1cblxuICAgIGNvbnN0IHRvb2x0aXBQb3NpdGlvbnMgPSB0aGlzLnNldFRvb2x0aXBQb3NpdGlvbnMoZXZlbnQpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy50b29sdGlwRWxlbWVudCwgJ2xlZnQnLCBgJHt0b29sdGlwUG9zaXRpb25zLmxlZnR9cHhgKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMudG9vbHRpcEVsZW1lbnQsICd0b3AnLCBgJHt0b29sdGlwUG9zaXRpb25zLnRvcH1weGApO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGFydEluaXRTZXR1cCgpIHtcbiAgICB0aGlzLmNhbGN1bGF0ZVNWR0RpbWVuc2lvbnMoKTtcbiAgICB0aGlzLmNhbGN1bGF0ZVRvdGFsVmFsdWUoKTtcbiAgICB0aGlzLmNhbGN1bGF0ZUFuZ2xlUmFkaWFucygpO1xuICAgIHRoaXMuY3JlYXRlU1ZHRWxlbWVudHMoKTtcbiAgICB0aGlzLmFuaW1hdGlvblNldHVwKCk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNraW5nSWZTY3JvbGxzV2l0aFBvUGFnZSgpIHtcbiAgICBjb25zdCBwb1BhZ2VDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgncG8tcGFnZS1jb250ZW50Jyk7XG5cbiAgICByZXR1cm4gcG9QYWdlQ29udGVudC5sZW5ndGggPyBwb1BhZ2VDb250ZW50WzBdIDogd2luZG93O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVQYXRoKHNlcmllOiBQb0NpcmN1bGFyQ2hhcnRTZXJpZXMsIHN2Z1BhdGhzV3JhcHBlcjogYW55KSB7XG4gICAgY29uc3Qgc3ZnUGF0aCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnBhdGgnLCAnc3ZnJyk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdQYXRoLCAnY2xhc3MnLCAncG8tcGF0aC1pdGVtJyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnUGF0aCwgJ2ZpbGwnLCBzZXJpZS5jb2xvcik7XG5cbiAgICB0aGlzLnNldFRvb2x0aXBBdHRyaWJ1dGVzKHN2Z1BhdGgsIHNlcmllKTtcblxuICAgIHN2Z1BhdGhzV3JhcHBlci5hcHBlbmRDaGlsZChzdmdQYXRoKTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQodGhpcy5zdmdFbGVtZW50LCBzdmdQYXRoc1dyYXBwZXIpO1xuXG4gICAgdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0LnB1c2goc3ZnUGF0aCk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVBhdGhzKCkge1xuICAgIGNvbnN0IHN2Z1BhdGhzV3JhcHBlciA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOmcnLCAnc3ZnJyk7XG5cbiAgICB0aGlzLnNlcmllcy5mb3JFYWNoKHNlcmllID0+IHRoaXMuY3JlYXRlUGF0aChzZXJpZSwgc3ZnUGF0aHNXcmFwcGVyKSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVRleHQoc2VyaWU6IFBvQ2lyY3VsYXJDaGFydFNlcmllcykge1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHNlcmllO1xuXG4gICAgY29uc3Qgc3ZnRyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOmcnLCAnc3ZnJyk7XG4gICAgY29uc3Qgc3ZnVGV4dCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnRleHQnLCAnc3ZnJyk7XG5cbiAgICBjb25zdCBmb250U2l6ZSA9IHRoaXMuZ2V0Rm9udFNpemUoKTtcbiAgICBjb25zdCB0ZXh0Q29sb3IgPSB0aGlzLmdldFRleHRDb2xvcihzZXJpZS5jb2xvcik7XG5cbiAgICBzdmdUZXh0LnRleHRDb250ZW50ID0gdGhpcy5nZXRQZXJjZW50VmFsdWUodmFsdWUsIHRoaXMudG90YWxWYWx1ZSkgKyAnJScgO1xuXG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUoc3ZnVGV4dCwgJ2NsYXNzJywgJ3BvLXBhdGgtaXRlbScpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsJywgdGV4dENvbG9yKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdUZXh0LCAnZm9udC1zaXplJywgZm9udFNpemUpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z1RleHQsICdmaWxsLW9wYWNpdHknLCAnMCcpO1xuXG4gICAgdGhpcy5zZXRUb29sdGlwQXR0cmlidXRlcyhzdmdUZXh0LCBzZXJpZSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHN2Z0csIHN2Z1RleHQpO1xuXG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnN2Z0VsZW1lbnQsIHN2Z0cpO1xuICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdC5wdXNoKHN2Z1RleHQpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUZXh0cygpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCkge1xuICAgICAgdGhpcy5zZXJpZXMuZm9yRWFjaChzZXJpZSA9PiB0aGlzLmNyZWF0ZVRleHQoc2VyaWUpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVNWR0VsZW1lbnRzKCkge1xuICAgIHRoaXMuc3ZnRWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc3ZnOnN2ZycsICdzdmcnKTtcblxuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3ZpZXdCb3gnLCBgMCAwICR7dGhpcy5jaGFydFdyYXBwZXJ9ICR7dGhpcy5jZW50ZXJYICogMn1gKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3hNaWRZTWluIG1lZXQnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnN2Z0VsZW1lbnQsICdjbGFzcycsICdwby1jaGFydC1zdmctZWxlbWVudCcpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5jaGFydFdyYXBwZXIgLSBwb0NoYXJ0UGFkZGluZyAqIDJ9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5zdmdIZWlnaHR9YCk7XG5cbiAgICB0aGlzLnN2Z0NvbnRhaW5lci5uYXRpdmVFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuc3ZnRWxlbWVudCk7XG5cbiAgICB0aGlzLmNyZWF0ZVBhdGhzKCk7XG4gICAgdGhpcy5jcmVhdGVUZXh0cygpO1xuXG4gIH1cblxuICBwcml2YXRlIGRyYXdQYXRoKHBhdGgsIGNoYXJ0SXRlbVN0YXJ0QW5nbGUsIGNoYXJ0SXRlbUVuZEFuZ2xlKSB7XG4gICAgY29uc3QgbGFyZ2VBcmMgPSBjaGFydEl0ZW1FbmRBbmdsZSAtIGNoYXJ0SXRlbVN0YXJ0QW5nbGUgPiBNYXRoLlBJO1xuXG4gICAgY29uc3Qgc2luQWxwaGEgPSBNYXRoLnNpbihjaGFydEl0ZW1TdGFydEFuZ2xlKTtcbiAgICBjb25zdCBjb3NBbHBoYSA9IE1hdGguY29zKGNoYXJ0SXRlbVN0YXJ0QW5nbGUpO1xuXG4gICAgY29uc3Qgc2luQmV0YSA9IE1hdGguc2luKGNoYXJ0SXRlbUVuZEFuZ2xlKTtcbiAgICBjb25zdCBjb3NCZXRhID0gTWF0aC5jb3MoY2hhcnRJdGVtRW5kQW5nbGUpO1xuXG4gICAgY29uc3Qgc3RhcnRYID0gdGhpcy5jZW50ZXJYICsgY29zQWxwaGEgKiB0aGlzLmNlbnRlclg7XG4gICAgY29uc3Qgc3RhcnRZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmNlbnRlclg7XG5cbiAgICBjb25zdCBlbmRYID0gdGhpcy5jZW50ZXJYICsgY29zQmV0YSAqIHRoaXMuY2VudGVyWDtcbiAgICBjb25zdCBlbmRZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuY2VudGVyWDtcblxuICAgIGNvbnN0IHN0YXJ0SW5uZXJYID0gdGhpcy5jZW50ZXJYICsgY29zQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuICAgIGNvbnN0IHN0YXJ0SW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQWxwaGEgKiB0aGlzLmlubmVyUmFkaXVzO1xuXG4gICAgY29uc3QgZW5kSW5uZXJYID0gdGhpcy5jZW50ZXJYICsgY29zQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XG4gICAgY29uc3QgZW5kSW5uZXJZID0gdGhpcy5jZW50ZXJYICsgc2luQmV0YSAqIHRoaXMuaW5uZXJSYWRpdXM7XG5cbiAgICBjb25zdCBwYXRoQ29vcmRpbmF0ZXMgPSBbXG4gICAgICAnTScsIHN0YXJ0WCwgc3RhcnRZLFxuICAgICAgJ0EnLCB0aGlzLmNlbnRlclgsIHRoaXMuY2VudGVyWCwgMCwgbGFyZ2VBcmMgPyAnMSwxJyA6ICcwLDEnLCBlbmRYLCBlbmRZLFxuICAgICAgJ0wnLCBlbmRJbm5lclgsIGVuZElubmVyWSxcbiAgICAgICdBJywgdGhpcy5pbm5lclJhZGl1cywgdGhpcy5pbm5lclJhZGl1cywgMCwgbGFyZ2VBcmMgPyAnMSwwJyA6ICcwLDAnLCBzdGFydElubmVyWCwgc3RhcnRJbm5lclksXG4gICAgICAnWiddLmpvaW4oJyAnKTtcblxuICAgIHJldHVybiBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsIHBhdGhDb29yZGluYXRlcyk7XG4gIH1cblxuICBwcml2YXRlIGRyYXdQYXRoSW5pdCgpIHtcblxuICAgIGlmICghdGhpcy5hbmltYXRpb25SdW5uaW5nKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZHJhd1NlcmllcygpKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRyYXdTZXJpZXMoY3VycmVudFNlcmllSW5kZXg6IG51bWJlciA9IDAsIGFuZ2xlQ3VycmVudFBvc2l0aW9uOiBudW1iZXIgPSAwKSB7XG4gICAgY29uc3QgaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzID0gYW5nbGVDdXJyZW50UG9zaXRpb24gPiB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuICAgIGNvbnN0IGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzID0gY3VycmVudFNlcmllSW5kZXggPT09IHRoaXMuc3ZnUGF0aEVsZW1lbnRzTGlzdC5sZW5ndGg7XG5cbiAgICBpZiAoIGlzRmluaXNoZWREcmF3aW5nQWxsU2VyaWVzICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICggaXNGaW5pc2hlZERyYXdpbmdDdXJyZW50U2VyaWVzICkge1xuXG4gICAgICB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgPSB0aGlzLmNoYXJ0SXRlbVN0YXJ0QW5nbGUgKyB0aGlzLmNoYXJ0SXRlbUVuZEFuZ2xlO1xuICAgICAgY3VycmVudFNlcmllSW5kZXgrKztcbiAgICAgIHRoaXMuY2hhcnRJdGVtRW5kQW5nbGUgPSB0aGlzLmNoYXJ0SXRlbXNFbmRBbmdsZUxpc3RbY3VycmVudFNlcmllSW5kZXhdO1xuICAgICAgYW5nbGVDdXJyZW50UG9zaXRpb24gPSAwO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIGFuZ2xlQ3VycmVudFBvc2l0aW9uICs9IHBvQ2hhcnRBbmdsZVN0ZXBJbnRlcnZhbDtcblxuICAgICAgdGhpcy5kcmF3UGF0aChcbiAgICAgICAgdGhpcy5zdmdQYXRoRWxlbWVudHNMaXN0W2N1cnJlbnRTZXJpZUluZGV4XSxcbiAgICAgICAgdGhpcy5jaGFydEl0ZW1TdGFydEFuZ2xlLFxuICAgICAgICB0aGlzLmNhbGN1bGF0ZUN1cnJlbnRFbmRBbmdsZShhbmdsZUN1cnJlbnRQb3NpdGlvbilcbiAgICAgICk7XG5cbiAgICAgIHRoaXMuc2V0VGV4dFByb3BlcnRpZXMoXG4gICAgICAgIHRoaXMuc3ZnVGV4dEVsZW1lbnRzTGlzdFtjdXJyZW50U2VyaWVJbmRleF0sXG4gICAgICAgIHRoaXMuY2hhcnRJdGVtU3RhcnRBbmdsZSxcbiAgICAgICAgdGhpcy5jYWxjdWxhdGVDdXJyZW50RW5kQW5nbGUoYW5nbGVDdXJyZW50UG9zaXRpb24pKTtcbiAgICB9XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuZHJhd1Nlcmllcy5iaW5kKHRoaXMsIGN1cnJlbnRTZXJpZUluZGV4LCBhbmdsZUN1cnJlbnRQb3NpdGlvbikpO1xuXG4gIH1cblxuICBwcml2YXRlIGVtaXRFdmVudE9uRW50ZXIoZXZlbnQ6IFBvQ2lyY3VsYXJDaGFydFNlcmllcykge1xuICAgIHRoaXMub25TZXJpZUhvdmVyLm5leHQoZXZlbnQpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGb250U2l6ZSgpIHtcbiAgICBjb25zdCBmb250U2l6ZVBvcmNlbnQgPSAwLjA0O1xuXG4gICAgY29uc3QgZm9udFNpemUgPSBmb250U2l6ZVBvcmNlbnQgKiB0aGlzLmNoYXJ0V3JhcHBlcjtcblxuICAgIHJldHVybiBgJHtmb250U2l6ZS50b0ZpeGVkKDApfXB4YDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGVyY2VudFZhbHVlKHZhbHVlOiBudW1iZXIsIHRvdGFsVmFsdWU6IG51bWJlcikge1xuICAgIGNvbnN0IHBlcmNlbnRWYWx1ZSA9ICh2YWx1ZSAvIHRvdGFsVmFsdWUpICogMTAwO1xuXG4gICAgLy8gY2FzbyB0aXZlciBtYWlzIHF1ZSBkdWFzIGNhc2FzIGRlY2ltYWlzLCBmaXhhIGF0w6kgZHVhcywgZXg6IDEwLjY1NzUgPT4gMTAuNjVcbiAgICAvLyBzZSBuw6NvIHJldG9ybmEgbyB2YWxvciBjb20gcGFyc2VmbG9hdCBxdWUgcmVtb3ZlIGNhc2EgZGVjaW1hbCBkZXNlbmNlc3NhcmlhLCBleDogMTAuNjAgPT4gMTAuNlxuICAgIGNvbnN0IGZsb2F0UGVyY2VudFZhbHVlID0gdGhpcy5pc01vcmVUaGFuVHdvRGVjaW1hbHNQbGFjZXMocGVyY2VudFZhbHVlKSA/XG4gICAgICBwYXJzZUZsb2F0KHBlcmNlbnRWYWx1ZS50b0ZpeGVkKDIpKSA6IHBhcnNlRmxvYXQoPGFueT4gcGVyY2VudFZhbHVlKTtcblxuICAgIHJldHVybiBTdHJpbmcoZmxvYXRQZXJjZW50VmFsdWUpLnJlcGxhY2UoJy4nLCAnLCcpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXJpZXNXaXRoVmFsdWUoc2VyaWVzOiBBcnJheTxQb0NpcmN1bGFyQ2hhcnRTZXJpZXM+KSB7XG4gICAgY29uc3QgbmV3U2VyaWVzID0gW107XG5cbiAgICBzZXJpZXMuZm9yRWFjaCgoc2VyaWUsIGluZGV4KSA9PiB7XG4gICAgICBpZiAoc2VyaWUudmFsdWUgPiAwKSB7XG4gICAgICAgIG5ld1Nlcmllcy5wdXNoKHsgLi4uc2VyaWUsIGNvbG9yOiB0aGlzLmNvbG9yc1tpbmRleF0gfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3U2VyaWVzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUZXh0Q29sb3IoY29sb3I6IHN0cmluZykge1xuICAgIGlmIChQb1Nlcmllc1RleHRCbGFjay5pbmNsdWRlcyhjb2xvcikpIHtcbiAgICAgIHJldHVybiBwb0NoYXJ0QmxhY2tDb2xvcjtcbiAgICB9XG5cbiAgICByZXR1cm4gcG9DaGFydFdoaXRlQ29sb3I7XG4gIH1cblxuICBwcml2YXRlIGdldFRvb2x0aXBWYWx1ZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMudHlwZSA9PT0gUG9DaGFydFR5cGUuUGllKSB7XG4gICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5nZXRQZXJjZW50VmFsdWUodmFsdWUsIHRoaXMudG90YWxWYWx1ZSkgKyAnJSc7XG4gIH1cblxuICBwcml2YXRlIGlzTW9yZVRoYW5Ud29EZWNpbWFsc1BsYWNlcyh2YWx1ZTogbnVtYmVyID0gMCkge1xuICAgIGNvbnN0IFssIHZhbHVlQWZ0ZXJEb3QgXSA9IHZhbHVlLnRvU3RyaW5nKCkuc3BsaXQoJy4nKTtcblxuICAgIHJldHVybiB2YWx1ZUFmdGVyRG90ICYmIHZhbHVlQWZ0ZXJEb3QubGVuZ3RoID4gMjtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUNsaWNrKCkge1xuICAgIGNvbnN0IHNlcmllT25DbGljazogUG9DaXJjdWxhckNoYXJ0U2VyaWVzID0geyBjYXRlZ29yeTogdGhpcy5jaGFydEVsZW1lbnRDYXRlZ29yeSwgdmFsdWU6IHRoaXMuY2hhcnRFbGVtZW50VmFsdWUgfTtcblxuICAgIHRoaXMub25TZXJpZUNsaWNrLm5leHQoc2VyaWVPbkNsaWNrKTtcbiAgfVxuXG4gIHByaXZhdGUgb25Nb3VzZUVudGVyKGV2ZW50KSB7XG4gICAgdGhpcy50b29sdGlwRWxlbWVudCA9IHRoaXMuY2hhcnRCb2R5Lm5hdGl2ZUVsZW1lbnQubGFzdENoaWxkO1xuICAgIHRoaXMuY2hhcnRFbGVtZW50Q2F0ZWdvcnkgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC1jYXRlZ29yeScpO1xuICAgIHRoaXMuY2hhcnRFbGVtZW50VmFsdWUgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC12YWx1ZScpO1xuICAgIHRoaXMudG9vbHRpcFRleHQgPSBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlTlMobnVsbCwgJ2RhdGEtdG9vbHRpcC10ZXh0Jyk7XG4gICAgdGhpcy5zaG93VG9vbHRpcCgpO1xuICAgIHRoaXMuY2hhbmdlVG9vbHRpcFBvc2l0aW9uKGV2ZW50KTtcblxuICAgIGNvbnN0IHNlcmllT25FbnRlciA9IHsgY2F0ZWdvcnk6IHRoaXMuY2hhcnRFbGVtZW50Q2F0ZWdvcnksIHZhbHVlOiB0aGlzLmNoYXJ0RWxlbWVudFZhbHVlIH07XG4gICAgdGhpcy5lbWl0RXZlbnRPbkVudGVyKHNlcmllT25FbnRlcik7XG4gIH1cblxuICBwcml2YXRlIG9uV2luZG93UmVzaXplKCkge1xuICAgIHRoaXMuY2FsY3VsYXRlU1ZHRGltZW5zaW9ucygpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHRoaXMuc3ZnRWxlbWVudCwgJ3dpZHRoJywgYCR7dGhpcy5jaGFydFdyYXBwZXIgLSBwb0NoYXJ0UGFkZGluZyAqIDJ9YCk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5zdmdFbGVtZW50LCAnaGVpZ2h0JywgYCR7dGhpcy5zdmdIZWlnaHR9YCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVRvb2x0aXAoKSB7XG4gICAgaWYgKHRoaXMudG9vbHRpcEVsZW1lbnQpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy50b29sdGlwRWxlbWVudCwgJ3BvLWludmlzaWJsZScpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlV2luZG93UmVzaXplTGlzdGVuZXIoKSB7XG4gICAgaWYgKHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIpIHtcbiAgICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZVdpbmRvd1Njcm9sbExpc3RlbmVyKCkge1xuICAgIGlmICh0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyKSB7XG4gICAgICB0aGlzLndpbmRvd1Njcm9sbExpc3RlbmVyKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBsZXQgY2hhcnRTZXJpZXM6IEFycmF5PHN0cmluZz4gPSB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBvLXBhdGgtaXRlbScpO1xuICAgIGNoYXJ0U2VyaWVzID0gQXJyYXkuZnJvbShjaGFydFNlcmllcyk7XG5cbiAgICBjaGFydFNlcmllcy5mb3JFYWNoKHNlcmllID0+IHtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnY2xpY2snLCB0aGlzLm9uTW91c2VDbGljay5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VlbnRlcicsIHRoaXMub25Nb3VzZUVudGVyLmJpbmQodGhpcykpO1xuICAgICAgdGhpcy5yZW5kZXJlci5saXN0ZW4oc2VyaWUsICdtb3VzZW1vdmUnLCB0aGlzLmNoYW5nZVRvb2x0aXBQb3NpdGlvbi5iaW5kKHRoaXMpKTtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlcmllLCAnbW91c2VsZWF2ZScsIHRoaXMucmVtb3ZlVG9vbHRpcC5iaW5kKHRoaXMpKTtcbiAgICB9KTtcblxuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3csICdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplLmJpbmQodGhpcykpO1xuICAgIHRoaXMud2luZG93U2Nyb2xsTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmNoZWNraW5nSWZTY3JvbGxzV2l0aFBvUGFnZSgpLCAnc2Nyb2xsJywgdGhpcy5yZW1vdmVUb29sdGlwLmJpbmQodGhpcykpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJbm5lclJhZGl1cygpIHtcbiAgICAvLyB0YW1hbmhvIGRhIGxhcmd1YSBkYSBzZXJpZSBwcm9wb3JjaW9uYWwgYW8gZ3JhZmljbywgbyB2YWxvciAwLjI3IGZpY2EgcHJveGltbyBkZSAzMnB4XG4gICAgY29uc3Qgc2VyaWVXaWR0aCA9IDAuMjc7XG5cbiAgICB0aGlzLmlubmVyUmFkaXVzID0gdGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5QaWUgPyAwIDogdGhpcy5jZW50ZXJYIC0gKHRoaXMuY2VudGVyWCAqIHNlcmllV2lkdGgpO1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRUZXh0UHJvcGVydGllcyh0ZXh0LCBzdGFydEFuZ2xlOiBudW1iZXIsIGVuZEFuZ2xlOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb0NoYXJ0VHlwZS5Eb251dCkge1xuICAgICAgLy8gdXRpbGl6YWRvIHBhcmEgcmVjdXBlcmFyIG8gYW5ndWxvIGRvIG1laW8sIGVudHJlIG8gaW5pY2lvIGUgZmltIHBhcmEgY2VudHJhbGl6YXIgbyB0ZXh0b1xuICAgICAgY29uc3QgY2VudGVyQW5nbGUgPSAoc3RhcnRBbmdsZSArIGVuZEFuZ2xlKSAvIDI7XG4gICAgICBjb25zdCB0ZXh0Qm94ID0gdGV4dC5nZXRCQm94KCk7XG5cbiAgICAgIGNvbnN0IGhhbGZUZXh0V2lkdGggPSB0ZXh0Qm94LndpZHRoIC8gMjtcbiAgICAgIGNvbnN0IGhhbGZUZXh0SGVpZ2h0ID0gdGV4dEJveC5oZWlnaHQgLyAyO1xuXG4gICAgICAvLyByYWRpdXMgaW50ZXJubyAoY2lyY3VsbyBicmFuY28pICsgYSBtZXRhZGUgZGEgZGlmZXJlbsOnYSBlbnRyZSB0YW1hbmhvIGRvIGNlbnRybyBlIHJhZGl1cyBpbnRlcm5vXG4gICAgICBjb25zdCByYWRpdXMgPSB0aGlzLmlubmVyUmFkaXVzICsgKHRoaXMuY2VudGVyWCAtIHRoaXMuaW5uZXJSYWRpdXMpIC8gMjtcblxuICAgICAgY29uc3QgeENvb3JkaW5hdGUgPSByYWRpdXMgKiBNYXRoLmNvcyhjZW50ZXJBbmdsZSkgKyB0aGlzLmNlbnRlclggLSAoaGFsZlRleHRXaWR0aCk7XG4gICAgICBjb25zdCB5Q29vcmRpbmF0ZSA9IHJhZGl1cyAqIE1hdGguc2luKGNlbnRlckFuZ2xlKSArIHRoaXMuY2VudGVyWCArIChoYWxmVGV4dEhlaWdodCAvIDIpO1xuXG4gICAgICB0ZXh0LnNldEF0dHJpYnV0ZSgneCcsIHhDb29yZGluYXRlKTtcbiAgICAgIHRleHQuc2V0QXR0cmlidXRlKCd5JywgeUNvb3JkaW5hdGUpO1xuICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoJ2ZpbGwtb3BhY2l0eScsICcxJyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRUb29sdGlwUG9zaXRpb25zKGV2ZW50OiBNb3VzZUV2ZW50KSB7XG4gICAgY29uc3QgZGlzcGxhY2VtZW50OiBudW1iZXIgPSA4O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxlZnQ6IGV2ZW50LmNsaWVudFggLSB0aGlzLnRvb2x0aXBFbGVtZW50Lm9mZnNldFdpZHRoIC8gMixcbiAgICAgIHRvcDogZXZlbnQuY2xpZW50WSAtIHRoaXMudG9vbHRpcEVsZW1lbnQub2Zmc2V0SGVpZ2h0IC0gZGlzcGxhY2VtZW50XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VG9vbHRpcEF0dHJpYnV0ZXMoc3ZnRWxlbWVudCwgc2VyaWU6IFBvUGllQ2hhcnRTZXJpZXMgfCBQb0RvbnV0Q2hhcnRTZXJpZXMpIHtcbiAgICBjb25zdCB7IHZhbHVlLCBjYXRlZ29yeSwgdG9vbHRpcCB9ID0gc2VyaWU7XG5cbiAgICBjb25zdCB0b29sdGlwVmFsdWUgPSB0aGlzLmdldFRvb2x0aXBWYWx1ZSh2YWx1ZSk7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLWNhdGVnb3J5JywgY2F0ZWdvcnkpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0QXR0cmlidXRlKHN2Z0VsZW1lbnQsICdkYXRhLXRvb2x0aXAtdmFsdWUnLCBgJHt2YWx1ZX1gKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShzdmdFbGVtZW50LCAnZGF0YS10b29sdGlwLXRleHQnLCB0b29sdGlwIHx8IGAke2NhdGVnb3J5fTogJHt0b29sdGlwVmFsdWV9YCk7XG4gIH1cblxuICBwcml2YXRlIHNob3dUb29sdGlwKCkge1xuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQ2xhc3ModGhpcy50b29sdGlwRWxlbWVudCwgJ3BvLWludmlzaWJsZScpO1xuICB9XG5cbn1cbiJdfQ==