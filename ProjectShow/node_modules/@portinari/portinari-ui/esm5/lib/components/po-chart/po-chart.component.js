/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ComponentFactoryResolver, ElementRef, HostListener, IterableDiffers, ViewChild, ViewContainerRef } from '@angular/core';
import { Subject } from 'rxjs';
import { PoChartBaseComponent } from './po-chart-base.component';
import { PoChartColors } from './po-chart-colors.constant';
import { PoChartDonutComponent } from './po-chart-types/po-chart-donut/po-chart-donut.component';
import { PoChartPieComponent } from './po-chart-types/po-chart-pie/po-chart-pie.component';
import { PoChartType } from './enums/po-chart-type.enum';
/**
 * \@docsExtends PoChartBaseComponent
 *
 * \@example
 *
 * <example name="po-chart-basic" title="Portinari Chart Basic">
 *  <file name="sample-po-chart-basic/sample-po-chart-basic.component.html"> </file>
 *  <file name="sample-po-chart-basic/sample-po-chart-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-chart-labs" title="Portinari Chart Labs">
 *  <file name="sample-po-chart-labs/sample-po-chart-labs.component.html"> </file>
 *  <file name="sample-po-chart-labs/sample-po-chart-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-chart-coffee-ranking" title="Portinari Chart - Coffee Ranking">
 *  <file name="sample-po-chart-coffee-ranking/sample-po-chart-coffee-ranking.component.html"> </file>
 *  <file name="sample-po-chart-coffee-ranking/sample-po-chart-coffee-ranking.component.ts"> </file>
 * </example>
 */
var PoChartComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoChartComponent, _super);
    function PoChartComponent(changeDetector, componentFactoryResolver, differs) {
        var _a;
        var _this = _super.call(this) || this;
        _this.changeDetector = changeDetector;
        _this.componentFactoryResolver = componentFactoryResolver;
        _this.differs = differs;
        _this.calculatedElement = false;
        _this.initialized = false;
        _this.windowResizeListener = new Subject();
        _this.mappings = (_a = {},
            _a[PoChartType.Pie] = PoChartPieComponent,
            _a[PoChartType.Donut] = PoChartDonutComponent,
            _a);
        _this.colors = [];
        _this.onResize = (/**
         * @return {?}
         */
        function () { return _this.windowResizeListener.next(); });
        _this.differ = _this.differs.find([]).create(null);
        return _this;
    }
    /**
     * @return {?}
     */
    PoChartComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.initialized = true;
    };
    /**
     * @return {?}
     */
    PoChartComponent.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var charWrapperWidth = this.chartWrapper.nativeElement.offsetWidth;
        // Permite que o chart seja calculado na primeira vez que o componente torna-se visÃ­vel,
        // evitando com isso, problemas com Tabs ou Divs que iniciem escondidas.
        if (charWrapperWidth && !this.calculatedElement && this.initialized) {
            this.calculatedElement = true;
            this.getSeriesColor();
            this.dynamicComponentSetting();
        }
        this.checkingForSerieChanges();
    };
    /**
     * @return {?}
     */
    PoChartComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.removeWindowResizeListener();
    };
    /**
     * @return {?}
     */
    PoChartComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.getSeriesColor();
    };
    /**
     * @return {?}
     */
    PoChartComponent.prototype.rebuildComponent = /**
     * @return {?}
     */
    function () {
        if (this.componentRef) {
            this.componentRef.destroy();
            this.dynamicComponentSetting();
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartComponent.prototype.checkingForSerieChanges = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.componentRef && this.differ) {
            /** @type {?} */
            var changeSeries = this.differ.diff(this.series);
            if (changeSeries) {
                this.getSeriesColor();
                this.rebuildComponent();
            }
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoChartComponent.prototype.createComponent = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var componentType = this.getComponentType(this.type);
        /** @type {?} */
        var factory = this.componentFactoryResolver.resolveComponentFactory(componentType);
        this.componentRef = this.chartContainer.createComponent(factory);
        /** @type {?} */
        var instance = (/** @type {?} */ (this.componentRef.instance));
        this.setChartProperties(instance);
        return instance;
    };
    /**
     * @private
     * @return {?}
     */
    PoChartComponent.prototype.dynamicComponentSetting = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var instance = this.createComponent();
        this.setResizeListenerSubscribe(instance);
        this.changeDetector.detectChanges();
        this.setClickSubscribe(instance);
        this.setHoverSubscribe(instance);
    };
    /**
     * @private
     * @param {?} typeName
     * @return {?}
     */
    PoChartComponent.prototype.getComponentType = /**
     * @private
     * @param {?} typeName
     * @return {?}
     */
    function (typeName) {
        return this.mappings[typeName];
    };
    /**
     * @private
     * @return {?}
     */
    PoChartComponent.prototype.getSeriesColor = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var colorsLength = PoChartColors.length - 1;
        if (!this.series) {
            return this.colors = PoChartColors[colorsLength];
        }
        /** @type {?} */
        var seriesLength = this.series.length - 1;
        if (seriesLength > colorsLength) {
            /** @type {?} */
            var colors = PoChartColors[colorsLength];
            // recupera o resultado da divisao entre tamanho das series e o numero de cores disponiveis
            /** @type {?} */
            var quantityDuplicates = seriesLength / colorsLength;
            for (var i = 1; i <= quantityDuplicates; i++) {
                colors = colors.concat(PoChartColors[colorsLength]);
            }
            return this.colors = colors;
        }
        return this.colors = PoChartColors[seriesLength];
    };
    /**
     * @private
     * @return {?}
     */
    PoChartComponent.prototype.removeWindowResizeListener = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.onResize) {
            this.onResize = (/**
             * @return {?}
             */
            function () { });
        }
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    PoChartComponent.prototype.setChartProperties = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        instance.chartHeader = this.chartHeader.nativeElement.offsetHeight;
        instance.chartLegend = this.chartLegend.nativeElement.offsetHeight;
        instance.chartWrapper = this.chartWrapper.nativeElement.offsetWidth;
        instance.colors = Array.isArray(this.colors) ? tslib_1.__spread(this.colors) : [];
        instance.height = this.height;
        instance.series = this.series || [];
        instance.type = this.type;
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    PoChartComponent.prototype.setClickSubscribe = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        var _this = this;
        instance.onSerieClick.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.onSeriesClick(event);
        }));
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    PoChartComponent.prototype.setHoverSubscribe = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        var _this = this;
        instance.onSerieHover.subscribe((/**
         * @param {?} event
         * @return {?}
         */
        function (event) {
            _this.onSeriesHover(event);
        }));
    };
    /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    PoChartComponent.prototype.setResizeListenerSubscribe = /**
     * @private
     * @param {?} instance
     * @return {?}
     */
    function (instance) {
        var _this = this;
        this.windowResizeListener.subscribe((/**
         * @return {?}
         */
        function () {
            instance.chartHeader = _this.chartHeader.nativeElement.offsetHeight;
            instance.chartLegend = _this.chartLegend.nativeElement.offsetHeight;
            instance.chartWrapper = _this.chartWrapper.nativeElement.offsetWidth;
        }));
    };
    PoChartComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-chart',
                    template: "<div #chartWrapper class=\"po-chart-wrapper\">\n  <div #chartHeader class=\"po-chart-header\">\n    <div class=\"po-chart-title\">{{ title }}</div>\n  </div>\n  <ng-template #chartContainer></ng-template>\n  <div #chartLegend class=\"po-chart-legend\">\n    <div class=\"po-chart-legend-container\">\n      <div class=\"po-chart-legend-item\" *ngFor=\"let serie of series; let i = index\">\n        <div class=\"po-chart-legend-square\" [style.background]=\"colors[i]\"></div>\n        <span class=\"po-chart-legend-text\">{{ serie.category }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    PoChartComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: ComponentFactoryResolver },
        { type: IterableDiffers }
    ]; };
    PoChartComponent.propDecorators = {
        chartContainer: [{ type: ViewChild, args: ['chartContainer', { read: ViewContainerRef, static: true },] }],
        chartHeader: [{ type: ViewChild, args: ['chartHeader', { static: true },] }],
        chartLegend: [{ type: ViewChild, args: ['chartLegend', { static: true },] }],
        chartWrapper: [{ type: ViewChild, args: ['chartWrapper', { static: true },] }],
        onResize: [{ type: HostListener, args: ['window:resize',] }]
    };
    return PoChartComponent;
}(PoChartBaseComponent));
export { PoChartComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.calculatedElement;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.componentRef;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.initialized;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.windowResizeListener;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.mappings;
    /** @type {?} */
    PoChartComponent.prototype.colors;
    /** @type {?} */
    PoChartComponent.prototype.chartContainer;
    /** @type {?} */
    PoChartComponent.prototype.chartHeader;
    /** @type {?} */
    PoChartComponent.prototype.chartLegend;
    /** @type {?} */
    PoChartComponent.prototype.chartWrapper;
    /** @type {?} */
    PoChartComponent.prototype.onResize;
    /** @type {?} */
    PoChartComponent.prototype.changeDetector;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.componentFactoryResolver;
    /**
     * @type {?}
     * @private
     */
    PoChartComponent.prototype.differs;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hhcnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1jaGFydC9wby1jaGFydC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWlCLGlCQUFpQixFQUFFLFNBQVMsRUFBRSx3QkFBd0IsRUFBeUIsVUFBVSxFQUFFLFlBQVksRUFDN0gsZUFBZSxFQUFxQixTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFekYsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUUvQixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDM0QsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMERBQTBELENBQUM7QUFFakcsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFDM0YsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLDRCQUE0QixDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFzQnpEO0lBSXNDLDRDQUFvQjtJQXlCeEQsMEJBQ1MsY0FBaUMsRUFDaEMsd0JBQWtELEVBQ2xELE9BQXdCOztRQUhsQyxZQUlJLGlCQUFPLFNBR1Y7UUFOUSxvQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFDaEMsOEJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNsRCxhQUFPLEdBQVAsT0FBTyxDQUFpQjtRQTFCMUIsdUJBQWlCLEdBQVksS0FBSyxDQUFDO1FBR25DLGlCQUFXLEdBQVksS0FBSyxDQUFDO1FBQzdCLDBCQUFvQixHQUFpQixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBRW5ELGNBQVE7WUFDZCxHQUFDLFdBQVcsQ0FBQyxHQUFHLElBQUcsbUJBQW1CO1lBQ3RD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YSxDQUFDLFlBQVksQ0FBQztZQUNuRSxRQUFRLENBQUMsWUFBWSxHQUFHLEtBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQztRQUN0RSxDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7O2dCQXRLRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLFVBQVU7b0JBQ3BCLGdtQkFBd0M7aUJBQ3pDOzs7O2dCQW5DdUIsaUJBQWlCO2dCQUFhLHdCQUF3QjtnQkFDNUUsZUFBZTs7O2lDQWtEZCxTQUFTLFNBQUMsZ0JBQWdCLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs4QkFHcEUsU0FBUyxTQUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7OEJBQ3pDLFNBQVMsU0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOytCQUN6QyxTQUFTLFNBQUMsY0FBYyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTsyQkFFMUMsWUFBWSxTQUFDLGVBQWU7O0lBOEkvQix1QkFBQztDQUFBLEFBeEtELENBSXNDLG9CQUFvQixHQW9LekQ7U0FwS1ksZ0JBQWdCOzs7Ozs7SUFFM0IsNkNBQTJDOzs7OztJQUMzQyx3Q0FBdUM7Ozs7O0lBQ3ZDLGtDQUFvQjs7Ozs7SUFDcEIsdUNBQXFDOzs7OztJQUNyQyxnREFBMkQ7Ozs7O0lBRTNELG9DQUdFOztJQUVGLGtDQUEyQjs7SUFFM0IsMENBQ2lDOztJQUVqQyx1Q0FBb0U7O0lBQ3BFLHVDQUFvRTs7SUFDcEUsd0NBQXNFOztJQUV0RSxvQ0FDaUQ7O0lBRy9DLDBDQUF3Qzs7Ozs7SUFDeEMsb0RBQTBEOzs7OztJQUMxRCxtQ0FBZ0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsIENvbXBvbmVudFJlZiwgRG9DaGVjaywgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyLFxuICBJdGVyYWJsZURpZmZlcnMsIE9uRGVzdHJveSwgT25Jbml0LCBWaWV3Q2hpbGQsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBQb0NoYXJ0QmFzZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9DaGFydENvbG9ycyB9IGZyb20gJy4vcG8tY2hhcnQtY29sb3JzLmNvbnN0YW50JztcbmltcG9ydCB7IFBvQ2hhcnREb251dENvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtZG9udXQvcG8tY2hhcnQtZG9udXQuY29tcG9uZW50JztcbmltcG9ydCB7IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCB9IGZyb20gJy4vcG8tY2hhcnQtdHlwZXMvcG8tY2hhcnQtZHluYW1pYy10eXBlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0UGllQ29tcG9uZW50IH0gZnJvbSAnLi9wby1jaGFydC10eXBlcy9wby1jaGFydC1waWUvcG8tY2hhcnQtcGllLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb0NoYXJ0VHlwZSB9IGZyb20gJy4vZW51bXMvcG8tY2hhcnQtdHlwZS5lbnVtJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgUG9DaGFydEJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1jaGFydC1iYXNpY1wiIHRpdGxlPVwiUG9ydGluYXJpIENoYXJ0IEJhc2ljXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1iYXNpYy9zYW1wbGUtcG8tY2hhcnQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2hhcnQtYmFzaWMvc2FtcGxlLXBvLWNoYXJ0LWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLWNoYXJ0LWxhYnNcIiB0aXRsZT1cIlBvcnRpbmFyaSBDaGFydCBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1sYWJzL3NhbXBsZS1wby1jaGFydC1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLWNoYXJ0LWxhYnMvc2FtcGxlLXBvLWNoYXJ0LWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tY2hhcnQtY29mZmVlLXJhbmtpbmdcIiB0aXRsZT1cIlBvcnRpbmFyaSBDaGFydCAtIENvZmZlZSBSYW5raW5nXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1jaGFydC1jb2ZmZWUtcmFua2luZy9zYW1wbGUtcG8tY2hhcnQtY29mZmVlLXJhbmtpbmcuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tY2hhcnQtY29mZmVlLXJhbmtpbmcvc2FtcGxlLXBvLWNoYXJ0LWNvZmZlZS1yYW5raW5nLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLWNoYXJ0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLWNoYXJ0LmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBQb0NoYXJ0Q29tcG9uZW50IGV4dGVuZHMgUG9DaGFydEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBEb0NoZWNrLCBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVkRWxlbWVudDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPHt9PjtcbiAgcHJpdmF0ZSBkaWZmZXI6IGFueTtcbiAgcHJpdmF0ZSBpbml0aWFsaXplZDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHdpbmRvd1Jlc2l6ZUxpc3RlbmVyOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIHByaXZhdGUgbWFwcGluZ3MgPSB7XG4gICAgW1BvQ2hhcnRUeXBlLlBpZV06IFBvQ2hhcnRQaWVDb21wb25lbnQsXG4gICAgW1BvQ2hhcnRUeXBlLkRvbnV0XTogUG9DaGFydERvbnV0Q29tcG9uZW50XG4gIH07XG5cbiAgY29sb3JzOiBBcnJheTxzdHJpbmc+ID0gW107XG5cbiAgQFZpZXdDaGlsZCgnY2hhcnRDb250YWluZXInLCB7IHJlYWQ6IFZpZXdDb250YWluZXJSZWYsIHN0YXRpYzogdHJ1ZSB9KVxuICBjaGFydENvbnRhaW5lcjogVmlld0NvbnRhaW5lclJlZjtcblxuICBAVmlld0NoaWxkKCdjaGFydEhlYWRlcicsIHsgc3RhdGljOiB0cnVlIH0pIGNoYXJ0SGVhZGVyOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjaGFydExlZ2VuZCcsIHsgc3RhdGljOiB0cnVlIH0pIGNoYXJ0TGVnZW5kOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdjaGFydFdyYXBwZXInLCB7IHN0YXRpYzogdHJ1ZSB9KSBjaGFydFdyYXBwZXI6IEVsZW1lbnRSZWY7XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpXG4gIG9uUmVzaXplID0gKCkgPT4gdGhpcy53aW5kb3dSZXNpemVMaXN0ZW5lci5uZXh0KClcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHJpdmF0ZSBkaWZmZXJzOiBJdGVyYWJsZURpZmZlcnMpIHtcbiAgICAgIHN1cGVyKCk7XG5cbiAgICAgIHRoaXMuZGlmZmVyID0gdGhpcy5kaWZmZXJzLmZpbmQoW10pLmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcbiAgICBjb25zdCBjaGFyV3JhcHBlcldpZHRoID0gdGhpcy5jaGFydFdyYXBwZXIubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcblxuICAgIC8vIFBlcm1pdGUgcXVlIG8gY2hhcnQgc2VqYSBjYWxjdWxhZG8gbmEgcHJpbWVpcmEgdmV6IHF1ZSBvIGNvbXBvbmVudGUgdG9ybmEtc2Ugdmlzw612ZWwsXG4gICAgLy8gZXZpdGFuZG8gY29tIGlzc28sIHByb2JsZW1hcyBjb20gVGFicyBvdSBEaXZzIHF1ZSBpbmljaWVtIGVzY29uZGlkYXMuXG4gICAgaWYgKGNoYXJXcmFwcGVyV2lkdGggJiYgIXRoaXMuY2FsY3VsYXRlZEVsZW1lbnQgJiYgdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgdGhpcy5jYWxjdWxhdGVkRWxlbWVudCA9IHRydWU7XG4gICAgICB0aGlzLmdldFNlcmllc0NvbG9yKCk7XG4gICAgICB0aGlzLmR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCk7XG4gICAgfVxuXG4gICAgdGhpcy5jaGVja2luZ0ZvclNlcmllQ2hhbmdlcygpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5yZW1vdmVXaW5kb3dSZXNpemVMaXN0ZW5lcigpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5nZXRTZXJpZXNDb2xvcigpO1xuICB9XG5cbiAgcmVidWlsZENvbXBvbmVudCgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuZHluYW1pY0NvbXBvbmVudFNldHRpbmcoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNraW5nRm9yU2VyaWVDaGFuZ2VzKCkge1xuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZiAmJiB0aGlzLmRpZmZlcikge1xuICAgICAgY29uc3QgY2hhbmdlU2VyaWVzID0gdGhpcy5kaWZmZXIuZGlmZih0aGlzLnNlcmllcyk7XG4gICAgICBpZiAoY2hhbmdlU2VyaWVzKSB7XG4gICAgICAgIHRoaXMuZ2V0U2VyaWVzQ29sb3IoKTtcbiAgICAgICAgdGhpcy5yZWJ1aWxkQ29tcG9uZW50KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDb21wb25lbnQoKSB7XG4gICAgY29uc3QgY29tcG9uZW50VHlwZSA9IHRoaXMuZ2V0Q29tcG9uZW50VHlwZSh0aGlzLnR5cGUpO1xuICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShjb21wb25lbnRUeXBlKTtcblxuICAgIHRoaXMuY29tcG9uZW50UmVmID0gdGhpcy5jaGFydENvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XG5cbiAgICBjb25zdCBpbnN0YW5jZSA9IDxQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQ+dGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XG5cbiAgICB0aGlzLnNldENoYXJ0UHJvcGVydGllcyhpbnN0YW5jZSk7XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH1cblxuICBwcml2YXRlIGR5bmFtaWNDb21wb25lbnRTZXR0aW5nKCkge1xuICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5jcmVhdGVDb21wb25lbnQoKTtcblxuICAgIHRoaXMuc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIHRoaXMuc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICAgIHRoaXMuc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2UpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDb21wb25lbnRUeXBlKHR5cGVOYW1lKSB7XG4gICAgcmV0dXJuIHRoaXMubWFwcGluZ3NbdHlwZU5hbWVdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXJpZXNDb2xvcigpIHtcbiAgICBjb25zdCBjb2xvcnNMZW5ndGggPSBQb0NoYXJ0Q29sb3JzLmxlbmd0aCAtIDE7XG5cbiAgICBpZiAoIXRoaXMuc2VyaWVzKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb2xvcnMgPSBQb0NoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF07XG4gICAgfVxuXG4gICAgY29uc3Qgc2VyaWVzTGVuZ3RoID0gdGhpcy5zZXJpZXMubGVuZ3RoIC0gMTtcblxuICAgIGlmIChzZXJpZXNMZW5ndGggPiBjb2xvcnNMZW5ndGgpIHtcbiAgICAgIGxldCBjb2xvcnMgPSBQb0NoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF07XG5cbiAgICAgIC8vIHJlY3VwZXJhIG8gcmVzdWx0YWRvIGRhIGRpdmlzYW8gZW50cmUgdGFtYW5obyBkYXMgc2VyaWVzIGUgbyBudW1lcm8gZGUgY29yZXMgZGlzcG9uaXZlaXNcbiAgICAgIGNvbnN0IHF1YW50aXR5RHVwbGljYXRlcyA9IHNlcmllc0xlbmd0aCAvIGNvbG9yc0xlbmd0aDtcblxuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gcXVhbnRpdHlEdXBsaWNhdGVzOyBpKyspIHtcbiAgICAgICAgY29sb3JzID0gY29sb3JzLmNvbmNhdChQb0NoYXJ0Q29sb3JzW2NvbG9yc0xlbmd0aF0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jb2xvcnMgPSBjb2xvcnM7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuY29sb3JzID0gUG9DaGFydENvbG9yc1tzZXJpZXNMZW5ndGhdO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVXaW5kb3dSZXNpemVMaXN0ZW5lcigpIHtcbiAgICBpZiAodGhpcy5vblJlc2l6ZSkge1xuICAgICAgdGhpcy5vblJlc2l6ZSA9ICgpID0+IHt9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2hhcnRQcm9wZXJ0aWVzKGluc3RhbmNlOiBQb0NoYXJ0RHluYW1pY1R5cGVDb21wb25lbnQpIHtcbiAgICBpbnN0YW5jZS5jaGFydEhlYWRlciA9IHRoaXMuY2hhcnRIZWFkZXIubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgaW5zdGFuY2UuY2hhcnRMZWdlbmQgPSB0aGlzLmNoYXJ0TGVnZW5kLm5hdGl2ZUVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgaW5zdGFuY2UuY29sb3JzID0gQXJyYXkuaXNBcnJheSh0aGlzLmNvbG9ycykgPyBbLi4udGhpcy5jb2xvcnNdIDogW107XG4gICAgaW5zdGFuY2UuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgaW5zdGFuY2Uuc2VyaWVzID0gdGhpcy5zZXJpZXMgfHwgW107XG4gICAgaW5zdGFuY2UudHlwZSA9IHRoaXMudHlwZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2xpY2tTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGluc3RhbmNlLm9uU2VyaWVDbGljay5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgdGhpcy5vblNlcmllc0NsaWNrKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SG92ZXJTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIGluc3RhbmNlLm9uU2VyaWVIb3Zlci5zdWJzY3JpYmUoZXZlbnQgPT4ge1xuICAgICAgdGhpcy5vblNlcmllc0hvdmVyKGV2ZW50KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UmVzaXplTGlzdGVuZXJTdWJzY3JpYmUoaW5zdGFuY2U6IFBvQ2hhcnREeW5hbWljVHlwZUNvbXBvbmVudCkge1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGluc3RhbmNlLmNoYXJ0SGVhZGVyID0gdGhpcy5jaGFydEhlYWRlci5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGluc3RhbmNlLmNoYXJ0TGVnZW5kID0gdGhpcy5jaGFydExlZ2VuZC5uYXRpdmVFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGluc3RhbmNlLmNoYXJ0V3JhcHBlciA9IHRoaXMuY2hhcnRXcmFwcGVyLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgfSk7XG4gIH1cblxufVxuIl19