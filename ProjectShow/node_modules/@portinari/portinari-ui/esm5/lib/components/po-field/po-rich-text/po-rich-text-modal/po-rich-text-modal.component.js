/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Output, ViewChild } from '@angular/core';
import { NgForm } from '@angular/forms';
import { convertImageToBase64 } from '../../../../utils/util';
import { PoLanguageService } from './../../../../services/po-language/po-language.service';
import { PoModalComponent } from '../../../po-modal';
import { poRichTextLiteralsDefault } from '../po-rich-text-literals';
import { PoRichTextModalType } from '../enums/po-rich-text-modal-type.enum';
import { PoUploadComponent } from '../../po-upload/po-upload.component';
/** @type {?} */
var uploadRestrictions = ['.apng', '.bmp', '.gif', '.ico', '.jpeg', '.jpg', '.png', '.svg'];
var PoRichTextModalComponent = /** @class */ (function () {
    function PoRichTextModalComponent(languageService) {
        var _this = this;
        this.languageService = languageService;
        this.selection = document.getSelection();
        this.uploadRestrictions = {
            allowedExtensions: uploadRestrictions
        };
        this.literals = tslib_1.__assign({}, poRichTextLiteralsDefault[this.languageService.getShortLanguage()]);
        this.modalCancelAction = {
            label: this.literals.cancel,
            action: (/**
             * @return {?}
             */
            function () {
                _this.modal.close();
                _this.cleanUpFields();
            })
        };
        this.modalConfirmAction = {
            label: this.literals.insert,
            disabled: false,
            action: (/**
             * @return {?}
             */
            function () { return _this.insertElementRef(); })
        };
        this.modalLinkConfirmAction = {
            label: this.literals.insertLink,
            disabled: true,
            action: (/**
             * @return {?}
             */
            function () { return _this.toInsertLink(_this.urlLink, _this.urlLinkText); })
        };
        this.command = new EventEmitter();
    }
    Object.defineProperty(PoRichTextModalComponent.prototype, "modalTitle", {
        get: /**
         * @return {?}
         */
        function () {
            return this.modalType === 'image' ? this.literals.insertImage : this.literals.insertLink;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRichTextModalComponent.prototype, "isUploadValid", {
        get: /**
         * @return {?}
         */
        function () {
            return !!(this.uploadModel && this.uploadModel.length);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRichTextModalComponent.prototype, "isUrlValid", {
        get: /**
         * @return {?}
         */
        function () {
            return !!this.urlImage && this.modalImageForm && this.modalImageForm.valid;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRichTextModalComponent.prototype, "modalPrimaryAction", {
        get: /**
         * @return {?}
         */
        function () {
            return this.modalType === 'image' ? this.modalConfirmAction : this.modalLinkConfirmAction;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoRichTextModalComponent.prototype.convertToBase64 = /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var uploadImage;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.isUploadValid) return [3 /*break*/, 2];
                        uploadImage = this.uploadModel[0].rawFile;
                        return [4 /*yield*/, convertImageToBase64(uploadImage)];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @param {?} value
     * @return {?}
     */
    PoRichTextModalComponent.prototype.emitCommand = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        /** @type {?} */
        var command;
        if (value && this.modalType === PoRichTextModalType.Image) {
            command = 'insertImage';
            this.command.emit(({ command: command, value: value }));
        }
    };
    /**
     * @return {?}
     */
    PoRichTextModalComponent.prototype.formModelValidate = /**
     * @return {?}
     */
    function () {
        return this.modalLinkConfirmAction.disabled = this.modalLinkForm && this.modalLinkForm.invalid;
    };
    /**
     * @return {?}
     */
    PoRichTextModalComponent.prototype.insertElementRef = /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var uploadImage;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(this.modalType === PoRichTextModalType.Image && !this.urlImage)) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.convertToBase64()];
                    case 1:
                        uploadImage = _a.sent();
                        _a.label = 2;
                    case 2:
                        this.retrieveCursorPosition();
                        this.modal.close();
                        if (this.isUrlValid || this.isUploadValid) {
                            this.emitCommand(this.urlImage || uploadImage);
                        }
                        this.cleanUpFields();
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @param {?} type
     * @return {?}
     */
    PoRichTextModalComponent.prototype.openModal = /**
     * @param {?} type
     * @return {?}
     */
    function (type) {
        this.modalType = type;
        if (this.modalType === PoRichTextModalType.Image) {
            this.saveCursorPosition();
        }
        else {
            this.saveSelectionTextRange();
            this.formReset(this.modalLinkForm.control);
            this.formModelValidate();
        }
        this.modal.open();
    };
    /**
     * @private
     * @param {?} urlLink
     * @param {?} urlLinkText
     * @return {?}
     */
    PoRichTextModalComponent.prototype.checkIfIsEmpty = /**
     * @private
     * @param {?} urlLink
     * @param {?} urlLinkText
     * @return {?}
     */
    function (urlLink, urlLinkText) {
        return urlLinkText === undefined || urlLinkText.trim() === '' ? urlLink : urlLinkText;
    };
    /**
     * @private
     * @return {?}
     */
    PoRichTextModalComponent.prototype.cleanUpFields = /**
     * @private
     * @return {?}
     */
    function () {
        this.urlImage = undefined;
        this.urlLink = undefined;
        this.urlLinkText = undefined;
        this.uploadModel = undefined;
    };
    /**
     * @private
     * @param {?} control
     * @return {?}
     */
    PoRichTextModalComponent.prototype.formReset = /**
     * @private
     * @param {?} control
     * @return {?}
     */
    function (control) {
        control.markAsPristine();
        control.markAsUntouched();
        control.updateValueAndValidity();
    };
    /**
     * @private
     * @return {?}
     */
    PoRichTextModalComponent.prototype.restoreSelection = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.savedSelection) {
            if (this.selection) {
                this.selection.removeAllRanges();
                this.selection.addRange(this.savedSelection);
            }
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoRichTextModalComponent.prototype.retrieveCursorPosition = /**
     * @private
     * @return {?}
     */
    function () {
        this.selection.collapse(this.savedCursorPosition[0], this.savedCursorPosition[1]);
    };
    /**
     * @private
     * @return {?}
     */
    PoRichTextModalComponent.prototype.saveCursorPosition = /**
     * @private
     * @return {?}
     */
    function () {
        this.savedCursorPosition = [this.selection.focusNode, this.selection.focusOffset];
    };
    /**
     * @private
     * @return {?}
     */
    PoRichTextModalComponent.prototype.saveSelectionTextRange = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.selection.anchorNode !== null) {
            this.savedSelection = this.selection.getRangeAt(0);
            this.urlLinkText = this.selection.toString();
        }
        else {
            return null;
        }
    };
    /**
     * @private
     * @param {?} urlLink
     * @param {?} urlLinkText
     * @return {?}
     */
    PoRichTextModalComponent.prototype.toInsertLink = /**
     * @private
     * @param {?} urlLink
     * @param {?} urlLinkText
     * @return {?}
     */
    function (urlLink, urlLinkText) {
        this.modal.close();
        this.restoreSelection();
        /** @type {?} */
        var urlLinkTextValue = this.checkIfIsEmpty(urlLink, urlLinkText);
        /** @type {?} */
        var command = 'InsertHTML';
        /** @type {?} */
        var value = { urlLink: urlLink, urlLinkText: urlLinkTextValue };
        this.command.emit({ command: command, value: value });
        this.cleanUpFields();
    };
    PoRichTextModalComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-rich-text-modal',
                    template: "<po-modal #modal\r\n  p-hide-close\r\n  [p-primary-action]=\"modalPrimaryAction\"\r\n  [p-secondary-action]=\"modalCancelAction\"\r\n  [p-title]=\"modalTitle\">\r\n\r\n  <ng-container *ngTemplateOutlet=\"modalType === 'image' ? modalImage : modalLink\"></ng-container>\r\n</po-modal>\r\n\r\n<ng-template #modalImage>\r\n  <form #modalImageForm=\"ngForm\">\r\n    <div class=\"po-row\">\r\n      <!-- po-upload desabilita o drag drop caso n\u00E3o tenha valor atribuido para a propriedade p-url -->\r\n      <po-upload #upload\r\n        class=\"po-md-12\"\r\n        name=\"upload\"\r\n        [(ngModel)]=\"uploadModel\"\r\n        p-drag-drop-height=\"160\"\r\n        p-hide-restrictions-info\r\n        p-hide-send-button\r\n        p-url=\"x\"\r\n        [p-drag-drop]=\"!modal.isHidden\"\r\n        [p-disabled]=\"isUrlValid\"\r\n        [p-restrictions]=\"uploadRestrictions\">\r\n      </po-upload>\r\n    </div>\r\n\r\n    <div class=\"po-row\">\r\n      <po-url\r\n        class=\"po-md-12 po-mt-3\"\r\n        name=\"url\"\r\n        [(ngModel)]=\"urlImage\"\r\n        [p-label]=\"literals.urlImage\"\r\n        [p-disabled]=\"isUploadValid\">\r\n      </po-url>\r\n    </div>\r\n  </form>\r\n</ng-template>\r\n\r\n<ng-template #modalLink>\r\n  <form #modalLinkForm=\"ngForm\">\r\n    <div class=\"po-row\">\r\n      <po-input class=\"po-md-12 po-mb-2\"\r\n        name=\"urlLinkText\"\r\n        [(ngModel)]=\"urlLinkText\"\r\n        p-optional\r\n        [p-label]=\"literals.linkTextLabel\"\r\n        [p-placeholder]=\"literals.linkTextLabel\">\r\n      </po-input>\r\n\r\n      <po-url class=\"po-md-12\"\r\n        name=\"urlLink\"\r\n        [(ngModel)]=\"urlLink\"\r\n        p-label=\"Link\"\r\n        p-required\r\n        [p-help]=\"literals.linkUrlTextHelper\"\r\n        [p-placeholder]=\"literals.linkUrlTextPlaceholder\"\r\n        (p-change-model)=\"formModelValidate()\">\r\n      </po-url>\r\n    </div>\r\n  </form>\r\n</ng-template>\r\n"
                }] }
    ];
    /** @nocollapse */
    PoRichTextModalComponent.ctorParameters = function () { return [
        { type: PoLanguageService }
    ]; };
    PoRichTextModalComponent.propDecorators = {
        modal: [{ type: ViewChild, args: ['modal', { static: true },] }],
        modalImageForm: [{ type: ViewChild, args: ['modalImageForm', { static: false },] }],
        upload: [{ type: ViewChild, args: ['upload', { static: true },] }],
        modalImage: [{ type: ViewChild, args: ['modalImage', { static: true },] }],
        modalLink: [{ type: ViewChild, args: ['modalLink', { static: true },] }],
        modalLinkForm: [{ type: ViewChild, args: ['modalLinkForm', { static: false },] }],
        command: [{ type: Output, args: ['p-command',] }]
    };
    return PoRichTextModalComponent;
}());
export { PoRichTextModalComponent };
if (false) {
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalType;
    /** @type {?} */
    PoRichTextModalComponent.prototype.savedCursorPosition;
    /** @type {?} */
    PoRichTextModalComponent.prototype.selection;
    /** @type {?} */
    PoRichTextModalComponent.prototype.uploadModel;
    /** @type {?} */
    PoRichTextModalComponent.prototype.uploadRestrictions;
    /** @type {?} */
    PoRichTextModalComponent.prototype.urlImage;
    /** @type {?} */
    PoRichTextModalComponent.prototype.urlLink;
    /** @type {?} */
    PoRichTextModalComponent.prototype.urlLinkText;
    /**
     * @type {?}
     * @private
     */
    PoRichTextModalComponent.prototype.savedSelection;
    /** @type {?} */
    PoRichTextModalComponent.prototype.literals;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalCancelAction;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalConfirmAction;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalLinkConfirmAction;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modal;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalImageForm;
    /** @type {?} */
    PoRichTextModalComponent.prototype.upload;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalImage;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalLink;
    /** @type {?} */
    PoRichTextModalComponent.prototype.modalLinkForm;
    /** @type {?} */
    PoRichTextModalComponent.prototype.command;
    /**
     * @type {?}
     * @private
     */
    PoRichTextModalComponent.prototype.languageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcmljaC10ZXh0LW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tcmljaC10ZXh0L3BvLXJpY2gtdGV4dC1tb2RhbC9wby1yaWNoLXRleHQtbW9kYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDdkYsT0FBTyxFQUFtQixNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM5RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx3REFBd0QsQ0FBQztBQUUzRixPQUFPLEVBQWlCLGdCQUFnQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDcEUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDNUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0scUNBQXFDLENBQUM7O0lBR2xFLGtCQUFrQixHQUFHLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQztBQUU3RjtJQXlFRSxrQ0FBb0IsZUFBa0M7UUFBdEQsaUJBQTBEO1FBQXRDLG9CQUFlLEdBQWYsZUFBZSxDQUFtQjtRQWpFdEQsY0FBUyxHQUFHLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUVwQyx1QkFBa0IsR0FBNkI7WUFDN0MsaUJBQWlCLEVBQUUsa0JBQWtCO1NBQ3RDLENBQUM7UUFPTyxhQUFR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RSxJQUFJLEVBQUU7NEJBRXhDLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dDQUV2QyxTQUFTLFNBQUMsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTswQkFFNUMsTUFBTSxTQUFDLFdBQVc7O0lBaUhyQiwrQkFBQztDQUFBLEFBeExELElBd0xDO1NBcExZLHdCQUF3Qjs7O0lBRW5DLDZDQUErQjs7SUFDL0IsdURBQW9COztJQUNwQiw2Q0FBb0M7O0lBQ3BDLCtDQUF3Qjs7SUFDeEIsc0RBRUU7O0lBQ0YsNENBQWlCOztJQUNqQiwyQ0FBZ0I7O0lBQ2hCLCtDQUFvQjs7Ozs7SUFFcEIsa0RBQXFDOztJQUVyQyw0Q0FFRTs7SUFFRixxREFNRTs7SUFFRixzREFJRTs7SUFFRiwwREFJRTs7SUFrQkYseUNBQThEOztJQUU5RCxrREFBdUU7O0lBRXZFLDBDQUFpRTs7SUFFakUsOENBQWtFOztJQUVsRSw2Q0FBc0U7O0lBRXRFLGlEQUFxRTs7SUFFckUsMkNBQXFHOzs7OztJQUV6RixtREFBMEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBOZ0Zvcm0gfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcblxyXG5pbXBvcnQgeyBjb252ZXJ0SW1hZ2VUb0Jhc2U2NCB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xyXG5pbXBvcnQgeyBQb0xhbmd1YWdlU2VydmljZSB9IGZyb20gJy4vLi4vLi4vLi4vLi4vc2VydmljZXMvcG8tbGFuZ3VhZ2UvcG8tbGFuZ3VhZ2Uuc2VydmljZSc7XHJcblxyXG5pbXBvcnQgeyBQb01vZGFsQWN0aW9uLCBQb01vZGFsQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vLi4vcG8tbW9kYWwnO1xyXG5pbXBvcnQgeyBwb1JpY2hUZXh0TGl0ZXJhbHNEZWZhdWx0IH0gZnJvbSAnLi4vcG8tcmljaC10ZXh0LWxpdGVyYWxzJztcclxuaW1wb3J0IHsgUG9SaWNoVGV4dE1vZGFsVHlwZSB9IGZyb20gJy4uL2VudW1zL3BvLXJpY2gtdGV4dC1tb2RhbC10eXBlLmVudW0nO1xyXG5pbXBvcnQgeyBQb1VwbG9hZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL3BvLXVwbG9hZC9wby11cGxvYWQuY29tcG9uZW50JztcclxuaW1wb3J0IHsgUG9VcGxvYWRGaWxlUmVzdHJpY3Rpb25zIH0gZnJvbSAnLi4vLi4vcG8tdXBsb2FkL2ludGVyZmFjZXMvcG8tdXBsb2FkLWZpbGUtcmVzdHJpY3Rpb24uaW50ZXJmYWNlJztcclxuXHJcbmNvbnN0IHVwbG9hZFJlc3RyaWN0aW9ucyA9IFsnLmFwbmcnLCAnLmJtcCcsICcuZ2lmJywgJy5pY28nLCAnLmpwZWcnLCAnLmpwZycsICcucG5nJywgJy5zdmcnXTtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAncG8tcmljaC10ZXh0LW1vZGFsJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcG8tcmljaC10ZXh0LW1vZGFsLmNvbXBvbmVudC5odG1sJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgUG9SaWNoVGV4dE1vZGFsQ29tcG9uZW50IHtcclxuXHJcbiAgbW9kYWxUeXBlOiBQb1JpY2hUZXh0TW9kYWxUeXBlO1xyXG4gIHNhdmVkQ3Vyc29yUG9zaXRpb247XHJcbiAgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7XHJcbiAgdXBsb2FkTW9kZWw6IEFycmF5PGFueT47XHJcbiAgdXBsb2FkUmVzdHJpY3Rpb25zOiBQb1VwbG9hZEZpbGVSZXN0cmljdGlvbnMgPSB7XHJcbiAgICBhbGxvd2VkRXh0ZW5zaW9uczogdXBsb2FkUmVzdHJpY3Rpb25zXHJcbiAgfTtcclxuICB1cmxJbWFnZTogc3RyaW5nO1xyXG4gIHVybExpbms6IHN0cmluZztcclxuICB1cmxMaW5rVGV4dDogc3RyaW5nO1xyXG5cclxuICBwcml2YXRlIHNhdmVkU2VsZWN0aW9uOiBSYW5nZSB8IG51bGw7XHJcblxyXG4gIHJlYWRvbmx5IGxpdGVyYWxzID0ge1xyXG4gICAgLi4ucG9SaWNoVGV4dExpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCldXHJcbiAgfTtcclxuXHJcbiAgbW9kYWxDYW5jZWxBY3Rpb246IFBvTW9kYWxBY3Rpb24gPSB7XHJcbiAgICBsYWJlbDogdGhpcy5saXRlcmFscy5jYW5jZWwsXHJcbiAgICBhY3Rpb246ICgpID0+IHtcclxuICAgICAgdGhpcy5tb2RhbC5jbG9zZSgpO1xyXG4gICAgICB0aGlzLmNsZWFuVXBGaWVsZHMoKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBtb2RhbENvbmZpcm1BY3Rpb246IFBvTW9kYWxBY3Rpb24gPSB7XHJcbiAgICBsYWJlbDogdGhpcy5saXRlcmFscy5pbnNlcnQsXHJcbiAgICBkaXNhYmxlZDogZmFsc2UsXHJcbiAgICBhY3Rpb246ICgpID0+IHRoaXMuaW5zZXJ0RWxlbWVudFJlZigpXHJcbiAgfTtcclxuXHJcbiAgbW9kYWxMaW5rQ29uZmlybUFjdGlvbiA9IHtcclxuICAgIGxhYmVsOiB0aGlzLmxpdGVyYWxzLmluc2VydExpbmssXHJcbiAgICBkaXNhYmxlZDogdHJ1ZSxcclxuICAgIGFjdGlvbjogKCkgPT4gdGhpcy50b0luc2VydExpbmsodGhpcy51cmxMaW5rLCB0aGlzLnVybExpbmtUZXh0KVxyXG4gIH07XHJcblxyXG4gIGdldCBtb2RhbFRpdGxlKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5tb2RhbFR5cGUgPT09ICdpbWFnZScgPyB0aGlzLmxpdGVyYWxzLmluc2VydEltYWdlIDogdGhpcy5saXRlcmFscy5pbnNlcnRMaW5rO1xyXG4gIH1cclxuXHJcbiAgZ2V0IGlzVXBsb2FkVmFsaWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gISEodGhpcy51cGxvYWRNb2RlbCAmJiB0aGlzLnVwbG9hZE1vZGVsLmxlbmd0aCk7XHJcbiAgfVxyXG5cclxuICBnZXQgaXNVcmxWYWxpZCgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAhIXRoaXMudXJsSW1hZ2UgJiYgdGhpcy5tb2RhbEltYWdlRm9ybSAmJiB0aGlzLm1vZGFsSW1hZ2VGb3JtLnZhbGlkO1xyXG4gIH1cclxuXHJcbiAgZ2V0IG1vZGFsUHJpbWFyeUFjdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLm1vZGFsVHlwZSA9PT0gJ2ltYWdlJyA/IHRoaXMubW9kYWxDb25maXJtQWN0aW9uIDogdGhpcy5tb2RhbExpbmtDb25maXJtQWN0aW9uO1xyXG4gIH1cclxuXHJcbiAgQFZpZXdDaGlsZCgnbW9kYWwnLCB7IHN0YXRpYzogdHJ1ZSB9KSBtb2RhbDogUG9Nb2RhbENvbXBvbmVudDtcclxuXHJcbiAgQFZpZXdDaGlsZCgnbW9kYWxJbWFnZUZvcm0nLCB7IHN0YXRpYzogZmFsc2UgfSkgbW9kYWxJbWFnZUZvcm06IE5nRm9ybTtcclxuXHJcbiAgQFZpZXdDaGlsZCgndXBsb2FkJywgeyBzdGF0aWM6IHRydWUgfSkgdXBsb2FkOiBQb1VwbG9hZENvbXBvbmVudDtcclxuXHJcbiAgQFZpZXdDaGlsZCgnbW9kYWxJbWFnZScsIHsgc3RhdGljOiB0cnVlIH0pIG1vZGFsSW1hZ2U6IEVsZW1lbnRSZWY7XHJcblxyXG4gIEBWaWV3Q2hpbGQoJ21vZGFsTGluaycsIHsgc3RhdGljOiB0cnVlIH0pIG1vZGFsTGluazogUG9Nb2RhbENvbXBvbmVudDtcclxuXHJcbiAgQFZpZXdDaGlsZCgnbW9kYWxMaW5rRm9ybScsIHsgc3RhdGljOiBmYWxzZSB9KSBtb2RhbExpbmtGb3JtOiBOZ0Zvcm07XHJcblxyXG4gIEBPdXRwdXQoJ3AtY29tbWFuZCcpIGNvbW1hbmQgPSBuZXcgRXZlbnRFbWl0dGVyPHN0cmluZyB8IHsgY29tbWFuZDogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgYW55IH0+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZSkge31cclxuXHJcbiAgYXN5bmMgY29udmVydFRvQmFzZTY0KCkge1xyXG4gICAgaWYgKHRoaXMuaXNVcGxvYWRWYWxpZCkge1xyXG4gICAgICBjb25zdCB1cGxvYWRJbWFnZSA9IHRoaXMudXBsb2FkTW9kZWxbMF0ucmF3RmlsZTtcclxuICAgICAgcmV0dXJuIGF3YWl0IGNvbnZlcnRJbWFnZVRvQmFzZTY0KHVwbG9hZEltYWdlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGVtaXRDb21tYW5kKHZhbHVlKSB7XHJcbiAgICBsZXQgY29tbWFuZDogc3RyaW5nO1xyXG4gICAgaWYgKHZhbHVlICYmIHRoaXMubW9kYWxUeXBlID09PSBQb1JpY2hUZXh0TW9kYWxUeXBlLkltYWdlKSB7XHJcbiAgICAgIGNvbW1hbmQgPSAnaW5zZXJ0SW1hZ2UnO1xyXG4gICAgICB0aGlzLmNvbW1hbmQuZW1pdCgoeyBjb21tYW5kLCB2YWx1ZSB9KSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBmb3JtTW9kZWxWYWxpZGF0ZSgpIHtcclxuICAgIHJldHVybiB0aGlzLm1vZGFsTGlua0NvbmZpcm1BY3Rpb24uZGlzYWJsZWQgPSB0aGlzLm1vZGFsTGlua0Zvcm0gJiYgdGhpcy5tb2RhbExpbmtGb3JtLmludmFsaWQ7XHJcbiAgfVxyXG5cclxuICBhc3luYyBpbnNlcnRFbGVtZW50UmVmKCkge1xyXG5cclxuICAgIGxldCB1cGxvYWRJbWFnZTogc3RyaW5nO1xyXG5cclxuICAgIGlmICh0aGlzLm1vZGFsVHlwZSA9PT0gUG9SaWNoVGV4dE1vZGFsVHlwZS5JbWFnZSAmJiAhdGhpcy51cmxJbWFnZSkge1xyXG4gICAgICB1cGxvYWRJbWFnZSA9IGF3YWl0IHRoaXMuY29udmVydFRvQmFzZTY0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5yZXRyaWV2ZUN1cnNvclBvc2l0aW9uKCk7XHJcbiAgICB0aGlzLm1vZGFsLmNsb3NlKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuaXNVcmxWYWxpZCB8fCB0aGlzLmlzVXBsb2FkVmFsaWQpIHtcclxuICAgICAgdGhpcy5lbWl0Q29tbWFuZCh0aGlzLnVybEltYWdlIHx8IHVwbG9hZEltYWdlKTtcclxuICAgIH1cclxuICAgIHRoaXMuY2xlYW5VcEZpZWxkcygpO1xyXG4gIH1cclxuXHJcbiAgb3Blbk1vZGFsKHR5cGU6IFBvUmljaFRleHRNb2RhbFR5cGUpIHtcclxuICAgIHRoaXMubW9kYWxUeXBlID0gdHlwZTtcclxuXHJcbiAgICBpZiAodGhpcy5tb2RhbFR5cGUgPT09IFBvUmljaFRleHRNb2RhbFR5cGUuSW1hZ2UpIHtcclxuICAgICAgdGhpcy5zYXZlQ3Vyc29yUG9zaXRpb24oKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc2F2ZVNlbGVjdGlvblRleHRSYW5nZSgpO1xyXG4gICAgICB0aGlzLmZvcm1SZXNldCh0aGlzLm1vZGFsTGlua0Zvcm0uY29udHJvbCk7XHJcbiAgICAgIHRoaXMuZm9ybU1vZGVsVmFsaWRhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLm1vZGFsLm9wZW4oKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2hlY2tJZklzRW1wdHkodXJsTGluazogc3RyaW5nLCB1cmxMaW5rVGV4dDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gdXJsTGlua1RleHQgPT09IHVuZGVmaW5lZCB8fCB1cmxMaW5rVGV4dC50cmltKCkgPT09ICcnID8gdXJsTGluayA6IHVybExpbmtUZXh0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjbGVhblVwRmllbGRzKCkge1xyXG4gICAgdGhpcy51cmxJbWFnZSA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMudXJsTGluayA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMudXJsTGlua1RleHQgPSB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLnVwbG9hZE1vZGVsID0gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmb3JtUmVzZXQoY29udHJvbDogQWJzdHJhY3RDb250cm9sKSB7XHJcbiAgICBjb250cm9sLm1hcmtBc1ByaXN0aW5lKCk7XHJcbiAgICBjb250cm9sLm1hcmtBc1VudG91Y2hlZCgpO1xyXG4gICAgY29udHJvbC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlc3RvcmVTZWxlY3Rpb24oKSB7XHJcbiAgICBpZiAodGhpcy5zYXZlZFNlbGVjdGlvbikge1xyXG4gICAgICBpZiAodGhpcy5zZWxlY3Rpb24pIHtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGlvbi5hZGRSYW5nZSh0aGlzLnNhdmVkU2VsZWN0aW9uKTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gIGVsc2Uge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJldHJpZXZlQ3Vyc29yUG9zaXRpb24oKSB7XHJcbiAgICB0aGlzLnNlbGVjdGlvbi5jb2xsYXBzZSh0aGlzLnNhdmVkQ3Vyc29yUG9zaXRpb25bMF0sIHRoaXMuc2F2ZWRDdXJzb3JQb3NpdGlvblsxXSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNhdmVDdXJzb3JQb3NpdGlvbigpIHtcclxuICAgIHRoaXMuc2F2ZWRDdXJzb3JQb3NpdGlvbiA9IFsgdGhpcy5zZWxlY3Rpb24uZm9jdXNOb2RlLCB0aGlzLnNlbGVjdGlvbi5mb2N1c09mZnNldCBdO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzYXZlU2VsZWN0aW9uVGV4dFJhbmdlKCkge1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0aW9uLmFuY2hvck5vZGUgIT09IG51bGwpIHtcclxuICAgICAgdGhpcy5zYXZlZFNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uLmdldFJhbmdlQXQoMCk7XHJcbiAgICAgIHRoaXMudXJsTGlua1RleHQgPSB0aGlzLnNlbGVjdGlvbi50b1N0cmluZygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHRvSW5zZXJ0TGluayh1cmxMaW5rLCB1cmxMaW5rVGV4dCkge1xyXG4gICAgdGhpcy5tb2RhbC5jbG9zZSgpO1xyXG4gICAgdGhpcy5yZXN0b3JlU2VsZWN0aW9uKCk7XHJcblxyXG4gICAgY29uc3QgdXJsTGlua1RleHRWYWx1ZSA9IHRoaXMuY2hlY2tJZklzRW1wdHkodXJsTGluaywgdXJsTGlua1RleHQpO1xyXG4gICAgY29uc3QgY29tbWFuZDogc3RyaW5nID0gJ0luc2VydEhUTUwnO1xyXG4gICAgY29uc3QgdmFsdWUgPSB7IHVybExpbms6IHVybExpbmssIHVybExpbmtUZXh0OiB1cmxMaW5rVGV4dFZhbHVlIH07XHJcblxyXG4gICAgdGhpcy5jb21tYW5kLmVtaXQoeyBjb21tYW5kLCB2YWx1ZSB9KTtcclxuXHJcbiAgICB0aGlzLmNsZWFuVXBGaWVsZHMoKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==