/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, EventEmitter, HostListener, Input, Output } from '@angular/core';
import { PoI18nPipe } from '../../../../services/po-i18n/po-i18n.pipe';
import { PoNotificationService } from '../../../../services/po-notification/po-notification.service';
var PoUploadDragDropDirective = /** @class */ (function () {
    function PoUploadDragDropDirective(i18nPipe, notification) {
        this.i18nPipe = i18nPipe;
        this.notification = notification;
        this.dragLeave = new EventEmitter();
        this.dragOver = new EventEmitter();
        this.fileChange = new EventEmitter();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.onDragLeave = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        event.preventDefault();
        event.stopPropagation();
        this.timeout = setTimeout((/**
         * @return {?}
         */
        function () { return _this.dragLeave.emit(); }), 30);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.onDragOver = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.preventDefault();
        event.stopPropagation();
        clearTimeout(this.timeout);
        if (!this.disabled) {
            this.dragOver.emit();
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.onDrop = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.preventDefault();
        event.stopPropagation();
        this.getFilesFromDataTransferItems(event);
        this.dragLeave.emit();
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.getFilesFromDataTransferItems = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (!this.disabled) {
            this.invalidFileType = 0;
            if (this.directoryCompatible) {
                this.getOnlyDirectories(event.dataTransfer.items).then((/**
                 * @return {?}
                 */
                function () {
                    _this.sendFiles(event, _this.files);
                }));
            }
            else {
                /** @type {?} */
                var files = this.getOnlyFiles(event.dataTransfer.files);
                this.sendFiles(event, files);
            }
        }
    };
    // analisa as entradas recursivamente
    // analisa as entradas recursivamente
    /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.getFilesFromEntry = 
    // analisa as entradas recursivamente
    /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    function (entry) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var file;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!entry.isFile) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.readFile(entry)];
                    case 1:
                        file = _a.sent();
                        return [2 /*return*/, [file]];
                    case 2:
                        if (!entry.isDirectory) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.readDirectory(entry)];
                    case 3: return [2 /*return*/, _a.sent()];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @private
     * @param {?} dataTransferItems
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.getOnlyDirectories = /**
     * @private
     * @param {?} dataTransferItems
     * @return {?}
     */
    function (dataTransferItems) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var e_1, _a, e_2, _b, entries, dataTransferItems_1, dataTransferItems_1_1, item, entries_1, entries_1_1, entry, newFiles, e_2_1;
            return tslib_1.__generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        entries = [];
                        try {
                            // lista todas as entradas antes de analisá-las
                            for (dataTransferItems_1 = tslib_1.__values(dataTransferItems), dataTransferItems_1_1 = dataTransferItems_1.next(); !dataTransferItems_1_1.done; dataTransferItems_1_1 = dataTransferItems_1.next()) {
                                item = dataTransferItems_1_1.value;
                                entries.push(item.webkitGetAsEntry());
                            }
                        }
                        catch (e_1_1) { e_1 = { error: e_1_1 }; }
                        finally {
                            try {
                                if (dataTransferItems_1_1 && !dataTransferItems_1_1.done && (_a = dataTransferItems_1.return)) _a.call(dataTransferItems_1);
                            }
                            finally { if (e_1) throw e_1.error; }
                        }
                        this.files = [];
                        _c.label = 1;
                    case 1:
                        _c.trys.push([1, 7, 8, 9]);
                        entries_1 = tslib_1.__values(entries), entries_1_1 = entries_1.next();
                        _c.label = 2;
                    case 2:
                        if (!!entries_1_1.done) return [3 /*break*/, 6];
                        entry = entries_1_1.value;
                        if (!entry.isFile) return [3 /*break*/, 3];
                        this.invalidFileType++;
                        return [3 /*break*/, 5];
                    case 3: return [4 /*yield*/, this.getFilesFromEntry(entry)];
                    case 4:
                        newFiles = _c.sent();
                        this.files = this.files.concat(newFiles);
                        _c.label = 5;
                    case 5:
                        entries_1_1 = entries_1.next();
                        return [3 /*break*/, 2];
                    case 6: return [3 /*break*/, 9];
                    case 7:
                        e_2_1 = _c.sent();
                        e_2 = { error: e_2_1 };
                        return [3 /*break*/, 9];
                    case 8:
                        try {
                            if (entries_1_1 && !entries_1_1.done && (_b = entries_1.return)) _b.call(entries_1);
                        }
                        finally { if (e_2) throw e_2.error; }
                        return [7 /*endfinally*/];
                    case 9: return [2 /*return*/];
                }
            });
        });
    };
    // return only files. If it is a directory, invalidFileType counts.
    // return only files. If it is a directory, invalidFileType counts.
    /**
     * @private
     * @param {?} fileList
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.getOnlyFiles = 
    // return only files. If it is a directory, invalidFileType counts.
    /**
     * @private
     * @param {?} fileList
     * @return {?}
     */
    function (fileList) {
        var _this = this;
        return Array.from(fileList).reduce((/**
         * @param {?} newFiles
         * @param {?} file
         * @return {?}
         */
        function (newFiles, file) {
            if (file.type) {
                return newFiles.concat(file);
            }
            else {
                _this.invalidFileType++;
            }
            return newFiles;
        }), []);
    };
    /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.readFile = /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    function (entry) {
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            entry.file((/**
             * @param {?} file
             * @return {?}
             */
            function (file) {
                resolve(file);
            }));
        }));
    };
    /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.readDirectory = /**
     * @private
     * @param {?} entry
     * @return {?}
     */
    function (entry) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var dirReader, files, newFiles;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        dirReader = entry.createReader();
                        files = [];
                        return [4 /*yield*/, this.readDirectoryEntries(dirReader)];
                    case 1:
                        newFiles = _a.sent();
                        files = files.concat(newFiles);
                        return [2 /*return*/, files];
                }
            });
        });
    };
    /**
     * @private
     * @param {?} dirReader
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.readDirectoryEntries = /**
     * @private
     * @param {?} dirReader
     * @return {?}
     */
    function (dirReader) {
        var _this = this;
        return new Promise((/**
         * @param {?} resolve
         * @return {?}
         */
        function (resolve) {
            dirReader.readEntries((/**
             * @param {?} entries
             * @return {?}
             */
            function (entries) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
                var e_3, _a, files, entries_2, entries_2_1, entry, itemFiles, e_3_1;
                return tslib_1.__generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            files = [];
                            _b.label = 1;
                        case 1:
                            _b.trys.push([1, 6, 7, 8]);
                            entries_2 = tslib_1.__values(entries), entries_2_1 = entries_2.next();
                            _b.label = 2;
                        case 2:
                            if (!!entries_2_1.done) return [3 /*break*/, 5];
                            entry = entries_2_1.value;
                            return [4 /*yield*/, this.getFilesFromEntry(entry)];
                        case 3:
                            itemFiles = _b.sent();
                            files = files.concat(itemFiles);
                            _b.label = 4;
                        case 4:
                            entries_2_1 = entries_2.next();
                            return [3 /*break*/, 2];
                        case 5: return [3 /*break*/, 8];
                        case 6:
                            e_3_1 = _b.sent();
                            e_3 = { error: e_3_1 };
                            return [3 /*break*/, 8];
                        case 7:
                            try {
                                if (entries_2_1 && !entries_2_1.done && (_a = entries_2.return)) _a.call(entries_2);
                            }
                            finally { if (e_3) throw e_3.error; }
                            return [7 /*endfinally*/];
                        case 8:
                            resolve(files);
                            return [2 /*return*/];
                    }
                });
            }); }));
        }));
    };
    /**
     * @private
     * @param {?} invalidFiles
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.sendFeedback = /**
     * @private
     * @param {?} invalidFiles
     * @return {?}
     */
    function (invalidFiles) {
        if (invalidFiles) {
            this.setPipeArguments('invalidFileType', invalidFiles);
        }
    };
    /**
     * @private
     * @param {?} event
     * @param {?} files
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.sendFiles = /**
     * @private
     * @param {?} event
     * @param {?} files
     * @return {?}
     */
    function (event, files) {
        if (this.areaElement.contains(event.target)) {
            if (files.length > 0) {
                this.fileChange.emit(files);
            }
            this.sendFeedback(this.invalidFileType);
        }
        else {
            /** @type {?} */
            var invalidDropAreaArg = this.directoryCompatible ? this.literals.folders : this.literals.files;
            this.setPipeArguments('invalidDropArea', invalidDropAreaArg);
        }
    };
    // método responsável por setar os argumentos do i18nPipe.
    // método responsável por setar os argumentos do i18nPipe.
    /**
     * @private
     * @param {?} literalAttributes
     * @param {?=} args
     * @return {?}
     */
    PoUploadDragDropDirective.prototype.setPipeArguments = 
    // método responsável por setar os argumentos do i18nPipe.
    /**
     * @private
     * @param {?} literalAttributes
     * @param {?=} args
     * @return {?}
     */
    function (literalAttributes, args) {
        /** @type {?} */
        var pipeArguments = this.i18nPipe.transform(this.literals[literalAttributes], args);
        this.notification.information(pipeArguments);
    };
    PoUploadDragDropDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[p-upload-drag-drop]',
                    providers: [PoI18nPipe]
                },] }
    ];
    /** @nocollapse */
    PoUploadDragDropDirective.ctorParameters = function () { return [
        { type: PoI18nPipe },
        { type: PoNotificationService }
    ]; };
    PoUploadDragDropDirective.propDecorators = {
        areaElement: [{ type: Input, args: ['p-area-element',] }],
        directoryCompatible: [{ type: Input, args: ['p-directory-compatible',] }],
        disabled: [{ type: Input, args: ['p-disabled',] }],
        literals: [{ type: Input, args: ['p-literals',] }],
        dragLeave: [{ type: Output, args: ['p-drag-leave',] }],
        dragOver: [{ type: Output, args: ['p-drag-over',] }],
        fileChange: [{ type: Output, args: ['p-file-change',] }],
        onDragLeave: [{ type: HostListener, args: ['document:dragleave', ['$event'],] }],
        onDragOver: [{ type: HostListener, args: ['document:dragover', ['$event'],] }],
        onDrop: [{ type: HostListener, args: ['document:drop', ['$event'],] }]
    };
    return PoUploadDragDropDirective;
}());
export { PoUploadDragDropDirective };
if (false) {
    /** @type {?} */
    PoUploadDragDropDirective.prototype.timeout;
    /**
     * @type {?}
     * @private
     */
    PoUploadDragDropDirective.prototype.files;
    /**
     * @type {?}
     * @private
     */
    PoUploadDragDropDirective.prototype.invalidFileType;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.areaElement;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.directoryCompatible;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.disabled;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.literals;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.dragLeave;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.dragOver;
    /** @type {?} */
    PoUploadDragDropDirective.prototype.fileChange;
    /**
     * @type {?}
     * @private
     */
    PoUploadDragDropDirective.prototype.i18nPipe;
    /**
     * @type {?}
     * @private
     */
    PoUploadDragDropDirective.prototype.notification;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLWRyYWctZHJvcC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLXVwbG9hZC9wby11cGxvYWQtZHJhZy1kcm9wL3BvLXVwbG9hZC1kcmFnLWRyb3AuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFckYsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLDhEQUE4RCxDQUFDO0FBR3JHO0lBeUJFLG1DQUFvQixRQUFvQixFQUFVLFlBQW1DO1FBQWpFLGFBQVEsR0FBUixRQUFRLENBQVk7UUFBVSxpQkFBWSxHQUFaLFlBQVksQ0FBdUI7UUFON0QsY0FBUyxHQUFzQixJQUFJLFlBQVksRUFBTyxDQUFDO1FBRXhELGFBQVEsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVwRCxlQUFVLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7SUFFUSxDQUFDOzs7OztJQUUxQywrQ0FBVzs7OztJQUEzRCxVQUE0RCxLQUFLO1FBQWpFLGlCQUtDO1FBSkMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3ZCLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUV4QixJQUFJLENBQUMsT0FBTyxHQUFHLFVBQVU7OztRQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxFQUFyQixDQUFxQixHQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQzdELENBQUM7Ozs7O0lBRThDLDhDQUFVOzs7O0lBQXpELFVBQTBELEtBQUs7UUFDN0QsS0FBSyxDQUFDLGNBQWMsRUFBRSxD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QVEsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLElBQUksQ0FBQztRQUNyRixJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUMvQyxDQUFDOztnQkFuS0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxzQkFBc0I7b0JBQ2hDLFNBQVMsRUFBRSxDQUFFLFVBQVUsQ0FBRTtpQkFDMUI7Ozs7Z0JBUFEsVUFBVTtnQkFDVixxQkFBcUI7Ozs4QkFjM0IsS0FBSyxTQUFDLGdCQUFnQjtzQ0FFdEIsS0FBSyxTQUFDLHdCQUF3QjsyQkFFOUIsS0FBSyxTQUFDLFlBQVk7MkJBRWxCLEtBQUssU0FBQyxZQUFZOzRCQUVsQixNQUFNLFNBQUMsY0FBYzsyQkFFckIsTUFBTSxTQUFDLGFBQWE7NkJBRXBCLE1BQU0sU0FBQyxlQUFlOzhCQUl0QixZQUFZLFNBQUMsb0JBQW9CLEVBQUUsQ0FBQyxRQUFRLENBQUM7NkJBTzdDLFlBQVksU0FBQyxtQkFBbUIsRUFBRSxDQUFDLFFBQVEsQ0FBQzt5QkFXNUMsWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7SUF3SDNDLGdDQUFDO0NBQUEsQUFyS0QsSUFxS0M7U0FqS1kseUJBQXlCOzs7SUFFcEMsNENBQWE7Ozs7O0lBRWIsMENBQTJCOzs7OztJQUMzQixvREFBZ0M7O0lBRWhDLGdEQUFrRDs7SUFFbEQsd0RBQThEOztJQUU5RCw2Q0FBdUM7O0lBRXZDLDZDQUFnRDs7SUFFaEQsOENBQStFOztJQUUvRSw2Q0FBNkU7O0lBRTdFLCtDQUFpRjs7Ozs7SUFFckUsNkNBQTRCOzs7OztJQUFFLGlEQUEyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgRXZlbnRFbWl0dGVyLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmltcG9ydCB7IFBvSTE4blBpcGUgfSBmcm9tICcuLi8uLi8uLi8uLi9zZXJ2aWNlcy9wby1pMThuL3BvLWkxOG4ucGlwZSc7XHJcbmltcG9ydCB7IFBvTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uLy4uLy4uL3NlcnZpY2VzL3BvLW5vdGlmaWNhdGlvbi9wby1ub3RpZmljYXRpb24uc2VydmljZSc7XHJcbmltcG9ydCB7IFBvVXBsb2FkTGl0ZXJhbHMgfSBmcm9tICcuLi9pbnRlcmZhY2VzL3BvLXVwbG9hZC1saXRlcmFscy5pbnRlcmZhY2UnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbcC11cGxvYWQtZHJhZy1kcm9wXScsXHJcbiAgcHJvdmlkZXJzOiBbIFBvSTE4blBpcGUgXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUG9VcGxvYWREcmFnRHJvcERpcmVjdGl2ZSB7XHJcblxyXG4gIHRpbWVvdXQ6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBmaWxlczogQXJyYXk8RmlsZT47XHJcbiAgcHJpdmF0ZSBpbnZhbGlkRmlsZVR5cGU6IG51bWJlcjtcclxuXHJcbiAgQElucHV0KCdwLWFyZWEtZWxlbWVudCcpIGFyZWFFbGVtZW50OiBIVE1MRWxlbWVudDtcclxuXHJcbiAgQElucHV0KCdwLWRpcmVjdG9yeS1jb21wYXRpYmxlJykgZGlyZWN0b3J5Q29tcGF0aWJsZTogYm9vbGVhbjtcclxuXHJcbiAgQElucHV0KCdwLWRpc2FibGVkJykgZGlzYWJsZWQ6IGJvb2xlYW47XHJcblxyXG4gIEBJbnB1dCgncC1saXRlcmFscycpIGxpdGVyYWxzOiBQb1VwbG9hZExpdGVyYWxzO1xyXG5cclxuICBAT3V0cHV0KCdwLWRyYWctbGVhdmUnKSBkcmFnTGVhdmU6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBPdXRwdXQoJ3AtZHJhZy1vdmVyJykgZHJhZ092ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XHJcblxyXG4gIEBPdXRwdXQoJ3AtZmlsZS1jaGFuZ2UnKSBmaWxlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGkxOG5QaXBlOiBQb0kxOG5QaXBlLCBwcml2YXRlIG5vdGlmaWNhdGlvbjogUG9Ob3RpZmljYXRpb25TZXJ2aWNlKSB7IH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6ZHJhZ2xlYXZlJywgWyckZXZlbnQnXSkgb25EcmFnTGVhdmUoZXZlbnQpIHtcclxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuXHJcbiAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHRoaXMuZHJhZ0xlYXZlLmVtaXQoKSwgMzApO1xyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6ZHJhZ292ZXInLCBbJyRldmVudCddKSBvbkRyYWdPdmVyKGV2ZW50KSB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XHJcblxyXG4gICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMuZHJhZ092ZXIuZW1pdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6ZHJvcCcsIFsnJGV2ZW50J10pIG9uRHJvcChldmVudCkge1xyXG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG5cclxuICAgIHRoaXMuZ2V0RmlsZXNGcm9tRGF0YVRyYW5zZmVySXRlbXMoZXZlbnQpO1xyXG4gICAgdGhpcy5kcmFnTGVhdmUuZW1pdCgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXRGaWxlc0Zyb21EYXRhVHJhbnNmZXJJdGVtcyhldmVudDogRHJhZ0V2ZW50KSB7XHJcbiAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcclxuICAgICAgdGhpcy5pbnZhbGlkRmlsZVR5cGUgPSAwO1xyXG4gICAgICBpZiAodGhpcy5kaXJlY3RvcnlDb21wYXRpYmxlKSB7XHJcbiAgICAgICAgdGhpcy5nZXRPbmx5RGlyZWN0b3JpZXMoZXZlbnQuZGF0YVRyYW5zZmVyLml0ZW1zKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuc2VuZEZpbGVzKGV2ZW50LCB0aGlzLmZpbGVzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBmaWxlcyA9IHRoaXMuZ2V0T25seUZpbGVzKGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlcyk7XHJcbiAgICAgICAgdGhpcy5zZW5kRmlsZXMoZXZlbnQsIGZpbGVzKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLy8gYW5hbGlzYSBhcyBlbnRyYWRhcyByZWN1cnNpdmFtZW50ZVxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0RmlsZXNGcm9tRW50cnkoZW50cnkpIHtcclxuICAgIGlmIChlbnRyeS5pc0ZpbGUpIHtcclxuICAgICAgY29uc3QgZmlsZSA9IGF3YWl0IHRoaXMucmVhZEZpbGUoZW50cnkpO1xyXG4gICAgICByZXR1cm4gW2ZpbGVdO1xyXG4gICAgfSBlbHNlIGlmIChlbnRyeS5pc0RpcmVjdG9yeSkge1xyXG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZWFkRGlyZWN0b3J5KGVudHJ5KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgZ2V0T25seURpcmVjdG9yaWVzKGRhdGFUcmFuc2Zlckl0ZW1zKSB7XHJcbiAgICBjb25zdCBlbnRyaWVzID0gW107XHJcblxyXG4gICAgLy8gbGlzdGEgdG9kYXMgYXMgZW50cmFkYXMgYW50ZXMgZGUgYW5hbGlzw6EtbGFzXHJcbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZGF0YVRyYW5zZmVySXRlbXMpIHtcclxuICAgICAgZW50cmllcy5wdXNoKGl0ZW0ud2Via2l0R2V0QXNFbnRyeSgpKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmZpbGVzID0gW107XHJcbiAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcclxuICAgICAgaWYgKGVudHJ5LmlzRmlsZSkge1xyXG4gICAgICAgIHRoaXMuaW52YWxpZEZpbGVUeXBlKys7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgbmV3RmlsZXMgPSBhd2FpdCB0aGlzLmdldEZpbGVzRnJvbUVudHJ5KGVudHJ5KTtcclxuICAgICAgICB0aGlzLmZpbGVzID0gdGhpcy5maWxlcy5jb25jYXQobmV3RmlsZXMpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyByZXR1cm4gb25seSBmaWxlcy4gSWYgaXQgaXMgYSBkaXJlY3RvcnksIGludmFsaWRGaWxlVHlwZSBjb3VudHMuXHJcbiAgcHJpdmF0ZSBnZXRPbmx5RmlsZXMoZmlsZUxpc3Q6IEZpbGVMaXN0KTogQXJyYXk8RmlsZT4ge1xyXG4gICAgcmV0dXJuIEFycmF5LmZyb20oZmlsZUxpc3QpLnJlZHVjZSgobmV3RmlsZXMsIGZpbGUpID0+IHtcclxuICAgICAgaWYgKGZpbGUudHlwZSkge1xyXG4gICAgICAgIHJldHVybiBuZXdGaWxlcy5jb25jYXQoZmlsZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5pbnZhbGlkRmlsZVR5cGUrKztcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gbmV3RmlsZXM7XHJcbiAgICB9LCBbXSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHJlYWRGaWxlKGVudHJ5KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIGVudHJ5LmZpbGUoZmlsZSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShmaWxlKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgYXN5bmMgcmVhZERpcmVjdG9yeShlbnRyeSkge1xyXG4gICAgY29uc3QgZGlyUmVhZGVyID0gZW50cnkuY3JlYXRlUmVhZGVyKCk7XHJcbiAgICBsZXQgZmlsZXMgPSBbXTtcclxuICAgIGxldCBuZXdGaWxlcztcclxuXHJcbiAgICBuZXdGaWxlcyA9IGF3YWl0IHRoaXMucmVhZERpcmVjdG9yeUVudHJpZXMoZGlyUmVhZGVyKTtcclxuICAgIGZpbGVzID0gZmlsZXMuY29uY2F0KG5ld0ZpbGVzKTtcclxuICAgIHJldHVybiBmaWxlcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVhZERpcmVjdG9yeUVudHJpZXMoZGlyUmVhZGVyKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XHJcbiAgICAgIGRpclJlYWRlci5yZWFkRW50cmllcyhhc3luYyBlbnRyaWVzID0+IHtcclxuICAgICAgICBsZXQgZmlsZXMgPSBbXTtcclxuICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcclxuICAgICAgICAgIGNvbnN0IGl0ZW1GaWxlcyA9IGF3YWl0IHRoaXMuZ2V0RmlsZXNGcm9tRW50cnkoZW50cnkpO1xyXG4gICAgICAgICAgZmlsZXMgPSBmaWxlcy5jb25jYXQoaXRlbUZpbGVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb2x2ZShmaWxlcyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNlbmRGZWVkYmFjayhpbnZhbGlkRmlsZXM6IG51bWJlcikge1xyXG4gICAgaWYgKGludmFsaWRGaWxlcykge1xyXG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRGaWxlVHlwZScsIGludmFsaWRGaWxlcyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHNlbmRGaWxlcyhldmVudCwgZmlsZXMpIHtcclxuICAgIGlmICh0aGlzLmFyZWFFbGVtZW50LmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpIHtcclxuXHJcbiAgICAgIGlmIChmaWxlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgdGhpcy5maWxlQ2hhbmdlLmVtaXQoZmlsZXMpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNlbmRGZWVkYmFjayh0aGlzLmludmFsaWRGaWxlVHlwZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBpbnZhbGlkRHJvcEFyZWFBcmcgPSB0aGlzLmRpcmVjdG9yeUNvbXBhdGlibGUgPyB0aGlzLmxpdGVyYWxzLmZvbGRlcnMgOiB0aGlzLmxpdGVyYWxzLmZpbGVzO1xyXG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWREcm9wQXJlYScsIGludmFsaWREcm9wQXJlYUFyZyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBtw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3Igc2V0YXIgb3MgYXJndW1lbnRvcyBkbyBpMThuUGlwZS5cclxuICBwcml2YXRlIHNldFBpcGVBcmd1bWVudHMobGl0ZXJhbEF0dHJpYnV0ZXM6IHN0cmluZywgYXJncz8pIHtcclxuICAgIGNvbnN0IHBpcGVBcmd1bWVudHMgPSB0aGlzLmkxOG5QaXBlLnRyYW5zZm9ybSh0aGlzLmxpdGVyYWxzW2xpdGVyYWxBdHRyaWJ1dGVzXSwgYXJncyk7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvbi5pbmZvcm1hdGlvbihwaXBlQXJndW1lbnRzKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==