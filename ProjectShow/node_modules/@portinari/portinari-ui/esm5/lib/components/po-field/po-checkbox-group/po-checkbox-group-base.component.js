/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { convertToBoolean, convertToInt, uuid } from './../../../utils/util';
import { requiredFailed } from '../validators';
/** @type {?} */
var poCheckboxGroupColumnsDefaultLength = 6;
/** @type {?} */
var poCheckboxGroupColumnsTotalLength = 12;
/**
 * \@description
 *
 * O componente `po-checkbox-group` exibe uma lista de múltipla escolha onde o usuário pode marcar e desmarcar,
 * utilizando a tecla de espaço ou o clique do mouse, várias opções.
 *
 * > Para seleção única, utilize o [**Portinari Radio Group**](/documentation/po-radio-group).
 *
 * Por padrão, o po-checkbox-group retorna um array com os valores dos itens selecionados para o model.
 *
 * ```
 * favorites = ['PO', 'Angular'];
 * ```
 *
 * Na maioria das situações, o array com os objetos setados já atende as necessidades mas, caso o desenvolvedor
 * tenha necessidade de usar um valor indeterminado (`null`), ou seja, nem marcado (`true`) e nem desmarcado (`false`),
 * deve setar a propriedade `p-indeterminate` como `true`.
 *
 * Nesse caso, o po-checkbox-group vai retornar um objeto com todas as opções disponíveis e seus valores.
 *
 * ```
 * favorites = {
 *  PO: true,
 *  Angular: true,
 *  VueJS: false,
 *  React: null // indeterminado
 * };
 * ```
 */
var PoCheckboxGroupBaseComponent = /** @class */ (function () {
    function PoCheckboxGroupBaseComponent() {
        this.checkedOptions = {};
        this.checkedOptionsList = [];
        this.mdColumns = poCheckboxGroupColumnsDefaultLength;
        this._columns = poCheckboxGroupColumnsDefaultLength;
        this._disabled = false;
        this._indeterminate = false;
        this._required = false;
        // Função para atualizar o `ngModel` do componente, necessário quando não for utilizado dentro da tag form.
        this.ngModelChange = new EventEmitter();
        /**
         * Evento disparado ao alterar valor do campo
         */
        this.change = new EventEmitter();
    }
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "columns", {
        get: /**
         * @return {?}
         */
        function () {
            return this._columns;
        },
        /**
         * @optional
         *
         * @description
         *
         * Possibilita definir a quantidade de colunas para exibição dos itens do *checkbox*.
         * - É possível exibir as opções entre `1` e `4` colunas.
         * - Para resolução `sm` a colunagem invariavelmente passa para `1` coluna.
         * - Quando se trata de resolução `md` e o valor estabelecido para colunas for superior a `2`,
         * o *grid system* será composto por `2` colunas.
         * - Para evitar a quebra de linha, prefira a utilização de `1` coluna para opções com textos grandes.
         *
         * @default `2`
         *
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Possibilita definir a quantidade de colunas para exibição dos itens do *checkbox*.
         * - É possível exibir as opções entre `1` e `4` colunas.
         * - Para resolução `sm` a colunagem invariavelmente passa para `1` coluna.
         * - Quando se trata de resolução `md` e o valor estabelecido para colunas for superior a `2`,
         * o *grid system* será composto por `2` colunas.
         * - Para evitar a quebra de linha, prefira a utilização de `1` coluna para opções com textos grandes.
         *
         * \@default `2`
         *
         * @param {?} value
         * @return {?}
         */
        function (value) {
            /** @type {?} */
            var columns = convertToInt(value, poCheckboxGroupColumnsDefaultLength);
            this._columns = this.getGridSystemColumns(columns, 4);
            this.mdColumns = this.getGridSystemColumns(columns, 2);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "disabled", {
        get: /**
         * @return {?}
         */
        function () {
            return this._disabled;
        },
        /**
         * @optional
         *
         * @description
         *
         * Desabilita todos os itens do checkbox.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Desabilita todos os itens do checkbox.
         *
         * \@default `false`
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._disabled = convertToBoolean(value);
            this.validateModel(this.checkIndeterminate());
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "indeterminate", {
        get: /**
         * @return {?}
         */
        function () {
            return this._indeterminate;
        },
        /**
         * @optional
         *
         * @description
         *
         * Caso exista a necessidade de usar o valor indeterminado (`null`) dentro da lista de opções, é necessário setar
         * a propriedade `p-indeterminate` como `true`, por padrão essa propriedade vem desabilitada (`false`).
         *
         * Quando essa propriedade é setada como `true`, o *po-checkbox-group* passa a devolver um objeto completo para o
         * `ngModel`, diferente do array que contém apenas os valores selecionados.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Caso exista a necessidade de usar o valor indeterminado (`null`) dentro da lista de opções, é necessário setar
         * a propriedade `p-indeterminate` como `true`, por padrão essa propriedade vem desabilitada (`false`).
         *
         * Quando essa propriedade é setada como `true`, o *po-checkbox-group* passa a devolver um objeto completo para o
         * `ngModel`, diferente do array que contém apenas os valores selecionados.
         *
         * \@default `false`
         * @param {?} indeterminate
         * @return {?}
         */
        function (indeterminate) {
            this._indeterminate = convertToBoolean(indeterminate);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "options", {
        get: /**
         * @return {?}
         */
        function () {
            return this._options;
        },
        /**
         * @optional
         *
         * @description
         * Lista de opções que serão exibidas
         * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoCheckboxGroupOption
         */
        set: /**
         * \@optional
         *
         * \@description
         * Lista de opções que serão exibidas
         * Nesta propriedade deve ser definido um array de objetos que implementam a interface PoCheckboxGroupOption
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._options = Array.isArray(value) ? value : [];
            this.removeDuplicatedOptions();
            this.setCheckboxGroupOptionsView(this.options);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoCheckboxGroupBaseComponent.prototype, "required", {
        get: /**
         * @return {?}
         */
        function () {
            return this._required;
        },
        /**
         * @optional
         *
         * @description
         *
         * Define que o campo será obrigatório.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Define que o campo será obrigatório.
         *
         * \@default `false`
         * @param {?} required
         * @return {?}
         */
        function (required) {
            this._required = convertToBoolean(required);
            this.validateModel(this.checkIndeterminate());
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.changeValue = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var value = this.checkIndeterminate();
        if (this.propagateChange) {
            this.propagateChange(value);
        }
        else {
            this.ngModelChange.emit(value);
        }
        this.change.emit(value);
    };
    /**
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.checkIndeterminate = /**
     * @return {?}
     */
    function () {
        return this.indeterminate ? this.checkedOptions : this.checkedOptionsList;
    };
    /**
     * @param {?} value
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.checkOption = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (!this._disabled && !value.disabled) {
            this.checkOptionModel(value);
            this.changeValue();
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.propagateChange = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) { };
    /**
     * @param {?} optionsModel
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.writeValue = /**
     * @param {?} optionsModel
     * @return {?}
     */
    function (optionsModel) {
        if (optionsModel && this.checkedOptions !== optionsModel) {
            this.generateCheckOptions(optionsModel);
        }
        else {
            this.checkedOptionsList = [];
            this.checkedOptions = {};
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.registerOnValidatorChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.validatorChange = fn;
    };
    /**
     * @param {?} abstractControl
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.validate = /**
     * @param {?} abstractControl
     * @return {?}
     */
    function (abstractControl) {
        if ((!this.indeterminate && requiredFailed(this.required, this.disabled, abstractControl.value)) || this.isInvalidIndeterminate()) {
            return {
                required: {
                    valid: false,
                }
            };
        }
    };
    /**
     * @protected
     * @param {?} model
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.validateModel = /**
     * @protected
     * @param {?} model
     * @return {?}
     */
    function (model) {
        if (this.validatorChange) {
            this.validatorChange(model);
        }
    };
    /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.checkColumnsRange = /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    function (columns, maxColumns) {
        /** @type {?} */
        var minColumns = 1;
        return columns >= minColumns && columns <= maxColumns;
    };
    /**
     * @private
     * @param {?} optionChecked
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.checkOptionModel = /**
     * @private
     * @param {?} optionChecked
     * @return {?}
     */
    function (optionChecked) {
        this.checkedOptions[optionChecked.value] = !this.checkedOptions[optionChecked.value];
        if (!this.indeterminate && this.checkedOptionsList.includes(optionChecked.value)) {
            this.checkedOptionsList.splice(this.checkedOptionsList.indexOf(optionChecked.value), 1);
        }
        else if (!this.indeterminate) {
            this.checkedOptionsList.push(optionChecked.value);
        }
    };
    /**
     * @private
     * @param {?} optionsModel
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.generateCheckOptions = /**
     * @private
     * @param {?} optionsModel
     * @return {?}
     */
    function (optionsModel) {
        var _this = this;
        this.checkedOptions = {};
        if (optionsModel instanceof Array) {
            this.checkedOptionsList = optionsModel;
            this.options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            function (option) {
                _this.checkedOptions[option.value] = optionsModel.includes(option.value);
            }));
        }
        else {
            this.options.forEach((/**
             * @param {?} option
             * @return {?}
             */
            function (option) {
                optionsModel[option.value] = optionsModel[option.value] === undefined ? false : optionsModel[option.value];
                _this.checkedOptions = optionsModel;
            }));
        }
    };
    /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.getGridSystemColumns = /**
     * @private
     * @param {?} columns
     * @param {?} maxColumns
     * @return {?}
     */
    function (columns, maxColumns) {
        /** @type {?} */
        var gridSystemColumns = poCheckboxGroupColumnsTotalLength / columns;
        return this.checkColumnsRange(columns, maxColumns) ? gridSystemColumns : poCheckboxGroupColumnsDefaultLength;
    };
    /**
     * @private
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.isInvalidIndeterminate = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.indeterminate && this.required && this.checkedOptions) {
            return ((/** @type {?} */ (Object))).values(this.checkedOptions).every((/**
             * @param {?} value
             * @return {?}
             */
            function (value) { return value === false; }));
        }
        return false;
    };
    /**
     * @private
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.removeDuplicatedOptions = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        this.options.forEach((/**
         * @param {?} option
         * @param {?} index
         * @return {?}
         */
        function (option, index) {
            /** @type {?} */
            var duplicatedIndex = _this.options.findIndex((/**
             * @param {?} optionFind
             * @return {?}
             */
            function (optionFind) { return optionFind.value === option.value; })) === index;
            if (!duplicatedIndex) {
                _this.options.splice(_this.options.indexOf(option), 1);
            }
        }));
    };
    /**
     * @private
     * @param {?} optionsList
     * @return {?}
     */
    PoCheckboxGroupBaseComponent.prototype.setCheckboxGroupOptionsView = /**
     * @private
     * @param {?} optionsList
     * @return {?}
     */
    function (optionsList) {
        this.checkboxGroupOptionsView = optionsList.map((/**
         * @param {?} option
         * @return {?}
         */
        function (option) {
            return tslib_1.__assign({}, option, { id: uuid() });
        }));
    };
    PoCheckboxGroupBaseComponent.propDecorators = {
        name: [{ type: Input, args: ['name',] }],
        columns: [{ type: Input, args: ['p-columns',] }],
        disabled: [{ type: Input, args: ['p-disabled',] }],
        help: [{ type: Input, args: ['p-help',] }],
        indeterminate: [{ type: Input, args: ['p-indeterminate',] }],
        label: [{ type: Input, args: ['p-label',] }],
        optional: [{ type: Input, args: ['p-optional',] }],
        options: [{ type: Input, args: ['p-options',] }],
        required: [{ type: Input, args: ['p-required',] }],
        ngModelChange: [{ type: Output, args: ['ngModelChange',] }],
        change: [{ type: Output, args: ['p-change',] }]
    };
    return PoCheckboxGroupBaseComponent;
}());
export { PoCheckboxGroupBaseComponent };
if (false) {
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.checkboxGroupOptionsView;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.checkedOptions;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.checkedOptionsList;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.mdColumns;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.propagateChange;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.validatorChange;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._columns;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._disabled;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._indeterminate;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._options;
    /**
     * @type {?}
     * @private
     */
    PoCheckboxGroupBaseComponent.prototype._required;
    /**
     * Nome dos checkboxes
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.name;
    /**
     * Texto de apoio do campo
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.help;
    /**
     * Label do campo
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.label;
    /**
     * \@optional
     *
     * \@description
     *
     * Define se a indicação de campo opcional será exibida.
     *
     * > Não será exibida a indicação se:
     * - O campo conter `p-required`;
     * - Não possuir `p-help` e/ou `p-label`.
     *
     * \@default `false`
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.optional;
    /** @type {?} */
    PoCheckboxGroupBaseComponent.prototype.ngModelChange;
    /**
     * Evento disparado ao alterar valor do campo
     * @type {?}
     */
    PoCheckboxGroupBaseComponent.prototype.change;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tY2hlY2tib3gtZ3JvdXAtYmFzZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9ydGluYXJpL3BvcnRpbmFyaS11aS8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLWZpZWxkL3BvLWNoZWNrYm94LWdyb3VwL3BvLWNoZWNrYm94LWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTVELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDN0UsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7SUFLekMsbUNBQW1DLEdBQVcsQ0FBQzs7SUFDL0MsaUNBQWlDLEdBQVcsRUFBRTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBK0JwRDtJQUFBO1FBR0UsbUJBQWMsR0FBUSxFQUFFLENBQUM7UUFDekIsdUJBQWtCLEdBQVEsRUFBRSxDQUFDO1FBQzdCLGNBQVMsR0FBVyxtQ0FBbUMsQ0FBQztRQUloRCxhQUFRLEdBQVcsbUNBQW1DLENBQUM7UUFDdkQsY0FBUyxHQUFhLEtBQUssQ0FBQztRQUM1QixtQkFBYyxHQUFhLEtBQUssQ0FBQztRQUVqQyxjQUFTLEdBQWEsS0FBSyxDQUFDOztRQWlJWCxrQkFBYSxHQUF1QixJQUFJLFlBQVksRUFBTyxDQUFDOzs7O1FBR2pFLFdBQU0sR0FBdUIsSUFBSSxZQUFZLEVBQU8sQ0FBQztJQThIM0UsQ0FBQztJQTlPQyxzQkFBd0IsaURBQU87Ozs7UUFPL0I7WUFDRSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7UUFDdkIsQ0FBQztRQXhCRDs7Ozs7Ozs7Ozs7Ozs7V0FjRzs7Ozs7Ozs7Ozs7Ozs7Ozs7O1FBQ0gsVUFBZ0MsS0FBYTs7Z0JBQ3JDLE9BQU8sR0FB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Q0FBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIENvbnRyb2xWYWx1ZUFjY2Vzc29yLCBWYWxpZGF0b3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIElucHV0LCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgY29udmVydFRvQm9vbGVhbiwgY29udmVydFRvSW50LCB1dWlkIH0gZnJvbSAnLi8uLi8uLi8uLi91dGlscy91dGlsJztcbmltcG9ydCB7IHJlcXVpcmVkRmFpbGVkIH0gZnJvbSAnLi4vdmFsaWRhdG9ycyc7XG5cbmltcG9ydCB7IFBvQ2hlY2tib3hHcm91cE9wdGlvbiB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1jaGVja2JveC1ncm91cC1vcHRpb24uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvQ2hlY2tib3hHcm91cE9wdGlvblZpZXcgfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tY2hlY2tib3gtZ3JvdXAtb3B0aW9uLXZpZXcuaW50ZXJmYWNlJztcblxuY29uc3QgcG9DaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg6IG51bWJlciA9IDY7XG5jb25zdCBwb0NoZWNrYm94R3JvdXBDb2x1bW5zVG90YWxMZW5ndGg6IG51bWJlciA9IDEyO1xuXG4vKipcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIE8gY29tcG9uZW50ZSBgcG8tY2hlY2tib3gtZ3JvdXBgIGV4aWJlIHVtYSBsaXN0YSBkZSBtw7psdGlwbGEgZXNjb2xoYSBvbmRlIG8gdXN1w6FyaW8gcG9kZSBtYXJjYXIgZSBkZXNtYXJjYXIsXG4gKiB1dGlsaXphbmRvIGEgdGVjbGEgZGUgZXNwYcOnbyBvdSBvIGNsaXF1ZSBkbyBtb3VzZSwgdsOhcmlhcyBvcMOnw7Vlcy5cbiAqXG4gKiA+IFBhcmEgc2VsZcOnw6NvIMO6bmljYSwgdXRpbGl6ZSBvIFsqKlBvcnRpbmFyaSBSYWRpbyBHcm91cCoqXSgvZG9jdW1lbnRhdGlvbi9wby1yYWRpby1ncm91cCkuXG4gKlxuICogUG9yIHBhZHLDo28sIG8gcG8tY2hlY2tib3gtZ3JvdXAgcmV0b3JuYSB1bSBhcnJheSBjb20gb3MgdmFsb3JlcyBkb3MgaXRlbnMgc2VsZWNpb25hZG9zIHBhcmEgbyBtb2RlbC5cbiAqXG4gKiBgYGBcbiAqIGZhdm9yaXRlcyA9IFsnUE8nLCAnQW5ndWxhciddO1xuICogYGBgXG4gKlxuICogTmEgbWFpb3JpYSBkYXMgc2l0dWHDp8O1ZXMsIG8gYXJyYXkgY29tIG9zIG9iamV0b3Mgc2V0YWRvcyBqw6EgYXRlbmRlIGFzIG5lY2Vzc2lkYWRlcyBtYXMsIGNhc28gbyBkZXNlbnZvbHZlZG9yXG4gKiB0ZW5oYSBuZWNlc3NpZGFkZSBkZSB1c2FyIHVtIHZhbG9yIGluZGV0ZXJtaW5hZG8gKGBudWxsYCksIG91IHNlamEsIG5lbSBtYXJjYWRvIChgdHJ1ZWApIGUgbmVtIGRlc21hcmNhZG8gKGBmYWxzZWApLFxuICogZGV2ZSBzZXRhciBhIHByb3ByaWVkYWRlIGBwLWluZGV0ZXJtaW5hdGVgIGNvbW8gYHRydWVgLlxuICpcbiAqIE5lc3NlIGNhc28sIG8gcG8tY2hlY2tib3gtZ3JvdXAgdmFpIHJldG9ybmFyIHVtIG9iamV0byBjb20gdG9kYXMgYXMgb3DDp8O1ZXMgZGlzcG9uw612ZWlzIGUgc2V1cyB2YWxvcmVzLlxuICpcbiAqIGBgYFxuICogZmF2b3JpdGVzID0ge1xuICogIFBPOiB0cnVlLFxuICogIEFuZ3VsYXI6IHRydWUsXG4gKiAgVnVlSlM6IGZhbHNlLFxuICogIFJlYWN0OiBudWxsIC8vIGluZGV0ZXJtaW5hZG9cbiAqIH07XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNsYXNzIFBvQ2hlY2tib3hHcm91cEJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciwgVmFsaWRhdG9yIHtcblxuICBjaGVja2JveEdyb3VwT3B0aW9uc1ZpZXc6IEFycmF5PFBvQ2hlY2tib3hHcm91cE9wdGlvblZpZXc+O1xuICBjaGVja2VkT3B0aW9uczogYW55ID0ge307XG4gIGNoZWNrZWRPcHRpb25zTGlzdDogYW55ID0gW107XG4gIG1kQ29sdW1uczogbnVtYmVyID0gcG9DaGVja2JveEdyb3VwQ29sdW1uc0RlZmF1bHRMZW5ndGg7XG4gIHByb3BhZ2F0ZUNoYW5nZTogYW55O1xuICB2YWxpZGF0b3JDaGFuZ2U6IGFueTtcblxuICBwcml2YXRlIF9jb2x1bW5zOiBudW1iZXIgPSBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aDtcbiAgcHJpdmF0ZSBfZGlzYWJsZWQ/OiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX2luZGV0ZXJtaW5hdGU/OiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX29wdGlvbnM/OiBBcnJheTxQb0NoZWNrYm94R3JvdXBPcHRpb24+O1xuICBwcml2YXRlIF9yZXF1aXJlZD86IGJvb2xlYW4gPSBmYWxzZTtcblxuICAvKiogTm9tZSBkb3MgY2hlY2tib3hlcyAqL1xuICBASW5wdXQoJ25hbWUnKSBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogUG9zc2liaWxpdGEgZGVmaW5pciBhIHF1YW50aWRhZGUgZGUgY29sdW5hcyBwYXJhIGV4aWJpw6fDo28gZG9zIGl0ZW5zIGRvICpjaGVja2JveCouXG4gICAqIC0gw4kgcG9zc8OtdmVsIGV4aWJpciBhcyBvcMOnw7VlcyBlbnRyZSBgMWAgZSBgNGAgY29sdW5hcy5cbiAgICogLSBQYXJhIHJlc29sdcOnw6NvIGBzbWAgYSBjb2x1bmFnZW0gaW52YXJpYXZlbG1lbnRlIHBhc3NhIHBhcmEgYDFgIGNvbHVuYS5cbiAgICogLSBRdWFuZG8gc2UgdHJhdGEgZGUgcmVzb2x1w6fDo28gYG1kYCBlIG8gdmFsb3IgZXN0YWJlbGVjaWRvIHBhcmEgY29sdW5hcyBmb3Igc3VwZXJpb3IgYSBgMmAsXG4gICAqIG8gKmdyaWQgc3lzdGVtKiBzZXLDoSBjb21wb3N0byBwb3IgYDJgIGNvbHVuYXMuXG4gICAqIC0gUGFyYSBldml0YXIgYSBxdWVicmEgZGUgbGluaGEsIHByZWZpcmEgYSB1dGlsaXphw6fDo28gZGUgYDFgIGNvbHVuYSBwYXJhIG9ww6fDtWVzIGNvbSB0ZXh0b3MgZ3JhbmRlcy5cbiAgICpcbiAgICogQGRlZmF1bHQgYDJgXG4gICAqXG4gICAqL1xuICBASW5wdXQoJ3AtY29sdW1ucycpIHNldCBjb2x1bW5zKHZhbHVlOiBudW1iZXIpIHtcbiAgICBjb25zdCBjb2x1bW5zID0gY29udmVydFRvSW50KHZhbHVlLCBwb0NoZWNrYm94R3JvdXBDb2x1bW5zRGVmYXVsdExlbmd0aCk7XG5cbiAgICB0aGlzLl9jb2x1bW5zID0gdGhpcy5nZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zLCA0KTtcbiAgICB0aGlzLm1kQ29sdW1ucyA9IHRoaXMuZ2V0R3JpZFN5c3RlbUNvbHVtbnMoY29sdW1ucywgMik7XG4gIH1cblxuICBnZXQgY29sdW1ucygpIHtcbiAgICByZXR1cm4gdGhpcy5fY29sdW1ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIERlc2FiaWxpdGEgdG9kb3Mgb3MgaXRlbnMgZG8gY2hlY2tib3guXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1kaXNhYmxlZCcpIHNldCBkaXNhYmxlZCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2Rpc2FibGVkID0gY29udmVydFRvQm9vbGVhbih2YWx1ZSk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTW9kZWwodGhpcy5jaGVja0luZGV0ZXJtaW5hdGUoKSk7XG4gIH1cblxuICBnZXQgZGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xuICB9XG5cbiAgLyoqIFRleHRvIGRlIGFwb2lvIGRvIGNhbXBvICovXG4gIEBJbnB1dCgncC1oZWxwJykgaGVscD86IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBDYXNvIGV4aXN0YSBhIG5lY2Vzc2lkYWRlIGRlIHVzYXIgbyB2YWxvciBpbmRldGVybWluYWRvIChgbnVsbGApIGRlbnRybyBkYSBsaXN0YSBkZSBvcMOnw7Vlcywgw6kgbmVjZXNzw6FyaW8gc2V0YXJcbiAgICogYSBwcm9wcmllZGFkZSBgcC1pbmRldGVybWluYXRlYCBjb21vIGB0cnVlYCwgcG9yIHBhZHLDo28gZXNzYSBwcm9wcmllZGFkZSB2ZW0gZGVzYWJpbGl0YWRhIChgZmFsc2VgKS5cbiAgICpcbiAgICogUXVhbmRvIGVzc2EgcHJvcHJpZWRhZGUgw6kgc2V0YWRhIGNvbW8gYHRydWVgLCBvICpwby1jaGVja2JveC1ncm91cCogcGFzc2EgYSBkZXZvbHZlciB1bSBvYmpldG8gY29tcGxldG8gcGFyYSBvXG4gICAqIGBuZ01vZGVsYCwgZGlmZXJlbnRlIGRvIGFycmF5IHF1ZSBjb250w6ltIGFwZW5hcyBvcyB2YWxvcmVzIHNlbGVjaW9uYWRvcy5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWluZGV0ZXJtaW5hdGUnKSBzZXQgaW5kZXRlcm1pbmF0ZShpbmRldGVybWluYXRlOiBib29sZWFuKSB7XG4gICAgdGhpcy5faW5kZXRlcm1pbmF0ZSA9IGNvbnZlcnRUb0Jvb2xlYW4oaW5kZXRlcm1pbmF0ZSk7XG4gIH1cblxuICBnZXQgaW5kZXRlcm1pbmF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5kZXRlcm1pbmF0ZTtcbiAgfVxuXG4gIC8qKiBMYWJlbCBkbyBjYW1wbyAqL1xuICBASW5wdXQoJ3AtbGFiZWwnKSBsYWJlbD86IHN0cmluZztcblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBEZWZpbmUgc2UgYSBpbmRpY2HDp8OjbyBkZSBjYW1wbyBvcGNpb25hbCBzZXLDoSBleGliaWRhLlxuICAgKlxuICAgKiA+IE7Do28gc2Vyw6EgZXhpYmlkYSBhIGluZGljYcOnw6NvIHNlOlxuICAgKiAtIE8gY2FtcG8gY29udGVyIGBwLXJlcXVpcmVkYDtcbiAgICogLSBOw6NvIHBvc3N1aXIgYHAtaGVscGAgZS9vdSBgcC1sYWJlbGAuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1vcHRpb25hbCcpIG9wdGlvbmFsOiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIExpc3RhIGRlIG9ww6fDtWVzIHF1ZSBzZXLDo28gZXhpYmlkYXNcbiAgICogTmVzdGEgcHJvcHJpZWRhZGUgZGV2ZSBzZXIgZGVmaW5pZG8gdW0gYXJyYXkgZGUgb2JqZXRvcyBxdWUgaW1wbGVtZW50YW0gYSBpbnRlcmZhY2UgUG9DaGVja2JveEdyb3VwT3B0aW9uXG4gICAqL1xuICBASW5wdXQoJ3Atb3B0aW9ucycpIHNldCBvcHRpb25zKHZhbHVlOiBBcnJheTxQb0NoZWNrYm94R3JvdXBPcHRpb24+KSB7XG4gICAgdGhpcy5fb3B0aW9ucyA9IEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUgOiBbXTtcbiAgICB0aGlzLnJlbW92ZUR1cGxpY2F0ZWRPcHRpb25zKCk7XG4gICAgdGhpcy5zZXRDaGVja2JveEdyb3VwT3B0aW9uc1ZpZXcodGhpcy5vcHRpb25zKTtcbiAgfVxuXG4gIGdldCBvcHRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGVmaW5lIHF1ZSBvIGNhbXBvIHNlcsOhIG9icmlnYXTDs3Jpby5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLXJlcXVpcmVkJykgc2V0IHJlcXVpcmVkKHJlcXVpcmVkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fcmVxdWlyZWQgPSBjb252ZXJ0VG9Cb29sZWFuKHJlcXVpcmVkKTtcblxuICAgIHRoaXMudmFsaWRhdGVNb2RlbCh0aGlzLmNoZWNrSW5kZXRlcm1pbmF0ZSgpKTtcbiAgfVxuXG4gIGdldCByZXF1aXJlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWlyZWQ7XG4gIH1cblxuICAvLyBGdW7Dp8OjbyBwYXJhIGF0dWFsaXphciBvIGBuZ01vZGVsYCBkbyBjb21wb25lbnRlLCBuZWNlc3PDoXJpbyBxdWFuZG8gbsOjbyBmb3IgdXRpbGl6YWRvIGRlbnRybyBkYSB0YWcgZm9ybS5cbiAgQE91dHB1dCgnbmdNb2RlbENoYW5nZScpIG5nTW9kZWxDaGFuZ2U/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKiBFdmVudG8gZGlzcGFyYWRvIGFvIGFsdGVyYXIgdmFsb3IgZG8gY2FtcG8gKi9cbiAgQE91dHB1dCgncC1jaGFuZ2UnKSBjaGFuZ2U/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIGNoYW5nZVZhbHVlKCkge1xuXG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmNoZWNrSW5kZXRlcm1pbmF0ZSgpO1xuXG4gICAgaWYgKHRoaXMucHJvcGFnYXRlQ2hhbmdlKSB7XG4gICAgICB0aGlzLnByb3BhZ2F0ZUNoYW5nZSh2YWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmdNb2RlbENoYW5nZS5lbWl0KHZhbHVlKTtcbiAgICB9XG5cbiAgICB0aGlzLmNoYW5nZS5lbWl0KHZhbHVlKTtcbiAgfVxuXG4gIGNoZWNrSW5kZXRlcm1pbmF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5pbmRldGVybWluYXRlID8gdGhpcy5jaGVja2VkT3B0aW9ucyA6IHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0O1xuICB9XG5cbiAgY2hlY2tPcHRpb24odmFsdWU6IFBvQ2hlY2tib3hHcm91cE9wdGlvbikge1xuICAgIGlmICghdGhpcy5fZGlzYWJsZWQgJiYgIXZhbHVlLmRpc2FibGVkKSB7XG4gICAgICB0aGlzLmNoZWNrT3B0aW9uTW9kZWwodmFsdWUpO1xuICAgICAgdGhpcy5jaGFuZ2VWYWx1ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMucHJvcGFnYXRlQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7IH1cblxuICB3cml0ZVZhbHVlKG9wdGlvbnNNb2RlbDogYW55KSB7XG4gICAgaWYgKG9wdGlvbnNNb2RlbCAmJiB0aGlzLmNoZWNrZWRPcHRpb25zICE9PSBvcHRpb25zTW9kZWwpIHtcbiAgICAgIHRoaXMuZ2VuZXJhdGVDaGVja09wdGlvbnMob3B0aW9uc01vZGVsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jaGVja2VkT3B0aW9uc0xpc3QgPSBbXTtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnMgPSB7fTtcbiAgICB9XG4gIH1cblxuICByZWdpc3Rlck9uVmFsaWRhdG9yQ2hhbmdlKGZuOiAoKSA9PiB2b2lkKSB7XG4gICAgdGhpcy52YWxpZGF0b3JDaGFuZ2UgPSBmbjtcbiAgfVxuXG4gIHZhbGlkYXRlKGFic3RyYWN0Q29udHJvbDogQWJzdHJhY3RDb250cm9sKTogeyBba2V5OiBzdHJpbmddOiBhbnk7IH0ge1xuXG4gICAgaWYgKCghdGhpcy5pbmRldGVybWluYXRlICYmIHJlcXVpcmVkRmFpbGVkKHRoaXMucmVxdWlyZWQsIHRoaXMuZGlzYWJsZWQsIGFic3RyYWN0Q29udHJvbC52YWx1ZSkpIHx8IHRoaXMuaXNJbnZhbGlkSW5kZXRlcm1pbmF0ZSgpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZXF1aXJlZDoge1xuICAgICAgICAgIHZhbGlkOiBmYWxzZSxcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG5cbiAgfVxuXG4gIHByb3RlY3RlZCB2YWxpZGF0ZU1vZGVsKG1vZGVsOiBhbnkpIHtcbiAgICBpZiAodGhpcy52YWxpZGF0b3JDaGFuZ2UpIHtcbiAgICAgIHRoaXMudmFsaWRhdG9yQ2hhbmdlKG1vZGVsKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrQ29sdW1uc1JhbmdlKGNvbHVtbnMsIG1heENvbHVtbnMpOiBib29sZWFuIHtcbiAgICBjb25zdCBtaW5Db2x1bW5zID0gMTtcblxuICAgIHJldHVybiBjb2x1bW5zID49IG1pbkNvbHVtbnMgJiYgY29sdW1ucyA8PSBtYXhDb2x1bW5zO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja09wdGlvbk1vZGVsKG9wdGlvbkNoZWNrZWQ6IFBvQ2hlY2tib3hHcm91cE9wdGlvbikge1xuICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNbb3B0aW9uQ2hlY2tlZC52YWx1ZV0gPSAhdGhpcy5jaGVja2VkT3B0aW9uc1tvcHRpb25DaGVja2VkLnZhbHVlXTtcblxuICAgIGlmICghdGhpcy5pbmRldGVybWluYXRlICYmIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LmluY2x1ZGVzKG9wdGlvbkNoZWNrZWQudmFsdWUpKSB7XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdC5zcGxpY2UodGhpcy5jaGVja2VkT3B0aW9uc0xpc3QuaW5kZXhPZihvcHRpb25DaGVja2VkLnZhbHVlKSwgMSk7XG5cbiAgICB9IGVsc2UgaWYgKCF0aGlzLmluZGV0ZXJtaW5hdGUpIHtcbiAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNMaXN0LnB1c2gob3B0aW9uQ2hlY2tlZC52YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNoZWNrT3B0aW9ucyhvcHRpb25zTW9kZWw6IGFueSkge1xuXG4gICAgdGhpcy5jaGVja2VkT3B0aW9ucyA9IHt9O1xuXG4gICAgaWYgKG9wdGlvbnNNb2RlbCBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICB0aGlzLmNoZWNrZWRPcHRpb25zTGlzdCA9IG9wdGlvbnNNb2RlbDtcblxuICAgICAgdGhpcy5vcHRpb25zLmZvckVhY2goKG9wdGlvbjogUG9DaGVja2JveEdyb3VwT3B0aW9uKSA9PiB7XG4gICAgICAgIHRoaXMuY2hlY2tlZE9wdGlvbnNbb3B0aW9uLnZhbHVlXSA9IG9wdGlvbnNNb2RlbC5pbmNsdWRlcyhvcHRpb24udmFsdWUpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3B0aW9ucy5mb3JFYWNoKChvcHRpb246IFBvQ2hlY2tib3hHcm91cE9wdGlvbikgPT4ge1xuICAgICAgICBvcHRpb25zTW9kZWxbb3B0aW9uLnZhbHVlXSA9IG9wdGlvbnNNb2RlbFtvcHRpb24udmFsdWVdID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IG9wdGlvbnNNb2RlbFtvcHRpb24udmFsdWVdO1xuICAgICAgICB0aGlzLmNoZWNrZWRPcHRpb25zID0gb3B0aW9uc01vZGVsO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRHcmlkU3lzdGVtQ29sdW1ucyhjb2x1bW5zOiBudW1iZXIsIG1heENvbHVtbnM6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgZ3JpZFN5c3RlbUNvbHVtbnMgPSBwb0NoZWNrYm94R3JvdXBDb2x1bW5zVG90YWxMZW5ndGggLyBjb2x1bW5zO1xuXG4gICAgcmV0dXJuIHRoaXMuY2hlY2tDb2x1bW5zUmFuZ2UoY29sdW1ucywgbWF4Q29sdW1ucykgPyBncmlkU3lzdGVtQ29sdW1ucyA6IHBvQ2hlY2tib3hHcm91cENvbHVtbnNEZWZhdWx0TGVuZ3RoO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0ludmFsaWRJbmRldGVybWluYXRlKCkge1xuICAgIGlmICh0aGlzLmluZGV0ZXJtaW5hdGUgJiYgdGhpcy5yZXF1aXJlZCAmJiB0aGlzLmNoZWNrZWRPcHRpb25zKSB7XG4gICAgICByZXR1cm4gKDxhbnk+T2JqZWN0KS52YWx1ZXModGhpcy5jaGVja2VkT3B0aW9ucykuZXZlcnkodmFsdWUgPT4gdmFsdWUgPT09IGZhbHNlKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVEdXBsaWNhdGVkT3B0aW9ucygpIHtcbiAgICB0aGlzLm9wdGlvbnMuZm9yRWFjaCgob3B0aW9uLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgZHVwbGljYXRlZEluZGV4ID0gdGhpcy5vcHRpb25zLmZpbmRJbmRleCgob3B0aW9uRmluZDogYW55KSA9PiBvcHRpb25GaW5kLnZhbHVlID09PSBvcHRpb24udmFsdWUpID09PSBpbmRleDtcbiAgICAgIGlmICghZHVwbGljYXRlZEluZGV4KSB7XG4gICAgICAgIHRoaXMub3B0aW9ucy5zcGxpY2UodGhpcy5vcHRpb25zLmluZGV4T2Yob3B0aW9uKSwgMSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHNldENoZWNrYm94R3JvdXBPcHRpb25zVmlldyhvcHRpb25zTGlzdDogQXJyYXk8UG9DaGVja2JveEdyb3VwT3B0aW9uPikge1xuICAgIHRoaXMuY2hlY2tib3hHcm91cE9wdGlvbnNWaWV3ID0gb3B0aW9uc0xpc3QubWFwKG9wdGlvbiA9PiB7XG4gICAgICByZXR1cm4geyAuLi5vcHRpb24sIGlkOiB1dWlkKCkgfTtcbiAgICB9KTtcbiAgfVxuXG59XG4iXX0=