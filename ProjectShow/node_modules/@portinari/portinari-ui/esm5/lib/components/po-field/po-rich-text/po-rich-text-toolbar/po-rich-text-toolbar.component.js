/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ElementRef, EventEmitter, Input, Output, ViewChild } from '@angular/core';
import { isIE } from '../../../../utils/util';
import { PoLanguageService } from '../../../../services/po-language/po-language.service';
import { poRichTextLiteralsDefault } from '../po-rich-text-literals';
import { PoRichTextModalType } from '../enums/po-rich-text-modal-type.enum';
/** @type {?} */
var poRichTextDefaultColor = '#000000';
var PoRichTextToolbarComponent = /** @class */ (function () {
    function PoRichTextToolbarComponent(languageService) {
        var _this = this;
        this.languageService = languageService;
        this.selection = document.getSelection();
        this.literals = tslib_1.__assign({}, poRichTextLiteralsDefault[this.languageService.getShortLanguage()]);
        this.alignButtons = [
            {
                command: 'justifyleft',
                icon: 'po-icon-align-left',
                tooltip: this.literals.left,
                action: this.emitAlignCommand.bind(this, 'justifyleft'),
                selected: true
            },
            {
                command: 'justifycenter',
                icon: 'po-icon-align-center',
                tooltip: this.literals.center,
                action: this.emitAlignCommand.bind(this, 'justifycenter')
            },
            {
                command: 'justifyright',
                icon: 'po-icon-align-right',
                tooltip: this.literals.right,
                action: this.emitAlignCommand.bind(this, 'justifyright')
            },
            {
                command: 'justifyfull',
                icon: 'po-icon-align-justify',
                tooltip: this.literals.justify,
                action: this.emitAlignCommand.bind(this, 'justifyfull')
            }
        ];
        this.formatButtons = [
            {
                command: 'bold',
                icon: 'po-icon-text-bold',
                tooltip: this.literals.bold,
                action: this.emitCommand.bind(this, 'bold')
            },
            {
                command: 'italic',
                icon: 'po-icon-text-italic',
                tooltip: this.literals.italic,
                action: this.emitCommand.bind(this, 'italic')
            },
            {
                command: 'underline',
                icon: 'po-icon-text-underline',
                tooltip: this.literals.underline,
                action: this.emitCommand.bind(this, 'underline')
            }
        ];
        this.listButtons = [
            {
                command: 'insertUnorderedList',
                icon: 'po-icon-list',
                tooltip: this.literals.unorderedList,
                action: this.emitCommand.bind(this, 'insertUnorderedList')
            }
        ];
        this.linkButtons = [
            {
                command: 'Createlink',
                icon: 'po-icon-link',
                tooltip: this.literals.insertLink + " (Ctrl + L)",
                action: (/**
                 * @return {?}
                 */
                function () { return _this.modal.emit(PoRichTextModalType.Link); })
            }
        ];
        this.mediaButtons = [
            {
                tooltip: this.literals.insertImage,
                icon: 'po-icon-picture',
                action: (/**
                 * @return {?}
                 */
                function () { return _this.modal.emit(PoRichTextModalType.Image); })
            }
        ];
        this.command = new EventEmitter();
        this.modal = new EventEmitter();
    }
    Object.defineProperty(PoRichTextToolbarComponent.prototype, "readonly", {
        get: /**
         * @return {?}
         */
        function () {
            return this._readonly;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._readonly = value;
            this.toggleDisableButtons(this._readonly);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoRichTextToolbarComponent.prototype, "isInternetExplorer", {
        get: /**
         * @return {?}
         */
        function () {
            return isIE();
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.removeButtonFocus();
        this.setColorInColorPicker(poRichTextDefaultColor);
    };
    /**
     * @param {?} value
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.changeTextColor = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        /** @type {?} */
        var command = 'foreColor';
        this.command.emit({ command: command, value: value });
    };
    /**
     * @param {?} obj
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.setButtonsStates = /**
     * @param {?} obj
     * @return {?}
     */
    function (obj) {
        if (!this.readonly) {
            this.alignButtons.forEach((/**
             * @param {?} button
             * @return {?}
             */
            function (button) { return button.selected = obj.commands.includes(button.command); }));
            this.formatButtons.forEach((/**
             * @param {?} button
             * @return {?}
             */
            function (button) { return button.selected = obj.commands.includes(button.command); }));
            this.listButtons[0].selected = obj.commands.includes(this.listButtons[0].command);
            this.linkButtons[0].selected = obj.commands.includes(this.linkButtons[0].command);
            this.setColorInColorPicker(obj.hexColor);
        }
    };
    /**
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.shortcutTrigger = /**
     * @return {?}
     */
    function () {
        this.modal.emit(PoRichTextModalType.Link);
    };
    /**
     * @private
     * @param {?} command
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.emitAlignCommand = /**
     * @private
     * @param {?} command
     * @return {?}
     */
    function (command) {
        /** @type {?} */
        var index = this.alignButtons.findIndex((/**
         * @param {?} btn
         * @return {?}
         */
        function (btn) { return btn.command === command; }));
        if (this.alignButtons[index].selected) {
            this.alignButtons[index].selected = false;
        }
        this.command.emit(command);
    };
    /**
     * @private
     * @param {?} command
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.emitCommand = /**
     * @private
     * @param {?} command
     * @return {?}
     */
    function (command) {
        this.command.emit(command);
    };
    /**
     * @private
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.removeButtonFocus = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var buttons = this.toolbarElement.nativeElement.querySelectorAll('button');
        buttons.forEach((/**
         * @param {?} button
         * @return {?}
         */
        function (button) { return button.setAttribute('tabindex', '-1'); }));
    };
    /**
     * @private
     * @param {?} color
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.setColorInColorPicker = /**
     * @private
     * @param {?} color
     * @return {?}
     */
    function (color) {
        this.colorPickerInput.nativeElement.value = color;
    };
    /**
     * @private
     * @param {?} state
     * @return {?}
     */
    PoRichTextToolbarComponent.prototype.toggleDisableButtons = /**
     * @private
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this.alignButtons.forEach((/**
         * @param {?} button
         * @return {?}
         */
        function (button) { return button.disabled = state; }));
        this.formatButtons.forEach((/**
         * @param {?} button
         * @return {?}
         */
        function (button) { return button.disabled = state; }));
        this.listButtons[0].disabled = state;
        this.linkButtons[0].disabled = state;
        this.mediaButtons[0].disabled = state;
    };
    PoRichTextToolbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-rich-text-toolbar',
                    template: "<div class=\"po-rich-text-toolbar\" #toolbarElement>\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group p-toggle=\"multiple\" [p-buttons]=\"formatButtons\">\n    </po-button-group>\n  </div>\n\n  <div *ngIf=\"!isInternetExplorer\" class=\"po-rich-text-toolbar-button-align\">\n    <div class=\"po-rich-text-toolbar-color-picker-container\">\n      <button class=\"po-button po-text-ellipsis po-rich-text-toolbar-color-picker-button\"\n        [disabled]=\"readonly\"\n        [p-tooltip]=\"literals.textColor\">\n        <input\n          #colorPickerInput\n          class=\"po-rich-text-toolbar-color-picker-input\"\n          type=\"color\"\n          [disabled]=\"readonly\"\n          (change)=\"changeTextColor($event.target.value)\">\n      </button>\n    </div>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group p-toggle=\"single\" [p-buttons]=\"alignButtons\">\n    </po-button-group>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group p-toggle=\"single\" [p-buttons]=\"listButtons\">\n    </po-button-group>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group [p-buttons]=\"linkButtons\">\n    </po-button-group>\n  </div>\n\n  <div class=\"po-rich-text-toolbar-button-align\">\n    <po-button-group [p-buttons]=\"mediaButtons\">\n    </po-button-group>\n  </div>\n\n</div>\n\n\n"
                }] }
    ];
    /** @nocollapse */
    PoRichTextToolbarComponent.ctorParameters = function () { return [
        { type: PoLanguageService }
    ]; };
    PoRichTextToolbarComponent.propDecorators = {
        colorPickerInput: [{ type: ViewChild, args: ['colorPickerInput', { read: ElementRef, static: false },] }],
        toolbarElement: [{ type: ViewChild, args: ['toolbarElement', { static: true },] }],
        readonly: [{ type: Input, args: ['p-readonly',] }],
        command: [{ type: Output, args: ['p-command',] }],
        modal: [{ type: Output, args: ['p-modal',] }]
    };
    return PoRichTextToolbarComponent;
}());
export { PoRichTextToolbarComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoRichTextToolbarComponent.prototype._readonly;
    /**
     * @type {?}
     * @private
     */
    PoRichTextToolbarComponent.prototype.selection;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.literals;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.alignButtons;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.formatButtons;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.listButtons;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.linkButtons;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.mediaButtons;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.colorPickerInput;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.toolbarElement;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.command;
    /** @type {?} */
    PoRichTextToolbarComponent.prototype.modal;
    /**
     * @type {?}
     * @private
     */
    PoRichTextToolbarComponent.prototype.languageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcmljaC10ZXh0LXRvb2xiYXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1maWVsZC9wby1yaWNoLXRleHQvcG8tcmljaC10ZXh0LXRvb2xiYXIvcG8tcmljaC10ZXh0LXRvb2xiYXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFpQixTQUFTLEVBQUUsVUFBVSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU3RyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDOUMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0RBQXNELENBQUM7QUFHekYsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDckUsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7O0lBR3RFLHNCQUFzQixHQUFHLFNBQVM7QUFFeEM7SUE2R0Usb0NBQW9CLGVBQWtDO1FBQXRELGlCQUEyRDtRQUF2QyxvQkFBZSxHQUFmLGVBQWUsQ0FBbUI7UUF0RzlDLGNBQVMsR0FBRyxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFbkMsYUFBUSx3QkFDWix5QkFBeUIsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLGdCQUFnQixFQUFFLENBQUMsRUFDckU7UUFFRixpQkFBWSxHQUE0QztZQUN0RDtnQkFDRSxPQUFPLEVBQUUsYUFBYTtnQkFDdEIsSUFBSSxFQUFFLG9CQUFvQjtnQkFDMUIsT0FBTyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSTtnQkFDM0IsTUFBTSxFQUFFLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQztnQkFDdkQsUUFBUSxF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LFNBQUMsWUFBWTswQkFTbEIsTUFBTSxTQUFDLFdBQVc7d0JBRWxCLE1BQU0sU0FBQyxTQUFTOztJQWlFbkIsaUNBQUM7Q0FBQSxBQXhLRCxJQXdLQztTQXBLWSwwQkFBMEI7Ozs7OztJQUVyQywrQ0FBMkI7Ozs7O0lBQzNCLCtDQUE0Qzs7SUFFNUMsOENBRUU7O0lBRUYsa0RBMEJFOztJQUVGLG1EQW1CRTs7SUFFRixpREFPRTs7SUFFRixpREFPRTs7SUFFRixrREFNRTs7SUFFRixzREFBaUc7O0lBRWpHLG9EQUEwRTs7SUFXMUUsNkNBQStGOztJQUUvRiwyQ0FBbUQ7Ozs7O0lBTXZDLHFEQUEwQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENvbXBvbmVudCwgRWxlbWVudFJlZiwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT3V0cHV0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuaW1wb3J0IHsgaXNJRSB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi8uLi9zZXJ2aWNlcy9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcblxuaW1wb3J0IHsgUG9CdXR0b25Hcm91cEl0ZW0gfSBmcm9tICcuLi8uLi8uLi9wby1idXR0b24tZ3JvdXAnO1xuaW1wb3J0IHsgcG9SaWNoVGV4dExpdGVyYWxzRGVmYXVsdCB9IGZyb20gJy4uL3BvLXJpY2gtdGV4dC1saXRlcmFscyc7XG5pbXBvcnQgeyBQb1JpY2hUZXh0TW9kYWxUeXBlIH0gZnJvbSAnLi4vZW51bXMvcG8tcmljaC10ZXh0LW1vZGFsLXR5cGUuZW51bSc7XG5pbXBvcnQgeyBQb1JpY2hUZXh0VG9vbGJhckJ1dHRvbkdyb3VwSXRlbSB9IGZyb20gJy4uL2ludGVyZmFjZXMvcG8tcmljaC10ZXh0LXRvb2xiYXItYnV0dG9uLWdyb3VwLWl0ZW0uaW50ZXJmYWNlJztcblxuY29uc3QgcG9SaWNoVGV4dERlZmF1bHRDb2xvciA9ICcjMDAwMDAwJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tcmljaC10ZXh0LXRvb2xiYXInLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tcmljaC10ZXh0LXRvb2xiYXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvUmljaFRleHRUb29sYmFyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG5cbiAgcHJpdmF0ZSBfcmVhZG9ubHk6IGJvb2xlYW47XG4gIHByaXZhdGUgc2VsZWN0aW9uID0gZG9jdW1lbnQuZ2V0U2VsZWN0aW9uKCk7XG5cbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XG4gICAgLi4ucG9SaWNoVGV4dExpdGVyYWxzRGVmYXVsdFt0aGlzLmxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCldXG4gIH07XG5cbiAgYWxpZ25CdXR0b25zOiBBcnJheTxQb1JpY2hUZXh0VG9vbGJhckJ1dHRvbkdyb3VwSXRlbT4gPSBbXG4gICAge1xuICAgICAgY29tbWFuZDogJ2p1c3RpZnlsZWZ0JyxcbiAgICAgIGljb246ICdwby1pY29uLWFsaWduLWxlZnQnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5sZWZ0LFxuICAgICAgYWN0aW9uOiB0aGlzLmVtaXRBbGlnbkNvbW1hbmQuYmluZCh0aGlzLCAnanVzdGlmeWxlZnQnKSxcbiAgICAgIHNlbGVjdGVkOiB0cnVlXG4gICAgfSxcbiAgICB7XG4gICAgICBjb21tYW5kOiAnanVzdGlmeWNlbnRlcicsXG4gICAgICBpY29uOiAncG8taWNvbi1hbGlnbi1jZW50ZXInLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5jZW50ZXIsXG4gICAgICBhY3Rpb246IHRoaXMuZW1pdEFsaWduQ29tbWFuZC5iaW5kKHRoaXMsICdqdXN0aWZ5Y2VudGVyJylcbiAgICB9LFxuICAgIHtcbiAgICAgIGNvbW1hbmQ6ICdqdXN0aWZ5cmlnaHQnLFxuICAgICAgaWNvbjogJ3BvLWljb24tYWxpZ24tcmlnaHQnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5yaWdodCxcbiAgICAgIGFjdGlvbjogdGhpcy5lbWl0QWxpZ25Db21tYW5kLmJpbmQodGhpcywgJ2p1c3RpZnlyaWdodCcpXG4gICAgfSxcbiAgICB7XG4gICAgICBjb21tYW5kOiAnanVzdGlmeWZ1bGwnLFxuICAgICAgaWNvbjogJ3BvLWljb24tYWxpZ24tanVzdGlmeScsXG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLmp1c3RpZnksXG4gICAgICBhY3Rpb246IHRoaXMuZW1pdEFsaWduQ29tbWFuZC5iaW5kKHRoaXMsICdqdXN0aWZ5ZnVsbCcpXG4gICAgfVxuICBdO1xuXG4gIGZvcm1hdEJ1dHRvbnM6IEFycmF5PFBvUmljaFRleHRUb29sYmFyQnV0dG9uR3JvdXBJdGVtPiA9IFtcbiAgICB7XG4gICAgICBjb21tYW5kOiAnYm9sZCcsXG4gICAgICBpY29uOiAncG8taWNvbi10ZXh0LWJvbGQnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5ib2xkLFxuICAgICAgYWN0aW9uOiB0aGlzLmVtaXRDb21tYW5kLmJpbmQodGhpcywgJ2JvbGQnKVxuICAgIH0sXG4gICAge1xuICAgICAgY29tbWFuZDogJ2l0YWxpYycsXG4gICAgICBpY29uOiAncG8taWNvbi10ZXh0LWl0YWxpYycsXG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLml0YWxpYyxcbiAgICAgIGFjdGlvbjogdGhpcy5lbWl0Q29tbWFuZC5iaW5kKHRoaXMsICdpdGFsaWMnKVxuICAgIH0sXG4gICAge1xuICAgICAgY29tbWFuZDogJ3VuZGVybGluZScsXG4gICAgICBpY29uOiAncG8taWNvbi10ZXh0LXVuZGVybGluZScsXG4gICAgICB0b29sdGlwOiB0aGlzLmxpdGVyYWxzLnVuZGVybGluZSxcbiAgICAgIGFjdGlvbjogdGhpcy5lbWl0Q29tbWFuZC5iaW5kKHRoaXMsICd1bmRlcmxpbmUnKVxuICAgIH1cbiAgXTtcblxuICBsaXN0QnV0dG9uczogQXJyYXk8UG9SaWNoVGV4dFRvb2xiYXJCdXR0b25Hcm91cEl0ZW0+ID0gW1xuICAgIHtcbiAgICAgIGNvbW1hbmQ6ICdpbnNlcnRVbm9yZGVyZWRMaXN0JyxcbiAgICAgIGljb246ICdwby1pY29uLWxpc3QnLFxuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy51bm9yZGVyZWRMaXN0LFxuICAgICAgYWN0aW9uOiB0aGlzLmVtaXRDb21tYW5kLmJpbmQodGhpcywgJ2luc2VydFVub3JkZXJlZExpc3QnKVxuICAgIH1cbiAgXTtcblxuICBsaW5rQnV0dG9uczogQXJyYXk8UG9SaWNoVGV4dFRvb2xiYXJCdXR0b25Hcm91cEl0ZW0+ID0gW1xuICAgIHtcbiAgICAgIGNvbW1hbmQ6ICdDcmVhdGVsaW5rJyxcbiAgICAgIGljb246ICdwby1pY29uLWxpbmsnLFxuICAgICAgdG9vbHRpcDogYCR7dGhpcy5saXRlcmFscy5pbnNlcnRMaW5rfSAoQ3RybCArIEwpYCxcbiAgICAgIGFjdGlvbjogKCkgPT4gdGhpcy5tb2RhbC5lbWl0KFBvUmljaFRleHRNb2RhbFR5cGUuTGluaylcbiAgICB9XG4gIF07XG5cbiAgbWVkaWFCdXR0b25zOiBBcnJheTxQb0J1dHRvbkdyb3VwSXRlbT4gPSBbXG4gICAge1xuICAgICAgdG9vbHRpcDogdGhpcy5saXRlcmFscy5pbnNlcnRJbWFnZSxcbiAgICAgIGljb246ICdwby1pY29uLXBpY3R1cmUnLFxuICAgICAgYWN0aW9uOiAoKSA9PiB0aGlzLm1vZGFsLmVtaXQoUG9SaWNoVGV4dE1vZGFsVHlwZS5JbWFnZSlcbiAgICB9XG4gIF07XG5cbiAgQFZpZXdDaGlsZCgnY29sb3JQaWNrZXJJbnB1dCcsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiBmYWxzZSB9KSBjb2xvclBpY2tlcklucHV0OiBFbGVtZW50UmVmO1xuXG4gIEBWaWV3Q2hpbGQoJ3Rvb2xiYXJFbGVtZW50JywgeyBzdGF0aWM6IHRydWUgfSkgdG9vbGJhckVsZW1lbnQ6IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KCdwLXJlYWRvbmx5Jykgc2V0IHJlYWRvbmx5KHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5fcmVhZG9ubHkgPSB2YWx1ZTtcbiAgICB0aGlzLnRvZ2dsZURpc2FibGVCdXR0b25zKHRoaXMuX3JlYWRvbmx5KTtcbiAgfVxuXG4gIGdldCByZWFkb25seSgpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVhZG9ubHk7XG4gIH1cblxuICBAT3V0cHV0KCdwLWNvbW1hbmQnKSBjb21tYW5kID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmcgfCB7IGNvbW1hbmQ6IHN0cmluZywgdmFsdWU6IHN0cmluZyB9PigpO1xuXG4gIEBPdXRwdXQoJ3AtbW9kYWwnKSBtb2RhbCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIGdldCBpc0ludGVybmV0RXhwbG9yZXIoKSB7XG4gICAgcmV0dXJuIGlzSUUoKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZSkgeyB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMucmVtb3ZlQnV0dG9uRm9jdXMoKTtcbiAgICB0aGlzLnNldENvbG9ySW5Db2xvclBpY2tlcihwb1JpY2hUZXh0RGVmYXVsdENvbG9yKTtcbiAgfVxuXG4gIGNoYW5nZVRleHRDb2xvcih2YWx1ZSkge1xuICAgIGNvbnN0IGNvbW1hbmQgPSAnZm9yZUNvbG9yJztcblxuICAgIHRoaXMuY29tbWFuZC5lbWl0KHsgY29tbWFuZCwgdmFsdWUgfSk7XG4gIH1cblxuICBzZXRCdXR0b25zU3RhdGVzKG9iajoge2NvbW1hbmRzOiBBcnJheTxzdHJpbmc+LCBoZXhDb2xvcjogc3RyaW5nfSkge1xuICAgIGlmICghdGhpcy5yZWFkb25seSkge1xuICAgICAgdGhpcy5hbGlnbkJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnNlbGVjdGVkID0gb2JqLmNvbW1hbmRzLmluY2x1ZGVzKGJ1dHRvbi5jb21tYW5kKSk7XG4gICAgICB0aGlzLmZvcm1hdEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnNlbGVjdGVkID0gb2JqLmNvbW1hbmRzLmluY2x1ZGVzKGJ1dHRvbi5jb21tYW5kKSk7XG4gICAgICB0aGlzLmxpc3RCdXR0b25zWzBdLnNlbGVjdGVkID0gb2JqLmNvbW1hbmRzLmluY2x1ZGVzKHRoaXMubGlzdEJ1dHRvbnNbMF0uY29tbWFuZCk7XG4gICAgICB0aGlzLmxpbmtCdXR0b25zWzBdLnNlbGVjdGVkID0gb2JqLmNvbW1hbmRzLmluY2x1ZGVzKHRoaXMubGlua0J1dHRvbnNbMF0uY29tbWFuZCk7XG4gICAgICB0aGlzLnNldENvbG9ySW5Db2xvclBpY2tlcihvYmouaGV4Q29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIHNob3J0Y3V0VHJpZ2dlcigpIHtcbiAgICB0aGlzLm1vZGFsLmVtaXQoUG9SaWNoVGV4dE1vZGFsVHlwZS5MaW5rKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdEFsaWduQ29tbWFuZChjb21tYW5kOiBzdHJpbmcpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuYWxpZ25CdXR0b25zLmZpbmRJbmRleChidG4gPT4gYnRuLmNvbW1hbmQgPT09IGNvbW1hbmQpO1xuXG4gICAgaWYgKHRoaXMuYWxpZ25CdXR0b25zW2luZGV4XS5zZWxlY3RlZCkge1xuICAgICAgdGhpcy5hbGlnbkJ1dHRvbnNbaW5kZXhdLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5jb21tYW5kLmVtaXQoY29tbWFuZCk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRDb21tYW5kKGNvbW1hbmQ6IHN0cmluZykge1xuICAgIHRoaXMuY29tbWFuZC5lbWl0KGNvbW1hbmQpO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVCdXR0b25Gb2N1cygpIHtcbiAgICBjb25zdCBidXR0b25zID0gdGhpcy50b29sYmFyRWxlbWVudC5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2J1dHRvbicpO1xuXG4gICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q29sb3JJbkNvbG9yUGlja2VyKGNvbG9yOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmNvbG9yUGlja2VySW5wdXQubmF0aXZlRWxlbWVudC52YWx1ZSA9IGNvbG9yO1xuICB9XG5cbiAgcHJpdmF0ZSB0b2dnbGVEaXNhYmxlQnV0dG9ucyhzdGF0ZTogYm9vbGVhbikge1xuICAgIHRoaXMuYWxpZ25CdXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5kaXNhYmxlZCA9IHN0YXRlKTtcbiAgICB0aGlzLmZvcm1hdEJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLmRpc2FibGVkID0gc3RhdGUpO1xuICAgIHRoaXMubGlzdEJ1dHRvbnNbMF0uZGlzYWJsZWQgPSBzdGF0ZTtcbiAgICB0aGlzLmxpbmtCdXR0b25zWzBdLmRpc2FibGVkID0gc3RhdGU7XG4gICAgdGhpcy5tZWRpYUJ1dHRvbnNbMF0uZGlzYWJsZWQgPSBzdGF0ZTtcbiAgfVxuXG59XG4iXX0=