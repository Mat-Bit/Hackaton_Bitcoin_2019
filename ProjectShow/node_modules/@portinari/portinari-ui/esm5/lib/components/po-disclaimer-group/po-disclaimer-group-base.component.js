/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Input, Output } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, isKeyCodeEnter, poLocaleDefault } from '../../utils/util';
/** @type {?} */
export var poDisclaimerGroupLiteralsDefault = {
    en: { removeAll: 'Remove all' },
    es: { removeAll: 'Eliminar todos' },
    pt: { removeAll: 'Remover todos' }
};
/**
 * \@description
 *
 * O componente `po-disclaimer-group` é recomendado para manipular palavras-chave de filtros aplicados em uma pesquisa.
 *
 * À partir de dois *disclaimers* com o botão **fechar** habilitado, o componente renderiza de forma automática um novo e destacado
 * *disclaimer* que possibilita **remover todos**, mas que também pode ser desabilitado.
 *
 * Também é possível navegar entre os *disclaimers* através do teclado utilizando a tecla *tab* e, para remoção do *disclaimer* selecionado,
 * basta pressionar a tecla *enter*. Esta funcionalidade não se aplica caso a propriedade `hideClose` estiver habilitada.
 *
 * > Veja a integração destas funcionalidade no componente [po-page-list](/documentation/po-page-list).
 */
var PoDisclaimerGroupBaseComponent = /** @class */ (function () {
    function PoDisclaimerGroupBaseComponent(differs) {
        this._disclaimers = [];
        this._hideRemoveAll = false;
        this.previousDisclaimers = [];
        this.literals = tslib_1.__assign({}, poDisclaimerGroupLiteralsDefault[poLocaleDefault], poDisclaimerGroupLiteralsDefault[browserLanguage()]);
        /**
         * Função que será disparada quando a lista de *disclaimers* for modificada.
         */
        this.change = new EventEmitter();
        this.differ = differs.find([]).create(null);
    }
    Object.defineProperty(PoDisclaimerGroupBaseComponent.prototype, "disclaimers", {
        get: /**
         * @return {?}
         */
        function () {
            return this._disclaimers;
        },
        /** Lista de *disclaimers*. */
        /**
         * @description
         *
         * Lista de *disclaimers*.
         *
         * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `PoDisclaimer`.
         *
         * Exemplo adicionando um *disclaimer* no array:
         *
         * ```
         * this.disclaimers = [...this.disclaimers, disclaimer];
         * ```
         *
         * ou
         *
         * ```
         * this.disclaimers = this.disclaimers.concat(disclaimer);
         * ```
         */
        set: /** Lista de *disclaimers*. */
        /**
         * \@description
         *
         * Lista de *disclaimers*.
         *
         * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `PoDisclaimer`.
         *
         * Exemplo adicionando um *disclaimer* no array:
         *
         * ```
         * this.disclaimers = [...this.disclaimers, disclaimer];
         * ```
         *
         * ou
         *
         * ```
         * this.disclaimers = this.disclaimers.concat(disclaimer);
         * ```
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this.previousDisclaimers = tslib_1.__spread(this.disclaimers);
            this._disclaimers = this.checkDisclaimers(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoDisclaimerGroupBaseComponent.prototype, "hideRemoveAll", {
        get: /**
         * @return {?}
         */
        function () {
            return this._hideRemoveAll;
        },
        /**
         * @optional
         *
         * @description
         *
         * Oculta o botão para remover todos os *disclaimers* do grupo.
         *
         * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Oculta o botão para remover todos os *disclaimers* do grupo.
         *
         * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
         *
         * \@default `false`
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._hideRemoveAll = (/** @type {?} */ (value)) === '' ? true : convertToBoolean(value);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        this.checkChanges();
    };
    /**
     * @param {?} disclaimer
     * @param {?=} emitChange
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.closeItem = /**
     * @param {?} disclaimer
     * @param {?=} emitChange
     * @return {?}
     */
    function (disclaimer, emitChange) {
        if (emitChange === void 0) { emitChange = true; }
        /** @type {?} */
        var itemIndex = this.disclaimers.findIndex((/**
         * @param {?} d
         * @return {?}
         */
        function (d) { return d['$id'] === disclaimer['$id']; }));
        this.disclaimers.splice(itemIndex, 1);
        if (emitChange) {
            this.emitChangeDisclaimers();
        }
    };
    /**
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.isRemoveAll = /**
     * @return {?}
     */
    function () {
        return !this.hideRemoveAll && this.disclaimers.filter((/**
         * @param {?} c
         * @return {?}
         */
        function (c) { return !c.hideClose; })).length > 1;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.onKeyPress = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (isKeyCodeEnter(event)) {
            this.removeAllItems();
        }
    };
    /**
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.removeAllItems = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var removeItems = [];
        this.disclaimers.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        function (disclaimer) {
            if (!disclaimer.hideClose) {
                removeItems.push(disclaimer);
            }
        }));
        removeItems.forEach((/**
         * @param {?} disclaimer
         * @return {?}
         */
        function (disclaimer) { return _this.closeItem(disclaimer, false); }));
        this.emitChangeDisclaimers();
    };
    /**
     * @private
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.checkChanges = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.differ) {
            /** @type {?} */
            var changes = this.differ.diff(this.disclaimers);
            if (changes && this.disclaimersAreChanged(this.disclaimers)) {
                this.emitChangeDisclaimers();
            }
        }
    };
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.checkDisclaimers = /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    function (disclaimers) {
        if (Array.isArray(disclaimers)) {
            for (var i = 0; i < disclaimers.length; i++) {
                /** @type {?} */
                var disclaimer = disclaimers[i];
                if (disclaimer.value || disclaimer.value === 0 || disclaimer.value === false) {
                    disclaimer['$id'] = uuid();
                }
                else {
                    disclaimers.splice(i, 1);
                    i--;
                }
            }
            return disclaimers;
        }
        return [];
    };
    /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.disclaimersAreChanged = /**
     * @private
     * @param {?} disclaimers
     * @return {?}
     */
    function (disclaimers) {
        var _this = this;
        /** @type {?} */
        var currentValues = disclaimers;
        if (currentValues.length !== this.previousDisclaimers.length) {
            return true;
        }
        return currentValues.some((/**
         * @param {?} disclaimer
         * @param {?} index
         * @return {?}
         */
        function (disclaimer, index) { return disclaimer.value !== _this.previousDisclaimers[index].value
            || disclaimer.property !== _this.previousDisclaimers[index].property; }));
    };
    /**
     * @private
     * @return {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.emitChangeDisclaimers = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.change.emit(_this.disclaimers);
        }));
        this.previousDisclaimers = tslib_1.__spread(this._disclaimers);
    };
    PoDisclaimerGroupBaseComponent.propDecorators = {
        disclaimers: [{ type: Input, args: ['p-disclaimers',] }],
        hideRemoveAll: [{ type: Input, args: ['p-hide-remove-all',] }],
        title: [{ type: Input, args: ['p-title',] }],
        change: [{ type: Output, args: ['p-change',] }]
    };
    return PoDisclaimerGroupBaseComponent;
}());
export { PoDisclaimerGroupBaseComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoDisclaimerGroupBaseComponent.prototype._disclaimers;
    /**
     * @type {?}
     * @private
     */
    PoDisclaimerGroupBaseComponent.prototype._hideRemoveAll;
    /**
     * @type {?}
     * @private
     */
    PoDisclaimerGroupBaseComponent.prototype.differ;
    /**
     * @type {?}
     * @private
     */
    PoDisclaimerGroupBaseComponent.prototype.previousDisclaimers;
    /** @type {?} */
    PoDisclaimerGroupBaseComponent.prototype.literals;
    /**
     * Título do grupo de *disclaimers*.
     * @type {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.title;
    /**
     * Função que será disparada quando a lista de *disclaimers* for modificada.
     * @type {?}
     */
    PoDisclaimerGroupBaseComponent.prototype.change;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlzY2xhaW1lci1ncm91cC1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZGlzY2xhaW1lci1ncm91cC9wby1kaXNjbGFpbWVyLWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFXLFlBQVksRUFBRSxLQUFLLEVBQW1CLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV0RixPQUFPLEVBQUUsRUFBRSxJQUFJLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVsQyxPQUFPLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7QUFJdEcsTUFBTSxLQUFPLGdDQUFnQyxHQUFHO0lBQzlDLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUU7SUFDL0IsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO0lBQ25DLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxlQUFlLEVBQUU7Q0FDbkM7Ozs7Ozs7Ozs7Ozs7O0FBZUQ7SUF1RUUsd0NBQVksT0FBd0I7UUFyRTVCLGlCQUFZLEdBQXdCLEVBQUUsQ0FBQztRQUN2QyxtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUdoQyx3QkFBbUIsR0FBd0IsRUFBRSxDQUFDO1FBRTdDLGFBQVEsd0JBQ1YsZ0NBQWdDLENBQUMsZUFBZSxDQUFDLEVBQ2pELGdDQUFnQyxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQ3hEOzs7O1FBMERrQixXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7UUFHdkUsSUFBSSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QyxD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QyxDQUFDO0lBQ3pFLENBQUM7Ozs7O0lBRU8sOERBQXFCOzs7O0lBQTdCO1FBQUEsaUJBS0M7UUFKQyxVQUFVOzs7UUFBQztZQUNULEtBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUNyQyxDQUFDLEVBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxtQkFBbUIsb0JBQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ3BELENBQUM7OzhCQXBJQSxLQUFLLFNBQUMsZUFBZTtnQ0FzQnJCLEtBQUssU0FBQyxtQkFBbUI7d0JBVXpCLEtBQUssU0FBQyxTQUFTO3lCQUdmLE1BQU0sU0FBQyxVQUFVOztJQW1HcEIscUNBQUM7Q0FBQSxBQXhLRCxJQXdLQztTQXhLWSw4QkFBOEI7Ozs7OztJQUV6QyxzREFBK0M7Ozs7O0lBQy9DLHdEQUF3Qzs7Ozs7SUFFeEMsZ0RBQWU7Ozs7O0lBQ2YsNkRBQXNEOztJQUV0RCxrREFHRTs7Ozs7SUF1REYsK0NBQWlDOzs7OztJQUdqQyxnREFBeUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEb0NoZWNrLCBFdmVudEVtaXR0ZXIsIElucHV0LCBJdGVyYWJsZURpZmZlcnMsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSAndXVpZCc7XG5cbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgY29udmVydFRvQm9vbGVhbiwgaXNLZXlDb2RlRW50ZXIsIHBvTG9jYWxlRGVmYXVsdCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBQb0Rpc2NsYWltZXIgfSBmcm9tICcuLi9wby1kaXNjbGFpbWVyL3BvLWRpc2NsYWltZXIuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNvbnN0IHBvRGlzY2xhaW1lckdyb3VwTGl0ZXJhbHNEZWZhdWx0ID0ge1xuICBlbjogeyByZW1vdmVBbGw6ICdSZW1vdmUgYWxsJyB9LFxuICBlczogeyByZW1vdmVBbGw6ICdFbGltaW5hciB0b2RvcycgfSxcbiAgcHQ6IHsgcmVtb3ZlQWxsOiAnUmVtb3ZlciB0b2RvcycgfVxufTtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGNvbXBvbmVudGUgYHBvLWRpc2NsYWltZXItZ3JvdXBgIMOpIHJlY29tZW5kYWRvIHBhcmEgbWFuaXB1bGFyIHBhbGF2cmFzLWNoYXZlIGRlIGZpbHRyb3MgYXBsaWNhZG9zIGVtIHVtYSBwZXNxdWlzYS5cbiAqXG4gKiDDgCBwYXJ0aXIgZGUgZG9pcyAqZGlzY2xhaW1lcnMqIGNvbSBvIGJvdMOjbyAqKmZlY2hhcioqIGhhYmlsaXRhZG8sIG8gY29tcG9uZW50ZSByZW5kZXJpemEgZGUgZm9ybWEgYXV0b23DoXRpY2EgdW0gbm92byBlIGRlc3RhY2Fkb1xuICogKmRpc2NsYWltZXIqIHF1ZSBwb3NzaWJpbGl0YSAqKnJlbW92ZXIgdG9kb3MqKiwgbWFzIHF1ZSB0YW1iw6ltIHBvZGUgc2VyIGRlc2FiaWxpdGFkby5cbiAqXG4gKiBUYW1iw6ltIMOpIHBvc3PDrXZlbCBuYXZlZ2FyIGVudHJlIG9zICpkaXNjbGFpbWVycyogYXRyYXbDqXMgZG8gdGVjbGFkbyB1dGlsaXphbmRvIGEgdGVjbGEgKnRhYiogZSwgcGFyYSByZW1vw6fDo28gZG8gKmRpc2NsYWltZXIqIHNlbGVjaW9uYWRvLFxuICogYmFzdGEgcHJlc3Npb25hciBhIHRlY2xhICplbnRlciouIEVzdGEgZnVuY2lvbmFsaWRhZGUgbsOjbyBzZSBhcGxpY2EgY2FzbyBhIHByb3ByaWVkYWRlIGBoaWRlQ2xvc2VgIGVzdGl2ZXIgaGFiaWxpdGFkYS5cbiAqXG4gKiA+IFZlamEgYSBpbnRlZ3Jhw6fDo28gZGVzdGFzIGZ1bmNpb25hbGlkYWRlIG5vIGNvbXBvbmVudGUgW3BvLXBhZ2UtbGlzdF0oL2RvY3VtZW50YXRpb24vcG8tcGFnZS1saXN0KS5cbiAqL1xuZXhwb3J0IGNsYXNzIFBvRGlzY2xhaW1lckdyb3VwQmFzZUNvbXBvbmVudCBpbXBsZW1lbnRzIERvQ2hlY2sge1xuXG4gIHByaXZhdGUgX2Rpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+ID0gW107XG4gIHByaXZhdGUgX2hpZGVSZW1vdmVBbGw6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIGRpZmZlcjtcbiAgcHJpdmF0ZSBwcmV2aW91c0Rpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+ID0gW107XG5cbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XG4gICAgICAuLi5wb0Rpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFtwb0xvY2FsZURlZmF1bHRdLFxuICAgICAgLi4ucG9EaXNjbGFpbWVyR3JvdXBMaXRlcmFsc0RlZmF1bHRbYnJvd3Nlckxhbmd1YWdlKCldXG4gIH07XG5cbiAgLyoqIExpc3RhIGRlICpkaXNjbGFpbWVycyouICovXG5cbiAgLyoqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBMaXN0YSBkZSAqZGlzY2xhaW1lcnMqLlxuICAgKlxuICAgKiBQYXJhIHF1ZSBhIGxpc3RhIGRlICpkaXNjbGFpbWVycyogc2VqYSBhdHVhbGl6YWRhIGRpbmFtaWNhbWVudGUgZGV2ZS1zZSBwYXNzYXIgdW1hIG5vdmEgcmVmZXLDqm5jaWEgZG8gYXJyYXkgZGUgYFBvRGlzY2xhaW1lcmAuXG4gICAqXG4gICAqIEV4ZW1wbG8gYWRpY2lvbmFuZG8gdW0gKmRpc2NsYWltZXIqIG5vIGFycmF5OlxuICAgKlxuICAgKiBgYGBcbiAgICogdGhpcy5kaXNjbGFpbWVycyA9IFsuLi50aGlzLmRpc2NsYWltZXJzLCBkaXNjbGFpbWVyXTtcbiAgICogYGBgXG4gICAqXG4gICAqIG91XG4gICAqXG4gICAqIGBgYFxuICAgKiB0aGlzLmRpc2NsYWltZXJzID0gdGhpcy5kaXNjbGFpbWVycy5jb25jYXQoZGlzY2xhaW1lcik7XG4gICAqIGBgYFxuICAgKi9cbiAgQElucHV0KCdwLWRpc2NsYWltZXJzJykgc2V0IGRpc2NsYWltZXJzKHZhbHVlOiBBcnJheTxQb0Rpc2NsYWltZXI+KSB7XG5cbiAgICB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnMgPSBbLi4udGhpcy5kaXNjbGFpbWVyc107XG4gICAgdGhpcy5fZGlzY2xhaW1lcnMgPSB0aGlzLmNoZWNrRGlzY2xhaW1lcnModmFsdWUpO1xuXG4gIH1cblxuICBnZXQgZGlzY2xhaW1lcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Rpc2NsYWltZXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogT2N1bHRhIG8gYm90w6NvIHBhcmEgcmVtb3ZlciB0b2RvcyBvcyAqZGlzY2xhaW1lcnMqIGRvIGdydXBvLlxuICAgKlxuICAgKiA+IFBvciBwYWRyw6NvLCBvIG1lc21vIMOpIGV4aWJpZG8gw6AgcGFydGlyIGRlIGRvaXMgb3UgbWFpcyAqZGlzY2xhaW1lcnMqIGNvbSBhIG9ww6fDo28gYGhpZGVDbG9zZWAgaGFiaWxpdGFkYS5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWhpZGUtcmVtb3ZlLWFsbCcpXG4gIHNldCBoaWRlUmVtb3ZlQWxsKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5faGlkZVJlbW92ZUFsbCA9IDxhbnk+dmFsdWUgPT09ICcnID8gdHJ1ZSA6IGNvbnZlcnRUb0Jvb2xlYW4odmFsdWUpO1xuICB9XG5cbiAgZ2V0IGhpZGVSZW1vdmVBbGwoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2hpZGVSZW1vdmVBbGw7XG4gIH1cblxuICAvKiogVMOtdHVsbyBkbyBncnVwbyBkZSAqZGlzY2xhaW1lcnMqLiAqL1xuICBASW5wdXQoJ3AtdGl0bGUnKSB0aXRsZT86IHN0cmluZztcblxuICAvKiogRnVuw6fDo28gcXVlIHNlcsOhIGRpc3BhcmFkYSBxdWFuZG8gYSBsaXN0YSBkZSAqZGlzY2xhaW1lcnMqIGZvciBtb2RpZmljYWRhLiAqL1xuICBAT3V0cHV0KCdwLWNoYW5nZScpIGNoYW5nZT86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY29uc3RydWN0b3IoZGlmZmVyczogSXRlcmFibGVEaWZmZXJzKSB7XG4gICAgdGhpcy5kaWZmZXIgPSBkaWZmZXJzLmZpbmQoW10pLmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcbiAgICB0aGlzLmNoZWNrQ2hhbmdlcygpO1xuICB9XG5cbiAgY2xvc2VJdGVtKGRpc2NsYWltZXI6IGFueSwgZW1pdENoYW5nZTogYm9vbGVhbiA9IHRydWUpIHtcbiAgICBjb25zdCBpdGVtSW5kZXggPSB0aGlzLmRpc2NsYWltZXJzLmZpbmRJbmRleChkID0+IGRbJyRpZCddID09PSBkaXNjbGFpbWVyWyckaWQnXSk7XG4gICAgdGhpcy5kaXNjbGFpbWVycy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcblxuICAgIGlmIChlbWl0Q2hhbmdlKSB7XG4gICAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICAgIH1cbiAgfVxuXG4gIGlzUmVtb3ZlQWxsKCkge1xuICAgIHJldHVybiAhdGhpcy5oaWRlUmVtb3ZlQWxsICYmIHRoaXMuZGlzY2xhaW1lcnMuZmlsdGVyKGMgPT4gIWMuaGlkZUNsb3NlKS5sZW5ndGggPiAxO1xuICB9XG5cbiAgb25LZXlQcmVzcyhldmVudDogYW55KSB7XG5cbiAgICBpZiAoaXNLZXlDb2RlRW50ZXIoZXZlbnQpKSB7XG4gICAgICB0aGlzLnJlbW92ZUFsbEl0ZW1zKCk7XG4gICAgfVxuXG4gIH1cblxuICByZW1vdmVBbGxJdGVtcygpIHtcbiAgICBjb25zdCByZW1vdmVJdGVtcyA9IFtdO1xuXG4gICAgdGhpcy5kaXNjbGFpbWVycy5mb3JFYWNoKGRpc2NsYWltZXIgPT4ge1xuICAgICAgaWYgKCFkaXNjbGFpbWVyLmhpZGVDbG9zZSkge1xuICAgICAgICByZW1vdmVJdGVtcy5wdXNoKGRpc2NsYWltZXIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmVtb3ZlSXRlbXMuZm9yRWFjaChkaXNjbGFpbWVyID0+IHRoaXMuY2xvc2VJdGVtKGRpc2NsYWltZXIsIGZhbHNlKSk7XG5cbiAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0NoYW5nZXMoKSB7XG5cbiAgICBpZiAodGhpcy5kaWZmZXIpIHtcbiAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLmRpZmZlci5kaWZmKHRoaXMuZGlzY2xhaW1lcnMpO1xuXG4gICAgICBpZiAoY2hhbmdlcyAmJiB0aGlzLmRpc2NsYWltZXJzQXJlQ2hhbmdlZCh0aGlzLmRpc2NsYWltZXJzKSkge1xuICAgICAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gIH1cblxuICBwcml2YXRlIGNoZWNrRGlzY2xhaW1lcnMoZGlzY2xhaW1lcnM6IEFycmF5PFBvRGlzY2xhaW1lcj4pIHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShkaXNjbGFpbWVycykpIHtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNjbGFpbWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBkaXNjbGFpbWVyID0gZGlzY2xhaW1lcnNbaV07XG5cbiAgICAgICAgaWYgKGRpc2NsYWltZXIudmFsdWUgfHwgZGlzY2xhaW1lci52YWx1ZSA9PT0gMCB8fCBkaXNjbGFpbWVyLnZhbHVlID09PSBmYWxzZSkge1xuXG4gICAgICAgICAgZGlzY2xhaW1lclsnJGlkJ10gPSB1dWlkKCk7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgIGRpc2NsYWltZXJzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBpLS07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRpc2NsYWltZXJzO1xuICAgIH1cblxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzY2xhaW1lcnNBcmVDaGFuZ2VkKGRpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlczogQXJyYXk8UG9EaXNjbGFpbWVyPiA9IGRpc2NsYWltZXJzO1xuXG4gICAgaWYgKGN1cnJlbnRWYWx1ZXMubGVuZ3RoICE9PSB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3VycmVudFZhbHVlcy5zb21lKChkaXNjbGFpbWVyLCBpbmRleCkgPT4gZGlzY2xhaW1lci52YWx1ZSAhPT0gdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzW2luZGV4XS52YWx1ZVxuICAgICAgfHwgZGlzY2xhaW1lci5wcm9wZXJ0eSAhPT0gdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzW2luZGV4XS5wcm9wZXJ0eSk7XG4gIH1cblxuICBwcml2YXRlIGVtaXRDaGFuZ2VEaXNjbGFpbWVycygpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuY2hhbmdlLmVtaXQodGhpcy5kaXNjbGFpbWVycyk7XG4gICAgfSk7XG4gICAgdGhpcy5wcmV2aW91c0Rpc2NsYWltZXJzID0gWy4uLnRoaXMuX2Rpc2NsYWltZXJzXTtcbiAgfVxuXG59XG4iXX0=