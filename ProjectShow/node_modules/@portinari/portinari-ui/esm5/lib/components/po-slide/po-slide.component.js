/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, ContentChild, ElementRef, HostListener, QueryList, ViewChild, ViewChildren } from '@angular/core';
import { animate, AnimationBuilder, keyframes, style } from '@angular/animations';
import { PoSlideBaseComponent } from './po-slide-base.component';
import { PoSlideContentTemplateDirective } from './directives/po-slide-content-template.directive';
import { PoSlideItemComponent } from './po-slide-item/po-slide-item.component';
/** @type {?} */
var poSlideDefaultHeight = 336;
/** @type {?} */
var poSlideIntervalMin = 1000;
/** @type {?} */
var poSlideMinHeight = 192;
/** @type {?} */
var poSlideTiming = '250ms ease';
/**
 * \@docsExtends PoSlideBaseComponent
 *
 * \@example
 * <example name="po-slide-basic" title="Portinari Slide Basic">
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.html"> </file>
 *   <file name="sample-po-slide-basic/sample-po-slide-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-labs" title="Portinari Slide Labs">
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.html"> </file>
 *   <file name="sample-po-slide-labs/sample-po-slide-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-useful-articles" title="Portinari Slide - Useful articles">
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.html"> </file>
 *   <file name="sample-po-slide-useful-articles/sample-po-slide-useful-articles.component.ts"> </file>
 * </example>
 *
 * <example name="po-slide-landscapes" title="Portinari Slide - Landscapes">
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.html"> </file>
 *   <file name="sample-po-slide-landscapes/sample-po-slide-landscapes.component.ts"> </file>
 * </example>
 */
var PoSlideComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoSlideComponent, _super);
    function PoSlideComponent(builder) {
        var _this = _super.call(this) || this;
        _this.builder = builder;
        _this.isLoaded = false;
        _this.currentSlideIndex = 0;
        _this.slideItems = [];
        return _this;
    }
    Object.defineProperty(PoSlideComponent.prototype, "hasElements", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return !!this.slide.nativeElement.offsetWidth && !!this.itemsElements && !!this.itemsElements.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoSlideComponent.prototype, "isImageSlide", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return !this.slideContentTemplate;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoSlideComponent.prototype, "offset", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return this.currentSlideIndex * this.slideItemWidth;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoSlideComponent.prototype, "hasSlides", {
        get: /**
         * @return {?}
         */
        function () {
            return !!this.slides && !!this.slides.length;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoSlideComponent.prototype.onResize = /**
     * @return {?}
     */
    function () {
        if (this.slide) {
            this.setSlideItemWidth();
            this.goToItem(this.currentSlideIndex);
        }
    };
    /**
     * @return {?}
     */
    PoSlideComponent.prototype.ngDoCheck = /**
     * @return {?}
     */
    function () {
        if (!this.isLoaded && this.hasElements) {
            this.setSlideItemWidth();
            this.isLoaded = true;
            if (this.hasSlides) {
                this.startSlide();
            }
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    PoSlideComponent.prototype.goToItem = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = index;
        this.animate(this.offset);
    };
    /**
     * @return {?}
     */
    PoSlideComponent.prototype.nextControl = /**
     * @return {?}
     */
    function () {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.next();
    };
    /**
     * @return {?}
     */
    PoSlideComponent.prototype.next = /**
     * @return {?}
     */
    function () {
        if (this.currentSlideIndex + 1 === this.slideItems.length) {
            this.currentSlideIndex = 0;
            this.animate(0);
            return;
        }
        this.currentSlideIndex = (this.currentSlideIndex + 1) % this.slideItems.length;
        this.animate(this.offset);
    };
    /**
     * @return {?}
     */
    PoSlideComponent.prototype.previous = /**
     * @return {?}
     */
    function () {
        if (this.currentSlideIndex === 0) {
            this.currentSlideIndex = this.slideItems.length - 1;
            this.animate(this.offset);
            return;
        }
        this.currentSlideIndex = ((this.currentSlideIndex - 1) + this.slideItems.length) % this.slideItems.length;
        this.animate(this.offset);
    };
    /**
     * @return {?}
     */
    PoSlideComponent.prototype.previousControl = /**
     * @return {?}
     */
    function () {
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.previous();
    };
    /**
     * @param {?} height
     * @return {?}
     */
    PoSlideComponent.prototype.setSlideHeight = /**
     * @param {?} height
     * @return {?}
     */
    function (height) {
        this.setHeight(height);
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    PoSlideComponent.prototype.animate = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        if (this.hasElements) {
            /** @type {?} */
            var animation = this.buildTransitionAnimation(offset);
            this.player = animation.create(this.slide.nativeElement);
            this.player.play();
        }
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    PoSlideComponent.prototype.buildTransitionAnimation = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        return this.builder.build([
            animate(poSlideTiming, keyframes([style({ transform: "translateX(-" + offset + "px)" })]))
        ]);
    };
    /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    PoSlideComponent.prototype.createArrayForTemplate = /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    function (slides) {
        this.slideItems = tslib_1.__spread(slides);
    };
    /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    PoSlideComponent.prototype.createArrayFromSlides = /**
     * @private
     * @param {?} slides
     * @return {?}
     */
    function (slides) {
        var _this = this;
        /** @type {?} */
        var isStringArray = slides.every((/**
         * @param {?} item
         * @return {?}
         */
        function (item) { return typeof item === 'string'; }));
        if (isStringArray) {
            slides.forEach((/**
             * @param {?} element
             * @return {?}
             */
            function (element) { return _this.slideItems.push({ image: "" + element }); }));
        }
        else {
            this.slideItems = tslib_1.__spread((/** @type {?} */ (slides)));
        }
    };
    /**
     * @private
     * @param {?} height
     * @return {?}
     */
    PoSlideComponent.prototype.setDefaultHeight = /**
     * @private
     * @param {?} height
     * @return {?}
     */
    function (height) {
        if (height && height <= poSlideMinHeight || !height && this.isImageSlide) {
            this.slide.nativeElement.style.height = poSlideDefaultHeight + "px";
            this.imageHeight = poSlideDefaultHeight;
        }
        else {
            this.imageHeight = undefined;
        }
    };
    /**
     * @private
     * @param {?} height
     * @return {?}
     */
    PoSlideComponent.prototype.setHeight = /**
     * @private
     * @param {?} height
     * @return {?}
     */
    function (height) {
        if (height && height > poSlideMinHeight) {
            this.slide.nativeElement.style.height = height + "px";
            this.imageHeight = height;
        }
        else {
            this.setDefaultHeight(height);
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoSlideComponent.prototype.setSlideItemWidth = /**
     * @private
     * @return {?}
     */
    function () {
        if (this.hasElements) {
            this.slideItemWidth = this.itemsElements.first.itemElement.nativeElement.getBoundingClientRect().width;
        }
    };
    /**
     * @protected
     * @return {?}
     */
    PoSlideComponent.prototype.cancelInterval = /**
     * @protected
     * @return {?}
     */
    function () {
        clearInterval(this.setInterval);
    };
    /**
     * @protected
     * @param {?} slides
     * @return {?}
     */
    PoSlideComponent.prototype.setSlideItems = /**
     * @protected
     * @param {?} slides
     * @return {?}
     */
    function (slides) {
        if (this.hasSlides) {
            this.slideContentTemplate ? this.createArrayForTemplate(slides) : this.createArrayFromSlides(slides);
        }
        else {
            this.slideItems = [];
            this.cancelInterval();
        }
    };
    /**
     * @protected
     * @return {?}
     */
    PoSlideComponent.prototype.startSlide = /**
     * @protected
     * @return {?}
     */
    function () {
        this.setSlideHeight(this.height);
        if (this.interval > poSlideIntervalMin) {
            this.startInterval();
        }
        this.currentSlideIndex = 0;
    };
    /**
     * @protected
     * @return {?}
     */
    PoSlideComponent.prototype.startInterval = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.setInterval) {
            this.cancelInterval();
        }
        this.setInterval = this.hasSlides && this.hasElements ? setInterval((/**
         * @return {?}
         */
        function () { _this.next(); }), this.interval) : undefined;
    };
    PoSlideComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-slide',
                    template: "<div class=\"po-slide-wrapper\">\n  <div class=\"po-slide-outer\">\n    <div class=\"po-slide-inner\" #slide>\n      <ng-container *ngFor=\"let item of slideItems; let index = index;\">\n        <po-slide-item\n          [p-action]=\"item.action\"\n          [p-data]=\"item\"\n          [p-image]=\"item.image\"\n          [p-image-height]=\"imageHeight\"\n          [p-template]=\"slideContentTemplate\"\n          [p-alt]=\"item.alt\"\n          [p-link]=\"item.link\">\n        </po-slide-item>\n      </ng-container>\n    </div>\n\n    <po-slide-control *ngIf=\"hasSlides && slides.length > 1\" \n      p-control=\"previous\"\n      (p-click)=\"previousControl()\">\n    </po-slide-control>\n\n    <po-slide-control *ngIf=\"hasSlides && slides.length > 1\"\n      p-control=\"next\"\n      (p-click)=\"nextControl()\">\n    </po-slide-control>\n\n  </div>\n\n  <po-slide-circles\n    *ngIf=\"hasSlides && slides.length > 1\"\n    [p-current-slide-index]=\"currentSlideIndex\"\n    [p-items]=\"slideItems\"\n    (p-click)=\"goToItem($event)\">\n  </po-slide-circles>\n</div>\n"
                }] }
    ];
    /** @nocollapse */
    PoSlideComponent.ctorParameters = function () { return [
        { type: AnimationBuilder }
    ]; };
    PoSlideComponent.propDecorators = {
        slideContentTemplate: [{ type: ContentChild, args: [PoSlideContentTemplateDirective, { static: true },] }],
        slide: [{ type: ViewChild, args: ['slide', { static: true },] }],
        itemsElements: [{ type: ViewChildren, args: [PoSlideItemComponent,] }],
        onResize: [{ type: HostListener, args: ['window:resize',] }]
    };
    return PoSlideComponent;
}(PoSlideBaseComponent));
export { PoSlideComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoSlideComponent.prototype.isLoaded;
    /**
     * @type {?}
     * @private
     */
    PoSlideComponent.prototype.player;
    /**
     * @type {?}
     * @private
     */
    PoSlideComponent.prototype.setInterval;
    /** @type {?} */
    PoSlideComponent.prototype.currentSlideIndex;
    /** @type {?} */
    PoSlideComponent.prototype.imageHeight;
    /** @type {?} */
    PoSlideComponent.prototype.slideItems;
    /** @type {?} */
    PoSlideComponent.prototype.slideItemWidth;
    /** @type {?} */
    PoSlideComponent.prototype.slideContentTemplate;
    /**
     * @type {?}
     * @private
     */
    PoSlideComponent.prototype.slide;
    /**
     * @type {?}
     * @private
     */
    PoSlideComponent.prototype.itemsElements;
    /**
     * @type {?}
     * @private
     */
    PoSlideComponent.prototype.builder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tc2xpZGUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvcnRpbmFyaS9wb3J0aW5hcmktdWkvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wby1zbGlkZS9wby1zbGlkZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBWSxVQUFVLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRWhJLE9BQU8sRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQXFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUVySCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUVuRyxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQzs7SUFFekUsb0JBQW9CLEdBQUcsR0FBRzs7SUFDMUIsa0JBQWtCLEdBQUcsSUFBSTs7SUFDekIsZ0JBQWdCLEdBQUcsR0FBRzs7SUFDdEIsYUFBYSxHQUFHLFlBQVk7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEwQmxDO0lBSXNDLDRDQUFvQjtJQXdDeEQsMEJBQW9CLE9BQXlCO1FBQTdDLFlBQ0UsaUJBQU8sU0FDUjtRQUZtQixhQUFPLEdBQVAsT0FBTyxDQUFrQjtRQXRDckMsY0FBUSxHQUFZLEtBQUssQ0FBQztRQW9CbEMsdUJBQWlCLEdBQUcsQ0FBQyxDQUFDO1FBRXRCLGdCQUFVLEdBQTZCLEVBQUUsQ0FBQzs7SUFrQjFDLENBQUM7SUFwQ0Qsc0JBQVkseUNBQVc7Ozs7O1FBQXZCO1lBQ0UsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMs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LENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7SUFDekgsQ0FBQzs7Z0JBek1GLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsVUFBVTtvQkFDcEIsb2tDQUF3QztpQkFDekM7Ozs7Z0JBdkNpQixnQkFBZ0I7Ozt1Q0FtRS9CLFlBQVksU0FBQywrQkFBK0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7d0JBRTlELFNBQVMsU0FBQyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dDQUVuQyxZQUFZLFNBQUMsb0JBQW9COzJCQUVqQyxZQUFZLFNBQUMsZUFBZTs7SUFzSy9CLHVCQUFDO0NBQUEsQUEzTUQsQ0FJc0Msb0JBQW9CLEdBdU16RDtTQXZNWSxnQkFBZ0I7Ozs7OztJQUUzQixvQ0FBa0M7Ozs7O0lBQ2xDLGtDQUFnQzs7Ozs7SUFDaEMsdUNBQXlCOztJQWtCekIsNkNBQXNCOztJQUN0Qix1Q0FBb0I7O0lBQ3BCLHNDQUEwQzs7SUFDMUMsMENBQXVCOztJQUV2QixnREFBdUg7Ozs7O0lBRXZILGlDQUFnRTs7Ozs7SUFFaEUseUNBQTJGOzs7OztJQVMvRSxtQ0FBaUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZCwgRG9DaGVjayAsIEVsZW1lbnRSZWYsIEhvc3RMaXN0ZW5lciwgUXVlcnlMaXN0LCBWaWV3Q2hpbGQsIFZpZXdDaGlsZHJlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBhbmltYXRlLCBBbmltYXRpb25CdWlsZGVyLCBBbmltYXRpb25GYWN0b3J5LCBBbmltYXRpb25QbGF5ZXIsIGtleWZyYW1lcywgc3R5bGUgfSBmcm9tICdAYW5ndWxhci9hbmltYXRpb25zJztcblxuaW1wb3J0IHsgUG9TbGlkZUJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLXNsaWRlLWJhc2UuY29tcG9uZW50JztcbmltcG9ydCB7IFBvU2xpZGVDb250ZW50VGVtcGxhdGVEaXJlY3RpdmUgfSBmcm9tICcuL2RpcmVjdGl2ZXMvcG8tc2xpZGUtY29udGVudC10ZW1wbGF0ZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgUG9TbGlkZUl0ZW0gfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tc2xpZGUtaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9TbGlkZUl0ZW1Db21wb25lbnQgfSBmcm9tICcuL3BvLXNsaWRlLWl0ZW0vcG8tc2xpZGUtaXRlbS5jb21wb25lbnQnO1xuXG5jb25zdCBwb1NsaWRlRGVmYXVsdEhlaWdodCA9IDMzNjtcbmNvbnN0IHBvU2xpZGVJbnRlcnZhbE1pbiA9IDEwMDA7XG5jb25zdCBwb1NsaWRlTWluSGVpZ2h0ID0gMTkyO1xuY29uc3QgcG9TbGlkZVRpbWluZyA9ICcyNTBtcyBlYXNlJztcblxuLyoqXG4gKiBAZG9jc0V4dGVuZHMgUG9TbGlkZUJhc2VDb21wb25lbnRcbiAqXG4gKiBAZXhhbXBsZVxuICogPGV4YW1wbGUgbmFtZT1cInBvLXNsaWRlLWJhc2ljXCIgdGl0bGU9XCJQb3J0aW5hcmkgU2xpZGUgQmFzaWNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS1iYXNpYy9zYW1wbGUtcG8tc2xpZGUtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWJhc2ljL3NhbXBsZS1wby1zbGlkZS1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1zbGlkZS1sYWJzXCIgdGl0bGU9XCJQb3J0aW5hcmkgU2xpZGUgTGFic1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWxhYnMvc2FtcGxlLXBvLXNsaWRlLWxhYnMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWxhYnMvc2FtcGxlLXBvLXNsaWRlLWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2xpZGUtdXNlZnVsLWFydGljbGVzXCIgdGl0bGU9XCJQb3J0aW5hcmkgU2xpZGUgLSBVc2VmdWwgYXJ0aWNsZXNcIj5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1zbGlkZS11c2VmdWwtYXJ0aWNsZXMvc2FtcGxlLXBvLXNsaWRlLXVzZWZ1bC1hcnRpY2xlcy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tc2xpZGUtdXNlZnVsLWFydGljbGVzL3NhbXBsZS1wby1zbGlkZS11c2VmdWwtYXJ0aWNsZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tc2xpZGUtbGFuZHNjYXBlc1wiIHRpdGxlPVwiUG9ydGluYXJpIFNsaWRlIC0gTGFuZHNjYXBlc1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMvc2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMvc2FtcGxlLXBvLXNsaWRlLWxhbmRzY2FwZXMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tc2xpZGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tc2xpZGUuY29tcG9uZW50Lmh0bWwnLFxufSlcbmV4cG9ydCBjbGFzcyBQb1NsaWRlQ29tcG9uZW50IGV4dGVuZHMgUG9TbGlkZUJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBEb0NoZWNrIHtcblxuICBwcml2YXRlIGlzTG9hZGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgcGxheWVyOiBBbmltYXRpb25QbGF5ZXI7XG4gIHByaXZhdGUgc2V0SW50ZXJ2YWw6IGFueTtcblxuICBwcml2YXRlIGdldCBoYXNFbGVtZW50cygpIHtcbiAgICByZXR1cm4gISF0aGlzLnNsaWRlLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggJiYgISF0aGlzLml0ZW1zRWxlbWVudHMgJiYgISF0aGlzLml0ZW1zRWxlbWVudHMubGVuZ3RoO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgaXNJbWFnZVNsaWRlKCkge1xuICAgIHJldHVybiAhdGhpcy5zbGlkZUNvbnRlbnRUZW1wbGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG9mZnNldCgpIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50U2xpZGVJbmRleCAqIHRoaXMuc2xpZGVJdGVtV2lkdGg7XG4gIH1cblxuICBnZXQgaGFzU2xpZGVzKCkge1xuICAgIHJldHVybiAhIXRoaXMuc2xpZGVzICYmICEhdGhpcy5zbGlkZXMubGVuZ3RoO1xuICB9XG5cbiAgY3VycmVudFNsaWRlSW5kZXggPSAwO1xuICBpbWFnZUhlaWdodDogbnVtYmVyO1xuICBzbGlkZUl0ZW1zOiBBcnJheTxQb1NsaWRlSXRlbSB8IGFueT4gPSBbXTtcbiAgc2xpZGVJdGVtV2lkdGg6IG51bWJlcjtcblxuICBAQ29udGVudENoaWxkKFBvU2xpZGVDb250ZW50VGVtcGxhdGVEaXJlY3RpdmUsIHsgc3RhdGljOiB0cnVlIH0pIHNsaWRlQ29udGVudFRlbXBsYXRlOiBQb1NsaWRlQ29udGVudFRlbXBsYXRlRGlyZWN0aXZlO1xuXG4gIEBWaWV3Q2hpbGQoJ3NsaWRlJywgeyBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBzbGlkZTogRWxlbWVudFJlZjtcblxuICBAVmlld0NoaWxkcmVuKFBvU2xpZGVJdGVtQ29tcG9uZW50KSBwcml2YXRlIGl0ZW1zRWxlbWVudHM6IFF1ZXJ5TGlzdDxQb1NsaWRlSXRlbUNvbXBvbmVudD47XG5cbiAgQEhvc3RMaXN0ZW5lcignd2luZG93OnJlc2l6ZScpIG9uUmVzaXplKCkge1xuICAgIGlmICh0aGlzLnNsaWRlKSB7XG4gICAgICB0aGlzLnNldFNsaWRlSXRlbVdpZHRoKCk7XG4gICAgICB0aGlzLmdvVG9JdGVtKHRoaXMuY3VycmVudFNsaWRlSW5kZXgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlcikge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBuZ0RvQ2hlY2soKSB7XG5cbiAgICBpZiAoIXRoaXMuaXNMb2FkZWQgJiYgdGhpcy5oYXNFbGVtZW50cykge1xuXG4gICAgICB0aGlzLnNldFNsaWRlSXRlbVdpZHRoKCk7XG4gICAgICB0aGlzLmlzTG9hZGVkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMuaGFzU2xpZGVzKSB7XG4gICAgICAgIHRoaXMuc3RhcnRTbGlkZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdvVG9JdGVtKGluZGV4OiBudW1iZXIpIHtcblxuICAgIGlmICh0aGlzLmludGVydmFsID4gcG9TbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gaW5kZXg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIG5leHRDb250cm9sKCkge1xuXG4gICAgaWYgKHRoaXMuaW50ZXJ2YWwgPiBwb1NsaWRlSW50ZXJ2YWxNaW4pIHtcbiAgICAgIHRoaXMuc3RhcnRJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMubmV4dCgpO1xuICB9XG5cbiAgbmV4dCgpIHtcbiAgICBpZiAodGhpcy5jdXJyZW50U2xpZGVJbmRleCArIDEgPT09IHRoaXMuc2xpZGVJdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAwO1xuICAgICAgdGhpcy5hbmltYXRlKDApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gKHRoaXMuY3VycmVudFNsaWRlSW5kZXggKyAxKSAlIHRoaXMuc2xpZGVJdGVtcy5sZW5ndGg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIHByZXZpb3VzKCkge1xuICAgIGlmICh0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID09PSAwKSB7XG4gICAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gdGhpcy5zbGlkZUl0ZW1zLmxlbmd0aCAtIDE7XG4gICAgICB0aGlzLmFuaW1hdGUodGhpcy5vZmZzZXQpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmN1cnJlbnRTbGlkZUluZGV4ID0gKCh0aGlzLmN1cnJlbnRTbGlkZUluZGV4IC0gMSkgKyB0aGlzLnNsaWRlSXRlbXMubGVuZ3RoKSAlIHRoaXMuc2xpZGVJdGVtcy5sZW5ndGg7XG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIHByZXZpb3VzQ29udHJvbCgpIHtcblxuICAgIGlmICh0aGlzLmludGVydmFsID4gcG9TbGlkZUludGVydmFsTWluKSB7XG4gICAgICB0aGlzLnN0YXJ0SW50ZXJ2YWwoKTtcbiAgICB9XG5cbiAgICB0aGlzLnByZXZpb3VzKCk7XG4gIH1cblxuICBzZXRTbGlkZUhlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgIHRoaXMuc2V0SGVpZ2h0KGhlaWdodCk7XG4gIH1cblxuICBwcml2YXRlIGFuaW1hdGUob2Zmc2V0OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5oYXNFbGVtZW50cykge1xuICAgICAgY29uc3QgYW5pbWF0aW9uOiBBbmltYXRpb25GYWN0b3J5ID0gdGhpcy5idWlsZFRyYW5zaXRpb25BbmltYXRpb24ob2Zmc2V0KTtcblxuICAgICAgdGhpcy5wbGF5ZXIgPSBhbmltYXRpb24uY3JlYXRlKHRoaXMuc2xpZGUubmF0aXZlRWxlbWVudCk7XG4gICAgICB0aGlzLnBsYXllci5wbGF5KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFRyYW5zaXRpb25BbmltYXRpb24ob2Zmc2V0OiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5idWlsZGVyLmJ1aWxkKFtcbiAgICAgIGFuaW1hdGUoXG4gICAgICAgIHBvU2xpZGVUaW1pbmcsXG4gICAgICAgIGtleWZyYW1lcyhbc3R5bGUoeyB0cmFuc2Zvcm06IGB0cmFuc2xhdGVYKC0ke29mZnNldH1weClgIH0pXSlcbiAgICAgIClcbiAgICBdKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQXJyYXlGb3JUZW1wbGF0ZShzbGlkZXM6IEFycmF5PGFueT4pIHtcbiAgICB0aGlzLnNsaWRlSXRlbXMgPSBbLi4uc2xpZGVzXTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlQXJyYXlGcm9tU2xpZGVzKHNsaWRlczogQXJyYXk8UG9TbGlkZUl0ZW0gfCBzdHJpbmcgfCBhbnk+KSB7XG4gICAgY29uc3QgaXNTdHJpbmdBcnJheSA9IHNsaWRlcy5ldmVyeShpdGVtID0+IHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJyk7XG5cbiAgICBpZiAoaXNTdHJpbmdBcnJheSkge1xuICAgICAgc2xpZGVzLmZvckVhY2goZWxlbWVudCA9PiB0aGlzLnNsaWRlSXRlbXMucHVzaCh7IGltYWdlOiBgJHtlbGVtZW50fWAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNsaWRlSXRlbXMgPSBbLi4uPEFycmF5PFBvU2xpZGVJdGVtPj5zbGlkZXNdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0RGVmYXVsdEhlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgIGlmIChoZWlnaHQgJiYgaGVpZ2h0IDw9IHBvU2xpZGVNaW5IZWlnaHQgfHwgIWhlaWdodCAmJiB0aGlzLmlzSW1hZ2VTbGlkZSkge1xuICAgICAgdGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke3BvU2xpZGVEZWZhdWx0SGVpZ2h0fXB4YDtcbiAgICAgIHRoaXMuaW1hZ2VIZWlnaHQgPSBwb1NsaWRlRGVmYXVsdEhlaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbWFnZUhlaWdodCA9IHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEhlaWdodChoZWlnaHQ6IG51bWJlcikge1xuICAgIGlmIChoZWlnaHQgJiYgaGVpZ2h0ID4gcG9TbGlkZU1pbkhlaWdodCkge1xuICAgICAgdGhpcy5zbGlkZS5uYXRpdmVFbGVtZW50LnN0eWxlLmhlaWdodCA9IGAke2hlaWdodH1weGA7XG4gICAgICB0aGlzLmltYWdlSGVpZ2h0ID0gaGVpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldERlZmF1bHRIZWlnaHQoaGVpZ2h0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFNsaWRlSXRlbVdpZHRoKCkge1xuICAgIGlmICh0aGlzLmhhc0VsZW1lbnRzKSB7XG4gICAgICB0aGlzLnNsaWRlSXRlbVdpZHRoID0gdGhpcy5pdGVtc0VsZW1lbnRzLmZpcnN0Lml0ZW1FbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGNhbmNlbEludGVydmFsKCkge1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zZXRJbnRlcnZhbCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc2V0U2xpZGVJdGVtcyhzbGlkZXM6IEFycmF5PFBvU2xpZGVJdGVtIHwgc3RyaW5nIHwgYW55Pikge1xuXG4gICAgaWYgKHRoaXMuaGFzU2xpZGVzKSB7XG4gICAgICB0aGlzLnNsaWRlQ29udGVudFRlbXBsYXRlID8gdGhpcy5jcmVhdGVBcnJheUZvclRlbXBsYXRlKHNsaWRlcykgOiB0aGlzLmNyZWF0ZUFycmF5RnJvbVNsaWRlcyhzbGlkZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNsaWRlSXRlbXMgPSBbXTtcbiAgICAgIHRoaXMuY2FuY2VsSW50ZXJ2YWwoKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgc3RhcnRTbGlkZSgpIHtcblxuICAgIHRoaXMuc2V0U2xpZGVIZWlnaHQodGhpcy5oZWlnaHQpO1xuXG4gICAgaWYgKHRoaXMuaW50ZXJ2YWwgPiBwb1NsaWRlSW50ZXJ2YWxNaW4pIHtcbiAgICAgIHRoaXMuc3RhcnRJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMuY3VycmVudFNsaWRlSW5kZXggPSAwO1xuICB9XG5cbiAgcHJvdGVjdGVkIHN0YXJ0SW50ZXJ2YWwoKSB7XG5cbiAgICBpZiAodGhpcy5zZXRJbnRlcnZhbCkge1xuICAgICAgdGhpcy5jYW5jZWxJbnRlcnZhbCgpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0SW50ZXJ2YWwgPSB0aGlzLmhhc1NsaWRlcyAmJiB0aGlzLmhhc0VsZW1lbnRzID8gc2V0SW50ZXJ2YWwoKCkgPT4geyB0aGlzLm5leHQoKTsgfSwgdGhpcy5pbnRlcnZhbCkgOiB1bmRlZmluZWQ7XG4gIH1cblxufVxuIl19