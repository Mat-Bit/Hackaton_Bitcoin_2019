/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, Input, ViewChild } from '@angular/core';
import { convertToInt, convertToBoolean } from '../../../utils/util';
import { PoMenuItemsService } from '../services/po-menu-items.service';
// valor para que caibam 3 linhas de `label`
/** @type {?} */
var poMenuItemSubItemSize = 98;
/**
 * \@docsPrivate
 *
 * \@description
 *
 * Componente que implementa cada item do po-menu.
 */
var PoMenuItemComponent = /** @class */ (function () {
    function PoMenuItemComponent(menuItemsService) {
        this.menuItemsService = menuItemsService;
        this._isSelected = false;
        this._isSubItem = false;
        this.maxHeight = 0;
    }
    Object.defineProperty(PoMenuItemComponent.prototype, "badgeValue", {
        get: /**
         * @return {?}
         */
        function () {
            return this._badgeValue;
        },
        // Valor do badge.
        set: 
        // Valor do badge.
        /**
         * @param {?} badgeValue
         * @return {?}
         */
        function (badgeValue) {
            this._badgeValue = convertToInt(badgeValue);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuItemComponent.prototype, "isSelected", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isSelected;
        },
        // Indica se o item está selecionado.
        set: 
        // Indica se o item está selecionado.
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._isSelected = convertToBoolean(value);
            this.isSelectedSubItem = this.isSelected && this.isSubItem;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuItemComponent.prototype, "isSubItem", {
        get: /**
         * @return {?}
         */
        function () {
            return this._isSubItem;
        },
        // Indica se o item é um sub item
        set: 
        // Indica se o item é um sub item
        /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._isSubItem = convertToBoolean(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuItemComponent.prototype, "subItems", {
        get: /**
         * @return {?}
         */
        function () {
            return this._subItems;
        },
        // Lista de sub-items.
        set: 
        // Lista de sub-items.
        /**
         * @param {?} subitems
         * @return {?}
         */
        function (subitems) {
            this._subItems = subitems;
            if (this.isOpened) {
                this.calcMenuSubItemsMaxHeight();
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuItemComponent.prototype, "canShowBadge", {
        get: /**
         * @return {?}
         */
        function () {
            return this.type !== 'subItems' && (this.badgeValue || this.badgeValue === 0) && this.badgeValue >= 0;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoMenuItemComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.itemSubscription.unsubscribe();
    };
    /**
     * @return {?}
     */
    PoMenuItemComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // subscribe to menu component messages
        this.itemSubscription = this.menuItemsService.receiveFromParentMenuClicked().subscribe((/**
         * @param {?} menu
         * @return {?}
         */
        function (menu) {
            _this.processMenuItem(menu);
        }));
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PoMenuItemComponent.prototype.clickMenuItem = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (!(event.ctrlKey || event.metaKey)) {
            event.preventDefault();
            // Emmit to parent
            this.menuItemsService.sendToParentMenuClicked({
                link: this.link,
                action: this.action,
                id: this.id,
                icon: this.icon,
                label: this.label,
                level: this.level,
                subItems: this.subItems,
                isSelected: this.isSelected,
                isOpened: this.isOpened,
                shortLabel: this.shortLabel,
                type: this.type
            });
        }
    };
    /**
     * @private
     * @param {?} menuActive
     * @param {?} menuOpened
     * @param {?} hasSubItemOpened
     * @param {?} activatedByRoute
     * @return {?}
     */
    PoMenuItemComponent.prototype.accordionAnimation = /**
     * @private
     * @param {?} menuActive
     * @param {?} menuOpened
     * @param {?} hasSubItemOpened
     * @param {?} activatedByRoute
     * @return {?}
     */
    function (menuActive, menuOpened, hasSubItemOpened, activatedByRoute) {
        if (this.id === menuOpened['id']) {
            this.maxHeight = this.subItems.length * poMenuItemSubItemSize;
        }
        if (hasSubItemOpened) {
            this.maxHeight = menuOpened['isOpened'] ?
                (this.maxHeight + menuOpened.subItems.length * poMenuItemSubItemSize) :
                (this.maxHeight - menuOpened.subItems.length * poMenuItemSubItemSize);
            if (activatedByRoute) {
                this.maxHeight = this.getMinimumHeight(0, this, menuActive);
            }
        }
    };
    /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    PoMenuItemComponent.prototype.activateMenu = /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    function (menu) {
        this.isSelected = menu && this.id === menu.id;
    };
    /**
     * @private
     * @return {?}
     */
    PoMenuItemComponent.prototype.calcMenuSubItemsMaxHeight = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        setTimeout((/**
         * @return {?}
         */
        function () {
            /** @type {?} */
            var subItems = Array.from(_this.menuSubItems.nativeElement.querySelectorAll('.po-menu-item'));
            subItems.forEach((/**
             * @param {?} menuItem
             * @return {?}
             */
            function (menuItem) { return _this.maxHeight += menuItem.offsetHeight; }));
        }));
    };
    /**
     * @private
     * @param {?} minimumHeight
     * @param {?} menuItem
     * @param {?} menuActive
     * @return {?}
     */
    PoMenuItemComponent.prototype.getMinimumHeight = /**
     * @private
     * @param {?} minimumHeight
     * @param {?} menuItem
     * @param {?} menuActive
     * @return {?}
     */
    function (minimumHeight, menuItem, menuActive) {
        minimumHeight += poMenuItemSubItemSize;
        if (menuItem.subItems && this.hasSubItem(menuItem.subItems, menuActive['id'])) {
            for (var index = 0; index < menuItem.subItems.length; index++) {
                minimumHeight = this.getMinimumHeight(minimumHeight, menuItem.subItems[index], menuActive);
            }
        }
        return minimumHeight;
    };
    /**
     * @private
     * @param {?} menuActive
     * @param {?} menuOpened
     * @param {?=} activatedByRoute
     * @return {?}
     */
    PoMenuItemComponent.prototype.groupedMenu = /**
     * @private
     * @param {?} menuActive
     * @param {?} menuOpened
     * @param {?=} activatedByRoute
     * @return {?}
     */
    function (menuActive, menuOpened, activatedByRoute) {
        if (activatedByRoute === void 0) { activatedByRoute = false; }
        /** @type {?} */
        var hasSubItemOpened = (menuOpened && this.id !== menuOpened['id']) ? this.hasSubItem(this.subItems, menuOpened['id']) : false;
        this.isOpened = this.isMenuOpened(menuOpened, hasSubItemOpened);
        this.isSelected = (menuActive && !this.isOpened) ? this.hasSubItem(this.subItems, menuActive['id']) : false;
        if (!this.isOpened) {
            this.maxHeight = 0;
            return;
        }
        this.accordionAnimation(menuActive, menuOpened, hasSubItemOpened, activatedByRoute);
    };
    /**
     * @private
     * @param {?} subItems
     * @param {?} id
     * @return {?}
     */
    PoMenuItemComponent.prototype.hasSubItem = /**
     * @private
     * @param {?} subItems
     * @param {?} id
     * @return {?}
     */
    function (subItems, id) {
        var _this = this;
        if (subItems) {
            return subItems.some((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                return item['id'] === id ? true : _this.hasSubItem(item.subItems, id);
            }));
        }
    };
    /**
     * @private
     * @param {?} menuOpened
     * @param {?} hasSubItemOpened
     * @return {?}
     */
    PoMenuItemComponent.prototype.isMenuOpened = /**
     * @private
     * @param {?} menuOpened
     * @param {?} hasSubItemOpened
     * @return {?}
     */
    function (menuOpened, hasSubItemOpened) {
        if (menuOpened) {
            return (this.id === menuOpened['id']) ? menuOpened['isOpened'] : hasSubItemOpened;
        }
        return false;
    };
    /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    PoMenuItemComponent.prototype.processMenuItem = /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    function (menu) {
        if (this.type === 'internalLink') {
            this.activateMenu(menu.active);
            return;
        }
        if (this.type === 'subItems') {
            this.groupedMenu(menu.active, menu.grouped, menu.activatedByRoute);
            return;
        }
    };
    PoMenuItemComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-menu-item',
                    template: "<!-- menu com link interno -->\n<a *ngIf=\"type === 'internalLink'\" class=\"po-menu-item-link\" [routerLink]=\"link\">\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\n</a>\n<!-- menu com link externo -->\n<a *ngIf=\"type === 'externalLink'\" class=\"po-menu-item-link\" [href]=\"link\">\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\n</a>\n<!-- menu sem link -->\n<a *ngIf=\"type === 'noLink'\" class=\"po-menu-item-link\" href=\"javascript:;\">\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate\"></ng-container>\n</a>\n<!-- menu com sub itens -->\n<div *ngIf=\"type === 'subItems'\" class=\"po-menu-item-link po-clickable\">\n  <ng-container *ngTemplateOutlet=\"menuItemTemplate;\"></ng-container>\n  <div #menuSubItems\n    class=\"po-menu-sub-items\"\n    [hidden]=\"collapsedMenu\"\n    [style.maxHeight.px]=\"maxHeight\">\n    <div *ngFor=\"let subItem of subItems\">\n      <po-menu-item\n        p-is-sub-item\n        [p-action]=\"subItem.action\"\n        [p-badge-alert]=\"subItem.badgeAlert\"\n        [p-badge-color]=\"subItem.badge ? subItem.badge.color : undefined\"\n        [p-badge-value]=\"subItem.badge ? subItem.badge.value : undefined\"\n        [p-id]=\"subItem.id\"\n        [p-label]=\"subItem.label\"\n        [p-level]=\"subItem.level\"\n        [p-link]=\"subItem.link\"\n        [p-sub-items]=\"subItem.subItems\"\n        [p-type]=\"subItem.type\">\n      </po-menu-item>\n    </div>\n  </div>\n</div>\n\n<ng-template #menuItemTemplate>\n  <div class=\"po-menu-item\"\n    [class.po-menu-icon-container]=\"level === 1 && icon\"\n    [class.po-menu-item-selected]=\"isSelected\"\n    [class.po-menu-item-level-two]=\"level === 2\"\n    [class.po-menu-item-level-three]=\"level === 3\"\n    [class.po-menu-item-level-four]=\"level === 4\"\n    [class.po-menu-item-grouper-up]=\"type === 'subItems' && isOpened\"\n    [class.po-menu-item-grouper-down]=\"type === 'subItems' && !isOpened\"\n    [class.po-menu-sub-item-selected]=\"isSelectedSubItem\"\n    (click)=\"clickMenuItem($event);\">\n    <po-badge *ngIf=\"canShowBadge\"\n      [ngClass]=\"!collapsedMenu ? 'po-menu-badge-align' : 'po-menu-badge-align-collapsed'\"\n      [p-color]=\"badgeColor\"\n      [p-value]=\"badgeValue\">\n    </po-badge>\n    <span *ngIf=\"level === 1 && icon\" class=\"po-icon {{icon}} po-menu-icon-item\"></span>\n    <div *ngIf=\"badgeAlert\"\n      class=\"po-color-07\"\n      [ngClass]=\"!collapsedMenu ? 'po-menu-badge-alert' : 'po-menu-badge-alert-collapsed'\">\n    </div>\n    <span *ngIf=\"type === 'subItems' && !collapsedMenu\"\n      class=\"po-icon po-menu-group-icon\"\n      [class.po-icon-arrow-up]=\"isOpened\"\n      [class.po-icon-arrow-down]=\"!isOpened\">\n    </span>\n    <div [class.po-menu-icon-label]=\"level === 1 && icon\">\n      {{ label }}\n    </div>\n    <div *ngIf=\"collapsedMenu\" class=\"po-menu-short-label\">{{ shortLabel }}</div>\n  </div>\n</ng-template>\n"
                }] }
    ];
    /** @nocollapse */
    PoMenuItemComponent.ctorParameters = function () { return [
        { type: PoMenuItemsService }
    ]; };
    PoMenuItemComponent.propDecorators = {
        action: [{ type: Input, args: ['p-action',] }],
        badgeAlert: [{ type: Input, args: ['p-badge-alert',] }],
        badgeColor: [{ type: Input, args: ['p-badge-color',] }],
        badgeValue: [{ type: Input, args: ['p-badge-value',] }],
        collapsedMenu: [{ type: Input, args: ['p-collapsed-menu',] }],
        icon: [{ type: Input, args: ['p-icon',] }],
        id: [{ type: Input, args: ['p-id',] }],
        isOpened: [{ type: Input, args: ['p-is-opened',] }],
        isSelected: [{ type: Input, args: ['p-is-selected',] }],
        isSubItem: [{ type: Input, args: ['p-is-sub-item',] }],
        label: [{ type: Input, args: ['p-label',] }],
        level: [{ type: Input, args: ['p-level',] }],
        link: [{ type: Input, args: ['p-link',] }],
        shortLabel: [{ type: Input, args: ['p-short-label',] }],
        subItems: [{ type: Input, args: ['p-sub-items',] }],
        type: [{ type: Input, args: ['p-type',] }],
        menuSubItems: [{ type: ViewChild, args: ['menuSubItems', { static: false },] }]
    };
    return PoMenuItemComponent;
}());
export { PoMenuItemComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoMenuItemComponent.prototype._badgeValue;
    /**
     * @type {?}
     * @private
     */
    PoMenuItemComponent.prototype._isSelected;
    /**
     * @type {?}
     * @private
     */
    PoMenuItemComponent.prototype._isSubItem;
    /**
     * @type {?}
     * @private
     */
    PoMenuItemComponent.prototype._subItems;
    /** @type {?} */
    PoMenuItemComponent.prototype.isSelectedSubItem;
    /** @type {?} */
    PoMenuItemComponent.prototype.maxHeight;
    /**
     * @type {?}
     * @private
     */
    PoMenuItemComponent.prototype.itemSubscription;
    /** @type {?} */
    PoMenuItemComponent.prototype.action;
    /** @type {?} */
    PoMenuItemComponent.prototype.badgeAlert;
    /** @type {?} */
    PoMenuItemComponent.prototype.badgeColor;
    /** @type {?} */
    PoMenuItemComponent.prototype.collapsedMenu;
    /** @type {?} */
    PoMenuItemComponent.prototype.icon;
    /** @type {?} */
    PoMenuItemComponent.prototype.id;
    /** @type {?} */
    PoMenuItemComponent.prototype.isOpened;
    /** @type {?} */
    PoMenuItemComponent.prototype.label;
    /** @type {?} */
    PoMenuItemComponent.prototype.level;
    /** @type {?} */
    PoMenuItemComponent.prototype.link;
    /** @type {?} */
    PoMenuItemComponent.prototype.shortLabel;
    /** @type {?} */
    PoMenuItemComponent.prototype.type;
    /** @type {?} */
    PoMenuItemComponent.prototype.menuSubItems;
    /**
     * @type {?}
     * @private
     */
    PoMenuItemComponent.prototype.menuItemsService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbWVudS1pdGVtLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tbWVudS9wby1tZW51LWl0ZW0vcG8tbWVudS1pdGVtLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFxQixTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFJM0YsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3JFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG1DQUFtQyxDQUFDOzs7SUFHakUscUJBQXFCLEdBQUcsRUFBRTs7Ozs7Ozs7QUFTaEM7SUFrR0UsNkJBQW9CLGdCQUFvQztRQUFwQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQW9CO1FBM0ZoRCxnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUM3QixlQUFVLEdBQVksS0FBSyxDQUFDO1FBSXBDLGNBQVMsR0FBVyxDQUFDLENBQUM7SUFzRnNDLENBQUM7SUF4RTdELHNCQUE0QiwyQ0FBVTs7OztRQUl0QztZQUNFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUMxQixDQUFDO1FBUEQsa0JBQWtCOzs7Ozs7O1FBQ2xCLFVBQXVDLFVBQWtCO1lBQ3ZELElBQUksQ0FBQyxXQUFXLEdBQUcsWUFBWSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzlDLENBQUM7OztPQUFBO0lBbUJELHNCQUE0QiwyQ0FBVTs7OztRQUt0QztZQUNFLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUMxQixDQUFDO1FBUkQscUNBQXFDOzs7Ozs7O1FBQ3JDLFVBQXVDLEtBQWM7WUFDbkQsSUFBSSxDQUFDLFdBQVcsR0FBRyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUUzQyxJQUFJLENBQUMsaUJB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QixLQUFLLFNBQUMsVUFBVTs2QkFHaEIsS0FBSyxTQUFDLGVBQWU7NkJBR3JCLEtBQUssU0FBQyxlQUFlOzZCQUdyQixLQUFLLFNBQUMsZUFBZTtnQ0FTckIsS0FBSyxTQUFDLGtCQUFrQjt1QkFHeEIsS0FBSyxTQUFDLFFBQVE7cUJBR2QsS0FBSyxTQUFDLE1BQU07MkJBR1osS0FBSyxTQUFDLGFBQWE7NkJBR25CLEtBQUssU0FBQyxlQUFlOzRCQVVyQixLQUFLLFNBQUMsZUFBZTt3QkFTckIsS0FBSyxTQUFDLFNBQVM7d0JBR2YsS0FBSyxTQUFDLFNBQVM7dUJBR2YsS0FBSyxTQUFDLFFBQVE7NkJBR2QsS0FBSyxTQUFDLGVBQWU7MkJBR3JCLEtBQUssU0FBQyxhQUFhO3VCQVluQixLQUFLLFNBQUMsUUFBUTsrQkFFZCxTQUFTLFNBQUMsY0FBYyxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTs7SUE2SDlDLDBCQUFDO0NBQUEsQUF6TkQsSUF5TkM7U0FyTlksbUJBQW1COzs7Ozs7SUFFOUIsMENBQTRCOzs7OztJQUM1QiwwQ0FBcUM7Ozs7O0lBQ3JDLHlDQUFvQzs7Ozs7SUFDcEMsd0NBQXFDOztJQUVyQyxnREFBa0I7O0lBQ2xCLHdDQUFzQjs7Ozs7SUFFdEIsK0NBQXVDOztJQUd2QyxxQ0FBNkM7O0lBRzdDLHlDQUE0Qzs7SUFHNUMseUNBQTJDOztJQVkzQyw0Q0FBa0Q7O0lBR2xELG1DQUE4Qjs7SUFHOUIsaUNBQTBCOztJQUcxQix1Q0FBd0M7O0lBc0J4QyxvQ0FBZ0M7O0lBR2hDLG9DQUFnQzs7SUFHaEMsbUNBQStCOztJQUcvQix5Q0FBMkM7O0lBZTNDLG1DQUE4Qjs7SUFFOUIsMkNBQXVFOzs7OztJQU0zRCwrQ0FBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBjb252ZXJ0VG9JbnQsIGNvbnZlcnRUb0Jvb2xlYW4gfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcblxuaW1wb3J0IHsgUG9NZW51SXRlbSB9IGZyb20gJy4uL3BvLW1lbnUtaXRlbS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9NZW51SXRlbXNTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvcG8tbWVudS1pdGVtcy5zZXJ2aWNlJztcblxuLy8gdmFsb3IgcGFyYSBxdWUgY2FpYmFtIDMgbGluaGFzIGRlIGBsYWJlbGBcbmNvbnN0IHBvTWVudUl0ZW1TdWJJdGVtU2l6ZSA9IDk4O1xuXG4vKipcbiAqIEBkb2NzUHJpdmF0ZVxuICpcbiAqIEBkZXNjcmlwdGlvblxuICpcbiAqIENvbXBvbmVudGUgcXVlIGltcGxlbWVudGEgY2FkYSBpdGVtIGRvIHBvLW1lbnUuXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvLW1lbnUtaXRlbScsXG4gIHRlbXBsYXRlVXJsOiAnLi9wby1tZW51LWl0ZW0uY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvTWVudUl0ZW1Db21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG5cbiAgcHJpdmF0ZSBfYmFkZ2VWYWx1ZTogbnVtYmVyO1xuICBwcml2YXRlIF9pc1NlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgX2lzU3ViSXRlbTogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIF9zdWJJdGVtczogQXJyYXk8UG9NZW51SXRlbT47XG5cbiAgaXNTZWxlY3RlZFN1Ykl0ZW07XG4gIG1heEhlaWdodDogbnVtYmVyID0gMDtcblxuICBwcml2YXRlIGl0ZW1TdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcblxuICAvLyBBw6fDo28gcXVlIHNlcsOhIGNoYW1hZGEgYW8gY2xpY2FyIG5vIGl0ZW0uXG4gIEBJbnB1dCgncC1hY3Rpb24nKSBhY3Rpb246IHN0cmluZyB8IEZ1bmN0aW9uO1xuXG4gIC8vIEluZGljYSBzZSBjb250w6ltIGFsZ3VtIGl0ZW0gZmlsaG8gY29tIG8gYmFkZ2UuXG4gIEBJbnB1dCgncC1iYWRnZS1hbGVydCcpIGJhZGdlQWxlcnQ6IGJvb2xlYW47XG5cbiAgLy8gQ29yIGRvIGJhZGdlLlxuICBASW5wdXQoJ3AtYmFkZ2UtY29sb3InKSBiYWRnZUNvbG9yOiBzdHJpbmc7XG5cbiAgLy8gVmFsb3IgZG8gYmFkZ2UuXG4gIEBJbnB1dCgncC1iYWRnZS12YWx1ZScpIHNldCBiYWRnZVZhbHVlKGJhZGdlVmFsdWU6IG51bWJlcikge1xuICAgIHRoaXMuX2JhZGdlVmFsdWUgPSBjb252ZXJ0VG9JbnQoYmFkZ2VWYWx1ZSk7XG4gIH1cblxuICBnZXQgYmFkZ2VWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fYmFkZ2VWYWx1ZTtcbiAgfVxuXG4gIC8vIEluZGljYSBzZSBvIG1lbnUgZXN0w6EgY29sYXBzYWRvXG4gIEBJbnB1dCgncC1jb2xsYXBzZWQtbWVudScpIGNvbGxhcHNlZE1lbnU6IGJvb2xlYW47XG5cbiAgLy8gw41jb25lIGRlIG1lbnVcbiAgQElucHV0KCdwLWljb24nKSBpY29uOiBzdHJpbmc7XG5cbiAgLy8gSWRlbnRpZmljYWRvciBkbyBpdGVtLlxuICBASW5wdXQoJ3AtaWQnKSBpZDogc3RyaW5nO1xuXG4gIC8vIEluZGljYSBzZSBvIGl0ZW0gZXN0w6EgYWJlcnRvIChtZW51IGFncnVwYWRvKVxuICBASW5wdXQoJ3AtaXMtb3BlbmVkJykgaXNPcGVuZWQ6IGJvb2xlYW47XG5cbiAgLy8gSW5kaWNhIHNlIG8gaXRlbSBlc3TDoSBzZWxlY2lvbmFkby5cbiAgQElucHV0KCdwLWlzLXNlbGVjdGVkJykgc2V0IGlzU2VsZWN0ZWQodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9pc1NlbGVjdGVkID0gY29udmVydFRvQm9vbGVhbih2YWx1ZSk7XG5cbiAgICB0aGlzLmlzU2VsZWN0ZWRTdWJJdGVtID0gdGhpcy5pc1NlbGVjdGVkICYmIHRoaXMuaXNTdWJJdGVtO1xuICB9XG4gIGdldCBpc1NlbGVjdGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9pc1NlbGVjdGVkO1xuICB9XG5cbiAgLy8gSW5kaWNhIHNlIG8gaXRlbSDDqSB1bSBzdWIgaXRlbVxuICBASW5wdXQoJ3AtaXMtc3ViLWl0ZW0nKSBzZXQgaXNTdWJJdGVtKHZhbHVlOiBib29sZWFuKSB7XG4gICAgdGhpcy5faXNTdWJJdGVtID0gY29udmVydFRvQm9vbGVhbih2YWx1ZSk7XG4gIH1cblxuICBnZXQgaXNTdWJJdGVtKCkge1xuICAgIHJldHVybiB0aGlzLl9pc1N1Ykl0ZW07XG4gIH1cblxuICAvLyBUZXh0byBxdWUgYXBhcmVjZXLDoSByZXByZXNlbnRhbmRvIG8gaXRlbS5cbiAgQElucHV0KCdwLWxhYmVsJykgbGFiZWw6IHN0cmluZztcblxuICAvLyBJbmRpY2EgcXVhbCBlbSBuw612ZWwgZG8gcG8tbWVudSBlbmNvbnRyYS1zZS5cbiAgQElucHV0KCdwLWxldmVsJykgbGV2ZWw6IG51bWJlcjtcblxuICAvLyBMaW5rIGRvIGl0ZW0uXG4gIEBJbnB1dCgncC1saW5rJykgbGluaz86IHN0cmluZztcblxuICAvLyBUZXh0byBxdWUgYXBhcmVjZXLDoSByZXByZXNlbnRhbmRvIG8gaXRlbS5cbiAgQElucHV0KCdwLXNob3J0LWxhYmVsJykgc2hvcnRMYWJlbDogc3RyaW5nO1xuXG4gIC8vIExpc3RhIGRlIHN1Yi1pdGVtcy5cbiAgQElucHV0KCdwLXN1Yi1pdGVtcycpIHNldCBzdWJJdGVtcyhzdWJpdGVtczogQXJyYXk8UG9NZW51SXRlbT4pIHtcbiAgICB0aGlzLl9zdWJJdGVtcyA9IHN1Yml0ZW1zO1xuICAgIGlmICh0aGlzLmlzT3BlbmVkKSB7XG4gICAgICB0aGlzLmNhbGNNZW51U3ViSXRlbXNNYXhIZWlnaHQoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgc3ViSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3N1Ykl0ZW1zO1xuICB9XG5cbiAgLy8gSW5kaWNhIG8gdGlwbyBkZSBpdGVtLCBjb21vICdpbnRlcm5hbExpbmsnIG91ICdzdWJJdGVtcycuXG4gIEBJbnB1dCgncC10eXBlJykgdHlwZTogc3RyaW5nO1xuXG4gIEBWaWV3Q2hpbGQoJ21lbnVTdWJJdGVtcycsIHsgc3RhdGljOiBmYWxzZSB9KSBtZW51U3ViSXRlbXM6IEVsZW1lbnRSZWY7XG5cbiAgZ2V0IGNhblNob3dCYWRnZSgpIHtcbiAgICByZXR1cm4gdGhpcy50eXBlICE9PSAnc3ViSXRlbXMnICYmICh0aGlzLmJhZGdlVmFsdWUgfHwgdGhpcy5iYWRnZVZhbHVlID09PSAwKSAmJiB0aGlzLmJhZGdlVmFsdWUgPj0gMDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbWVudUl0ZW1zU2VydmljZTogUG9NZW51SXRlbXNTZXJ2aWNlKSB7IH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLml0ZW1TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuXG4gICAgLy8gc3Vic2NyaWJlIHRvIG1lbnUgY29tcG9uZW50IG1lc3NhZ2VzXG4gICAgdGhpcy5pdGVtU3Vic2NyaXB0aW9uID0gdGhpcy5tZW51SXRlbXNTZXJ2aWNlLnJlY2VpdmVGcm9tUGFyZW50TWVudUNsaWNrZWQoKS5zdWJzY3JpYmUobWVudSA9PiB7XG4gICAgICB0aGlzLnByb2Nlc3NNZW51SXRlbShtZW51KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsaWNrTWVudUl0ZW0oZXZlbnQpOiB2b2lkIHtcbiAgICBpZiAoIShldmVudC5jdHJsS2V5IHx8IGV2ZW50Lm1ldGFLZXkpKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAvLyBFbW1pdCB0byBwYXJlbnRcbiAgICAgIHRoaXMubWVudUl0ZW1zU2VydmljZS5zZW5kVG9QYXJlbnRNZW51Q2xpY2tlZCh7XG4gICAgICAgIGxpbms6IHRoaXMubGluayxcbiAgICAgICAgYWN0aW9uOiB0aGlzLmFjdGlvbixcbiAgICAgICAgaWQ6IHRoaXMuaWQsXG4gICAgICAgIGljb246IHRoaXMuaWNvbixcbiAgICAgICAgbGFiZWw6IHRoaXMubGFiZWwsXG4gICAgICAgIGxldmVsOiB0aGlzLmxldmVsLFxuICAgICAgICBzdWJJdGVtczogdGhpcy5zdWJJdGVtcyxcbiAgICAgICAgaXNTZWxlY3RlZDogdGhpcy5pc1NlbGVjdGVkLFxuICAgICAgICBpc09wZW5lZDogdGhpcy5pc09wZW5lZCxcbiAgICAgICAgc2hvcnRMYWJlbDogdGhpcy5zaG9ydExhYmVsLFxuICAgICAgICB0eXBlOiB0aGlzLnR5cGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWNjb3JkaW9uQW5pbWF0aW9uKG1lbnVBY3RpdmU6IFBvTWVudUl0ZW0sIG1lbnVPcGVuZWQ6IFBvTWVudUl0ZW0sIGhhc1N1Ykl0ZW1PcGVuZWQ6IGJvb2xlYW4sIGFjdGl2YXRlZEJ5Um91dGU6IGJvb2xlYW4pIHtcblxuICAgIGlmICh0aGlzLmlkID09PSBtZW51T3BlbmVkWydpZCddKSB7XG4gICAgICB0aGlzLm1heEhlaWdodCA9IHRoaXMuc3ViSXRlbXMubGVuZ3RoICogcG9NZW51SXRlbVN1Ykl0ZW1TaXplO1xuICAgIH1cblxuICAgIGlmIChoYXNTdWJJdGVtT3BlbmVkKSB7XG4gICAgICB0aGlzLm1heEhlaWdodCA9IG1lbnVPcGVuZWRbJ2lzT3BlbmVkJ10gP1xuICAgICAgICAodGhpcy5tYXhIZWlnaHQgKyBtZW51T3BlbmVkLnN1Ykl0ZW1zLmxlbmd0aCAqIHBvTWVudUl0ZW1TdWJJdGVtU2l6ZSkgOlxuICAgICAgICAodGhpcy5tYXhIZWlnaHQgLSBtZW51T3BlbmVkLnN1Ykl0ZW1zLmxlbmd0aCAqIHBvTWVudUl0ZW1TdWJJdGVtU2l6ZSk7XG5cbiAgICAgIGlmIChhY3RpdmF0ZWRCeVJvdXRlKSB7XG4gICAgICAgIHRoaXMubWF4SGVpZ2h0ID0gdGhpcy5nZXRNaW5pbXVtSGVpZ2h0KDAsIHRoaXMsIG1lbnVBY3RpdmUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWN0aXZhdGVNZW51KG1lbnU6IGFueSk6IHZvaWQge1xuICAgIHRoaXMuaXNTZWxlY3RlZCA9IG1lbnUgJiYgdGhpcy5pZCA9PT0gbWVudS5pZDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY01lbnVTdWJJdGVtc01heEhlaWdodCgpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IHN1Ykl0ZW1zID0gQXJyYXkuZnJvbSh0aGlzLm1lbnVTdWJJdGVtcy5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wby1tZW51LWl0ZW0nKSk7XG4gICAgICBzdWJJdGVtcy5mb3JFYWNoKChtZW51SXRlbTogYW55KSA9PiB0aGlzLm1heEhlaWdodCArPSBtZW51SXRlbS5vZmZzZXRIZWlnaHQpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRNaW5pbXVtSGVpZ2h0KG1pbmltdW1IZWlnaHQ6IG51bWJlciwgbWVudUl0ZW06IFBvTWVudUl0ZW0sIG1lbnVBY3RpdmU6IFBvTWVudUl0ZW0pIHtcbiAgICBtaW5pbXVtSGVpZ2h0ICs9IHBvTWVudUl0ZW1TdWJJdGVtU2l6ZTtcblxuICAgIGlmIChtZW51SXRlbS5zdWJJdGVtcyAmJiB0aGlzLmhhc1N1Ykl0ZW0obWVudUl0ZW0uc3ViSXRlbXMsIG1lbnVBY3RpdmVbJ2lkJ10pKSB7XG4gICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbWVudUl0ZW0uc3ViSXRlbXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIG1pbmltdW1IZWlnaHQgPSB0aGlzLmdldE1pbmltdW1IZWlnaHQobWluaW11bUhlaWdodCwgbWVudUl0ZW0uc3ViSXRlbXNbaW5kZXhdLCBtZW51QWN0aXZlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbWluaW11bUhlaWdodDtcbiAgfVxuXG4gIHByaXZhdGUgZ3JvdXBlZE1lbnUobWVudUFjdGl2ZTogUG9NZW51SXRlbSwgbWVudU9wZW5lZDogUG9NZW51SXRlbSwgYWN0aXZhdGVkQnlSb3V0ZTogYm9vbGVhbiA9IGZhbHNlKTogdm9pZCB7XG5cbiAgICBjb25zdCBoYXNTdWJJdGVtT3BlbmVkID0gKG1lbnVPcGVuZWQgJiYgdGhpcy5pZCAhPT0gbWVudU9wZW5lZFsnaWQnXSkgPyB0aGlzLmhhc1N1Ykl0ZW0odGhpcy5zdWJJdGVtcywgbWVudU9wZW5lZFsnaWQnXSkgOiBmYWxzZTtcblxuICAgIHRoaXMuaXNPcGVuZWQgPSB0aGlzLmlzTWVudU9wZW5lZChtZW51T3BlbmVkLCBoYXNTdWJJdGVtT3BlbmVkKTtcblxuICAgIHRoaXMuaXNTZWxlY3RlZCA9IChtZW51QWN0aXZlICYmICF0aGlzLmlzT3BlbmVkKSA/IHRoaXMuaGFzU3ViSXRlbSh0aGlzLnN1Ykl0ZW1zLCBtZW51QWN0aXZlWydpZCddKSA6IGZhbHNlO1xuXG4gICAgaWYgKCF0aGlzLmlzT3BlbmVkKSB7XG4gICAgICB0aGlzLm1heEhlaWdodCA9IDA7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuYWNjb3JkaW9uQW5pbWF0aW9uKG1lbnVBY3RpdmUsIG1lbnVPcGVuZWQsIGhhc1N1Ykl0ZW1PcGVuZWQsIGFjdGl2YXRlZEJ5Um91dGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYXNTdWJJdGVtKHN1Ykl0ZW1zOiBBcnJheTxQb01lbnVJdGVtPiwgaWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGlmIChzdWJJdGVtcykge1xuICAgICAgcmV0dXJuIHN1Ykl0ZW1zLnNvbWUoaXRlbSA9PiB7XG4gICAgICAgIHJldHVybiBpdGVtWydpZCddID09PSBpZCA/IHRydWUgOiB0aGlzLmhhc1N1Ykl0ZW0oaXRlbS5zdWJJdGVtcywgaWQpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc01lbnVPcGVuZWQobWVudU9wZW5lZDogUG9NZW51SXRlbSwgaGFzU3ViSXRlbU9wZW5lZDogYm9vbGVhbik6IGJvb2xlYW4ge1xuICAgIGlmIChtZW51T3BlbmVkKSB7XG4gICAgICByZXR1cm4gKHRoaXMuaWQgPT09IG1lbnVPcGVuZWRbJ2lkJ10pID8gbWVudU9wZW5lZFsnaXNPcGVuZWQnXSA6IGhhc1N1Ykl0ZW1PcGVuZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSBwcm9jZXNzTWVudUl0ZW0obWVudSkge1xuXG4gICAgaWYgKHRoaXMudHlwZSA9PT0gJ2ludGVybmFsTGluaycpIHtcbiAgICAgIHRoaXMuYWN0aXZhdGVNZW51KG1lbnUuYWN0aXZlKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy50eXBlID09PSAnc3ViSXRlbXMnKSB7XG4gICAgICB0aGlzLmdyb3VwZWRNZW51KG1lbnUuYWN0aXZlLCBtZW51Lmdyb3VwZWQsIG1lbnUuYWN0aXZhdGVkQnlSb3V0ZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==