/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Input } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, convertToInt, isExternalLink, isTypeof, poLocaleDefault, validValue } from '../../utils/util';
/** @type {?} */
export var poMenuLiteralsDefault = {
    en: { itemNotFound: 'Item not found.' },
    es: { itemNotFound: 'Elemento no encontrado.' },
    pt: { itemNotFound: 'Item não encontrado.' }
};
/**
 * \@description
 *
 * Este é um componente de menu lateral que é utilizado para navegação nas páginas de uma aplicação.
 *
 * O componente po-menu recebe uma lista de objetos do tipo `MenuItem` com as informações dos itens de menu como
 * textos, links para redirecionamento, ações, até 4 níveis de menu e ícones para o primeiro nível de menu.
 * @abstract
 */
var PoMenuBaseComponent = /** @class */ (function () {
    function PoMenuBaseComponent(menuService) {
        this.menuService = menuService;
        this._collapsed = false;
        this._filter = false;
        this._maxLevel = 4;
        this._menus = [];
        this.literals = tslib_1.__assign({}, poMenuLiteralsDefault[poLocaleDefault], poMenuLiteralsDefault[browserLanguage()]);
    }
    Object.defineProperty(PoMenuBaseComponent.prototype, "collapsed", {
        get: /**
         * @return {?}
         */
        function () {
            return this._collapsed;
        },
        /**
         * @optional
         *
         * @description
         *
         * Colapsa (retrai) o menu e caso receba o valor `false` expande o menu.
         *
         * > Utilize esta propriedade para iniciar o menu colapsado.
         *
         * > Ao utilizar os métodos [`colapse`](documentation/po-menu#colapseMethod), [`expand`](documentation/po-menu#expandMethod) e
         * [`toggle`](documentation/po-menu#toggleMethod) o valor desta propriedade não é alterado.
         *
         * **Importante:**
         *
         * > O menu será colapsado/expandido apenas se todos os itens de menu tiverem valor nas propriedades `icon` e `shortLabel`.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Colapsa (retrai) o menu e caso receba o valor `false` expande o menu.
         *
         * > Utilize esta propriedade para iniciar o menu colapsado.
         *
         * > Ao utilizar os métodos [`colapse`](documentation/po-menu#colapseMethod), [`expand`](documentation/po-menu#expandMethod) e
         * [`toggle`](documentation/po-menu#toggleMethod) o valor desta propriedade não é alterado.
         *
         * **Importante:**
         *
         * > O menu será colapsado/expandido apenas se todos os itens de menu tiverem valor nas propriedades `icon` e `shortLabel`.
         *
         * \@default `false`
         * @param {?} collapsed
         * @return {?}
         */
        function (collapsed) {
            this._collapsed = convertToBoolean(collapsed);
            this.validateCollapseClass();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "menus", {
        get: /**
         * @return {?}
         */
        function () {
            return this._menus;
        },
        /** Lista dos itens do menu. Se o valor estiver indefinido ou inválido, será inicializado como um array vazio. */
        set: /**
         * Lista dos itens do menu. Se o valor estiver indefinido ou inválido, será inicializado como um array vazio.
         * @param {?} menus
         * @return {?}
         */
        function (menus) {
            this._menus = Array.isArray(menus) ? menus : [];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "maxLevel", {
        get: /**
         * @return {?}
         */
        function () {
            return this._maxLevel;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "filter", {
        get: /**
         * @return {?}
         */
        function () {
            return this._filter;
        },
        /**
         * @optional
         *
         * @description
         *
         * Habilita um campo para pesquisa no menu.
         * A pesquisa é realizada em todos os níveis do menu e busca apenas pelos itens que contém uma ação e/ou link definidos,
         * ou também, pode ser realizada através de um serviço definido na propriedade `p-service`.
         *
         * > O campo de pesquisa é desabilitado se o menu estiver colapsado.
         *
         * @default `false`
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Habilita um campo para pesquisa no menu.
         * A pesquisa é realizada em todos os níveis do menu e busca apenas pelos itens que contém uma ação e/ou link definidos,
         * ou também, pode ser realizada através de um serviço definido na propriedade `p-service`.
         *
         * > O campo de pesquisa é desabilitado se o menu estiver colapsado.
         *
         * \@default `false`
         * @param {?} filter
         * @return {?}
         */
        function (filter) {
            this._filter = (/** @type {?} */ (filter)) === '' ? true : convertToBoolean(filter);
            this.filteredItems = tslib_1.__spread(this._menus);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "service", {
        get: /**
         * @return {?}
         */
        function () {
            return this._service;
        },
        /**
         * @optional
         *
         * @description
         *
         * Nesta propriedade deve ser informada a URL do serviço em que será utilizado para realizar o filtro de itens do
         * menu quando realizar uma busca. Caso haja a necessidade de customização, pode ser informado um
         * serviço implementando a interface `PoMenuFilter`.
         *
         * Caso utilizada uma URL, o serviço deve retornar os dados conforme o
         * [Guia de implementação de API da Portinari](http://tdn.portinari.com/display/public/INT/Guia+de+implementacao+das+APIs+PORTINARI).
         *
         * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando o valor digitado
         * no parâmetro `search`, veja exemplo:
         *
         * > O filtro no serviço será realizado caso contenha no mínimo três caracteres no campo de busca, por exemplo `tot`.
         *
         * ```
         * <po-menu p-service="/api/v1/fnd/menu">
         * </po-menu>
         *
         * Requisição: GET /api/v1/fnd/menu?search=contas
         * ```
         *
         * > É necessário que propriedade `p-filter` esteja habilitada.
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Nesta propriedade deve ser informada a URL do serviço em que será utilizado para realizar o filtro de itens do
         * menu quando realizar uma busca. Caso haja a necessidade de customização, pode ser informado um
         * serviço implementando a interface `PoMenuFilter`.
         *
         * Caso utilizada uma URL, o serviço deve retornar os dados conforme o
         * [Guia de implementação de API da Portinari](http://tdn.portinari.com/display/public/INT/Guia+de+implementacao+das+APIs+PORTINARI).
         *
         * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando o valor digitado
         * no parâmetro `search`, veja exemplo:
         *
         * > O filtro no serviço será realizado caso contenha no mínimo três caracteres no campo de busca, por exemplo `tot`.
         *
         * ```
         * <po-menu p-service="/api/v1/fnd/menu">
         * </po-menu>
         *
         * Requisição: GET /api/v1/fnd/menu?search=contas
         * ```
         *
         * > É necessário que propriedade `p-filter` esteja habilitada.
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._service = value || undefined;
            this.configService(this.service);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "params", {
        get: /**
         * @return {?}
         */
        function () {
            return this._params;
        },
        /**
         * @optional
         *
         * @description
         *
         * Deve ser informado um objeto que deseja-se utilizar na requisição de filtro dos itens de menu.
         *
         * Caso utilizado um serviço customizado, implementando a interface `PoMenuFilter`, o valor desta propriedade
         * será passado como parâmetro, na função `getFilteredData`.
         *
         * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando os valores informados
         * nesta propriedade em conjunto com o parâmetro `search`, veja exemplo:
         *
         * ```
         * <po-menu p-service="/api/v1/fnd/menu" [p-params]="{ company: 1, user: 297767512 }">
         * </po-menu>
         *
         * Requisição: GET /api/v1/fnd/menu?search=contas&company=1&user=297767512
         * ```
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Deve ser informado um objeto que deseja-se utilizar na requisição de filtro dos itens de menu.
         *
         * Caso utilizado um serviço customizado, implementando a interface `PoMenuFilter`, o valor desta propriedade
         * será passado como parâmetro, na função `getFilteredData`.
         *
         * Quando utilizada uma URL de serviço, será realizado um *GET* na URL informada, passando os valores informados
         * nesta propriedade em conjunto com o parâmetro `search`, veja exemplo:
         *
         * ```
         * <po-menu p-service="/api/v1/fnd/menu" [p-params]="{ company: 1, user: 297767512 }">
         * </po-menu>
         *
         * Requisição: GET /api/v1/fnd/menu?search=contas&company=1&user=297767512
         * ```
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._params = value && isTypeof(value, 'object') ? value : undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "logo", {
        get: /**
         * @return {?}
         */
        function () {
            return this._logo;
        },
        /**
         * @optional
         *
         * @description
         *
         * Caminho para a logomarca, que será exibida quando o componente estiver expandido, localizada na parte superior.
         *
         * > **Importante:**
         * - Caso esta propriedade estiver indefinida ou inválida o espaço para logomarca será removido.
         * - Como boa prática, indica-se utilizar imagens com até `24px` de altura e `224px` de largura,
         * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Caminho para a logomarca, que será exibida quando o componente estiver expandido, localizada na parte superior.
         *
         * > **Importante:**
         * - Caso esta propriedade estiver indefinida ou inválida o espaço para logomarca será removido.
         * - Como boa prática, indica-se utilizar imagens com até `24px` de altura e `224px` de largura,
         * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._logo = isTypeof(value, 'string') && value.trim() ? value : undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoMenuBaseComponent.prototype, "shortLogo", {
        get: /**
         * @return {?}
         */
        function () {
            return this._shortLogo;
        },
        /**
         * @optional
         *
         * @description
         *
         * Caminho para a logomarca, que será exibida quando o componente estiver colapsado, localizada na parte superior.
         *
         * > **Importante:**
         * - Caso esta propriedade estiver indefinida ou inválida passa a assumir o valor informado na propriedade `p-logo` e na ausência desta o
         * espaço para logomarca será removido.
         * - Como boa prática, indica-se utilizar imagens com até `48px` de altura e `48px` de largura,
         * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
         * - Caso não informar um valor, esta propriedade passa a assumir o valor informado na propriedade `p-logo`.
         */
        set: /**
         * \@optional
         *
         * \@description
         *
         * Caminho para a logomarca, que será exibida quando o componente estiver colapsado, localizada na parte superior.
         *
         * > **Importante:**
         * - Caso esta propriedade estiver indefinida ou inválida passa a assumir o valor informado na propriedade `p-logo` e na ausência desta o
         * espaço para logomarca será removido.
         * - Como boa prática, indica-se utilizar imagens com até `48px` de altura e `48px` de largura,
         * caso ultrapassar esses valores a imagem será readequada no espaço disponível.
         * - Caso não informar um valor, esta propriedade passa a assumir o valor informado na propriedade `p-logo`.
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._shortLogo = isTypeof(value, 'string') && value.trim() ? value : undefined;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @private
     * @param {?} service
     * @return {?}
     */
    PoMenuBaseComponent.prototype.configService = /**
     * @private
     * @param {?} service
     * @return {?}
     */
    function (service) {
        if (typeof service === 'string' && service.trim()) {
            // service url
            this.menuService.configProperties(service);
            this.filterService = this.menuService;
        }
        else if (typeof service === 'object' && service.getFilteredData) {
            // custom service
            this.filterService = service;
        }
        else {
            this.filterService = undefined;
        }
    };
    /**
     * @protected
     * @return {?}
     */
    PoMenuBaseComponent.prototype.setMenuExtraProperties = /**
     * @protected
     * @return {?}
     */
    function () {
        var _this = this;
        this.allowIcons = !!this.menus.length;
        this.allowCollapseMenu = !!this.menus.length;
        this.menus.forEach((/**
         * @param {?} menuItem
         * @return {?}
         */
        function (menuItem) {
            _this._level = 1;
            _this.allowIcons = _this.allowIcons ? validValue(menuItem.icon) : false;
            _this.allowCollapseMenu = _this.allowCollapseMenu && _this.allowIcons ? validValue(menuItem.shortLabel) : false;
            _this.removeBadgeAlert(menuItem);
            _this.setMenuItemProperties(menuItem);
            if (menuItem.subItems) {
                _this._level++;
                _this.processSubItems(menuItem);
            }
        }));
    };
    /**
     * @protected
     * @param {?} menuItem
     * @return {?}
     */
    PoMenuBaseComponent.prototype.setMenuItemProperties = /**
     * @protected
     * @param {?} menuItem
     * @return {?}
     */
    function (menuItem) {
        menuItem['id'] = menuItem['id'] || uuid();
        menuItem['level'] = this._level;
        menuItem['type'] = this.setMenuType(menuItem);
    };
    /**
     * @protected
     * @param {?} menus
     * @return {?}
     */
    PoMenuBaseComponent.prototype.validateMenus = /**
     * @protected
     * @param {?} menus
     * @return {?}
     */
    function (menus) {
        var _this = this;
        menus.forEach((/**
         * @param {?} menu
         * @return {?}
         */
        function (menu) { return _this.validateMenu(menu); }));
    };
    /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    PoMenuBaseComponent.prototype.processSubItems = /**
     * @private
     * @param {?} menu
     * @return {?}
     */
    function (menu) {
        var _this = this;
        menu.subItems.forEach((/**
         * @param {?} menuItem
         * @param {?} index
         * @param {?} menuItems
         * @return {?}
         */
        function (menuItem, index, menuItems) {
            /** @type {?} */
            var previousItem = menuItems[index - 1];
            if (previousItem && previousItem.subItems) {
                _this._level = previousItem['level'];
            }
            if (_this._level <= _this.maxLevel) {
                _this.setMenuItemProperties(menuItem);
                if (menuItem.subItems) {
                    _this._level++;
                    _this.processSubItems(menuItem);
                }
            }
            if (!menu['badgeAlert']) {
                menu = _this.setMenuBadgeAlert(menu, menuItem);
            }
        }));
        menu.subItems = Object.assign([], menu.subItems);
    };
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    PoMenuBaseComponent.prototype.removeBadgeAlert = /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    function (menuItem) {
        var _this = this;
        if (menuItem['badgeAlert']) {
            delete menuItem['badgeAlert'];
        }
        if (menuItem.subItems) {
            menuItem.subItems.forEach((/**
             * @param {?} subItem
             * @return {?}
             */
            function (subItem) { return _this.removeBadgeAlert(subItem); }));
        }
    };
    /**
     * @private
     * @param {?} parent
     * @param {?} child
     * @return {?}
     */
    PoMenuBaseComponent.prototype.setMenuBadgeAlert = /**
     * @private
     * @param {?} parent
     * @param {?} child
     * @return {?}
     */
    function (parent, child) {
        /** @type {?} */
        var childHasSubItems = child.subItems && child.subItems.length;
        /** @type {?} */
        var childHasBadgeAlert = child['badgeAlert'];
        /** @type {?} */
        var childHasBadge = child.badge && convertToInt(child.badge.value) >= 0;
        parent['badgeAlert'] = childHasBadgeAlert || (childHasBadge && !childHasSubItems);
        return parent;
    };
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    PoMenuBaseComponent.prototype.setMenuType = /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    function (menuItem) {
        if (menuItem.subItems && menuItem.subItems.length > 0 && this._level < this.maxLevel) {
            return 'subItems';
        }
        if (!menuItem.link) {
            return 'noLink';
        }
        if (isExternalLink(menuItem.link)) {
            return 'externalLink';
        }
        return 'internalLink';
    };
    /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    PoMenuBaseComponent.prototype.validateMenu = /**
     * @private
     * @param {?} menuItem
     * @return {?}
     */
    function (menuItem) {
        var _this = this;
        if (!menuItem.label || menuItem.label.trim() === '') {
            throw new Error('O atributo PoMenuItem.label não pode ser vazio.');
        }
        else if (menuItem.subItems) {
            menuItem.subItems.forEach((/**
             * @param {?} subItem
             * @return {?}
             */
            function (subItem) {
                _this.validateMenu(subItem);
            }));
        }
    };
    PoMenuBaseComponent.propDecorators = {
        collapsed: [{ type: Input, args: ['p-collapsed',] }],
        menus: [{ type: Input, args: ['p-menus',] }],
        filter: [{ type: Input, args: ['p-filter',] }],
        service: [{ type: Input, args: ['p-service',] }],
        params: [{ type: Input, args: ['p-params',] }],
        logo: [{ type: Input, args: ['p-logo',] }],
        shortLogo: [{ type: Input, args: ['p-short-logo',] }]
    };
    return PoMenuBaseComponent;
}());
export { PoMenuBaseComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._collapsed;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._filter;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._level;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._logo;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._maxLevel;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._menus;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._params;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._service;
    /**
     * @type {?}
     * @private
     */
    PoMenuBaseComponent.prototype._shortLogo;
    /** @type {?} */
    PoMenuBaseComponent.prototype.allowIcons;
    /** @type {?} */
    PoMenuBaseComponent.prototype.allowCollapseMenu;
    /** @type {?} */
    PoMenuBaseComponent.prototype.filteredItems;
    /** @type {?} */
    PoMenuBaseComponent.prototype.filterService;
    /** @type {?} */
    PoMenuBaseComponent.prototype.literals;
    /** @type {?} */
    PoMenuBaseComponent.prototype.menuService;
    /**
     * @abstract
     * @protected
     * @return {?}
     */
    PoMenuBaseComponent.prototype.validateCollapseClass = function () { };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbWVudS1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tbWVudS9wby1tZW51LWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV0QyxPQUFPLEVBQUUsRUFBRSxJQUFJLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsQyxPQUFPLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7QUFNMUksTUFBTSxLQUFPLHFCQUFxQixHQUFHO0lBQ25DLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxpQkFBaUIsRUFBRTtJQUN2QyxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUseUJBQXlCLEVBQUU7SUFDL0MsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLHNCQUFzQixFQUFFO0NBQzdDOzs7Ozs7Ozs7O0FBVUQ7SUFnTUUsNkJBQW1CLFdBQTBCO1FBQTFCLGdCQUFXLEdBQVgsV0FBVyxDQUFlO1FBOUxyQyxlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLFlBQU8sR0FBRyxLQUFLLENBQUM7UUFHaEIsY0FBUyxHQUFHLENBQUMsQ0FBQztRQUNkLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFXWCxhQUFRLHdCQUNaLHFCQUFxQixDQUFDLGVBQWUsQ0FBQyxFQUN0QyxxQkFBcUIsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxFQUMzQztJQTJLK0MsQ0FBQztJQXZKbEQsc0JBQTBCLDBDQUFTOzs7O1FBTW5DO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLENBQUM7UUExQkQ7Ozs7Ozs7Ozs7Ozs7Ozs7O1dBaUJHOzs7Ozs7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SyxTQUFDLFdBQVc7eUJBOEJqQixLQUFLLFNBQUMsVUFBVTt1QkFvQmhCLEtBQUssU0FBQyxRQUFROzRCQXNCZCxLQUFLLFNBQUMsY0FBYzs7SUE2SHZCLDBCQUFDO0NBQUEsQUFyVEQsSUFxVEM7U0FyVHFCLG1CQUFtQjs7Ozs7O0lBRXZDLHlDQUEyQjs7Ozs7SUFDM0Isc0NBQXdCOzs7OztJQUN4QixxQ0FBZTs7Ozs7SUFDZixvQ0FBc0I7Ozs7O0lBQ3RCLHdDQUFzQjs7Ozs7SUFDdEIscUNBQW9COzs7OztJQUNwQixzQ0FBcUI7Ozs7O0lBQ3JCLHVDQUF3Qzs7Ozs7SUFDeEMseUNBQTJCOztJQUUzQix5Q0FBb0I7O0lBQ3BCLGdEQUEyQjs7SUFFM0IsNENBQWM7O0lBQ2QsNENBQTRCOztJQUU1Qix1Q0FHRTs7SUEyS1UsMENBQWlDOzs7Ozs7SUFtSDdDLHNFQUEyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IHY0IGFzIHV1aWQgfSBmcm9tICd1dWlkJztcbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgY29udmVydFRvQm9vbGVhbiwgY29udmVydFRvSW50LCBpc0V4dGVybmFsTGluaywgaXNUeXBlb2YsIHBvTG9jYWxlRGVmYXVsdCwgdmFsaWRWYWx1ZSB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBQb01lbnVGaWx0ZXIgfSBmcm9tICcuL3BvLW1lbnUtZmlsdGVyL3BvLW1lbnUtZmlsdGVyLmludGVyZmFjZSc7XG5pbXBvcnQgeyBQb01lbnVJdGVtIH0gZnJvbSAnLi9wby1tZW51LWl0ZW0uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvTWVudVNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL3BvLW1lbnUuc2VydmljZSc7XG5cbmV4cG9ydCBjb25zdCBwb01lbnVMaXRlcmFsc0RlZmF1bHQgPSB7XG4gIGVuOiB7IGl0ZW1Ob3RGb3VuZDogJ0l0ZW0gbm90IGZvdW5kLicgfSxcbiAgZXM6IHsgaXRlbU5vdEZvdW5kOiAnRWxlbWVudG8gbm8gZW5jb250cmFkby4nIH0sXG4gIHB0OiB7IGl0ZW1Ob3RGb3VuZDogJ0l0ZW0gbsOjbyBlbmNvbnRyYWRvLicgfVxufTtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBFc3RlIMOpIHVtIGNvbXBvbmVudGUgZGUgbWVudSBsYXRlcmFsIHF1ZSDDqSB1dGlsaXphZG8gcGFyYSBuYXZlZ2HDp8OjbyBuYXMgcMOhZ2luYXMgZGUgdW1hIGFwbGljYcOnw6NvLlxuICpcbiAqIE8gY29tcG9uZW50ZSBwby1tZW51IHJlY2ViZSB1bWEgbGlzdGEgZGUgb2JqZXRvcyBkbyB0aXBvIGBNZW51SXRlbWAgY29tIGFzIGluZm9ybWHDp8O1ZXMgZG9zIGl0ZW5zIGRlIG1lbnUgY29tb1xuICogdGV4dG9zLCBsaW5rcyBwYXJhIHJlZGlyZWNpb25hbWVudG8sIGHDp8O1ZXMsIGF0w6kgNCBuw612ZWlzIGRlIG1lbnUgZSDDrWNvbmVzIHBhcmEgbyBwcmltZWlybyBuw612ZWwgZGUgbWVudS5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFBvTWVudUJhc2VDb21wb25lbnQge1xuXG4gIHByaXZhdGUgX2NvbGxhcHNlZCA9IGZhbHNlO1xuICBwcml2YXRlIF9maWx0ZXIgPSBmYWxzZTtcbiAgcHJpdmF0ZSBfbGV2ZWw7XG4gIHByaXZhdGUgX2xvZ286IHN0cmluZztcbiAgcHJpdmF0ZSBfbWF4TGV2ZWwgPSA0O1xuICBwcml2YXRlIF9tZW51cyA9IFtdO1xuICBwcml2YXRlIF9wYXJhbXM6IGFueTtcbiAgcHJpdmF0ZSBfc2VydmljZTogc3RyaW5nIHwgUG9NZW51RmlsdGVyO1xuICBwcml2YXRlIF9zaG9ydExvZ286IHN0cmluZztcblxuICBhbGxvd0ljb25zOiBib29sZWFuO1xuICBhbGxvd0NvbGxhcHNlTWVudTogYm9vbGVhbjtcblxuICBmaWx0ZXJlZEl0ZW1zO1xuICBmaWx0ZXJTZXJ2aWNlOiBQb01lbnVGaWx0ZXI7XG5cbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XG4gICAgLi4ucG9NZW51TGl0ZXJhbHNEZWZhdWx0W3BvTG9jYWxlRGVmYXVsdF0sXG4gICAgLi4ucG9NZW51TGl0ZXJhbHNEZWZhdWx0W2Jyb3dzZXJMYW5ndWFnZSgpXVxuICB9O1xuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIENvbGFwc2EgKHJldHJhaSkgbyBtZW51IGUgY2FzbyByZWNlYmEgbyB2YWxvciBgZmFsc2VgIGV4cGFuZGUgbyBtZW51LlxuICAgKlxuICAgKiA+IFV0aWxpemUgZXN0YSBwcm9wcmllZGFkZSBwYXJhIGluaWNpYXIgbyBtZW51IGNvbGFwc2Fkby5cbiAgICpcbiAgICogPiBBbyB1dGlsaXphciBvcyBtw6l0b2RvcyBbYGNvbGFwc2VgXShkb2N1bWVudGF0aW9uL3BvLW1lbnUjY29sYXBzZU1ldGhvZCksIFtgZXhwYW5kYF0oZG9jdW1lbnRhdGlvbi9wby1tZW51I2V4cGFuZE1ldGhvZCkgZVxuICAgKiBbYHRvZ2dsZWBdKGRvY3VtZW50YXRpb24vcG8tbWVudSN0b2dnbGVNZXRob2QpIG8gdmFsb3IgZGVzdGEgcHJvcHJpZWRhZGUgbsOjbyDDqSBhbHRlcmFkby5cbiAgICpcbiAgICogKipJbXBvcnRhbnRlOioqXG4gICAqXG4gICAqID4gTyBtZW51IHNlcsOhIGNvbGFwc2Fkby9leHBhbmRpZG8gYXBlbmFzIHNlIHRvZG9zIG9zIGl0ZW5zIGRlIG1lbnUgdGl2ZXJlbSB2YWxvciBuYXMgcHJvcHJpZWRhZGVzIGBpY29uYCBlIGBzaG9ydExhYmVsYC5cbiAgICpcbiAgICogQGRlZmF1bHQgYGZhbHNlYFxuICAgKi9cbiAgQElucHV0KCdwLWNvbGxhcHNlZCcpIHNldCBjb2xsYXBzZWQoY29sbGFwc2VkOiBib29sZWFuKSB7XG4gICAgdGhpcy5fY29sbGFwc2VkID0gY29udmVydFRvQm9vbGVhbihjb2xsYXBzZWQpO1xuXG4gICAgdGhpcy52YWxpZGF0ZUNvbGxhcHNlQ2xhc3MoKTtcbiAgfVxuXG4gIGdldCBjb2xsYXBzZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbGxhcHNlZDtcbiAgfVxuXG4gIC8qKiBMaXN0YSBkb3MgaXRlbnMgZG8gbWVudS4gU2UgbyB2YWxvciBlc3RpdmVyIGluZGVmaW5pZG8gb3UgaW52w6FsaWRvLCBzZXLDoSBpbmljaWFsaXphZG8gY29tbyB1bSBhcnJheSB2YXppby4gKi9cbiAgQElucHV0KCdwLW1lbnVzJykgc2V0IG1lbnVzKG1lbnVzOiBBcnJheTxQb01lbnVJdGVtPikge1xuICAgIHRoaXMuX21lbnVzID0gQXJyYXkuaXNBcnJheShtZW51cykgPyBtZW51cyA6IFtdO1xuICB9XG5cbiAgZ2V0IG1lbnVzKCkge1xuICAgIHJldHVybiB0aGlzLl9tZW51cztcbiAgfVxuXG4gIGdldCBtYXhMZXZlbCgpIHtcbiAgICByZXR1cm4gdGhpcy5fbWF4TGV2ZWw7XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBIYWJpbGl0YSB1bSBjYW1wbyBwYXJhIHBlc3F1aXNhIG5vIG1lbnUuXG4gICAqIEEgcGVzcXVpc2Egw6kgcmVhbGl6YWRhIGVtIHRvZG9zIG9zIG7DrXZlaXMgZG8gbWVudSBlIGJ1c2NhIGFwZW5hcyBwZWxvcyBpdGVucyBxdWUgY29udMOpbSB1bWEgYcOnw6NvIGUvb3UgbGluayBkZWZpbmlkb3MsXG4gICAqIG91IHRhbWLDqW0sIHBvZGUgc2VyIHJlYWxpemFkYSBhdHJhdsOpcyBkZSB1bSBzZXJ2acOnbyBkZWZpbmlkbyBuYSBwcm9wcmllZGFkZSBgcC1zZXJ2aWNlYC5cbiAgICpcbiAgICogPiBPIGNhbXBvIGRlIHBlc3F1aXNhIMOpIGRlc2FiaWxpdGFkbyBzZSBvIG1lbnUgZXN0aXZlciBjb2xhcHNhZG8uXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1maWx0ZXInKSBzZXQgZmlsdGVyKGZpbHRlcjogYm9vbGVhbikge1xuICAgIHRoaXMuX2ZpbHRlciA9IDxhbnk+ZmlsdGVyID09PSAnJyA/IHRydWUgOiBjb252ZXJ0VG9Cb29sZWFuKGZpbHRlcik7XG4gICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gWy4uLnRoaXMuX21lbnVzXTtcbiAgfVxuXG4gIGdldCBmaWx0ZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ZpbHRlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE5lc3RhIHByb3ByaWVkYWRlIGRldmUgc2VyIGluZm9ybWFkYSBhIFVSTCBkbyBzZXJ2acOnbyBlbSBxdWUgc2Vyw6EgdXRpbGl6YWRvIHBhcmEgcmVhbGl6YXIgbyBmaWx0cm8gZGUgaXRlbnMgZG9cbiAgICogbWVudSBxdWFuZG8gcmVhbGl6YXIgdW1hIGJ1c2NhLiBDYXNvIGhhamEgYSBuZWNlc3NpZGFkZSBkZSBjdXN0b21pemHDp8OjbywgcG9kZSBzZXIgaW5mb3JtYWRvIHVtXG4gICAqIHNlcnZpw6dvIGltcGxlbWVudGFuZG8gYSBpbnRlcmZhY2UgYFBvTWVudUZpbHRlcmAuXG4gICAqXG4gICAqIENhc28gdXRpbGl6YWRhIHVtYSBVUkwsIG8gc2VydmnDp28gZGV2ZSByZXRvcm5hciBvcyBkYWRvcyBjb25mb3JtZSBvXG4gICAqIFtHdWlhIGRlIGltcGxlbWVudGHDp8OjbyBkZSBBUEkgZGEgUG9ydGluYXJpXShodHRwOi8vdGRuLnBvcnRpbmFyaS5jb20vZGlzcGxheS9wdWJsaWMvSU5UL0d1aWErZGUraW1wbGVtZW50YWNhbytkYXMrQVBJcytQT1JUSU5BUkkpLlxuICAgKlxuICAgKiBRdWFuZG8gdXRpbGl6YWRhIHVtYSBVUkwgZGUgc2VydmnDp28sIHNlcsOhIHJlYWxpemFkbyB1bSAqR0VUKiBuYSBVUkwgaW5mb3JtYWRhLCBwYXNzYW5kbyBvIHZhbG9yIGRpZ2l0YWRvXG4gICAqIG5vIHBhcsOibWV0cm8gYHNlYXJjaGAsIHZlamEgZXhlbXBsbzpcbiAgICpcbiAgICogPiBPIGZpbHRybyBubyBzZXJ2acOnbyBzZXLDoSByZWFsaXphZG8gY2FzbyBjb250ZW5oYSBubyBtw61uaW1vIHRyw6pzIGNhcmFjdGVyZXMgbm8gY2FtcG8gZGUgYnVzY2EsIHBvciBleGVtcGxvIGB0b3RgLlxuICAgKlxuICAgKiBgYGBcbiAgICogPHBvLW1lbnUgcC1zZXJ2aWNlPVwiL2FwaS92MS9mbmQvbWVudVwiPlxuICAgKiA8L3BvLW1lbnU+XG4gICAqXG4gICAqIFJlcXVpc2nDp8OjbzogR0VUIC9hcGkvdjEvZm5kL21lbnU/c2VhcmNoPWNvbnRhc1xuICAgKiBgYGBcbiAgICpcbiAgICogPiDDiSBuZWNlc3PDoXJpbyBxdWUgcHJvcHJpZWRhZGUgYHAtZmlsdGVyYCBlc3RlamEgaGFiaWxpdGFkYS5cbiAgICovXG4gIEBJbnB1dCgncC1zZXJ2aWNlJykgc2V0IHNlcnZpY2UodmFsdWU6IHN0cmluZyB8IFBvTWVudUZpbHRlcikge1xuICAgIHRoaXMuX3NlcnZpY2UgPSB2YWx1ZSB8fCB1bmRlZmluZWQ7XG5cbiAgICB0aGlzLmNvbmZpZ1NlcnZpY2UodGhpcy5zZXJ2aWNlKTtcbiAgfVxuXG4gIGdldCBzZXJ2aWNlKCkge1xuICAgIHJldHVybiB0aGlzLl9zZXJ2aWNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogRGV2ZSBzZXIgaW5mb3JtYWRvIHVtIG9iamV0byBxdWUgZGVzZWphLXNlIHV0aWxpemFyIG5hIHJlcXVpc2nDp8OjbyBkZSBmaWx0cm8gZG9zIGl0ZW5zIGRlIG1lbnUuXG4gICAqXG4gICAqIENhc28gdXRpbGl6YWRvIHVtIHNlcnZpw6dvIGN1c3RvbWl6YWRvLCBpbXBsZW1lbnRhbmRvIGEgaW50ZXJmYWNlIGBQb01lbnVGaWx0ZXJgLCBvIHZhbG9yIGRlc3RhIHByb3ByaWVkYWRlXG4gICAqIHNlcsOhIHBhc3NhZG8gY29tbyBwYXLDom1ldHJvLCBuYSBmdW7Dp8OjbyBgZ2V0RmlsdGVyZWREYXRhYC5cbiAgICpcbiAgICogUXVhbmRvIHV0aWxpemFkYSB1bWEgVVJMIGRlIHNlcnZpw6dvLCBzZXLDoSByZWFsaXphZG8gdW0gKkdFVCogbmEgVVJMIGluZm9ybWFkYSwgcGFzc2FuZG8gb3MgdmFsb3JlcyBpbmZvcm1hZG9zXG4gICAqIG5lc3RhIHByb3ByaWVkYWRlIGVtIGNvbmp1bnRvIGNvbSBvIHBhcsOibWV0cm8gYHNlYXJjaGAsIHZlamEgZXhlbXBsbzpcbiAgICpcbiAgICogYGBgXG4gICAqIDxwby1tZW51IHAtc2VydmljZT1cIi9hcGkvdjEvZm5kL21lbnVcIiBbcC1wYXJhbXNdPVwieyBjb21wYW55OiAxLCB1c2VyOiAyOTc3Njc1MTIgfVwiPlxuICAgKiA8L3BvLW1lbnU+XG4gICAqXG4gICAqIFJlcXVpc2nDp8OjbzogR0VUIC9hcGkvdjEvZm5kL21lbnU/c2VhcmNoPWNvbnRhcyZjb21wYW55PTEmdXNlcj0yOTc3Njc1MTJcbiAgICogYGBgXG4gICAqL1xuICBASW5wdXQoJ3AtcGFyYW1zJykgc2V0IHBhcmFtcyh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5fcGFyYW1zID0gdmFsdWUgJiYgaXNUeXBlb2YodmFsdWUsICdvYmplY3QnKSA/IHZhbHVlIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0IHBhcmFtcygpIHtcbiAgICByZXR1cm4gdGhpcy5fcGFyYW1zO1xuICB9XG5cbiAgLyoqXG4gICAqIEBvcHRpb25hbFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICpcbiAgICogQ2FtaW5obyBwYXJhIGEgbG9nb21hcmNhLCBxdWUgc2Vyw6EgZXhpYmlkYSBxdWFuZG8gbyBjb21wb25lbnRlIGVzdGl2ZXIgZXhwYW5kaWRvLCBsb2NhbGl6YWRhIG5hIHBhcnRlIHN1cGVyaW9yLlxuICAgKlxuICAgKiA+ICoqSW1wb3J0YW50ZToqKlxuICAgKiAtIENhc28gZXN0YSBwcm9wcmllZGFkZSBlc3RpdmVyIGluZGVmaW5pZGEgb3UgaW52w6FsaWRhIG8gZXNwYcOnbyBwYXJhIGxvZ29tYXJjYSBzZXLDoSByZW1vdmlkby5cbiAgICogLSBDb21vIGJvYSBwcsOhdGljYSwgaW5kaWNhLXNlIHV0aWxpemFyIGltYWdlbnMgY29tIGF0w6kgYDI0cHhgIGRlIGFsdHVyYSBlIGAyMjRweGAgZGUgbGFyZ3VyYSxcbiAgICogY2FzbyB1bHRyYXBhc3NhciBlc3NlcyB2YWxvcmVzIGEgaW1hZ2VtIHNlcsOhIHJlYWRlcXVhZGEgbm8gZXNwYcOnbyBkaXNwb27DrXZlbC5cbiAgICovXG4gIEBJbnB1dCgncC1sb2dvJykgc2V0IGxvZ28odmFsdWU6IGFueSkge1xuICAgIHRoaXMuX2xvZ28gPSBpc1R5cGVvZih2YWx1ZSwgJ3N0cmluZycpICYmIHZhbHVlLnRyaW0oKSA/IHZhbHVlIDogdW5kZWZpbmVkO1xuICB9XG5cbiAgZ2V0IGxvZ28oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xvZ287XG4gIH1cblxuICAvKipcbiAgICogQG9wdGlvbmFsXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiBDYW1pbmhvIHBhcmEgYSBsb2dvbWFyY2EsIHF1ZSBzZXLDoSBleGliaWRhIHF1YW5kbyBvIGNvbXBvbmVudGUgZXN0aXZlciBjb2xhcHNhZG8sIGxvY2FsaXphZGEgbmEgcGFydGUgc3VwZXJpb3IuXG4gICAqXG4gICAqID4gKipJbXBvcnRhbnRlOioqXG4gICAqIC0gQ2FzbyBlc3RhIHByb3ByaWVkYWRlIGVzdGl2ZXIgaW5kZWZpbmlkYSBvdSBpbnbDoWxpZGEgcGFzc2EgYSBhc3N1bWlyIG8gdmFsb3IgaW5mb3JtYWRvIG5hIHByb3ByaWVkYWRlIGBwLWxvZ29gIGUgbmEgYXVzw6puY2lhIGRlc3RhIG9cbiAgICogZXNwYcOnbyBwYXJhIGxvZ29tYXJjYSBzZXLDoSByZW1vdmlkby5cbiAgICogLSBDb21vIGJvYSBwcsOhdGljYSwgaW5kaWNhLXNlIHV0aWxpemFyIGltYWdlbnMgY29tIGF0w6kgYDQ4cHhgIGRlIGFsdHVyYSBlIGA0OHB4YCBkZSBsYXJndXJhLFxuICAgKiBjYXNvIHVsdHJhcGFzc2FyIGVzc2VzIHZhbG9yZXMgYSBpbWFnZW0gc2Vyw6EgcmVhZGVxdWFkYSBubyBlc3Bhw6dvIGRpc3BvbsOtdmVsLlxuICAgKiAtIENhc28gbsOjbyBpbmZvcm1hciB1bSB2YWxvciwgZXN0YSBwcm9wcmllZGFkZSBwYXNzYSBhIGFzc3VtaXIgbyB2YWxvciBpbmZvcm1hZG8gbmEgcHJvcHJpZWRhZGUgYHAtbG9nb2AuXG4gICAqL1xuICBASW5wdXQoJ3Atc2hvcnQtbG9nbycpIHNldCBzaG9ydExvZ28odmFsdWU6IGFueSkge1xuICAgIHRoaXMuX3Nob3J0TG9nbyA9IGlzVHlwZW9mKHZhbHVlLCAnc3RyaW5nJykgJiYgdmFsdWUudHJpbSgpID8gdmFsdWUgOiB1bmRlZmluZWQ7XG4gIH1cblxuICBnZXQgc2hvcnRMb2dvKCkge1xuICAgIHJldHVybiB0aGlzLl9zaG9ydExvZ287XG4gIH1cblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbWVudVNlcnZpY2U6IFBvTWVudVNlcnZpY2UpIHsgfVxuXG4gIHByaXZhdGUgY29uZmlnU2VydmljZShzZXJ2aWNlOiBzdHJpbmcgfCBQb01lbnVGaWx0ZXIpIHtcbiAgICBpZiAodHlwZW9mIHNlcnZpY2UgPT09ICdzdHJpbmcnICYmIHNlcnZpY2UudHJpbSgpKSB7XG4gICAgICAvLyBzZXJ2aWNlIHVybFxuICAgICAgdGhpcy5tZW51U2VydmljZS5jb25maWdQcm9wZXJ0aWVzKHNlcnZpY2UpO1xuICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlID0gdGhpcy5tZW51U2VydmljZTtcblxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHNlcnZpY2UgPT09ICdvYmplY3QnICYmIHNlcnZpY2UuZ2V0RmlsdGVyZWREYXRhKSB7XG4gICAgICAvLyBjdXN0b20gc2VydmljZVxuICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlID0gc2VydmljZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5maWx0ZXJTZXJ2aWNlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRNZW51RXh0cmFQcm9wZXJ0aWVzKCkge1xuICAgIHRoaXMuYWxsb3dJY29ucyA9ICEhdGhpcy5tZW51cy5sZW5ndGg7XG4gICAgdGhpcy5hbGxvd0NvbGxhcHNlTWVudSA9ICEhdGhpcy5tZW51cy5sZW5ndGg7XG5cbiAgICB0aGlzLm1lbnVzLmZvckVhY2gobWVudUl0ZW0gPT4ge1xuICAgICAgdGhpcy5fbGV2ZWwgPSAxO1xuICAgICAgdGhpcy5hbGxvd0ljb25zID0gdGhpcy5hbGxvd0ljb25zID8gdmFsaWRWYWx1ZShtZW51SXRlbS5pY29uKSA6IGZhbHNlO1xuICAgICAgdGhpcy5hbGxvd0NvbGxhcHNlTWVudSA9IHRoaXMuYWxsb3dDb2xsYXBzZU1lbnUgJiYgdGhpcy5hbGxvd0ljb25zID8gdmFsaWRWYWx1ZShtZW51SXRlbS5zaG9ydExhYmVsKSA6IGZhbHNlO1xuICAgICAgdGhpcy5yZW1vdmVCYWRnZUFsZXJ0KG1lbnVJdGVtKTtcbiAgICAgIHRoaXMuc2V0TWVudUl0ZW1Qcm9wZXJ0aWVzKG1lbnVJdGVtKTtcblxuICAgICAgaWYgKG1lbnVJdGVtLnN1Ykl0ZW1zKSB7XG4gICAgICAgIHRoaXMuX2xldmVsKys7XG4gICAgICAgIHRoaXMucHJvY2Vzc1N1Ykl0ZW1zKG1lbnVJdGVtKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzZXRNZW51SXRlbVByb3BlcnRpZXMobWVudUl0ZW06IFBvTWVudUl0ZW0pOiB2b2lkIHtcbiAgICBtZW51SXRlbVsnaWQnXSA9IG1lbnVJdGVtWydpZCddIHx8IHV1aWQoKTtcbiAgICBtZW51SXRlbVsnbGV2ZWwnXSA9IHRoaXMuX2xldmVsO1xuICAgIG1lbnVJdGVtWyd0eXBlJ10gPSB0aGlzLnNldE1lbnVUeXBlKG1lbnVJdGVtKTtcbiAgfVxuXG4gIHByb3RlY3RlZCB2YWxpZGF0ZU1lbnVzKG1lbnVzKTogdm9pZCB7XG4gICAgbWVudXMuZm9yRWFjaChtZW51ID0+IHRoaXMudmFsaWRhdGVNZW51KG1lbnUpKTtcbiAgfVxuXG4gIHByaXZhdGUgcHJvY2Vzc1N1Ykl0ZW1zKG1lbnUpIHtcbiAgICBtZW51LnN1Ykl0ZW1zLmZvckVhY2goKG1lbnVJdGVtLCBpbmRleCwgbWVudUl0ZW1zKSA9PiB7XG5cbiAgICAgIGNvbnN0IHByZXZpb3VzSXRlbSA9IG1lbnVJdGVtc1tpbmRleCAtIDFdO1xuICAgICAgaWYgKHByZXZpb3VzSXRlbSAmJiBwcmV2aW91c0l0ZW0uc3ViSXRlbXMpIHtcbiAgICAgICAgdGhpcy5fbGV2ZWwgPSBwcmV2aW91c0l0ZW1bJ2xldmVsJ107XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9sZXZlbCA8PSB0aGlzLm1heExldmVsKSB7XG4gICAgICAgIHRoaXMuc2V0TWVudUl0ZW1Qcm9wZXJ0aWVzKG1lbnVJdGVtKTtcblxuICAgICAgICBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcbiAgICAgICAgICB0aGlzLl9sZXZlbCsrO1xuICAgICAgICAgIHRoaXMucHJvY2Vzc1N1Ykl0ZW1zKG1lbnVJdGVtKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIW1lbnVbJ2JhZGdlQWxlcnQnXSkge1xuICAgICAgICBtZW51ID0gdGhpcy5zZXRNZW51QmFkZ2VBbGVydChtZW51LCBtZW51SXRlbSk7XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIG1lbnUuc3ViSXRlbXMgPSBPYmplY3QuYXNzaWduKFtdLCBtZW51LnN1Ykl0ZW1zKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlQmFkZ2VBbGVydChtZW51SXRlbTogUG9NZW51SXRlbSk6IHZvaWQge1xuXG4gICAgaWYgKG1lbnVJdGVtWydiYWRnZUFsZXJ0J10pIHtcbiAgICAgIGRlbGV0ZSBtZW51SXRlbVsnYmFkZ2VBbGVydCddO1xuICAgIH1cblxuICAgIGlmIChtZW51SXRlbS5zdWJJdGVtcykge1xuICAgICAgbWVudUl0ZW0uc3ViSXRlbXMuZm9yRWFjaChzdWJJdGVtID0+IHRoaXMucmVtb3ZlQmFkZ2VBbGVydChzdWJJdGVtKSk7XG4gICAgfVxuXG4gIH1cblxuICBwcml2YXRlIHNldE1lbnVCYWRnZUFsZXJ0KHBhcmVudDogUG9NZW51SXRlbSwgY2hpbGQ6IFBvTWVudUl0ZW0pOiBQb01lbnVJdGVtIHtcbiAgICBjb25zdCBjaGlsZEhhc1N1Ykl0ZW1zID0gY2hpbGQuc3ViSXRlbXMgJiYgY2hpbGQuc3ViSXRlbXMubGVuZ3RoO1xuICAgIGNvbnN0IGNoaWxkSGFzQmFkZ2VBbGVydCA9IGNoaWxkWydiYWRnZUFsZXJ0J107XG4gICAgY29uc3QgY2hpbGRIYXNCYWRnZSA9IGNoaWxkLmJhZGdlICYmIGNvbnZlcnRUb0ludChjaGlsZC5iYWRnZS52YWx1ZSkgPj0gMDtcblxuICAgIHBhcmVudFsnYmFkZ2VBbGVydCddID0gY2hpbGRIYXNCYWRnZUFsZXJ0IHx8IChjaGlsZEhhc0JhZGdlICYmICFjaGlsZEhhc1N1Ykl0ZW1zKTtcblxuICAgIHJldHVybiBwYXJlbnQ7XG4gIH1cblxuICBwcml2YXRlIHNldE1lbnVUeXBlKG1lbnVJdGVtOiBQb01lbnVJdGVtKTogc3RyaW5nIHtcbiAgICBpZiAobWVudUl0ZW0uc3ViSXRlbXMgJiYgbWVudUl0ZW0uc3ViSXRlbXMubGVuZ3RoID4gMCAmJiB0aGlzLl9sZXZlbCA8IHRoaXMubWF4TGV2ZWwpIHtcbiAgICAgIHJldHVybiAnc3ViSXRlbXMnO1xuICAgIH1cbiAgICBpZiAoIW1lbnVJdGVtLmxpbmspIHtcbiAgICAgIHJldHVybiAnbm9MaW5rJztcbiAgICB9XG4gICAgaWYgKGlzRXh0ZXJuYWxMaW5rKG1lbnVJdGVtLmxpbmspKSB7XG4gICAgICByZXR1cm4gJ2V4dGVybmFsTGluayc7XG4gICAgfVxuICAgIHJldHVybiAnaW50ZXJuYWxMaW5rJztcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVNZW51KG1lbnVJdGVtOiBQb01lbnVJdGVtKTogdm9pZCB7XG4gICAgaWYgKCFtZW51SXRlbS5sYWJlbCB8fCBtZW51SXRlbS5sYWJlbC50cmltKCkgPT09ICcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ08gYXRyaWJ1dG8gUG9NZW51SXRlbS5sYWJlbCBuw6NvIHBvZGUgc2VyIHZhemlvLicpO1xuICAgIH0gZWxzZSBpZiAobWVudUl0ZW0uc3ViSXRlbXMpIHtcbiAgICAgIG1lbnVJdGVtLnN1Ykl0ZW1zLmZvckVhY2goc3ViSXRlbSA9PiB7XG4gICAgICAgIHRoaXMudmFsaWRhdGVNZW51KHN1Ykl0ZW0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIGFic3RyYWN0IHZhbGlkYXRlQ29sbGFwc2VDbGFzcygpO1xuXG59XG4iXX0=