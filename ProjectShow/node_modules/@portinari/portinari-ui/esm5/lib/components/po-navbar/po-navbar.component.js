/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ChangeDetectorRef, Component, ElementRef, Renderer2, ViewChild } from '@angular/core';
import { animate, AnimationBuilder, keyframes, style } from '@angular/animations';
import { PoNavbarBaseComponent } from './po-navbar-base.component';
import { PoNavbarItemsComponent } from './po-navbar-items/po-navbar-items.component';
/** @type {?} */
var poNavbarNavigationWidth = 88;
/** @type {?} */
var poNavbarMenuMedia = 768;
/** @type {?} */
var poNavbarMatchMedia = "(max-width: " + poNavbarMenuMedia + "px)";
/** @type {?} */
var poNavbarTiming = '250ms ease';
/**
 * \@docsExtends PoNavbarBaseComponent
 */
var PoNavbarComponent = /** @class */ (function (_super) {
    tslib_1.__extends(PoNavbarComponent, _super);
    function PoNavbarComponent(renderer, builder, changeDetector) {
        var _this = _super.call(this) || this;
        _this.renderer = renderer;
        _this.builder = builder;
        _this.changeDetector = changeDetector;
        _this.showItemsNavigation = false;
        _this.offset = 0;
        _this.onMediaQueryChange = (/**
         * @param {?} changed
         * @return {?}
         */
        function (changed) {
            _this.changeNavbarMenuItems(changed.matches, _this.menuItems, _this.items, _this.literals.navbarLinks);
        });
        _this.windowResizeListener = _this.renderer.listen(window, 'resize', _this.displayItemsNavigation.bind(_this));
        return _this;
    }
    Object.defineProperty(PoNavbarComponent.prototype, "navbarItemNavigationDisableLeft", {
        get: /**
         * @return {?}
         */
        function () {
            return this.offset === 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoNavbarComponent.prototype, "navbarItemNavigationDisableRight", {
        get: /**
         * @return {?}
         */
        function () {
            return this.disableRight && this.offset !== 0;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    PoNavbarComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.displayItemsNavigation();
        if (this.menu) {
            this.initNavbarMenu();
        }
    };
    /**
     * @return {?}
     */
    PoNavbarComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.mediaQuery) {
            this.mediaQuery.removeListener(this.onMediaQueryChange);
        }
    };
    /**
     * @param {?} orientation
     * @return {?}
     */
    PoNavbarComponent.prototype.navigateItems = /**
     * @param {?} orientation
     * @return {?}
     */
    function (orientation) {
        orientation === 'left' ? this.navigateLeft() : this.navigateRight();
        this.animate(this.offset);
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.allNavbarItemsWidth = /**
     * @private
     * @return {?}
     */
    function () {
        return this.navbarItems.allNavbarItems.reduce((/**
         * @param {?} previous
         * @param {?} current
         * @return {?}
         */
        function (previous, current) { return previous + current.nativeElement.offsetWidth; }), 0);
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    PoNavbarComponent.prototype.animate = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        /** @type {?} */
        var animation = this.buildTransitionAnimation(offset);
        this.player = animation.create(this.navbarItems.navbarItemsContainer.nativeElement);
        this.player.play();
    };
    /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    PoNavbarComponent.prototype.buildTransitionAnimation = /**
     * @private
     * @param {?} offset
     * @return {?}
     */
    function (offset) {
        return this.builder.build([
            animate(poNavbarTiming, keyframes([style({ transform: "translateX(" + -offset + "px)" })]))
        ]);
    };
    /**
     * @private
     * @param {?} isCollapsedMedia
     * @param {?} menuItems
     * @param {?} navbarItems
     * @param {?} label
     * @return {?}
     */
    PoNavbarComponent.prototype.changeNavbarMenuItems = /**
     * @private
     * @param {?} isCollapsedMedia
     * @param {?} menuItems
     * @param {?} navbarItems
     * @param {?} label
     * @return {?}
     */
    function (isCollapsedMedia, menuItems, navbarItems, label) {
        if (isCollapsedMedia) {
            /** @type {?} */
            var subItems = [{ label: label, subItems: navbarItems }];
            this.menu.menus = tslib_1.__spread(subItems, menuItems);
        }
        else {
            this.menu.menus = menuItems;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.calculateLeftNavigation = /**
     * @private
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var calculatedOffset;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        function (navbarItem) {
            /** @type {?} */
            var navbarItemOffset = navbarItem.nativeElement.offsetLeft;
            /** @type {?} */
            var navbarItemWidth = navbarItem.nativeElement.offsetWidth;
            if (navbarItemOffset >= _this.offset) {
                calculatedOffset = navbarItemOffset - (_this.navbarItemsWidth() - navbarItemWidth);
                return true;
            }
        }));
        return calculatedOffset;
    };
    /**
     * @private
     * @param {?} itemBreakPoint
     * @return {?}
     */
    PoNavbarComponent.prototype.calculateRightNavigation = /**
     * @private
     * @param {?} itemBreakPoint
     * @return {?}
     */
    function (itemBreakPoint) {
        /** @type {?} */
        var calculatedOffset;
        this.navbarItems.allNavbarItems.some((/**
         * @param {?} navbarItem
         * @return {?}
         */
        function (navbarItem) {
            /** @type {?} */
            var offsetLeft = navbarItem.nativeElement.offsetLeft;
            /** @type {?} */
            var finalPosition = navbarItem.nativeElement.offsetWidth + offsetLeft;
            if (itemBreakPoint < finalPosition) {
                calculatedOffset = offsetLeft;
                return true;
            }
        }));
        return calculatedOffset;
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.displayItemsNavigation = /**
     * @private
     * @return {?}
     */
    function () {
        this.showItemsNavigation = this.navbarItemsWidth() < this.allNavbarItemsWidth() + poNavbarNavigationWidth;
        this.changeDetector.detectChanges();
        if (this.offset !== 0) {
            this.setOffsetToZero();
            this.animate(this.offset);
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.initNavbarMenu = /**
     * @private
     * @return {?}
     */
    function () {
        this.mediaQuery = window.matchMedia(poNavbarMatchMedia);
        this.menuItems = this.menu.menus;
        if (window.innerWidth < poNavbarMenuMedia) {
            this.changeNavbarMenuItems(true, this.menuItems, this.items, this.literals.navbarLinks);
        }
        this.validateMenuLogo();
        this.mediaQuery.addListener(this.onMediaQueryChange);
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.navbarItemsWidth = /**
     * @private
     * @return {?}
     */
    function () {
        return this.navbarItemsElement.nativeElement.offsetWidth;
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.navigateLeft = /**
     * @private
     * @return {?}
     */
    function () {
        this.disableRight = false;
        this.offset = this.calculateLeftNavigation();
        if (this.offset < 0) {
            this.setOffsetToZero();
        }
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.navigateRight = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var maxAllowedOffset = this.allNavbarItemsWidth() - this.navbarItemsWidth();
        /** @type {?} */
        var itemBreakPoint = this.offset + this.navbarItemsWidth();
        this.offset = this.calculateRightNavigation(itemBreakPoint);
        this.validateMaxOffset(maxAllowedOffset);
    };
    /**
     * @private
     * @return {?}
     */
    PoNavbarComponent.prototype.setOffsetToZero = /**
     * @private
     * @return {?}
     */
    function () {
        this.offset = 0;
    };
    /**
     * @private
     * @param {?} maxAllowedOffset
     * @return {?}
     */
    PoNavbarComponent.prototype.validateMaxOffset = /**
     * @private
     * @param {?} maxAllowedOffset
     * @return {?}
     */
    function (maxAllowedOffset) {
        if (this.offset >= maxAllowedOffset) {
            this.offset = maxAllowedOffset;
            this.disableRight = true;
        }
    };
    /**
     * @protected
     * @return {?}
     */
    PoNavbarComponent.prototype.validateMenuLogo = /**
     * @protected
     * @return {?}
     */
    function () {
        if (this.menu.logo && this.logo) {
            this.menu.logo = undefined;
            this.menu.changeDetector.detectChanges();
        }
    };
    PoNavbarComponent.decorators = [
        { type: Component, args: [{
                    selector: 'po-navbar',
                    template: "<header class=\"po-navbar\"\n  [ngClass]=\"{'po-navbar-shadow' : shadow}\">\n\n  <po-navbar-logo\n    class=\"po-navbar-logo\"\n    [ngClass]=\"{'po-navbar-logo-menu' : !!menu, 'po-navbar-no-logo' : !logo }\"\n    [p-logo]=\"logo\">\n  </po-navbar-logo>\n\n  <po-navbar-items\n    class=\"po-navbar-items\"\n    [p-items]=\"items\">\n  </po-navbar-items>\n\n  <po-navbar-item-navigation *ngIf=\"showItemsNavigation\"\n    class=\"po-navbar-item-navigation\"\n    [p-disable-left]=\"navbarItemNavigationDisableLeft\"\n    [p-disable-right]=\"navbarItemNavigationDisableRight\"\n    (p-click)=\"navigateItems($event)\">\n  </po-navbar-item-navigation>\n\n  <po-navbar-actions\n    class=\"po-navbar-actions\"\n    [p-icon-actions]=\"iconActions\">\n  </po-navbar-actions>\n\n</header>\n\n<po-menu *ngIf=\"!menu\"\n  [p-menus]=\"items\">\n</po-menu>"
                }] }
    ];
    /** @nocollapse */
    PoNavbarComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: AnimationBuilder },
        { type: ChangeDetectorRef }
    ]; };
    PoNavbarComponent.propDecorators = {
        navbarItemsElement: [{ type: ViewChild, args: [PoNavbarItemsComponent, { read: ElementRef, static: true },] }],
        navbarItems: [{ type: ViewChild, args: [PoNavbarItemsComponent, { static: true },] }]
    };
    return PoNavbarComponent;
}(PoNavbarBaseComponent));
export { PoNavbarComponent };
if (false) {
    /** @type {?} */
    PoNavbarComponent.prototype.disableRight;
    /** @type {?} */
    PoNavbarComponent.prototype.showItemsNavigation;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.mediaQuery;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.offset;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.player;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.menuItems;
    /**
     * @type {?}
     * @protected
     */
    PoNavbarComponent.prototype.windowResizeListener;
    /** @type {?} */
    PoNavbarComponent.prototype.navbarItemsElement;
    /** @type {?} */
    PoNavbarComponent.prototype.navbarItems;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.onMediaQueryChange;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.builder;
    /**
     * @type {?}
     * @private
     */
    PoNavbarComponent.prototype.changeDetector;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbmF2YmFyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwb3J0aW5hcmkvcG9ydGluYXJpLXVpLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tbmF2YmFyL3BvLW5hdmJhci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQWlCLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQWEsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN6SCxPQUFPLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFxQyxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFHckgsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFbkUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sNkNBQTZDLENBQUM7O0lBRS9FLHVCQUF1QixHQUFHLEVBQUU7O0lBQzVCLGlCQUFpQixHQUFHLEdBQUc7O0lBQ3ZCLGtCQUFrQixHQUFHLGlCQUFlLGlCQUFpQixRQUFLOztJQUMxRCxjQUFjLEdBQUcsWUFBWTs7OztBQUtuQztJQUl1Qyw2Q0FBcUI7SUF3QjFELDJCQUFvQixRQUFtQixFQUFVLE9BQXlCLEVBQVUsY0FBaUM7UUFBckgsWUFDRSxpQkFBTyxTQUVSO1FBSG1CLGNBQVEsR0FBUixRQUFRLENBQVc7UUFBVSxhQUFPLEdBQVAsT0FBTyxDQUFrQjtRQUFVLG9CQUFjLEdBQWQsY0FBYyxDQUFtQjtRQXJCckgseUJBQW1CLEdBQVksS0FBSyxDQUFDO1FBRzdCLFlBQU0sR0FBVyxDQUFDLENBQUM7UUEwSm5CLHdCQUFrQjs7OztRQUFHLFVBQUEsT0FBTztZQUNsQyxLQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxLQUFJLENBQUMsU0FBUyxFQUFFLEtBQUksQ0FBQyxLQUFLLEVBQUUsS0FBSSxDQUFDLFFBQVEsQ0FBQyxXQUFX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eUNBQXNCOztJQUN0QixnREFBcUM7Ozs7O0lBRXJDLHVDQUF3Qjs7Ozs7SUFDeEIsbUNBQTJCOzs7OztJQUMzQixtQ0FBZ0M7Ozs7O0lBQ2hDLHNDQUFxQzs7Ozs7SUFFckMsaURBQTJDOztJQVUzQywrQ0FBc0c7O0lBRXRHLHdDQUF5Rjs7Ozs7SUEwSXpGLCtDQUVDOzs7OztJQTFJVyxxQ0FBMkI7Ozs7O0lBQUUsb0NBQWlDOzs7OztJQUFFLDJDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIE9uRGVzdHJveSwgUmVuZGVyZXIyLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGFuaW1hdGUsIEFuaW1hdGlvbkJ1aWxkZXIsIEFuaW1hdGlvbkZhY3RvcnksIEFuaW1hdGlvblBsYXllciwga2V5ZnJhbWVzLCBzdHlsZSB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuXG5pbXBvcnQgeyBQb01lbnVJdGVtIH0gZnJvbSAnLi4vcG8tbWVudSc7XG5pbXBvcnQgeyBQb05hdmJhckJhc2VDb21wb25lbnQgfSBmcm9tICcuL3BvLW5hdmJhci1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb05hdmJhckl0ZW0gfSBmcm9tICcuL2ludGVyZmFjZXMvcG8tbmF2YmFyLWl0ZW0uaW50ZXJmYWNlJztcbmltcG9ydCB7IFBvTmF2YmFySXRlbXNDb21wb25lbnQgfSBmcm9tICcuL3BvLW5hdmJhci1pdGVtcy9wby1uYXZiYXItaXRlbXMuY29tcG9uZW50JztcblxuY29uc3QgcG9OYXZiYXJOYXZpZ2F0aW9uV2lkdGggPSA4ODtcbmNvbnN0IHBvTmF2YmFyTWVudU1lZGlhID0gNzY4O1xuY29uc3QgcG9OYXZiYXJNYXRjaE1lZGlhID0gYChtYXgtd2lkdGg6ICR7cG9OYXZiYXJNZW51TWVkaWF9cHgpYDtcbmNvbnN0IHBvTmF2YmFyVGltaW5nID0gJzI1MG1zIGVhc2UnO1xuXG4vKipcbiAqIEBkb2NzRXh0ZW5kcyBQb05hdmJhckJhc2VDb21wb25lbnRcbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tbmF2YmFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3BvLW5hdmJhci5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUG9OYXZiYXJDb21wb25lbnQgZXh0ZW5kcyBQb05hdmJhckJhc2VDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xuXG4gIGRpc2FibGVSaWdodDogYm9vbGVhbjtcbiAgc2hvd0l0ZW1zTmF2aWdhdGlvbjogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHByaXZhdGUgbWVkaWFRdWVyeTogYW55O1xuICBwcml2YXRlIG9mZnNldDogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBwbGF5ZXI6IEFuaW1hdGlvblBsYXllcjtcbiAgcHJpdmF0ZSBtZW51SXRlbXM6IEFycmF5PFBvTWVudUl0ZW0+O1xuXG4gIHByb3RlY3RlZCB3aW5kb3dSZXNpemVMaXN0ZW5lcjogKCkgPT4gdm9pZDtcblxuICBnZXQgbmF2YmFySXRlbU5hdmlnYXRpb25EaXNhYmxlTGVmdCgpIHtcbiAgICByZXR1cm4gdGhpcy5vZmZzZXQgPT09IDA7XG4gIH1cblxuICBnZXQgbmF2YmFySXRlbU5hdmlnYXRpb25EaXNhYmxlUmlnaHQoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGlzYWJsZVJpZ2h0ICYmIHRoaXMub2Zmc2V0ICE9PSAwO1xuICB9XG5cbiAgQFZpZXdDaGlsZChQb05hdmJhckl0ZW1zQ29tcG9uZW50LCB7IHJlYWQ6IEVsZW1lbnRSZWYsIHN0YXRpYzogdHJ1ZSB9KSBuYXZiYXJJdGVtc0VsZW1lbnQ6IEVsZW1lbnRSZWY7XG5cbiAgQFZpZXdDaGlsZChQb05hdmJhckl0ZW1zQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSBuYXZiYXJJdGVtczogUG9OYXZiYXJJdGVtc0NvbXBvbmVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgYnVpbGRlcjogQW5pbWF0aW9uQnVpbGRlciwgcHJpdmF0ZSBjaGFuZ2VEZXRlY3RvcjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMud2luZG93UmVzaXplTGlzdGVuZXIgPSB0aGlzLnJlbmRlcmVyLmxpc3Rlbih3aW5kb3csICdyZXNpemUnLCB0aGlzLmRpc3BsYXlJdGVtc05hdmlnYXRpb24uYmluZCh0aGlzKSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5kaXNwbGF5SXRlbXNOYXZpZ2F0aW9uKCk7XG5cbiAgICBpZiAodGhpcy5tZW51KSB7XG4gICAgICB0aGlzLmluaXROYXZiYXJNZW51KCk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMubWVkaWFRdWVyeSkge1xuICAgICAgdGhpcy5tZWRpYVF1ZXJ5LnJlbW92ZUxpc3RlbmVyKHRoaXMub25NZWRpYVF1ZXJ5Q2hhbmdlKTtcbiAgICB9XG4gIH1cblxuICBuYXZpZ2F0ZUl0ZW1zKG9yaWVudGF0aW9uOiBzdHJpbmcpIHtcbiAgICBvcmllbnRhdGlvbiA9PT0gJ2xlZnQnID8gdGhpcy5uYXZpZ2F0ZUxlZnQoKSA6IHRoaXMubmF2aWdhdGVSaWdodCgpO1xuXG4gICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgfVxuXG4gIHByaXZhdGUgYWxsTmF2YmFySXRlbXNXaWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5uYXZiYXJJdGVtcy5hbGxOYXZiYXJJdGVtcy5yZWR1Y2UoKHByZXZpb3VzOiBhbnksIGN1cnJlbnQ6IGFueSkgPT4gcHJldmlvdXMgKyBjdXJyZW50Lm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGgsIDApO1xuICB9XG5cbiAgcHJpdmF0ZSBhbmltYXRlKG9mZnNldDogbnVtYmVyKSB7XG4gICAgY29uc3QgYW5pbWF0aW9uOiBBbmltYXRpb25GYWN0b3J5ID0gdGhpcy5idWlsZFRyYW5zaXRpb25BbmltYXRpb24ob2Zmc2V0KTtcblxuICAgIHRoaXMucGxheWVyID0gYW5pbWF0aW9uLmNyZWF0ZSh0aGlzLm5hdmJhckl0ZW1zLm5hdmJhckl0ZW1zQ29udGFpbmVyLm5hdGl2ZUVsZW1lbnQpO1xuICAgIHRoaXMucGxheWVyLnBsYXkoKTtcbiAgfVxuXG4gIHByaXZhdGUgYnVpbGRUcmFuc2l0aW9uQW5pbWF0aW9uKG9mZnNldDogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXMuYnVpbGRlci5idWlsZChbXG4gICAgICBhbmltYXRlKFxuICAgICAgICBwb05hdmJhclRpbWluZyxcbiAgICAgICAga2V5ZnJhbWVzKFtzdHlsZSh7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVgoJHstb2Zmc2V0fXB4KWAgfSldKVxuICAgICAgKVxuICAgIF0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGFuZ2VOYXZiYXJNZW51SXRlbXMoaXNDb2xsYXBzZWRNZWRpYTogYW55LCBtZW51SXRlbXM6IEFycmF5PFBvTWVudUl0ZW0+LCBuYXZiYXJJdGVtczogQXJyYXk8UG9OYXZiYXJJdGVtPiwgbGFiZWw6IHN0cmluZykge1xuXG4gICAgaWYgKGlzQ29sbGFwc2VkTWVkaWEpIHtcbiAgICAgIGNvbnN0IHN1Ykl0ZW1zID0gW3sgbGFiZWwsIHN1Ykl0ZW1zOiBuYXZiYXJJdGVtcyB9XTtcbiAgICAgIHRoaXMubWVudS5tZW51cyA9IFsuLi5zdWJJdGVtcywgLi4ubWVudUl0ZW1zXTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tZW51Lm1lbnVzID0gbWVudUl0ZW1zO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlTGVmdE5hdmlnYXRpb24oKSB7XG5cbiAgICBsZXQgY2FsY3VsYXRlZE9mZnNldDogbnVtYmVyO1xuXG4gICAgdGhpcy5uYXZiYXJJdGVtcy5hbGxOYXZiYXJJdGVtcy5zb21lKG5hdmJhckl0ZW0gPT4ge1xuICAgICAgY29uc3QgbmF2YmFySXRlbU9mZnNldCA9IG5hdmJhckl0ZW0ubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuICAgICAgY29uc3QgbmF2YmFySXRlbVdpZHRoID0gbmF2YmFySXRlbS5uYXRpdmVFbGVtZW50Lm9mZnNldFdpZHRoO1xuXG4gICAgICBpZiAobmF2YmFySXRlbU9mZnNldCA+PSB0aGlzLm9mZnNldCkge1xuICAgICAgICBjYWxjdWxhdGVkT2Zmc2V0ID0gbmF2YmFySXRlbU9mZnNldCAtICh0aGlzLm5hdmJhckl0ZW1zV2lkdGgoKSAtIG5hdmJhckl0ZW1XaWR0aCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjYWxjdWxhdGVkT2Zmc2V0O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSaWdodE5hdmlnYXRpb24oaXRlbUJyZWFrUG9pbnQ6IG51bWJlcikge1xuXG4gICAgbGV0IGNhbGN1bGF0ZWRPZmZzZXQ6IG51bWJlcjtcblxuICAgIHRoaXMubmF2YmFySXRlbXMuYWxsTmF2YmFySXRlbXMuc29tZShuYXZiYXJJdGVtID0+IHtcbiAgICAgIGNvbnN0IG9mZnNldExlZnQgPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0TGVmdDtcbiAgICAgIGNvbnN0IGZpbmFsUG9zaXRpb24gPSBuYXZiYXJJdGVtLm5hdGl2ZUVsZW1lbnQub2Zmc2V0V2lkdGggKyBvZmZzZXRMZWZ0O1xuXG4gICAgICBpZiAoaXRlbUJyZWFrUG9pbnQgPCBmaW5hbFBvc2l0aW9uKSB7XG4gICAgICAgIGNhbGN1bGF0ZWRPZmZzZXQgPSBvZmZzZXRMZWZ0O1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIHJldHVybiBjYWxjdWxhdGVkT2Zmc2V0O1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNwbGF5SXRlbXNOYXZpZ2F0aW9uKCkge1xuICAgIHRoaXMuc2hvd0l0ZW1zTmF2aWdhdGlvbiA9IHRoaXMubmF2YmFySXRlbXNXaWR0aCgpIDwgdGhpcy5hbGxOYXZiYXJJdGVtc1dpZHRoKCkgKyBwb05hdmJhck5hdmlnYXRpb25XaWR0aDtcblxuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuXG4gICAgaWYgKHRoaXMub2Zmc2V0ICE9PSAwKSB7XG4gICAgICB0aGlzLnNldE9mZnNldFRvWmVybygpO1xuICAgICAgdGhpcy5hbmltYXRlKHRoaXMub2Zmc2V0KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluaXROYXZiYXJNZW51KCkge1xuICAgIHRoaXMubWVkaWFRdWVyeSA9IHdpbmRvdy5tYXRjaE1lZGlhKHBvTmF2YmFyTWF0Y2hNZWRpYSk7XG4gICAgdGhpcy5tZW51SXRlbXMgPSB0aGlzLm1lbnUubWVudXM7XG5cbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPCBwb05hdmJhck1lbnVNZWRpYSkge1xuICAgICAgdGhpcy5jaGFuZ2VOYXZiYXJNZW51SXRlbXModHJ1ZSwgdGhpcy5tZW51SXRlbXMsIHRoaXMuaXRlbXMsIHRoaXMubGl0ZXJhbHMubmF2YmFyTGlua3MpO1xuICAgIH1cblxuICAgIHRoaXMudmFsaWRhdGVNZW51TG9nbygpO1xuXG4gICAgdGhpcy5tZWRpYVF1ZXJ5LmFkZExpc3RlbmVyKHRoaXMub25NZWRpYVF1ZXJ5Q2hhbmdlKTtcbiAgfVxuXG4gIHByaXZhdGUgbmF2YmFySXRlbXNXaWR0aCgpIHtcbiAgICByZXR1cm4gdGhpcy5uYXZiYXJJdGVtc0VsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgfVxuXG4gIHByaXZhdGUgbmF2aWdhdGVMZWZ0KCkge1xuICAgIHRoaXMuZGlzYWJsZVJpZ2h0ID0gZmFsc2U7XG5cbiAgICB0aGlzLm9mZnNldCA9IHRoaXMuY2FsY3VsYXRlTGVmdE5hdmlnYXRpb24oKTtcblxuICAgIGlmICh0aGlzLm9mZnNldCA8IDApIHtcbiAgICAgIHRoaXMuc2V0T2Zmc2V0VG9aZXJvKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBuYXZpZ2F0ZVJpZ2h0KCkge1xuXG4gICAgY29uc3QgbWF4QWxsb3dlZE9mZnNldCA9IHRoaXMuYWxsTmF2YmFySXRlbXNXaWR0aCgpIC0gdGhpcy5uYXZiYXJJdGVtc1dpZHRoKCk7XG4gICAgY29uc3QgaXRlbUJyZWFrUG9pbnQgPSB0aGlzLm9mZnNldCArIHRoaXMubmF2YmFySXRlbXNXaWR0aCgpO1xuXG4gICAgdGhpcy5vZmZzZXQgPSB0aGlzLmNhbGN1bGF0ZVJpZ2h0TmF2aWdhdGlvbihpdGVtQnJlYWtQb2ludCk7XG5cbiAgICB0aGlzLnZhbGlkYXRlTWF4T2Zmc2V0KG1heEFsbG93ZWRPZmZzZXQpO1xuICB9XG5cbiAgcHJpdmF0ZSBvbk1lZGlhUXVlcnlDaGFuZ2UgPSBjaGFuZ2VkID0+IHtcbiAgICB0aGlzLmNoYW5nZU5hdmJhck1lbnVJdGVtcyhjaGFuZ2VkLm1hdGNoZXMsIHRoaXMubWVudUl0ZW1zLCB0aGlzLml0ZW1zLCB0aGlzLmxpdGVyYWxzLm5hdmJhckxpbmtzKTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0T2Zmc2V0VG9aZXJvKCkge1xuICAgIHRoaXMub2Zmc2V0ID0gMDtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVNYXhPZmZzZXQobWF4QWxsb3dlZE9mZnNldDogbnVtYmVyKSB7XG4gICAgaWYgKHRoaXMub2Zmc2V0ID49IG1heEFsbG93ZWRPZmZzZXQpIHtcbiAgICAgIHRoaXMub2Zmc2V0ID0gbWF4QWxsb3dlZE9mZnNldDtcbiAgICAgIHRoaXMuZGlzYWJsZVJpZ2h0ID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgdmFsaWRhdGVNZW51TG9nbygpIHtcbiAgICBpZiAodGhpcy5tZW51LmxvZ28gJiYgdGhpcy5sb2dvKSB7XG4gICAgICB0aGlzLm1lbnUubG9nbyA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMubWVudS5jaGFuZ2VEZXRlY3Rvci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==